(function(){cityWorldClass=function(){this.allTop;this.movieclip1;this.movieclip2;this.islock=true;this.e=null;this.touchObj=null};cityWorldClass.prototype={init:function(){this.lock();var B=$("#scroller");B.html($.template("cityworld_tmpl"));this.e=$("#cityworld_page");if(player.info.weather==3){this.e.addClass("newyear")}if(player.info.ongeneral==1){this.e.find("#muster_building").children(".popo").show()}if(player.info.level>=11){this.e.find("#practice_building").addClass("show")}if(player.info.level>=26&&player.info.level<170){this.e.find("#mine_building").addClass("show");this.e.find("#mine_building.newmine").hide();if(player.info.onmine==1){this.e.find("#mine_building").children(".popo").show()}}else{if(player.info.level>=170){this.e.find("#mine_building").hide();this.e.find("#mine_building.newmine").show();this.e.find("#mine_building.newmine").addClass("show");if(player.info.onmine==1){this.e.find("#mine_building.newmine").children(".popo").show()}}else{this.e.find("#mine_building.newmine").hide()}}if(player.info.level>=26){this.e.find("#inherit_building").addClass("show")}if(player.info.level>=31){this.e.find("#trade_building").addClass("show")}if(player.info.level>=31&&player.info.level<150){this.e.find("#bar_building").addClass("show")}if(channelID==153||channelID==154){if(player.info.level>=26){this.e.find("#arena_building").addClass("show")}}else{if(player.info.level>=26&&player.info.level<61){this.e.find("#arena_building").addClass("show")}if(player.info.level>=60){this.e.find("#war_building").addClass("show");if(player.info.war_entry==1){this.e.find("#war_building").children(".popo").show()}else{if(player.info.war_entry==2){this.e.find("#war_building").children(".fighting").show()}}}if(player.info.level>=61){this.e.find("#arena_building").hide();this.e.find("#worldarena_building").show()}}if(player.info.level>=60){this.e.find("#beauty_building").addClass("show")}if(player.info.level>=81){this.e.find("#heromanual_building").addClass("show")}if(player.info.god==1){this.e.find("#levy_building").hide();this.e.find("#champions_building").show();if(player.info.god_entry==1){this.e.find("#champions_building").children(".popo").show()}else{if(player.info.god_entry==2){this.e.find("#champions_building").children(".fighting").show()}}}else{if(player.info.level>=16){this.e.find("#levy_building").addClass("show")}}if(player.info.level>=91){this.e.find("#workshop_building").addClass("show");if(player.info.onworkshop==1){this.e.find("#workshop_building").children(".popo").show()}}if(player.info.level>=150){this.e.find("#bar_building").hide();this.e.find("#newbar_building").show()}if(player.info.level>=20){this.e.find("#statue_building").addClass("show")}var A=this;this.e.undelegate(".building.show","touchstart").delegate(".building.show","touchstart",function(){A.touchObj=this.id});this.e.undelegate(".building.show","click").delegate(".building.show","click",function(){var C=this.id;if(xGame.guide==false&&C!=A.touchObj){A.touchObj=null;return false}A.touchObj=null;if(C=="mine_building"){xGame.loadWorld("mine")}else{if(C=="champions_building"){xGame.loadWorld("champions")}else{if(C=="newbar_building"){xGame.showpop("bar")}else{if(C=="war_building"){xGame.loadWorld("war")}else{if(cityWorld.islock==true){return false}xGame.showpop(C.replace("_building",""))}}}}if($(this).find(".tag").length>0){if(player.info.edifice[$(this).attr("index")]!=undefined&&player.info.edifice[$(this).attr("index")].name==$(this).attr("name")){player.info.edifice[$(this).attr("index")]=0}$(this).find(".tag").remove()}});if(player.info.level<=20){$("#footer").find("#menu_map").addClass("tada").unbind("touchend").one("touchend",function(){$(this).removeClass("tada")})}this.e.find("#citymask").unbind("touchend").bind("touchend",function(){cityWorld.unlockProcess()});xGame.iscrollRefresh();this.unlock();xGame.setMenuList2("city");this.createNew();$("#worldloading").removeClass("black").hide();this.littleStart();if(guide.step){guide.show(guide.step);guide.step=0}},littleXX:function(){return false;var B=this;var C={x:744,y:275};if(typeof isIPhone5!="undefined"&&isIPhone5==true){C.x=813;C.y=300}var A=$("#cityworld_page");B.movieclip1=new movieClipClass({"img":staticUrl+"img/city/npc3.png","width":103,"height":68,"x":C.x,"y":C.y,"loop":true,"zindex":"1","frames":[{rect:[0,0],interval:200},{rect:[103,0],interval:150},{rect:[206,0],interval:150},{rect:[309,0],interval:200},{rect:[412,0],interval:150}]});B.movieclip1.appendTo(A);B.movieclip1.play();A=B=null},littleRun:function(){return false;var G=this;var I=$("#cityworld_page");var C=null;var A=[{"left":"520px","top":"460px"},{"left":"630px","top":"390px"},{"left":"355px","top":"260px"},{"left":"630px","top":"390px"},{"left":"520px","top":"460px"},{"left":"715px","top":"555px"}];var J=G.getTimeList(A);var K=$("#worldarena_building");var D=1,H,B;var F=null;G.movieclip2=new movieClipClass({"img":staticUrl+"img/city/npc1.png","width":67,"height":60,"x":715,"y":555,"loop":true,"zindex":"1","frames":[{rect:[0,0],interval:200},{rect:[67,0],interval:200},{rect:[134,0],interval:200},{rect:[201,0],interval:200}]});G.movieclip2.appendTo(I);G.movieclip2.play();var E=function(){if(G.allTop){D=H=B=F=I=A=J=bagin=G=K=null;return false}if(D==4||D==3){K.css({"z-index":2})}else{if(D==2||D==5){K.css({"z-index":1})}}if(D==7){D=1}H=D%2==0?1:-1;B=D>2&&D<6?2:1;F=arguments.callee;G.movieclip2.obj.animate(A[D-1],J[D-1],"linear",function(){G.movieclip2.obj.css({"-webkit-transform":"scaleX("+H+")","left":G.movieclip2.obj.offset().left,"background-image":"url("+staticUrl+"img/city/npc"+B+".png)"});D++;setTimeout(F,100)})};E()},littleStart:function(){if(xGame.nowWorld!="city"){return false}this.allTop=false;if(this.movieclip1==null){this.littleXX()}if(this.movieclip2==null){this.littleRun()}},clearLittle:function(){if(xGame.nowWorld!="city"){return false}if(this.movieclip1!=null){this.movieclip1.destory();this.movieclip1=null}if(this.movieclip2!=null){this.allTop=true;this.movieclip2.destory();this.movieclip2=null}},getTimeList:function(D){var C=this;var E=[],A=0.04;for(var B=0;B<D.length;B++){if(B==0){E.push(C.getDistance(715-parseInt(D[0].left.replace("px","")),555-parseInt(D[0].top.replace("px","")))/A)}else{E.push(C.getDistance(parseInt(D[B].left.replace("px",""))-parseInt(D[B-1].left.replace("px","")),parseInt(D[B].top.replace("px",""))-parseInt(D[B-1].top.replace("px","")))/A)}}return E},getDistance:function(A,B){return Math.sqrt(A*A+B*B)},lock:function(){this.islock=true;$("#citymask").show();cityWorld.clearLittle()},unlock:function(){setTimeout(function(){if(cityWorld.islock==true){cityWorld.unlockProcess()}},500)},unlockProcess:function(){cityWorld.littleStart();cityWorld.islock=false;$("#citymask").hide()},createNew:function(){var A='<span class="tag"></span>';for(var B=0;B<player.info.edifice.length;B++){if(player.info.edifice[B].name=="practice"&&player.info.edifice[B].open=="1"){this.e.find("#practice_building").append(A).attr({"name":player.info.edifice[B].name,"index":B})}else{if(player.info.edifice[B].name=="inherit"&&player.info.edifice[B].open=="1"){this.e.find("#inherit_building").append(A).attr({"name":player.info.edifice[B].name,"index":B})}else{if(player.info.edifice[B].name=="mine"&&player.info.edifice[B].open=="1"){this.e.find("#mine_building").append(A).attr({"name":player.info.edifice[B].name,"index":B})}else{if(player.info.edifice[B].name=="arena"&&player.info.edifice[B].open=="1"){this.e.find("#arena_building").append(A).attr({"name":player.info.edifice[B].name,"index":B})}else{if(player.info.edifice[B].name=="trade"&&player.info.edifice[B].open=="1"){this.e.find("#trade_building").append(A).attr({"name":player.info.edifice[B].name,"index":B})}else{if(player.info.edifice[B].name=="worldarena"&&player.info.edifice[B].open=="1"){this.e.find("#worldarena_building").append(A).attr({"name":player.info.edifice[B].name,"index":B})}else{if(player.info.edifice[B].name=="book"&&player.info.edifice[B].open=="1"){this.e.find("#heromanual_building").append(A).attr({"name":player.info.edifice[B].name,"index":B})}else{if(player.info.edifice[B].name=="workshop"&&player.info.edifice[B].open=="1"){this.e.find("#workshop_building").append(A).attr({"name":player.info.edifice[B].name,"index":B})}else{if(player.info.edifice[B].name=="herotavern"&&player.info.edifice[B].open=="1"){this.e.find("#newbar_building").append(A).attr({"name":player.info.edifice[B].name,"index":B})}else{if(player.info.edifice[B].name=="tavern"&&player.info.edifice[B].open=="1"){this.e.find("#bar_building").append(A).attr({"name":player.info.edifice[B].name,"index":B})}else{if(player.info.edifice[B].name=="war"&&player.info.edifice[B].open=="1"){this.e.find("#war_building").append(A).attr({"name":player.info.edifice[B].name,"index":B})}else{if(player.info.edifice[B].name=="beauty"&&player.info.edifice[B].open=="1"){this.e.find("#beauty_building").append(A).attr({"name":player.info.edifice[B].name,"index":B})}}}}}}}}}}}}}A=null},unbindAll:function(){this.e.find("#citymask").unbind("touchend");this.e.undelegate(".building.show","touchstart");this.e.undelegate(".building.show","click");this.e.remove();this.e=null},clear:function(){console.log("释放主城资源");xGame.unlock();this.clearLittle();if(this.movieclip1){this.movieclip1.destroy();this.movieclip1=null}if(this.movieclip2){this.movieclip2.destroy();this.movieclip2=null}this.touchObj=null;this.unbindAll()},}})();