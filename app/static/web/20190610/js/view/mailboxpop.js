(function(){mailboxPopClass=function(){this.e;this.isshow=false;this.topDom;this.bottomDom;this.stype;this.readMid;this.page;this.perPage;this.listScroller;this.listDom;this.mailInfoScroller;this.mailInfoDom;this.mailNoticeScroller;this.mailNoticeDom;this.starDom;this.star=1;this.grade=0;this.isTimeout=[]};mailboxPopClass.prototype={init:function(A){var B=this;if(B.isshow){$("#worldloading").hide();return}B.e=xGame.loadPopTmpl("mailbox");B.e.find(".content").find(".hidebtn").unbind("touchend").bind("touchend",function(C){if(xGame.checkLock(true)){return false}mailboxpop.hide();C.preventDefault();C.stopPropagation()});B.initList();if(A!=undefined){if(A.name!=undefined){B.e.find("#mb_countrysend_tbtn").trigger("touchend");B.bottomDom.find("#mb_write_all").find("#mb_receiver_input").val(A.name)}else{B.e.find("#mb_send_tbtn").trigger("touchend");B.bottomDom.find("#mb_write_all").find("#mb_receiver_input").val(A)}}else{B.fillSystem()}if(player.info.activities==1){B.e.find("#mb_activities_tbtn").append('<b class="new"></b>')}else{B.e.find("#mb_activities_tbtn").css("display","none")}if(player.info.country_job==1){B.e.find("#mb_countrysend_tbtn").css("display","inline-block")}B.e.show();$("#worldloading").hide()},checkHeightScroller:function(){var A=$("#mb_system_list");if(A.height()>330){if(this.mailNoticeScroller==null){this.mailNoticeScroller=new iScroll("mailboxpop_notice_scroller",{hScrollbar:false,vScrollbar:false})}$("#mb_system_list").height(A.height());this.mailNoticeScroller.refresh()}else{if(this.mailNoticeScroller!=null){this.mailNoticeScroller.destroy();this.mailNoticeScroller=null}}A=null},initList:function(B){var A=this;A.topDom=A.e.find("#mb_top");A.bottomDom=A.e.find("#mb_content");A.listDom=A.bottomDom.find("#mailpoppop_list");A.starDom=A.e.find("#grade_detail");A.listScroller=null;A.mailInfoScroller=null;A.mailNoticeScroller=null;A.stype=1;A.readMid=0;A.bindAll();A.createNewByInfo()},createNewByInfo:function(){var A=this;if(player.info.newmail==1){A.topDom.find("#mb_receive_tbtn").append('<b class="new"></b>').unbind("touchend").one("touchend",function(){$(this).find("b").remove()})}else{if(player.info.newmail==2){A.topDom.find("#mb_gm_tbtn").append('<b class="new"></b>').unbind("touchend").one("touchend",function(){$(this).find("b").remove()})}else{if(player.info.newmail==3){A.topDom.find("#mb_receive_tbtn").append('<b class="new"></b>').unbind("touchend").one("touchend",function(){$(this).find("b").remove()});A.topDom.find("#mb_gm_tbtn").append('<b class="new"></b>').unbind("touchend").one("touchend",function(){$(this).find("b").remove()})}}}},bindAll:function(){var A=this;A.topDom.undelegate("#mb_system_tbtn","touchend").delegate("#mb_system_tbtn","touchend",function(){if(xGame.islock||A.stype==1){return}A.stype=1;A.readMid=0;A.topDom.attr("class","mb_system_tab");A.bottomDom.attr("class","mb_system");A.fillSystem();A.checkHeightScroller()});A.topDom.undelegate("#mb_receive_tbtn","touchend").delegate("#mb_receive_tbtn","touchend",function(){if(xGame.islock||A.stype==2){return}A.page=1;A.perPage=10;A.stype=2;A.readMid=0;A.topDom.attr("class","mb_receive_tab");A.bottomDom.attr("class","mb_common");A.hideWriteDiv();A.bottomDom.find("#mb_creat_btn").html(lang("new_mail"));A.fillMessage()});A.topDom.undelegate("#mb_send_tbtn","touchend").delegate("#mb_send_tbtn","touchend",function(){if(xGame.islock||A.stype==3){return}A.sendFunc()});A.topDom.undelegate("#mb_gm_tbtn","touchend").delegate("#mb_gm_tbtn","touchend",function(){if(xGame.islock||A.stype==4){return}A.page=1;A.perPage=10;A.stype=4;A.readMid=0;A.topDom.attr("class","mb_gm_tab");A.bottomDom.attr("class","mb_common");A.hideWriteDiv();A.bottomDom.find("#mb_creat_btn").html(lang("leave_msg"));A.fillMessage();A.createFunc()});A.topDom.undelegate("#mb_activities_tbtn","touchend").delegate("#mb_activities_tbtn","touchend",function(){A.hide();xGame.showpop("activities")});A.topDom.undelegate("#mb_countrysend_tbtn","touchend").delegate("#mb_countrysend_tbtn","touchend",function(){if(xGame.islock||A.stype==5){return}A.countrySendFunc()});A.bottomDom.find("#mailpoppop_list").undelegate("li","touchend").delegate("li","touchend",function(){if(xGame.checkLock(true)){return false}A.hideWriteDiv();if($(this).attr("mbid")==A.readMid){return}A.readById($(this).attr("mbid"))});A.bottomDom.undelegate("#mb_creat_btn","touchend").delegate("#mb_creat_btn","touchend",function(){if(xGame.islock||A.bottomDom.find("#mb_mail_content").hasClass("write")){return}A.createFunc()});A.bottomDom.undelegate("#mb_send_btn","touchend").delegate("#mb_send_btn","touchend",function(){if(xGame.checkLock(true)){return false}A.sendMessage($(this).attr("sendtype"))});A.bottomDom.undelegate("#mb_reset_btn","touchend").delegate("#mb_reset_btn","touchend",function(){if(xGame.checkLock(true)){return false}A.resetWriteFunc()});A.bottomDom.undelegate("#mb_delete_btn.pop_btn_middle","touchend").delegate("#mb_delete_btn.pop_btn_middle","touchend",function(){if(xGame.checkLock(true)){return false}A.deleteFunc(A.readMid)});A.bottomDom.undelegate("#mb_delete_all_btn.pop_btn_middle","touchend").delegate("#mb_delete_all_btn.pop_btn_middle","touchend",function(){if(xGame.checkLock(true)){return false}xGame.confirm.show("",lang("all_delete_ask"),2,function(){xGame.confirm.hide();A.deleteFunc()},function(){xGame.confirm.hide()},lang("ok"),lang("close"))});A.bottomDom.undelegate("#mb_reply_btn.pop_btn_middle","touchend").delegate("#mb_reply_btn.pop_btn_middle","touchend",function(){if(xGame.checkLock(true)){return false}if($(this).attr("type")=="country"){A.bottomDom.find("#mb_write_all").find("#mb_nickname").html(lang("mailboxpop_receiver_country"));A.bottomDom.find("#mb_send_btn").attr("sendtype","5")}else{A.bottomDom.find("#mb_write_all").find("#mb_nickname").html(lang("receiver"));A.bottomDom.find("#mb_send_btn").attr("sendtype",A.stype)}A.resetWriteFunc();A.bottomDom.find("#mb_write_all").find("#mb_receiver_input").val(A.bottomDom.find("#mb_read_all").find("#mb_nickname_input").val());A.bottomDom.find("#mb_mail_content").attr("class","write");A.bottomDom.find("#mb_write_all").css("display","block")});A.bottomDom.undelegate("#mb_fetch_btn.pop_btn_middle","touchend").delegate("#mb_fetch_btn.pop_btn_middle","touchend",function(){if(xGame.checkLock(true)){return false}miscpop.fetchRewardFromMail(A.readMid);A.hideByObj($(this))});A.bottomDom.undelegate("#mb_nickname_input","touchend").delegate("#mb_nickname_input","touchend",function(){if(xGame.checkLock(true)||$(this).attr("uid")==undefined||$(this).attr("uid")==player.info.uid){return false}xGame.showpop("info",parseInt($(this).attr("uid")))});A.bottomDom.undelegate("#mb_gm_grade","touchend").delegate("#mb_gm_grade","touchend",function(){if(A.grade>0){xGame.toast.show(lang("mailboxpop_has_grade"))}else{A.setStar(1);A.starDom.show()}});A.starDom.undelegate("#grade_detail_hide","touchend").delegate("#grade_detail_hide","touchend",function(){A.e.find("#grade_detail").hide()});A.starDom.find("#grade_list").undelegate(".grade","touchstart").delegate(".grade","touchstart",function(){var B=$(this).attr("value");A.setStar(B)});A.starDom.undelegate("#grade_submit_btn","touchend").delegate("#grade_submit_btn","touchend",function(){A.submitGrade(A.readMid)})},submitGrade:function(C){if(xGame.checkLock()){return false}var B=this;var A=function(F){if(F.status==1){B.grade=B.star;B.e.find("#grade_detail").hide();var D="";for(var E=1;E<=B.star;E++){D+="<em></em>"}B.bottomDom.find("#mb_read_all").find("#mb_grade_info").html(D);B.bottomDom.find("#mb_read_all").find("#mb_grade_info").show();B.bottomDom.find("#mb_read_all").find("#mb_gm_grade").hide();xGame.toast.show(lang("mailboxpop_grade_success"))}else{if(F.status==-1){xGame.toast.show(lang("mailboxpop_grade_star_error"))}else{if(F.status==-2){xGame.toast.show(lang("mailboxpop_grade_info_lose"))}else{if(F.status==-3){xGame.toast.show(lang("mailboxpop_grade_not_reply"))}else{if(F.status==-4){xGame.toast.show(lang("mailboxpop_has_grade"))}else{xGame.toast.show(lang("mailboxpop_grade_lose"))}}}}}xGame.unlock()};loadContents({"c":"gmmail","m":"grade","id":C,"grade":B.star},A);A=null},setStar:function(B){var D=this;var C=0;D.star=B;for(var A=1;A<=5;A++){if(A<=B){if(!D.starDom.find("#grade_list").find(".grade"+A).hasClass("show")){(function(E){D.isTimeout.push(setTimeout(function(){D.starDom.find("#grade_list").find(".grade"+E).addClass("show")},C));C+=80})(A)}}else{D.starDom.find("#grade_list").find(".grade"+A).removeClass("show")}}},sendFunc:function(){var A=this;A.page=1;A.perPage=10;A.stype=3;A.readMid=0;A.topDom.attr("class","mb_send_tab");A.bottomDom.attr("class","mb_common");A.hideWriteDiv();A.bottomDom.find("#mb_creat_btn").html(lang("new_mail"));A.fillMessage();A.createFunc()},countrySendFunc:function(){var A=this;A.page=1;A.perPage=10;A.stype=5;A.readMid=0;A.topDom.attr("class","mb_countrysend_tab");A.bottomDom.attr("class","mb_common");A.hideWriteDiv();A.bottomDom.find("#mb_creat_btn").html(lang("new_mail"));A.fillMessage();A.createFunc()},createFunc:function(){var A=this;if(A.stype==5){A.bottomDom.find("#mb_write_all").find("#mb_nickname").html(lang("mailboxpop_receiver_country"));A.bottomDom.find("#mb_receiver_input").attr("placeholder",lang("mailboxpop_enter_country"))}else{A.bottomDom.find("#mb_write_all").find("#mb_nickname").html(lang("receiver"));A.bottomDom.find("#mb_receiver_input").attr("placeholder",lang("mailboxpop_enter_nickname"))}A.bottomDom.find("#mb_send_btn").attr("sendtype",A.stype);A.resetWriteFunc();A.bottomDom.find("#mb_mail_content").attr("class","write");A.bottomDom.find("#mb_write_all").css("display","block");if(A.stype==4){A.bottomDom.find("#mb_receiver_input").val("GM").attr("readonly","true")}else{A.bottomDom.find("#mb_receiver_input").removeAttr("readonly")}},hideWriteDiv:function(){var A=this;if(!A.bottomDom.find("#mb_mail_content").hasClass("read")){A.bottomDom.find("#mb_mail_content").attr("class","read")}},fillSystem:function(){var C=this;if(xGame.xsGet(xGame.server_prefix+"game_notice")!=undefined&&xGame.xsGet(xGame.server_prefix+"notice_id")==player.info.notice_id){$("#mb_system_list").html(xGame.xsGet(xGame.server_prefix+"game_notice"));C.checkHeightScroller()}else{if(xGame.checkLock()){return false}var A="";var B=function(E){if(E.status==1){for(var D=0;D<E.list.length;D++){A+="<li>"+E.list[D].info+"</li>"}$("#mb_system_list").html(A);C.checkHeightScroller();xGame.xsSet(xGame.server_prefix+"game_notice",A);xGame.xsSet(xGame.server_prefix+"notice_id",player.info.notice_id);C.e.find("#mb_system_tbtn").append('<b class="new"></b>')}xGame.unlock()};loadContents({"c":"message","m":"get_notice"},B);B=null}},fillMessage:function(C){if(xGame.checkLock()){return false}var B=this;var A=function(D){D.status=parseInt(D.status);if(D.status>=0){B.bottomDom.find("#mb_mail_author").html("");B.bottomDom.find("#mb_mail_dateline").html("");if(D.status==1){if(C!=undefined){B.page=C;B.buildList(D.list,true)}else{B.buildList(D.list)}if(B.stype==2){B.showRight(D.info)}}else{if(D.status==0){if(C!=undefined){B.page=C;B.buildList(D.list,true)}else{B.buildList(D.list)}if(B.stype==2){B.showRight(D.info)}}}}else{xGame.toast.show(lang("undefined_error"))}xGame.unlock()};if(B.stype==2){loadContents({"c":"message","m":"get_message","t":"1","f":"0","p":C==undefined?B.page:C,"per":B.perPage},A)}else{if(B.stype==3){loadContents({"c":"message","m":"get_message","t":"1","f":"1","p":C==undefined?B.page:C,"per":B.perPage},A)}else{if(B.stype==4){loadContents({"c":"gmmail","m":"get_message","p":C==undefined?B.page:C,"per":B.perPage},A)}else{if(B.stype==5){loadContents({"c":"message","m":"get_message","t":"4","f":"1","p":C==undefined?B.page:C,"per":B.perPage},A)}}}}A=null},buildList:function(F,E){var D=this;var A="",B="";if(F.length==0){if(E==undefined){D.isNoMail()}}else{D.bottomDom.find("#mb_read_all").find("#mb_grade_info").hide();D.bottomDom.find("#mb_read_all").find("#mb_gm_grade").hide();D.bottomDom.find("#mb_read_all").find(".mb_input").removeClass("gm_name_bg");D.bottomDom.find("#mb_list_all").removeClass("nodata");D.bottomDom.find("#mb_delete_all_btn").attr("class","pop_btn_middle btn").show();D.bottomDom.find("#mb_delete_btn").attr("class","pop_btn_middle btn").show();if(D.stype==2){D.bottomDom.find("#mb_read_all").find("#mb_nickname").html(lang("sender"))}if(D.stype==3){D.bottomDom.find("#mb_read_all").find("#mb_nickname").html(lang("receiver"));D.hideByObj(D.bottomDom.find("#mb_reply_btn"));D.hideByObj(D.bottomDom.find("#mb_fetch_btn"))}if(D.stype==4){D.hideByObj(D.bottomDom.find("#mb_reply_btn"));D.hideByObj(D.bottomDom.find("#mb_fetch_btn"));D.bottomDom.find("#mb_nickname_input").val("GM");D.bottomDom.find("#mb_read_all").find(".mb_input").addClass("gm_name_bg")}if(D.stype==5){D.bottomDom.find("#mb_read_all").find("#mb_nickname").html(lang("mailboxpop_receiver_country"));D.hideByObj(D.bottomDom.find("#mb_reply_btn"));D.hideByObj(D.bottomDom.find("#mb_fetch_btn"))}for(var C=0;C<F.length;C++){if(D.stype==2){B=(F[C].isread==0?"unread":"isread")}if(D.stype==3||D.stype==5){B="issend"}if(D.stype==4){B=(F[C].status==0?"issubmit":"isreply")}if(C==0&&E==undefined&&D.stype==2){D.readMid=F[C].id;B+=" selected"}if(D.stype!=5){if(D.stype==2&&F[C].type==10){A+='<li class="'+B+'" id="mbid_'+F[C].id+'" mbid="'+F[C].id+'"><span></span><p><em>['+lang("mailboxpop_country_mail")+"] "+F[C].name+"</em></p></li>"}else{A+='<li class="'+B+'" id="mbid_'+F[C].id+'" mbid="'+F[C].id+'"><span></span><p><em>['+F[C].name+"] "+F[C].message+"</em></p></li>"}}else{A+='<li class="'+B+'" id="mbid_'+F[C].id+'" mbid="'+F[C].id+'"><span></span><p><em>'+lang("mailboxpop_to_country",[F[C].name])+"</em></p></li>"}}if(E){D.listDom.append(A);if(F.length==D.perPage){D.getMore()}}else{D.listDom.html(A)}}if(D.listScroller==null){if(D.listDom.find("li").size()>4){D.listScrollerMaker();if(D.listDom.find("li").size()==D.perPage){D.getMore()}D.listScroller.refresh()}}else{if(D.listScroller!=null){if(D.listDom.find("li").size()>4){if(E==undefined){D.listScroller.scrollTo(0,0)}D.listScroller.refresh()}else{if(D.listDom.find("li").size()<=4){D.listScroller.destroy();D.listScroller=null}}}}},getMore:function(){var A=this;$('<div id="pullDown" ><span class="pullDownLabel">'+lang("click_for_more")+"</span></div>").appendTo("#mailpoppop_list").one("touchend",function(){A.fillMessage(A.page+1);A=null;$(this).remove()})},listScrollerMaker:function(){this.listScroller=new iScroll("mailboxpop_scroller",{snap:"li",hScroll:true,hScrollbar:false,vScrollbar:false,checkDOMChanges:true,bounce:true,})},showRight:function(D){var B=this;if(D==undefined){return}if(B.stype!=4){if(B.stype==2){if(D.type==10){B.bottomDom.find("#mb_read_all").find("#mb_nickname").html(lang("mailboxpop_send_country"))}else{B.bottomDom.find("#mb_read_all").find("#mb_nickname").html(lang("sender"))}}B.bottomDom.find("#mb_nickname_input").val(D.name)}if(B.stype==4&&D.status!=undefined){if(D.status==0){B.bottomDom.find("#mb_read_all").find("#mb_nickname").html(lang("receiver"))}else{B.bottomDom.find("#mb_read_all").find("#mb_nickname").html(lang("sender"))}}var A;if(B.stype==2){if(D.type==1){B.hideByObj(B.bottomDom.find("#mb_reply_btn"));if(D.giftstatus==1){B.hideByObj(B.bottomDom.find("#mb_fetch_btn"))}else{B.bottomDom.find("#mb_fetch_btn").attr("class","pop_btn_middle btn").show()}}else{B.hideByObj(B.bottomDom.find("#mb_fetch_btn"));if(D.type==10){if(player.info.country_job==1){B.bottomDom.find("#mb_reply_btn").attr({"class":"pop_btn_middle btn","type":"country"}).show()}else{B.hideByObj(B.bottomDom.find("#mb_reply_btn"))}}else{B.bottomDom.find("#mb_reply_btn").attr({"class":"pop_btn_middle btn","type":"player"}).show()}}var C="";if(D.act>0){C+='<li class="act">'+lang("act")+" +"+D.act+"</li>"}if(D.silver>0){C+='<li class="silver">'+lang("silver")+" +"+D.silver+"</li>"}if(D.gold>0){C+='<li class="gold">'+lang("gold")+" +"+D.gold+"</li>"}if(D.barcard>0){C+='<li class="barcard">'+lang("free_leap")+" +"+D.barcard+"</li>"}A=$("<li>"+D.message+'</li><ul id="mailreward_wrap" style="opacity: 1; display: block; ">'+C+"</ul>");C=null}else{A=$("<li>"+D.message+"</li>")}B.bottomDom.find("#mb_mail_text_ul").html(A);B.setIscroller(A,D.dateline,D.king);A=null;if(D.type==5){B.bottomDom.find("#mb_read_all").find("#mb_nickname_input").attr("uid",D.fromuid)}else{B.bottomDom.find("#mb_read_all").find("#mb_nickname_input").removeAttr("uid")}},setIscroller:function(C,D,A){if(D!=undefined){this.bottomDom.find("#mb_mail_dateline").html(D)}else{this.bottomDom.find("#mb_mail_dateline").html("")}var B=0;if(A!=undefined){this.bottomDom.find("#mb_mail_author").html(lang("mailboxpop_king_is",[A]));B=188}else{B=212;this.bottomDom.find("#mb_mail_author").html("")}this.bottomDom.find("#mb_mail_text_scroller").height(B);if(C.height()>B){if(this.mailInfoScroller==null){this.mailInfoScroller=new iScroll("mb_mail_text_scroller",{momentum:false,hScrollbar:false,vScrollbar:false})}this.bottomDom.find("#mb_mail_text_ul").height(C.height());this.mailInfoScroller.refresh()}else{if(this.mailInfoScroller!=null){this.mailInfoScroller.destroy();this.mailInfoScroller=null}}},readById:function(C){if(xGame.checkLock()){return false}var B=this;var A=function(F){if(parseInt(F.status)==1){B.bottomDom.find("#mbid_"+B.readMid).removeClass("selected");B.readMid=C;B.bottomDom.find("#mbid_"+B.readMid).addClass("selected");B.showRight(F.list);if(B.bottomDom.find("#mbid_"+B.readMid).hasClass("unread")&&F.list.isread==1){B.bottomDom.find("#mbid_"+B.readMid).removeClass("unread").addClass("isread")}B.grade=F.list.grade;if(B.stype==4&&F.list.reply_uid>0){if(F.list.grade>0){var D="";for(var E=1;E<=F.list.grade;E++){D+="<em></em>"}B.bottomDom.find("#mb_read_all").find("#mb_grade_info").html(D);B.bottomDom.find("#mb_read_all").find("#mb_grade_info").show();B.bottomDom.find("#mb_read_all").find("#mb_gm_grade").hide()}else{B.bottomDom.find("#mb_read_all").find("#mb_gm_grade").show();B.bottomDom.find("#mb_read_all").find("#mb_grade_info").hide()}}else{B.bottomDom.find("#mb_read_all").find("#mb_gm_grade").hide();B.bottomDom.find("#mb_read_all").find("#mb_grade_info").hide()}}else{xGame.toast.show(lang("can_not_found_mail"))}xGame.unlock()};if(B.stype==4){loadContents({"c":"gmmail","m":"index","id":C,},A)}else{loadContents({"c":"message","m":"index","id":C,"f":(B.stype==2?"0":"1"),"t":"2"},A)}A=null},sendMessage:function(A,F){var C=this;var D=C.bottomDom.find("#mb_receiver_input").val();var E=C.bottomDom.find("#mb_message_input").val();if(D==""){xGame.toast.show(lang("receiver_is_null"));return}if(E==""){xGame.toast.show(lang("msg_is_null"));return}if(E.length>150){xGame.toast.show(lang("msg_more_than_150"));return}if(D==player.info.nickname&&A!=5){xGame.toast.show(lang("can_not_send_self"));C.bottomDom.find("#mb_receiver_input").val("");return}if(xGame.checkLock()){return false}var B=function(H){if(H.status==1){C.hideWriteDiv();xGame.toast.show(lang("send_complete"));if(C.stype!=2){C.bottomDom.find("#mb_list_all").removeClass("nodata");C.bottomDom.find(".selected").removeClass("selected");var G=$("<li>"+E+"</li>");C.bottomDom.find("#mb_mail_text_ul").html(G);C.setIscroller(G,H.dateline,H.king);C.readMid=H.id.id;C.bottomDom.find("#mb_read_all").find("#mb_nickname_input").removeAttr("uid");if(C.stype==3){C.listDom.prepend('<li class="issend selected" id="mbid_'+H.id.id+'" mbid="'+H.id.id+'"><span></span><p><em>['+D+"] "+E+"</em></p></li>");C.bottomDom.find("#mb_read_all").find("#mb_nickname").html(lang("receiver"));C.bottomDom.find("#mb_read_all").find("#mb_nickname_input").val(D);if(H.uid!=undefined){C.bottomDom.find("#mb_read_all").find("#mb_nickname_input").attr("uid",H.uid)}}else{if(C.stype==4){C.listDom.prepend('<li class="issubmit selected" id="mbid_'+H.id.id+'" mbid="'+H.id.id+'"><span></span><p><em>[GM] '+E+"</em></p></li>");C.bottomDom.find("#mb_read_all").find("#mb_nickname").html(lang("receiver"));C.bottomDom.find("#mb_read_all").find("#mb_nickname_input").val("GM");C.bottomDom.find("#mb_read_all").find("#mb_grade_info").hide();C.bottomDom.find("#mb_read_all").find("#mb_gm_grade").hide()}else{if(C.stype==5){C.listDom.prepend('<li class="issend selected" id="mbid_'+H.id.id+'" mbid="'+H.id.id+'"><span></span><p><em>'+lang("mailboxpop_to_country",[D])+"</em></p></li>");C.bottomDom.find("#mb_read_all").find("#mb_nickname").html(lang("mailboxpop_receiver_country"));C.bottomDom.find("#mb_read_all").find("#mb_nickname_input").val(D)}}}C.bottomDom.find("#mb_delete_all_btn").attr("class","pop_btn_middle btn").show();C.bottomDom.find("#mb_delete_btn").attr("class","pop_btn_middle btn").show()}if(A==5){player.updateinfo({"gold":H.all_gold})}if(C.listDom.find("li").size()>=5){if(C.listScroller==null){C.listScrollerMaker()}C.listScroller.refresh()}}else{if(H.status==-1){xGame.toast.show(lang("no_user_try_again"));C.bottomDom.find("#mb_receiver_input").val("")}else{if(H.status==-2){xGame.toast.show(lang("mailboxpop_cannot_use"))}else{if(H.status==-3){xGame.toast.show(lang("mailboxpop_name_error"))}else{if(H.status==-4){xGame.confirm.show(lang("notice"),lang("mailboxpop_send_ensure",[H.price]),2,function(){xGame.confirm.hide();C.sendMessage(A,true)},function(){xGame.confirm.hide()})}else{if(H.status==-5){xGame.goPay(lang("mailboxpop_no_gold_to_send"))}else{if(H.status==-6){xGame.toast.show(lang("banned_words"))}else{if(H.status==-7){xGame.toast.show(lang("undefined_level"))}else{xGame.toast.show(lang("undefined_error"))}}}}}}}}xGame.unlock()};if(A==4){loadContents({"c":"gmmail","m":"send_message","i":E,},B)}else{if(A==5){loadContents({"c":"message","m":"send_message","n":D,"i":E,"sure":F==undefined?"0":"1","t":"2"},B)}else{loadContents({"c":"message","m":"send_message","n":D,"i":E},B)}}B=null},resetWriteFunc:function(){var A=this;if(A.stype!=4){A.bottomDom.find("#mb_receiver_input").val("")}A.bottomDom.find("#mb_message_input").val("")},deleteFunc:function(C){if(xGame.checkLock()){return false}var B=this;var A=function(E){if(E.status==1){if(C!=undefined){if(B.listDom.find("li").size()==5){B.listScroller.destroy();B.listScroller=null}var D=B.bottomDom.find("#mbid_"+B.readMid).siblings().first();if(D.length!=0){xGame.unlock();B.readById(D.attr("mbid"));B.bottomDom.find("#mbid_"+B.readMid).remove()}else{B.isNoMail()}}else{if(B.listScroller!=null){B.listScroller.destroy();B.listScroller=null}B.isNoMail()}xGame.toast.show(lang("delete_complete"))}else{if(E.status==0){xGame.toast.show(lang("can_not_delete"))}else{xGame.toast.show(lang("undefined_error"))}}xGame.unlock()};if(C!=undefined){if(B.stype==4){loadContents({"c":"gmmail","m":"del_message","id":C,},A)}else{if(B.stype==2){loadContents({"c":"message","m":"del_message","id":C,"t":"1"},A)}else{if(B.stype==3){loadContents({"c":"message","m":"del_message","id":C,"t":"1","f":"1"},A)}else{if(B.stype==5){loadContents({"c":"message","m":"del_message","id":C,"t":"3","f":"1"},A)}}}}}else{if(B.stype==4){loadContents({"c":"gmmail","m":"del_message"},A)}else{if(B.stype==2){loadContents({"c":"message","m":"del_message","t":"1"},A)}else{if(B.stype==3){loadContents({"c":"message","m":"del_message","t":"1","f":"1"},A)}else{if(B.stype==5){loadContents({"c":"message","m":"del_message","t":"3","f":"1"},A)}}}}}A=null},isNoMail:function(){var A=this;A.bottomDom.find("#mb_nickname_input").val("");A.bottomDom.find("#mb_mail_text_ul").html("");A.bottomDom.find("#mb_grade_info").html("");A.bottomDom.find("#mb_read_all").find("#mb_nickname").html("");A.listDom.html("");A.bottomDom.find("#mb_mail_author").html("");A.bottomDom.find("#mb_mail_dateline").html("");A.hideByObj(A.bottomDom.find("#mb_delete_all_btn"));A.hideByObj(A.bottomDom.find("#mb_delete_btn"));A.hideByObj(A.bottomDom.find("#mb_reply_btn"));A.hideByObj(A.bottomDom.find("#mb_fetch_btn"));A.bottomDom.find("#mb_list_all").addClass("nodata")},hideByObj:function(A){A.attr("class","pop_btn_middle_disable btn").hide()},unbindAll:function(){if(this.e){this.e.find(".content").find(".hidebtn").unbind("touchend");this.e.remove();this.e=null}if(this.topDom){this.topDom.undelegate("#mb_system_tbtn","touchend");this.topDom.undelegate("#mb_receive_tbtn","touchend");this.topDom.undelegate("#mb_send_tbtn","touchend");this.topDom.undelegate("#mb_gm_tbtn","touchend");this.topDom.undelegate("#mb_activities_tbtn","touchend");this.topDom.undelegate("#mb_countrysend_tbtn","touchend");this.topDom.remove();this.topDom=null}if(this.bottomDom){this.bottomDom.find("#mailpoppop_list").undelegate("li","touchend");this.bottomDom.undelegate("#mb_creat_btn","touchend");this.bottomDom.undelegate("#mb_send_btn","touchend");this.bottomDom.undelegate("#mb_reset_btn","touchend");this.bottomDom.undelegate("#mb_delete_btn.pop_btn_middle","touchend");this.bottomDom.undelegate("#mb_delete_all_btn.pop_btn_middle","touchend");this.bottomDom.undelegate("#mb_reply_btn.pop_btn_middle","touchend");this.bottomDom.undelegate("#mb_fetch_btn.pop_btn_middle","touchend");this.bottomDom.undelegate("#mb_nickname_input","touchend");this.bottomDom.undelegate("#mb_gm_grade","touchend");this.bottomDom.remove();this.bottomDom=null}if(this.starDom){this.starDom.undelegate("#grade_detail_hide","touchend");this.starDom.find("#grade_list").undelegate(".grade","touchstart");this.starDom.undelegate("#grade_submit_btn","touchend");this.starDom.remove();this.starDom=null}},hide:function(){xGame.unlock();this.isshow=false;if(this.listScroller!=null){this.listScroller.destroy();this.listScroller=null}if(this.mailInfoScroller!=null){this.mailInfoScroller.destroy();this.mailInfoScroller=null}if(this.mailNoticeScroller!=null){this.mailNoticeScroller.destroy();this.mailNoticeScroller=null}if(this.listDom){this.listDom.remove();this.listDom=null}if(this.mailInfoDom){this.mailInfoDom.remove();this.mailInfoDom=null}if(this.mailNoticeDom){this.mailNoticeDom.remove();this.mailNoticeDom=null}for(var A=0;A<this.isTimeout.length;A++){clearTimeout(this.isTimeout[A])}this.isTimeout.length=0;this.readMid=this.page=this.perPage=this.stype=null;this.unbindAll()},}})();