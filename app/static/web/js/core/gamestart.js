var player;var xGame;var timer;var gAudio;var loginWorld,cityWorld,mapWorld,battleWorld,roleWorld,treasureWorld,countrybattleWorld,countrymapWorld,soulWorld,mineWorld,countryWorld,bossWorld,towerWorld,generaltaskWorld,elitebattleWorld,championsWorld,palaceheroWorld,countrybossWorld,herothroneWorld,gemWorld,sanctumWorld,gvgWorld,gvgbattleWorld,countrymineWorld,nianWorld,heavenWorld,warWorld,warheroWorld,breakthroughworld,attackJapanWorld,meridianworld,runethroneWorld,fumineworld;var miscpop,packpop,strongpop,levypop,musterpop,fosterpop,heropop,teampop,tradepop,barpop,shoppop,practicepop,chatpop,lotterypop,vippop,mailpop,arenapop,settingspop,rushpop,mailboxpop,giftpop,sacrificepop,activitypop,iospaypop,firstpaypop,exercisepop,bossbandpop,drinkpop,taskgiftpop,giftchangepop,dailytaskpop,dailytradepop,infopop,treasuremappop,talentpop,dailysignpop,worshippop,rebatepop,helpinfopop,workshoppop,slyzpop,expostulationpop,countrypop,countryhousepop,countryworshippop,elitepop,strategypop,inheritpop,trendspop,blackmarketpop,worldarenapop,countrybanquetpop,countrylearnpop,christmaspaypop,christmassignpop,christmasgeneralpop,yuandansignpop,heromanualpop,godminepop,newyearpaypop,eggpop,newbiegift,overseastradepop,newyeardinnerpop,beatengodpop,friendspop,smashpop,epicpop,bearpop,viprewardpop,countrydicepop,qingmingpop,limitedgodpop,binding91pop,advancedpop,invitationpop,missionpop,sacredtreepop,anniversarypop,countrytreasurepop,mountpop,studfarmpop,zhulupop,practiceleappop,christmasgiftpop,ndgiftpop,viprepaypop,springshoppop,newyearlotterypop,firstpaygiftpop,levelgiftpop,newgiftpop,loginedpop,regrewardpop,countrynoticepop,countrywarnoticepop,equiprefinepop,refineinheritpop,refineachievepop,strongachievepop,acttreasurepop,championsrewardpop,recallpop,scoreshoppop,showmarpop,kemaripop,kemarisuccpop,kemarilosepop,worldcuppop,newpassrewardpop,chargegiftpop,signinpop,outprintgodpop,valentinepop,beautypop,lordsoulpop,soulrefinepop,countrycollegepop,midautumnpop,nationcelpop,loginrewardpop,paycheckspop,countrymallpop,nationaldaypop,halloweenpop,systempop,forgepop,resolvepop,pacifypop,sweeppop,enrichmentpop,sevenstarpop,christmasbuypop,newyearpop,lanternpop,swordpop,honormallpop,holidaypop,monthcardpop,recallfriendpop,killdevilpop,actsevenpop,godforgepop,essencepop,jademallpop,newactsevenpop,actjubaopop,threeyearpop,actfightpop,monthfundpop,paradepop,cornuspop,acthallowmaspop,fridaypop,novemberpop,warfieldpop,newepicpop,drumpop,drumshoppop,acteggpairpop,fiveyearpop,redenvelopepop,bazaarpop,devilpop,accumulatepop,vitalitypop,starbattlepop,flopbrandpop,luckydicepop,promotionpop,tongbaopop,countrygvgpop,runepop,runeshoppop,actmonopolypop,newlotterypop,accrueeverychargepop,accruecostpop,equipbookpop,actmanekipop,mooncakepop,actcornucopiapop,actrebatepop,actcarnivalpop,actcalendarpop,ladderwarpop,ladderpop,actsteadilypop,exploittreepop,exploitstonepop,actdoubleelevenpop,chickenpop,fukubukuropop,signpop,discountpop,generalpoolpop,eightdiagrampop,actwelfarepop,acteaticepop,awakenpop,awakenpackpop,awakenmallpop,awakenwarpop,actsalepop,anglingpop,drummallpop,anniversarymallpop,actauctionpop,sticationpop,equipguidepop,guoqingpop,elevenpop,elevenmallpop,shakepop,cardmallpop,travelpop,ordtravelpop,crytravelpop,actsolepop,actchristmaspop,actspringpop,newsacrificepop,fubimallpop,actspringwarpop,shoothalberdpop,actmuchmoneypop,elixirpop,signeggpop,equiplockpop,actsacrificepop,newfubimallpop,actscratchpop,bigdipperpop,fiveelementspop,threecontestpop,playersrecallpop,specialfestivalpop,scramblepop,guardianpop,statuepop,assistcardpop,artificepop,assistwarpop,ancientspiritpop,goldentimepop,rechargefeastpop,mallfeastpop,honorsmallpop,barscreenpop;var guide=new guideClass;var CD={};$(document).ready(function(){if(typeof preventTouchMove=="undefined"){document.addEventListener("touchmove",function(A){A.preventDefault();A.stopPropagation();return false},false)}hideAddressBar();xGame=new xGameClass;xGame.init();stopLoadingAnim=true;if(typeof cordova!="undefined"){iosTrackData()}});function iosTrackData(){step(function(A){window.plugins.DeviceTokenPlugin.fetchToken(function(B){if(B!="error"){console.log("JS获得devicetoken:"+B);A.devicetoken=B;A()}else{A.devicetoken="000000";A({msg:-1})}},function(B){A.devicetoken="000000";A({msg:-1})},[1,1])})(function(A){window.plugins.DeviceMacaddrPlugin.fetchMacAddr(function(B){if(B!="error"){console.log("JS获得MAC:"+B);A.mac=B;A()}else{A.mac="00:00:00:00:00:00";A({msg:-1})}},function(B){A.mac="00:00:00:00:00:00";A({msg:-1})},[1,1])})(function(B){var A=function(){B.udid="";B({msg:-2})};var C=setTimeout(function(){A()},1000);window.plugins.DeviceOpenUDIDPlugin.fetchOpenUDID(function(D){clearTimeout(C);if(D!="error"){console.log("JS获得openUDID:"+D);B.udid=D;B()}else{A()}},function(D){clearTimeout(C);A()},[1,1])})(function(B){var A=function(){B.adid="";B.ate="";B({msg:-3})};var C=setTimeout(function(){A()},1000);window.plugins.DeviceAdidPlugin.fetchAdid(function(E){clearTimeout(C);if(E!="error"&&E.indexOf("_")!=-1){var D=E.split("_");B.adid=D[0];B.ate=D[1];console.log("JS获得adid:"+B.adid);B()}else{A()}},function(D){clearTimeout(C);A()},[1,1])})(function(A){xGame.devicetoken=A.devicetoken;xGame.adid=A.adid;xGame.ate=A.ate;xGame.udid=A.udid;xGame.macaddr=A.mac;sendTrackData()}).run(function(B,A){if(B){console.log(B.msg)}A()})}function sendTrackData(){var B=localStorage["sg_tracked_"+client_version]?true:false;if(B==false){var A=UCAPI+"&c=iostrack&m=trackall&advertising_id="+xGame.adid+"&ate="+xGame.ate+"&openudid="+xGame.udid+"&mac="+xGame.macaddr+"&channel="+channelID;console.log(A);var C={"type":"get","dataType":"json","url":A,"success":function(D){},};$.ajax(C);localStorage["sg_tracked_"+client_version]="true"}}var updateCfg={client_version:client_version,local_version:0,server_version:0,cached_list:[],cached_path:"",file_index:0,webfile_list:{}};function checkLaterUpdate(E){if(isPhonegap==false){if(E){E()}return}var J;updateCfg.local_version=localStorage["sg2_version"+updateCfg.client_version]>0?localStorage["sg2_version"+updateCfg.client_version]:updateCfg.client_version;var G=37;var F={"type":"get","dataType":"json","url":UCAPI+"c=ios&m=update_world_common&clientid="+G+"&version_type=1&client_version="+updateCfg.client_version+"&local_version="+updateCfg.local_version+"&lang="+appLanguage+"&channel="+channelID,"complete":function(O,N){O=null},"success":function(N){if(N.status==1){updateCfg.server_version=N.version;if(isPhonegap==true&&updateCfg.client_version!=updateCfg.server_version){updateCfg.cached_list=N.cached_list;if(updateCfg.local_version!=updateCfg.server_version){xGame.confirm.show("",lang("update_file"),1,function(){xGame.confirm.hide();$("#updateinfo").html(N.updateinfo).show();updateCfg.webfile_list=N.filelist;B();C();I()})}else{D(false)}}else{D(false)}}else{if(N.status==2){initmsg(lang("protect_msg1",[N.time]))}else{initmsg(lang("protect_msg2"))}}},"error":function(O,N){hideAddressBar();initmsg(lang("no_internet_msg"));return},};$.ajax(F);function H(N){if(typeof cordova=="undefined"){D(false)}else{window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(O){appFileSystem=O;cached_path=appFileSystem.root.fullPath.replace("Documents","");updateCfg.file_index=0;N()},function(){stopLoadingAnim==true;initmsg(lang("update_resource_msg"))})}}function I(){if(typeof updateCfg.webfile_list["img"][updateCfg.file_index]!="undefined"){L((updateCfg.file_index+1)/updateCfg.webfile_list["imgnum"],lang("updating_image",[(updateCfg.file_index+1),updateCfg.webfile_list["imgnum"],updateCfg.webfile_list["allsize"]]));K(updateCfg.webfile_list["img"][updateCfg.file_index],"http://img2.hanjiangsanguo.com/h5cdn/"+updateCfg.server_version+"/img/plugin/"+updateCfg.webfile_list["img"][updateCfg.file_index],I)}else{updateCfg.file_index=0;A()}}function A(){if(typeof updateCfg.webfile_list["js"][updateCfg.file_index]!="undefined"){L((updateCfg.file_index+1)/updateCfg.webfile_list["jsnum"],lang("updating_modual",[(updateCfg.file_index+1),updateCfg.webfile_list["jsnum"],updateCfg.webfile_list["allsize"]]));K(updateCfg.webfile_list["js"][updateCfg.file_index],"http://img2.hanjiangsanguo.com/h5cdn/"+updateCfg.server_version+"/js/"+updateCfg.webfile_list["js"][updateCfg.file_index],A)}else{updateCfg.file_index=0;localStorage["sg2_version"+client_version]=updateCfg.server_version;updateCfg.local_version=updateCfg.server_version;D(true)}}function D(N){cached_list=cached_list.concat(updateCfg.cached_list);if(N==true){console.log("后期更新：更新完成。");M();xGame.toast.show(lang("update_file_done"));if(E){E()}}else{console.log("后期更新：没有需要更新的内容");if(E){E()}}}function C(){if(stopLoadingAnim==true){J=null;return false}J.css("width","10px").animate({"width":"464px",},N(100,1000),"ease",C);function N(O,R){var Q=R-O;var P=Math.random();return(O+Math.round(P*Q))}}function B(){stopLoadingAnim=false;var N=$("#initloading");N.find("#initloading_progress").width(10);N.find("#tips").html("");N.show();J=$("#initloading_progress")}function M(){stopLoadingAnim=true;$("#initloading").hide()}function L(N,P){var O=$("#initloading");if(P){O.find("#tips").html(P)}}function K(Q,P,N){updateCfg.file_index++;var S="sg_cache/"+Q;appFileSystem.root.getFile(S,null,function(T){T.remove(function(){appFileSystem.root.getDirectory("sg_cache",{create:true},O,R)})},function(){appFileSystem.root.getDirectory("sg_cache",{create:true},O,R)});function O(T){var V=new FileTransfer();var U=T.fullPath+"/"+Q;V.download(P,U,function(W){N()},R)}function R(T){console.log("ERROR");console.log(JSON.stringify(T));stopLoadingAnim==true;initmsg(lang("update_resource_msg"),function(){cleanGameCache()})}}}function cleanGameCache(){localStorage.removeItem("sg_tmpl_v"+client_version);if(typeof gAudio!="undefined"&&gAudio!=null){gAudio.stopMusic()}if(typeof cordova=="undefined"){localStorage["sg_version"+client_version]="";localStorage["sg2_version"+client_version]="";location.reload()}else{window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(A){appFileSystem=A;appFileSystem.root.getDirectory("sg_cache",{create:false},function(B){B.removeRecursively(function(){localStorage["sg_version"+client_version]="";localStorage["sg2_version"+client_version]="";location.reload()},function(){location.reload()})},function(){location.reload()})},function(){location.reload()})}};