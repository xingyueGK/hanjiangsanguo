function PxLoader(A){A=A||{};if(A.statusInterval==null){A.statusInterval=5000}if(A.loggingDelay==null){A.loggingDelay=20*1000}if(A.noProgressTimeout==null){A.noProgressTimeout=Infinity}var I=[],E=[],C,D=+new Date;var F={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4};var G=function(M){if(M==null){return[]}if(Array.isArray(M)){return M}return[M]};this.add=function(M){M.tags=new PxLoaderTags(M.tags);if(M.priority==null){M.priority=Infinity}I.push({resource:M,state:F.QUEUED})};this.addProgressListener=function(M,N){E.push({callback:M,tags:new PxLoaderTags(N)})};this.addCompletionListener=function(M,N){E.push({tags:new PxLoaderTags(N),callback:function(O){if(O.completedCount===O.totalCount){M()}}})};var K=function(N){N=G(N);var M=function(P){var Q=P.resource,R=Infinity;for(var O=0;O<Q.tags.length;O++){for(var S=0;S<Math.min(N.length,R);S++){if(Q.tags[O]==N[S]&&S<R){R=S;if(R===0){break}}if(R===0){break}}}return R};return function(R,O){var P=M(R),Q=M(O);if(P<Q){return -1}if(P>Q){return 1}if(R.priority<O.priority){return -1}if(R.priority>O.priority){return 1}return 0}};this.start=function(O){C=+new Date;var M=K(O);I.sort(M);for(var N=0,Q=I.length;N<Q;N++){var P=I[N];P.status=F.WAITING;P.resource.start(this)}setTimeout(H,100)};var H=function(){var R=false,N=(+new Date)-D,S=(N>=A.noProgressTimeout),O=(N>=A.loggingDelay);for(var M=0,Q=I.length;M<Q;M++){var P=I[M];if(P.status!==F.WAITING){continue}P.resource.checkStatus();if(P.status===F.WAITING){if(S){P.resource.onTimeout()}else{R=true}}}if(O&&R){L()}if(R){setTimeout(H,A.statusInterval)}};this.isBusy=function(){for(var M=0,N=I.length;M<N;M++){if(I[M].status===F.QUEUED||I[M].status===F.WAITING){return true}}return false};var B=function(Q,N){var P=null;for(var R=0,U=I.length;R<U;R++){if(I[R].resource===Q){P=I[R];break}}if(P==null||P.status!==F.WAITING){return}P.status=N;D=+new Date;var T=Q.tags.length;for(var R=0,M=E.length;R<M;R++){var O=E[R],S;if(O.tags.length===0){S=true}else{S=Q.tags.contains(O.tags)}if(S){J(P,O)}}};this.onLoad=function(M){B(M,F.LOADED)};this.onError=function(M){B(M,F.ERROR)};this.onTimeout=function(M){B(M,F.TIMEOUT)};var J=function(O,N){var T=0,R=0;for(var Q=0,S=I.length;Q<S;Q++){var P=I[Q],M=false;if(N.tags.length===0){M=true}else{M=P.resource.tags.contains(N.tags)}if(M){R++;if(P.status===F.LOADED||P.status===F.ERROR||P.status===F.TIMEOUT){T++}}}N.callback({resource:O.resource,loaded:(O.status===F.LOADED),error:(O.status===F.ERROR),timeout:(O.status===F.TIMEOUT),completedCount:T,totalCount:R})};var L=this.log=function(R){if(!window.console){return}var P=Math.round((+new Date-C)/1000);window.console.log("PxLoader elapsed: "+P+" sec");for(var M=0,O=I.length;M<O;M++){var N=I[M];if(!R&&N.status!==F.WAITING){continue}var Q="PxLoader: #"+M+" "+N.resource.getName();switch(N.status){case F.QUEUED:Q+=" (Not Started)";break;case F.WAITING:Q+=" (Waiting)";break;case F.LOADED:Q+=" (Loaded)";break;case F.ERROR:Q+=" (Error)";break;case F.TIMEOUT:Q+=" (Timeout)";break}if(N.resource.tags.length>0){Q+=" Tags: ["+N.resource.tags.join(",")+"]"}window.console.log(Q)}}}function PxLoaderTags(C){this.array=[];this.object={};this.value=null;this.length=0;if(C!==null&&C!==undefined){if(Array.isArray(C)){this.array=C}else{if(typeof C==="object"){for(var A in C){this.array.push(A)}}else{this.array.push(C);this.value=C}}this.length=this.array.length;for(var B=0;B<this.length;B++){this.object[this.array[B]]=true}}this.contains=function(E){if(this.length===0||E.length===0){return false}else{if(this.length===1){if(E.length===1){return this.value===E.value}else{return E.object.hasOwnProperty(this.value)}}else{if(E.length<this.length){return E.contains(this)}else{for(var D in this.object){if(E.object[D]){return true}}return false}}}}}if(!Array.isArray){Array.isArray=function(A){return Object.prototype.toString.call(A)=="[object Array]"}};