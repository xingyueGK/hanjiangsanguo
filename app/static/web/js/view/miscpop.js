(function(){miscPopClass=function(){this.e;this.clearflower=false;this.forceScroller;this.htmlData;this.starbattle_bg=["1","1","2","2","3","3","5","5","4","4","12","12","13","13","15","15","17","17","19","19"];this.SZF_cardlist={mobile:[10,20,30,50,100,300,500],unicom:[20,30,50,100,300,500],telcom:[20,30,50,100],};this.propertyScroller=null};miscPopClass.prototype={show:function(C){var B=this;for(var A in C){switch(A){case"enemyInfo":B.enemyInfo(C[A]);break;case"treasureEnemyInfo":B.treasureEnemyInfo(C[A]);break;case"battleResultFromTreasure":B.battleResultFromTreasure(C[A]);break;case"battleResult":B.battleResult(C[A]);break;case"showRewardbox":B.showRewardbox(C[A]);break;case"battleResultFromBoss":B.battleResultFromBoss(C[A]);break}}},showRewardbox:function(G,A,C){var F=$("#rewardbox_wrap");var D=function(){setTimeout(function(){F.find(".box").removeClass("open");F.hide();if(A==undefined){miscpop.battleResult(G)}else{if(A=="battle"){miscpop.battleResult(G,C)}else{if(A=="throne"){miscpop.battleResultFromThrone(G,G.info.reward,true)}else{if(A=="beauty"){miscpop.battleResultFromBeauty(G)}else{if(A=="act_sword"){miscpop.battleResultFromSword(G)}else{if(A=="amphitheater"){miscpop.battleResultFromWarfield(G)}else{if(A=="rune"){miscpop.runebattleResultFromThrone(G,G.info.reward,true)}}}}}}}},400)};var E=function(){F.find(".arrow").fadeIn();var H=new movieClipClass({"img":staticUrl+"img/battle/reward_box_shadow_anim.png","width":480,"height":100,"x":-130,"y":330,"loop":false,"endDestory":true,"frames":[{rect:[0,0],interval:50},{rect:[0,100],interval:50},{rect:[0,200],interval:50},{rect:[0,300],interval:50},{rect:[0,400],interval:50},{rect:[0,500],interval:50},{rect:[0,600],interval:50},{rect:[0,700],interval:50},{rect:[0,800],interval:50},],});F.append(H.obj);H.play()};var B=function(){var H=new movieClipClass({"img":staticUrl+"img/battle/resutl_box_stars.png","width":261,"height":233,"x":-30,"y":200,"loop":false,"endDestory":true,"callback":D,"frames":[{rect:[0,0],interval:60},{rect:[261,0],interval:60},{rect:[522,0],interval:60},{rect:[783,0],interval:60},{rect:[1044,0],interval:60},{rect:[1305,0],interval:60},{rect:[1566,0],interval:60}],});F.append(H.obj);H.play()};F.find(".box").unbind("webkitAnimationEnd").bind("webkitAnimationEnd",E).unbind("touchend").bind("touchend",function(H){$(this).unbind("webkitAnimationEnd").unbind("touchend").addClass("open");F.find(".arrow").hide();B();H.preventDefault();H.stopPropagation()});F.show()},itemfly2bag:function(D,A){var B=($.os.ipad==true?1024:(isIPhone5?1136:960))/2-60;var E=$("body").height()/2-60;if(D.url!=undefined){var C=$('<div class="flyitem" style="z-index:100;background:url('+D.url+") 50% 50% no-repeat;right:"+B+"px;bottom:"+E+"px;color:"+helper.getItemColor(D.quality)+';"></div>')}else{var C=$('<div class="flyitem" style="z-index:100;background:url('+xGame.itemurl(D.itemid)+") 50% 50% no-repeat;right:"+B+"px;bottom:"+E+"px;color:"+helper.getItemColor(D.quality)+';"></div>')}$("body").append(C);xGame.doAnimate(C,"fadeInScale","0.5s",function(){setTimeout(function(){xGame.doAnimate(C,"itemfly2bag"+(xGame.menustatus==false?"menuhide":""),"0.6s",function(){C.remove();C=null;if(A){A();A=null}})},200)});B=null;E=null},createBombFlower2:function(){var A=this;var B=function(C,F){if(A.clearflower==true){A.clearflower=false;B=null;return}var E={};if(C==1){E={"x":0,"y":-100}}else{if(C==2){E={"x":80,"y":40}}else{E={"x":220,"y":-80}}}var D=new movieClipClass({"img":staticUrl+"img/pop/bombflower"+C+".png","width":260,"height":260,"x":E.x,"y":E.y,"loop":false,"endDestory":true,"callback":F,"frames":[{rect:[0,0],interval:80},{rect:[260,0],interval:80},{rect:[520,0],interval:80},{rect:[0,260],interval:80},{rect:[260,260],interval:80},{rect:[520,260],interval:80},]});D.appendTo($("#battleresult_wrap"));D.play()};setTimeout(function(){B(1,function(){B(2,function(){B(3,function(){B=null})})})},500)},createBombFlower:function(){var B=this;if(B.clearflower==true){B.clearflower=false;return}var A=new movieClipClass({"img":staticUrl+"img/battle/battle_result_bomb.png","width":150,"height":150,"x":160,"y":-70,"loop":false,"endDestory":true,"frames":[{rect:[0,0],interval:60},{rect:[150,0],interval:60},{rect:[300,0],interval:60},{rect:[450,0],interval:60},{rect:[600,0],interval:60},{rect:[0,150],interval:60},{rect:[150,150],interval:60},{rect:[300,150],interval:60},{rect:[450,150],interval:60},{rect:[600,150],interval:60},]});A.appendTo($("#battleresult_wrap"));A.play();xGame.doAnimate($("#battleresult_wrap").find(".flag"),"title_shake","0.4s",function(){A=null})},destoryAllBombFlower:function(){this.clearflower=true},enemyInfo:function(C,D){var A=this;var E=1;var B=function(G){var F=xGame.loadPopTmpl("enemy");var H=function(K){K.find(".content").find(".hidebtn").unbind("touchend");K.find("#force_btn").unbind("touchend");K.find("#attack_force_btn").unbind("touchend");K.find("#attack_normal_btn").unbind("touchend");K.find("#attack_normal_btn").unbind("touchend");K.find("#strategy_btn").unbind("touchend");var L=$("#force");L.find(".result").find(".attack_btns").unbind("touchend");L.find(".list").find("span").unbind("touchend");L.find(".force_hidebtn").unbind("touchend");L=null;K=null};F.find(".content").find(".hidebtn").unbind("touchend").bind("touchend",function(K){if(xGame.checkLock(true)){return false}miscpop.hide("enemypop");K.preventDefault();K.stopPropagation();H(F);H=null});var J="";if(G.info.image>0){J="url("+xGame.avatar(G.info.image)+") 50% 50% no-repeat"}else{if(G.info.type>2){J="url("+staticUrl+"img/map/boss1.png) 50% 50% no-repeat"}else{J="url("+staticUrl+"img/map/enemy1.png) 50% 50% no-repeat"}}F.find(".avatarbox").children(".avatar").css({"background":J});F.find(".isboss").addClass("npc"+G.info.type);F.find(".herolv").children("span").text(G.info.name+"(Lv."+G.info.level+")");F.find(".lefttimes").children("span").text(parseInt(G.info.maxtimes)==0?lang("unlimited"):(G.info.nowmaxtimes+lang("times")));F.find(".headexp").children("span").text("+"+(G.info.first==1?(G.info.firstkillexp+lang("shousha")):G.info.exp));if(G.info.add_type==1){F.find(".heroexp").children("b").text(lang("general_exp"))}else{F.find(".heroexp").children("b").text(lang("reputation"))}F.find(".heroexp").children("span").text("+"+(G.info.first==1?(G.info.gfirstkillexp+lang("shousha")):G.info.gexp));if(G.info.recruitrate>0){if(G.info.own_general==0){F.find(".enjoin_tips").show()}else{F.find(".own_general").show()}}else{if(G.info.own_general==1){F.find(".own_general").show()}}var I="";if(G.info.gettype>0){if(G.info.gettype==1||G.info.gettype==2||G.info.gettype==5||G.info.gettype==6){I=G.info.getitemname}else{if(G.info.gettype==3){I=G.info.getvalue+""+lang("silver")}else{if(G.info.gettype==4){I=G.info.getvalue+""+lang("gold")}}}}if(I!=""){F.find(".lostitems").show();F.find(".lostitems").children("span").html("<b>"+I+"</b>");F.find(".lostitems").children("em").text(G.info.getrate==0?"":(G.info.getrate==1?lang("xiao_gailv"):lang("da_gailv")));if(G.info.quality&&G.info.quality>0){F.find(".lostitems").children("span").css({"color":helper.getItemColor(G.info.quality)});if(G.info.quality==8){F.find(".lostitems").children("span").find("b").addClass("colorwords")}}}else{F.find(".lostitems").hide()}if(G.info.getvalue1==0||G.info.getvalue1==undefined){F.find(".add_doggold").css("display","none")}else{if(I!=""){F.find(".add_doggold").css("top","180px")}F.find(".add_doggold").html("x"+G.info.getvalue1+lang("heavenworld_probability5"))}if(G.info.materials_info==undefined){F.find(".drum_mate").css("display","none")}else{F.find(".add_doggold").css("top","180px");F.find(".drum_mate").css({"color":helper.getItemColor(G.info.materials_info.quality),"background-image":"url("+xGame.forgeMaterial(G.info.materials_info.materials_id)+")","background-repeat":"no-repeat"});F.find(".drum_mate").html("<em>"+G.info.materials_info.name+"x"+G.info.getvalue+'</em><em style="color:#000">'+lang("heavenworld_probability5")+"</em>")}if(G.mop_up==1){F.find("#force_btn").show();F.find("#force_btn").unbind("touchend").bind("touchend",function(K){H(F);H=null;K.preventDefault();K.stopPropagation();var L=$("#force");L.data("times",5);L.data("price",G.info.five_sub);L.show();miscpop.htmlData="";L.find(".type1").attr("price",G.info.five_sub);L.find(".type1").find(".gold").html(G.info.five_sub+""+lang("gold"));L.find(".type2").attr("price",G.info.ten_sub);L.find(".type2").find(".gold").data("gold",G.info.ten_sub).html(G.info.ten_sub+""+lang("gold"));L.find(".type3").attr("price",G.info.fifty_sub);L.find(".type3").find(".gold").data("gold",G.info.fifty_sub).html(G.info.fifty_sub+""+lang("gold"));L.find(".type4").attr("price",G.info.hundred_sub);L.find(".type4").find(".gold").data("gold",G.info.hundred_sub).html(G.info.hundred_sub+""+lang("gold"));L.find(".force_hidebtn").unbind("touchend").bind("touchend",function(M){L.find(".force_hidebtn").unbind("touchend");miscpop.hide("enemypop");if(miscpop.forceScroller!=null){miscpop.forceScroller.destroy()}miscpop.forceScroller=null;miscpop.htmlData=null;L.hide();L=null;M.preventDefault();M.stopPropagation()});L.find(".list").find("span").unbind("touchend").bind("touchend",function(M){L.find("span").removeClass("select");$(this).addClass("select");L.data("times",$(this).attr("value"));L.data("price",$(this).attr("price"));M.preventDefault();M.stopPropagation()});L.find(".result").find(".attack_btns").unbind("touchend").bind("touchend",function(N){var O=parseInt(L.data("times"));var M=parseInt(L.data("price"));if(M>0){xGame.confirm.show(lang("notice"),lang("force_confirm",[M]),2,function(){xGame.confirm.hide();miscpop.continuousPlay({l:player.info.missionlevel,s:player.info.missionstage,id:C,times:O,})},function(){xGame.confirm.hide()},lang("ok"),lang("close"))}else{miscpop.continuousPlay({l:player.info.missionlevel,s:player.info.missionstage,id:C,times:O,})}N.preventDefault();N.stopPropagation()})})}else{F.find("#force_btn").hide()}if(D==1){if(G.info.maxtimes!=0&&G.info.nowmaxtimes==0){F.find("#attack_normal_btn").hide();F.find("#attack_force_btn").show();F.find("#attack_force_cost").text(G.info.coin+""+lang("gold")).show();F.find("#attack_force_btn").unbind("touchend").bind("touchend",function(K){miscpop.enterBattle({l:player.info.missionlevel,s:player.info.missionstage,id:C,gold:G.info.coin});K.preventDefault();K.stopPropagation()})}else{F.find("#attack_normal_btn").unbind("touchend").bind("touchend",function(K){miscpop.enterBattle({l:player.info.missionlevel,s:player.info.missionstage,id:C});K.preventDefault();K.stopPropagation()})}}else{F.find("#attack_normal_btn").unbind("touchend").attr({"class":"btn pop_btn_middle_disable attack_btns"}).bind("touchend",function(){xGame.toast.show(lang("please_battle_front"))})}F.find("#strategy_btn").unbind("touchend").bind("touchend",function(){xGame.showpop("strategy",{"name":G.info.name,"c":"map","m":"report","l":player.info.missionlevel,"s":player.info.missionstage,"id":C})});F.show();B=null;xGame.unlock();xGame.showGuide([2,5,101,104,107,201,204,207,301,304,602,605,612,615,701,704,707,710,713,720,723,1328,1923])};loadContents({"c":"map","m":"mission","l":player.info.missionlevel,"s":player.info.missionstage,"id":C},B)},actionenemyInfo:function(A,G,D,E){var B=this;var F=1;var C=function(I){var H=xGame.loadPopTmpl("enemy");var J=function(M){M.find(".content").find(".hidebtn").unbind("touchend");M.find("#force_btn").unbind("touchend");M.find("#attack_force_btn").unbind("touchend");M.find("#attack_normal_btn").unbind("touchend");M.find("#attack_normal_btn").unbind("touchend");M.find("#strategy_btn").unbind("touchend");var N=$("#force");N.find(".result").find(".attack_btns").unbind("touchend");N.find(".list").find("span").unbind("touchend");N.find(".force_hidebtn").unbind("touchend");N=null;M=null};H.find(".content").find(".hidebtn").unbind("touchend").bind("touchend",function(M){if(xGame.checkLock(true)){return false}if(equipguidepop&&equipguidepop.e){equipguidepop.equipGuide()}miscpop.hide("enemypop");M.preventDefault();M.stopPropagation();J(H);J=null});var L="";if(I.info.image>0){L="url("+xGame.avatar(I.info.image)+") 50% 50% no-repeat"}else{if(I.info.type>2){L="url("+staticUrl+"img/map/boss1.png) 50% 50% no-repeat"}else{L="url("+staticUrl+"img/map/enemy1.png) 50% 50% no-repeat"}}H.find(".avatarbox").children(".avatar").css({"background":L});H.find(".isboss").addClass("npc"+I.info.type);H.find(".herolv").children("span").text(I.info.name+"(Lv."+I.info.level+")");H.find(".lefttimes").children("span").text(parseInt(I.info.maxtimes)==0?lang("unlimited"):(I.info.nowmaxtimes+lang("times")));H.find(".headexp").children("span").text("+"+(I.info.first==1?(I.info.firstkillexp+lang("shousha")):I.info.exp));if(I.info.add_type==1){H.find(".heroexp").children("b").text(lang("general_exp"))}else{H.find(".heroexp").children("b").text(lang("reputation"))}H.find(".heroexp").children("span").text("+"+(I.info.first==1?(I.info.gfirstkillexp+lang("shousha")):I.info.gexp));if(I.info.recruitrate>0){if(I.info.own_general==0){H.find(".enjoin_tips").show()}else{H.find(".own_general").show()}}else{if(I.info.own_general==1){H.find(".own_general").show()}}var K="";if(I.info.gettype>0){if(I.info.gettype==1||I.info.gettype==2||I.info.gettype==5||I.info.gettype==6){K=I.info.getitemname}else{if(I.info.gettype==3){K=I.info.getvalue+""+lang("silver")}else{if(I.info.gettype==4){K=I.info.getvalue+""+lang("gold")}}}}if(K!=""){H.find(".lostitems").show();H.find(".lostitems").children("span").html("<b>"+K+"</b>");H.find(".lostitems").children("em").text(I.info.getrate==0?"":(I.info.getrate==1?lang("xiao_gailv"):lang("da_gailv")));if(I.info.quality&&I.info.quality>0){H.find(".lostitems").children("span").css({"color":helper.getItemColor(I.info.quality)});if(I.info.quality==8){H.find(".lostitems").children("span").find("b").addClass("colorwords")}}}else{H.find(".lostitems").hide()}if(I.info.getvalue1==0||I.info.getvalue1==undefined){H.find(".add_doggold").css("display","none")}else{if(K!=""){H.find(".add_doggold").css("top","180px")}H.find(".add_doggold").html("x"+I.info.getvalue1+lang("heavenworld_probability5"))}if(I.info.materials_info==undefined){H.find(".drum_mate").css("display","none")}else{H.find(".add_doggold").css("top","180px");H.find(".drum_mate").css({"color":helper.getItemColor(I.info.materials_info.quality),"background-image":"url("+xGame.forgeMaterial(I.info.materials_info.materials_id)+")","background-repeat":"no-repeat"});H.find(".drum_mate").html("<em>"+I.info.materials_info.name+"x"+I.info.getvalue+'</em><em style="color:#000">'+lang("heavenworld_probability5")+"</em>")}if(I.mop_up==1){H.find("#force_btn").show();H.find("#force_btn").unbind("touchend").bind("touchend",function(M){J(H);J=null;M.preventDefault();M.stopPropagation();var N=$("#force");N.data("times",5);N.data("price",I.info.five_sub);N.show();miscpop.htmlData="";N.find(".type1").attr("price",I.info.five_sub);N.find(".type1").find(".gold").html(I.info.five_sub+""+lang("gold"));N.find(".type2").attr("price",I.info.ten_sub);N.find(".type2").find(".gold").data("gold",I.info.ten_sub).html(I.info.ten_sub+""+lang("gold"));N.find(".type3").attr("price",I.info.fifty_sub);N.find(".type3").find(".gold").data("gold",I.info.fifty_sub).html(I.info.fifty_sub+""+lang("gold"));N.find(".type4").attr("price",I.info.hundred_sub);N.find(".type4").find(".gold").data("gold",I.info.hundred_sub).html(I.info.hundred_sub+""+lang("gold"));N.find(".force_hidebtn").unbind("touchend").bind("touchend",function(O){N.find(".force_hidebtn").unbind("touchend");miscpop.hide("enemypop");if(miscpop.forceScroller!=null){miscpop.forceScroller.destroy()}if(equipguidepop&&equipguidepop.e){equipguidepop.equipGuide()}miscpop.forceScroller=null;miscpop.htmlData=null;N.hide();N=null;O.preventDefault();O.stopPropagation()});N.find(".list").find("span").unbind("touchend").bind("touchend",function(O){N.find("span").removeClass("select");$(this).addClass("select");N.data("times",$(this).attr("value"));N.data("price",$(this).attr("price"));O.preventDefault();O.stopPropagation()});N.find(".result").find(".attack_btns").unbind("touchend").bind("touchend",function(P){var Q=parseInt(N.data("times"));var O=parseInt(N.data("price"));if(O>0){xGame.confirm.show(lang("notice"),lang("force_confirm",[O]),2,function(){xGame.confirm.hide();miscpop.continuousPlay({l:A,s:G,id:D,times:Q,})},function(){xGame.confirm.hide()},lang("ok"),lang("close"))}else{miscpop.continuousPlay({l:A,s:G,id:D,times:Q,})}P.preventDefault();P.stopPropagation()})})}else{H.find("#force_btn").hide()}if(E==1){if(I.info.maxtimes!=0&&I.info.nowmaxtimes==0){H.find("#attack_normal_btn").hide();H.find("#attack_force_btn").show();H.find("#attack_force_cost").text(I.info.coin+""+lang("gold")).show();H.find("#attack_force_btn").unbind("touchend").bind("touchend",function(M){miscpop.enterBattle({l:A,s:G,id:D,gold:I.info.coin});M.preventDefault();M.stopPropagation()})}else{H.find("#attack_normal_btn").unbind("touchend").bind("touchend",function(M){miscpop.enterBattle({l:A,s:G,id:D});M.preventDefault();M.stopPropagation()})}}else{H.find("#attack_normal_btn").unbind("touchend").attr({"class":"btn pop_btn_middle_disable attack_btns"}).bind("touchend",function(){xGame.toast.show(lang("please_battle_front"))})}H.find("#strategy_btn").unbind("touchend").bind("touchend",function(){xGame.showpop("strategy",{"name":I.info.name,"c":"map","m":"report","l":A,"s":G,"id":D})});H.show();C=null;xGame.unlock();xGame.showGuide([2,5,101,104,107,201,204,207,301,304,602,605,612,615,701,704,707,710,713,720,723,1328,1923])};loadContents({"c":"map","m":"mission","l":A,"s":G,"id":D},C)},enterBattle:function(B){if(xGame.checkLock()){return false}var A=function(D){if(D.status){if(D.status==-1){xGame.buyActConfirm();xGame.unlock();miscpop.hide("enemypop");return}else{if(D.status==-2){if(xGame.guide==true&&xGame.xsGet(player.info.uid+"firstbattlecd")!="1"&&0){xGame.xsSet(player.info.uid+"firstbattlecd","1");guide.showNpc(lang("clear_cd_ask"),function(){guide.createSimplePoint($("#header").find("#battle_timer"),null,false,"touchend")})}else{xGame.toast.show(lang("please_clear_battle_cd"));guide.createSimplePoint($("#header").find("#battle_timer"),null,false,"touchend");setTimeout(function(){$("#guide_arrow").remove()},2000)}xGame.unlock();miscpop.hide("enemypop");return}else{if(D.status==-7){xGame.unlock();xGame.goPay(lang("your_gold_is_not_enough"));return}else{xGame.unlock();var C="";switch(D.status){case -3:C=lang("current_map_exist");break;case -4:C=lang("current_shili_close");break;case -5:C=lang("battle_front_first");break;case -6:C=lang("current_no_data");break}if(C!=""){miscpop.hide("enemypop");xGame.toast.show(C);return}}}}}player.taskaction(6);$("#worldloading").addClass("black").show();miscpop.hide("enemypop");setTimeout(function(){xGame.loadBattle(D,function(){if(battleWorld.resultdata.win>0&&battleWorld.resultdata.gettype>0){miscpop.showRewardbox(battleWorld.resultdata,"battle",D.share)}else{miscpop.battleResult(battleWorld.resultdata,D.share)}},D.info.background,null,true)},500);player.reloadInfo();if(xGame.guide){guide.updateStep(D.info.win)}};loadContents({"c":"map","m":"action","l":B.l,"s":B.s,"id":B.id,},A);xGame.xsSet("lastBattle",B.l+","+B.s+","+B.id,true);xGame.xsSet(player.info.uid+"enterbattle_data",JSON.stringify(B),true)},continuousPlay:function(B){if(xGame.checkLock()){return false}var A=function(F){if(F.status){if(F.status==-1){xGame.buyActConfirm();xGame.unlock();return}else{if(F.status==-2){if(xGame.guide==true&&xGame.xsGet(player.info.uid+"firstbattlecd")!="1"){xGame.xsSet(player.info.uid+"firstbattlecd","1");guide.showNpc(lang("clear_cd_ask"),function(){guide.createSimplePoint($("#header").find("#battle_timer"),null,false,"touchend")})}else{xGame.toast.show(lang("please_clear_battle_cd"));guide.createSimplePoint($("#header").find("#battle_timer"),null,false,"touchend");setTimeout(function(){$("#guide_arrow").remove()},2000)}miscpop.hide("enemypop");return}else{if(F.status==-7){xGame.goPay(lang("your_gold_is_not_enough"));xGame.unlock();return}else{var E="";switch(F.status){case -3:E=lang("current_map_exist");break;case -4:E=lang("current_shili_close");break;case -5:E=lang("battle_front_first");break;case -6:E=lang("current_no_data");break;case -8:E=lang("first_not_battle");break;case -9:E=lang("need_vip_level");break}if(E!=""){miscpop.hide("enemypop");xGame.toast.show(E);return}}}}}if(F.info.levelup&&F.info.levelup==1){xGame.xsSet(player.info.uid+"levelup",1,true)}if(F.info.generalstatus&&F.info.generalstatus==1){miscpop.newhero(F.info.generalinfo)}var C="";if(F.info.add_type==1){C+=lang("enemypop_cleanup_message",[B.times,F.info.exp,lang("general"),F.info.gexp])}else{C+=lang("enemypop_cleanup_message2",[B.times,F.info.exp,lang("reputation"),F.info.gexp])}if(F.info.itemname!=""){if(parseInt(F.info.quality)==8){C+='<em class="equip colorwords" style="color:'+helper.getItemColor(F.info.quality)+'">'+F.info.itemname+"x"+parseInt(F.info.get_number)+"</em>"}else{C+='<em class="equip" style="color:'+helper.getItemColor(F.info.quality)+'">'+F.info.itemname+"x"+parseInt(F.info.get_number)+"</em>"}}if(F.info.getvalue1==0||F.info.getvalue1==undefined){C+=""}else{if(F.info.itemname!=""){C+='<em class="add_doggold" style="top:105px;">'+lang("doggold")+"x"+parseInt(F.info.getvalue1)+"</em>"}else{C+='<em class="add_doggold" style="top:80px;">'+lang("doggold")+"x"+parseInt(F.info.getvalue1)+"</em>"}}C+="</li>";var H=$("#force_list_scroller");miscpop.htmlData+=C;var D=H.height();H.html(miscpop.htmlData);if(D>=214){if(miscpop.forceScroller==null){miscpop.forceScroller=new iScroll("force_scroller",{momentum:false,hScrollbar:false,vScrollbar:true})}miscpop.forceScroller.refresh();D=H.height();miscpop.forceScroller.scrollTo(0,214-D,800)}var G=$("#force");if(B.times==5){G.data("price",F.info.five_sub)}G.find(".type1").attr("price",F.info.five_sub);G.find(".type1").find(".gold").html(F.info.five_sub+""+lang("gold"));if(B.times==10){G.data("price",F.info.ten_sub)}G.find(".type2").attr("price",F.info.ten_sub);G.find(".type2").find(".gold").html(F.info.ten_sub+""+lang("gold"));if(B.times==50){G.data("price",F.info.fifty_sub)}G.find(".type3").attr("price",F.info.fifty_sub);G.find(".type3").find(".gold").html(F.info.fifty_sub+""+lang("gold"));if(B.times==100){G.data("price",F.info.hundred_sub)}G.find(".type4").attr("price",F.info.hundred_sub);G.find(".type4").find(".gold").html(F.info.hundred_sub+""+lang("gold"));xGame.unlock();player.reloadInfo()};loadContents({"c":"map","m":"action","l":B.l,"s":B.s,"id":B.id,"times":B.times},A)},battleResult:function(B,H){var E=this;E.clearflower=false;var C=xGame.loadPopTmpl("battleend");if(B.gettype>0||B.itemtype==2){C.find("#battleend_main").attr("class","main type3");var D=lang("all_hero_exp")+"<p></p>";if(B.add_type==2){D=lang("reputation")+'：<p style="background-image:url('+staticUrl+'img/common/prestige_icon.png);"></p>'}if(B.getvalue1==0||B.getvalue1==undefined){C.find("#battleend_main").html('<div class="get1">'+lang("zhugong_exp")+'<p></p></div><div class="get2">'+D+'</div><div class="getitem">    <p>'+lang("get")+'：<span></span></p>    <div class="itembox"></div></div>')}else{C.find("#battleend_main").html('<div class="get1">'+lang("zhugong_exp")+'<p></p><span class="add_doggold">x'+B.getvalue1+'</span></div><div class="get2">'+D+'</div><div class="getitem">    <p>'+lang("get")+'：<span></span></p>    <div class="itembox"></div></div>')}}else{C.find("#battleend_main").attr("class","main type2");var D=lang("all_hero_exp")+"<p></p>";if(B.add_type==2){D=lang("reputation")+'：<p style="background-image:url('+staticUrl+'img/common/prestige_icon.png);"></p>'}if(B.getvalue1==0||B.getvalue1==undefined){C.find("#battleend_main").html('<div class="get1">'+lang("zhugong_exp")+'<p></p></div><div class="get2">'+D+"</div>")}else{C.find("#battleend_main").html('<div class="get1">'+lang("zhugong_exp")+'<p></p><span class="add_doggold">x'+B.getvalue1+'</span></div><div class="get2">'+D+"</div>")}}var I=B.win>0?"flagwin"+B.win:"flaglose"+Math.abs(B.win);C.find(".flag").addClass(I);if(B.win<0){C.find(".flagbg").addClass("lose")}else{if(B.win==0){C.find(".flagbg").addClass("equal")}}C.find(".get1").children("p").text("+"+B.exp);C.find(".get2").children("p").text("+"+B.gexp);var A="";if(B.gettype==3){A=lang("get_silver")+"<span>+"+B.getvalue+"</span>";C.find(".itembox").addClass("c_i_bj1").html('<img src="'+staticUrl+'img/common/header_gold.png" />')}else{if(B.gettype==4){A=lang("get_gold")+"<span>+"+B.getvalue+"</span>";C.find(".itembox").addClass("c_i_bj1").html('<img src="'+staticUrl+'img/common/header_money.png" />')}else{if(B.gettype==1||B.gettype==2){if(parseInt(B.quality)==8){A=lang("get")+'：<span class="colorwords" style="color:'+helper.getItemColor(B.quality)+'">'+B.itemname+"</span>"}else{A=lang("get")+'：<span style="color:'+helper.getItemColor(B.quality)+'">'+B.itemname+"</span>"}C.find(".itembox").addClass("c_i_bj"+B.quality).html('<img src="'+xGame.itemurl(B.itemid)+'" />');if(B.gettype==1&&B.itemid>0){var G=JSON.stringify({"itemid":B.itemid,"itemname":B.itemname,"quality":B.quality,"itemurl":xGame.itemurl(B.itemid)});xGame.xsSet(player.info.uid+"getitem",G,true)}}else{if(B.gettype==29){if(parseInt(B.quality)==8){A=lang("get")+'：<span class="colorwords" style="color:'+helper.getItemColor(B.quality)+'">'+B.itemname+"</span>"}else{A=lang("get")+'：<span style="color:'+helper.getItemColor(B.quality)+'">'+B.itemname+"</span>"}C.find(".itembox").addClass("c_i_bj"+B.quality).html('<img src="'+xGame.forgeMaterial(B.itemid)+'" />')}else{if(B.itemtype==2){if(parseInt(B.quality)==8){A=lang("get")+'：<span class="colorwords" style="color:'+helper.getItemColor(B.quality)+'">'+B.itemname+"</span>"}else{A=lang("get")+'：<span style="color:'+helper.getItemColor(B.quality)+'">'+B.itemname+"</span>"}C.find(".itembox").addClass("c_i_bj"+B.quality).html('<img src="'+staticUrl+"img/pop/talent_item"+B.itemid+'.png" />');var G=JSON.stringify({"itemname":B.itemname,"quality":B.quality,"url":staticUrl+"img/pop/talent_item"+B.itemid+".png"});xGame.xsSet(player.info.uid+"getitem",G,true)}}}}}if(A!=""){C.find(".getitem").children("p").html(A)}else{C.find("#battleend_main").attr("class","main type2")}var F=function(J){C.find(".replay_btn").off();C.find(".confirm_btn").off();C.find(".share_btn").unbind("touchend");miscpop.hide("battleendpop");E.destoryAllBombFlower();xGame.xsRemove(player.info.uid+"enterbattle_data",true);if(B.win<0){xGame.xsSet(player.info.uid+"islose","1",true);if(xGame.guide==false&&player.info.missionlevel==1&&player.info.missionstage==2){var K=xGame.xsGet(player.info.uid+"gozhangliang",true);if(K){xGame.xsRemove(player.info.uid+"gozhangliang",true);xGame.xsSet(player.info.uid+"zhanglianglose",1,true)}}}if(B.levelup&&B.levelup==1){xGame.xsSet(player.info.uid+"levelup",1,true);if(B.levelReward){xGame.xsSet(player.info.uid+"levelReward",JSON.stringify(B.levelReward),true)}if(B.levelFunc){xGame.xsSet(player.info.uid+"levelFunc",JSON.stringify(B.levelFunc),true)}}if(B.generalstatus&&B.generalstatus==1){xGame.xsSet(player.info.uid+"getgeneral",JSON.stringify(B.generalinfo),true)}if((xGame.guide==true&&guide.now>=1809&&B.openstatus==1)||(xGame.guide==false&&B.openstatus==1)){xGame.xsSet(player.info.uid+"guanqiadone",B.missionlevel,true)}else{if(B.openstatus==2){xGame.xsSet(player.info.uid+"shilidone",B.get_level,true);if(B.missionlevel==0&&B.missionstage==0){xGame.xsSet(player.info.uid+"shilialldone","solo")}}}xGame.loadWorld("map");F=null;C=null;J.preventDefault();J.stopPropagation()};C.find(".confirm_btn").unbind("touchend").one("touchend",F);C.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");E.destoryAllBombFlower();battleWorld.refight()});if(B.report>0&&B.win>0){C.find(".share_btn").unbind("touchend").bind("touchend",function(){var J=$(this);var K=xGame.xsGet(player.info.uid+"enterbattle_data",true);if(K){K=JSON.parse(K);K.c="map";K.m="send_to_chat";K.report=B.report;K.win=B.win;miscpop.shareBattle(K,J)}else{xGame.toast.show(lang("can_not_share_report"))}});if(xGame.guide==false){E.socialShareDisplay(H,"battle")}}else{C.find(".share_btn").addClass("disable")}C.show();if(B.win==3){E.createBombFlower()}xGame.showGuide([3,6,102,105,108,202,205,208,302,305,603,606,613,616,702,705,708,711,714,721,724]);if(xGame.guide){guide.updateStep(B.win)}},enterBattleFromMine:function(C,A,B){$("#worldloading").addClass("black").show();setTimeout(function(){xGame.loadBattle(C,function(){miscpop.battleResultFromMine(C,A,B)},"exploit")},500)},battleResultFromMine:function(G,A,B){var C=this;C.clearflower=false;var D=xGame.loadPopTmpl("battleend");D.find("#battleend_main").attr("class","main type4").html('<p class="tips"></p>');var E;if(G.info.win>0){E="flagwin"+G.info.win;if(parseInt(B)==3){D.find("#battleend_main").children("p").html(lang("rob_mine_from_3",[G.info.name])+'<em style="background: url('+staticUrl+'img/pop/pop_gem2.png)  0 50% no-repeat;padding-left: 50px;display:inline-block;">'+G.info.get_silver+"</em>")}else{if(parseInt(B)==4){D.find("#battleend_main").children("p").html(lang("rob_mine_from_4",[G.info.name])+'<em style="background: url('+staticUrl+'img/pop/pop_gem3.png)  0 50% no-repeat;padding-left: 50px;display:inline-block;">'+G.info.get_silver+"</em>")}else{D.find("#battleend_main").children("p").html(lang("rob_mine_from",[G.info.name])+'<em style="background: url('+staticUrl+'img/common/header_money.png)  0 50% no-repeat;padding-left: 50px;display:inline-block;">'+G.info.get_silver+"</em>")}}}else{if(G.info.win==0){E="flaglose"+Math.abs(G.info.win);D.find(".flagbg").addClass("equal");D.find("#battleend_main").children("p").html(lang("you_mine_fail"))}else{E="flaglose"+Math.abs(G.info.win);D.find(".flagbg").addClass("lose");D.find("#battleend_main").children("p").html(lang("you_mine_fail"))}}D.find(".flag").addClass(E);var F=function(){miscpop.hide("battleendpop");xGame.loadWorld("mine",{win:G.info.win})};D.find(".confirm_btn").unbind("touchend").one("touchend",F);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");C.destoryAllBombFlower();battleWorld.refight()});if(G.info.report>0){D.find(".share_btn").unbind("touchend").bind("touchend",function(){var H=$(this);miscpop.shareBattle({c:"mine",m:"send_to_chat",touid:A,report:G.info.report,win:G.info.win,},H)});if(G.share){C.socialShareDisplay(G.share,"mine")}}else{D.find(".share_btn").addClass("disable")}D.show();D=null;if(G.win==3){C.createBombFlower()}},enterBattleFromCountryMine:function(B,A){$("#worldloading").addClass("black").show();setTimeout(function(){xGame.loadBattle(B,function(){miscpop.battleResultFromCountryMine(B,A)},"countrymine")},500)},battleResultFromCountryMine:function(F,A){var B=this;B.clearflower=false;var C=xGame.loadPopTmpl("battleend");C.find("#battleend_main").attr("class","main type4").html('<p class="tips"></p>');var D;if(F.info.win>0){D="flagwin"+F.info.win;C.find("#battleend_main").children("p").html(lang("countrymine_rob_from",[F.info.name])+'<em class="chapter">'+F.info.jade+"</em>"+(F.info.event_type==2?'<em class="red">('+F.info.event_value+"%)</em>":""))}else{if(F.info.win==0){D="flaglose"+Math.abs(F.info.win);C.find(".flagbg").addClass("equal");C.find("#battleend_main").children("p").html(lang("you_mine_fail2"))}else{D="flaglose"+Math.abs(F.info.win);C.find(".flagbg").addClass("lose");C.find("#battleend_main").children("p").html(lang("you_mine_fail2"))}}C.find(".flag").addClass(D);var E=function(){miscpop.hide("battleendpop");xGame.loadWorld("countrymine",F.info)};C.find(".confirm_btn").unbind("touchend").one("touchend",E);C.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");B.destoryAllBombFlower();battleWorld.refight()});if(F.info.report>0){C.find(".share_btn").unbind("touchend").bind("touchend",function(){var G=$(this);miscpop.shareBattle({c:"countrymine",m:"send_to_chat",touid:A,report:F.info.report,win:F.info.win,},G)});if(F.share){B.socialShareDisplay(F.share,"countrymine")}}else{C.find(".share_btn").addClass("disable")}if(F.info.win>0&&F.info.event_status==1){miscpop.showCountrymineSp(F.info.event_name,F.info.event_type,F.info.event_value,F.info.jade,F.info.event_add,F.info.all_gold,F.info,function(){C.show();C=null})}else{C.show();C=null}if(F.win==3){B.createBombFlower()}},showCountrymineSp:function(K,E,H,F,B,A,D,I){var C=xGame.loadPopTmpl("countryminesp");C.find("#sp_name").html(K);H=parseInt(H);var G="";var L="";if(E!=2){if(E==1){G="gem3"}else{if(E==3){G="gold";player.updateinfo({"gold":A,})}else{if(E==5){G="countrygold"}}}C.find("#sp_reward").html("x"+H).attr("class",G)}else{C.find("#sp_reward").html(lang("countrymine_jade_times",[B,(H-100)+"%"]))}for(var J=1;J<3;J++){if(D["event_type"+J]&&parseInt(D["event_type"+J])!=0){if(parseInt(D["event_type"+J])==78){L+='<span id="buy_deity'+D["event_type"+J]+'">'+lang("overseastradepop_score")+"x"+D["event_value"+J]+"</span>"}else{L+='<span id="buy_deity'+D["event_type"+J]+'" style="background-size: 50px !important;padding-left: 50px;">x'+D["event_value"+J]+"</span>"}}}C.find("#christmas_reward").html(L);C.find("button").unbind("touchend").one("touchend",function(){C.remove();C=null;if(typeof I=="function"){I()}});C.find("#mine_sp").show();xGame.doAnimate(C.find("#mine_sp"),"newhero_scalein","0.5s",function(){xGame.unlock()});G=null;L=null},enterBattleFromArena:function(C,A){arenapop.e.hide();$("#worldloading").addClass("black").show();var B=xGame.nowWorld;setTimeout(function(){xGame.loadBattle(C,function(){miscpop.battleResultFromArena(C,B,A)},"pvp")},500)},battleResultFromArena:function(G,B,A){var C=this;C.clearflower=false;var D=xGame.loadPopTmpl("battleend");D.find("#battleend_main").attr("class","main type4").html('<p class="tips"></p>');var E;if(G.info.win>0){E="flagwin"+G.info.win;if(parseInt(G.info.rank)!=1){D.find("#battleend_main").children("p").html(lang("you_win_msg1",[G.info.rank]))}else{D.find("#battleend_main").children("p").html(lang("you_win_msg2",[G.info.rank]))}}else{if(G.info.win==0){E="flaglose"+Math.abs(G.info.win);D.find(".flagbg").addClass("equal");D.find("#battleend_main").children("p").html(lang("you_lose_msg"))}else{E="flaglose"+Math.abs(G.info.win);D.find(".flagbg").addClass("lose");D.find("#battleend_main").children("p").html(lang("you_lose_msg"))}}D.find(".flag").addClass(E);var F=function(){miscpop.hide("battleendpop");arenapop.e.show();xGame.loadWorld(B)};D.find(".confirm_btn").unbind("touchend").one("touchend",F);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");C.destoryAllBombFlower();battleWorld.refight()});if(G.info.report>0){D.find(".share_btn").unbind("touchend").bind("touchend",function(){var H=$(this);miscpop.shareBattle({c:"arena",m:"send_to_chat",touid:A,report:G.info.report,win:G.info.win,},H)});C.socialShareDisplay(G.share,"arena")}else{D.find(".share_btn").addClass("disable")}D.show();D=null;if(G.info.win==3){C.createBombFlower()}},enterBattleFromTower:function(A,C){$("#worldloading").addClass("black").show();var B=0;if(towerWorld&&towerWorld.nowstarid){B=towerWorld.nowstarid}setTimeout(function(){xGame.loadBattle(A,function(){miscpop.battleResultFromTower(A,B,C)},"tower")},500)},battleResultFromTower:function(B,G,F){var D=this;D.clearflower=false;var C=xGame.loadPopTmpl("battleend");C.find("#battleend_main").attr("class","main type5");var A='<div class="get1">'+lang("get_o_soul")+"<p></p></div>";A+='<div class="add_doggold"></div>';if(B.info.hero_soul.id>0){A+='<div class="getitem"><p>'+lang("get_soul")+'<span></span></p><div class="itembox"></div></div>'}C.find("#battleend_main").html(A);var H;if(B.info.win>0){H="flagwin"+B.info.win}else{if(B.info.win==0){H="flaglose"+Math.abs(B.info.win);C.find(".flagbg").addClass("equal")}else{H="flaglose"+Math.abs(B.info.win);C.find(".flagbg").addClass("lose")}}C.find(".flag").addClass(H);if(parseInt(B.info.firstkill)==1){C.find("#battleend_main").find(".get1").children("p").html("+"+B.info.first_soul_num)}else{C.find("#battleend_main").find(".get1").children("p").html("+"+B.info.reward_soul)}if(B.info.hero_soul.id>0){C.find("#battleend_main").find(".getitem").children("p").children("span").css("color",helper.getItemColor(B.info.hero_soul.quality)).html(B.info.hero_soul.name);C.find(".itembox").addClass("c_i_bj"+B.info.hero_soul.quality).html('<img src="http://img2.hanjiangsanguo.com/hjimg/pop/soul_'+B.info.hero_soul.image+'.png" />')}if(!B.info.get_item1.value||B.info.get_item1.value==0){C.find(".add_doggold").css("display","none")}else{C.find(".add_doggold").html("+"+B.info.get_item1.value)}var E=function(){miscpop.hide("battleendpop");var I=null;if(B.clear!=0){I={clearstar:true}}else{I={starid:G}}xGame.loadWorld("tower",I)};C.find(".confirm_btn").unbind("touchend").one("touchend",E);C.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");D.destoryAllBombFlower();battleWorld.refight()});if(B.info.report>0){C.find(".share_btn").unbind("touchend").bind("touchend",function(){var I=$(this);miscpop.shareBattle({c:"tower",m:"send_to_chat",id:F,report:B.info.report,win:B.info.win,},I)})}else{C.find(".share_btn").addClass("disable")}C.show();C=null;if(B.info.win==3){D.createBombFlower()}},enterBattleFromHeaven:function(A,B){$("#worldloading").addClass("black").show();player.taskaction(20);setTimeout(function(){xGame.loadBattle(A,function(){miscpop.battleResultFromHeaven(A,B)},"heaven")},500)},battleResultFromHeaven:function(C,G){var E=this;E.clearflower=false;var D=xGame.loadPopTmpl("battleend");D.find("#battleend_main").attr("class","main type5");var B='<div class="get1">'+lang("heavenworld_battleend")+'<ul class="material"></ul></div>';D.find("#battleend_main").html(B);var I="";if(parseInt(C.info.firstkill)==1){switch(parseInt(C.info.first_type)){case 1:I+='<li class="refinestone">'+lang("refinestone")+"x"+C.info.first_value+"</li>";break;case 2:I+='<li class="colorstone">'+lang("colorstone")+"x"+C.info.first_value+"</li>";break;case 3:I+='<li class="bloodstone">'+lang("bloodstone")+"x"+C.info.first_value+"</li>";break;default:break}}else{if(parseInt(C.info.refinestone)!=0){I+='<li class="refinestone">'+lang("refinestone")+"x"+C.info.refinestone+"</li>"}if(parseInt(C.info.colorstone)!=0){I+='<li class="colorstone">'+lang("colorstone")+"x"+C.info.colorstone+"</li>"}if(parseInt(C.info.bloodstone)!=0){I+='<li class="bloodstone">'+lang("bloodstone")+"x"+C.info.bloodstone+"</li>"}var A=parseInt(C.info.essence.id);var H=parseInt(C.info.essence.num);if(H!=0){if(A>=1&&A<=6){I+='<li class="equip_essence" style="color:'+helper.getItemColor(C.info.essence.quality)+";background-image:url("+xGame.essence(A)+')">'+lang("equip_ess")+"x"+H+"</li>"}else{if(A>=7&&A<=12){I+='<li class="defense_essence" style="color:'+helper.getItemColor(C.info.essence.quality)+";background-image:url("+xGame.essence(A)+')">'+lang("defense_ess")+"x"+H+"</li>"}else{if(A>=13&&A<=18){I+='<li class="acc_essence" style="color:'+helper.getItemColor(C.info.essence.quality)+";background-image:url("+xGame.essence(A)+')">'+lang("acc_ess")+"x"+H+"</li>"}}}}if(!C.info.general_item||C.info.general_item.num==0){I+=""}else{I+='<li class="add_doggold">'+lang("doggold")+"x"+C.info.general_item.num+"</li>"}}D.find(".material").html(I);var J;if(C.info.win>0){J="flagwin"+C.info.win}else{if(C.info.win==0){J="flaglose"+Math.abs(C.info.win);D.find(".flagbg").addClass("equal")}else{J="flaglose"+Math.abs(C.info.win);D.find(".flagbg").addClass("lose")}}D.find(".flag").addClass(J);var F=function(){miscpop.hide("battleendpop");xGame.loadWorld("heaven")};D.find(".confirm_btn").unbind("touchend").one("touchend",function(){F()});D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");E.destoryAllBombFlower();battleWorld.refight()});if(C.info.report>0){D.find(".share_btn").unbind("touchend").bind("touchend",function(){var K=$(this);miscpop.shareBattle({c:"heaven",m:"send_to_chat",id:G,report:C.info.report,win:C.info.win,},K)})}else{D.find(".share_btn").addClass("disable")}D.show();D=null;if(C.info.win==3){E.createBombFlower()}},enterBattleFromZhulu:function(C,A){zhulupop.e.hide();$("#worldloading").addClass("black").show();var B=xGame.nowWorld;setTimeout(function(){xGame.loadBattle(C,function(){miscpop.battleResultFromZhulu(C,B,A)},"pvp")},500)},battleResultFromZhulu:function(G,B,A){var C=this;C.clearflower=false;var D=xGame.loadPopTmpl("battleend");D.find("#battleend_main").attr("class","main type4").html('<p class="tips"></p>');var E;if(G.info.win>0){E="flagwin"+G.info.win;if(parseInt(G.info.rank)!=1){D.find("#battleend_main").children("p").html(lang("you_win_msg1",[G.info.rank]))}else{D.find("#battleend_main").children("p").html(lang("you_win_msg2",[G.info.rank]))}}else{if(G.info.win==0){E="flaglose"+Math.abs(G.info.win);D.find(".flagbg").addClass("equal");D.find("#battleend_main").children("p").html(lang("you_lose_msg"))}else{E="flaglose"+Math.abs(G.info.win);D.find(".flagbg").addClass("lose");D.find("#battleend_main").children("p").html(lang("you_lose_msg"))}}D.find(".flag").addClass(E);var F=function(H){miscpop.hide("battleendpop");zhulupop.e.show();xGame.loadWorld(B);H.preventDefault();H.stopPropagation();return false};D.find(".confirm_btn").unbind("touchend").one("touchend",F);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");C.destoryAllBombFlower();battleWorld.refight()});if(G.info.report>0){D.find(".share_btn").unbind("touchend").bind("touchend",function(){var H=$(this);miscpop.shareBattle({c:"compete",m:"send_to_chat",touid:A,report:G.info.report,win:G.info.win,},H)});C.socialShareDisplay(G.share,"compete")}else{D.find(".share_btn").addClass("disable")}D.show();D=null;if(G.info.win==3){C.createBombFlower()}},treasureEnemyInfo:function(C){var A=this;var B=function(E){if(E.status==4){xGame.confirm.show(lang("jinyindong"),lang("re_enter_jyd"),1,function(){xGame.confirm.hide(function(){miscpop.hide("treasureenemypop");xGame.loadWorld("treasure")})});A=null;B=null;xGame.unlock();return false}else{if(E.status!=1){xGame.toast.show(lang("can_not_get_hero_error")+E.status);A=null;B=null;xGame.unlock();return false}}var D=xGame.loadPopTmpl("treasureenemy");var F=function(H){H.find(".content").find(".hidebtn").unbind("touchend");H.find("#attack_normal_btn").unbind("touchend");H.find("#strategy_btn").unbind("touchend");H=null};D.find(".content").find(".hidebtn").unbind("touchend").bind("touchend",function(H){if(xGame.checkLock(true)){return false}miscpop.hide("treasureenemypop");H.preventDefault();H.stopPropagation();F(D);F=null});var G="url("+xGame.avatar(E.info.image)+") 50% 50% no-repeat";D.find(".avatarbox").children(".avatar").css({"background":G});D.find(".avatarbox").children("p").text(E.info.name);D.find(".herolv").children("span").text("Lv."+E.info.monsterlevel);D.find(".reward_silver").children("span").text("+"+E.info.silver);D.find(".reward_gold").children("span").text("+"+E.info.gold);D.find("#attack_act_cost").html(E.info.act+lang("act"));D.find("#attack_normal_btn").unbind("touchend").bind("touchend",function(){miscpop.enterBattleFromTreasure({id:C});F(D);F=null});D.find("#strategy_btn").unbind("touchend").bind("touchend",function(H){xGame.showpop("strategy",{"name":E.info.name,"c":"island","m":"get_report_list","id":C});H.preventDefault();H.stopPropagation()});D.show();A=null;B=null;xGame.unlock()};loadContents({"c":"island","m":"get_mission","id":C},B)},enterBattleFromTreasure:function(B){if(xGame.checkLock()){return false}var A=function(D){var C="";if(D.status==4){C=lang("act_can_not_atk")}else{if(D.status==2){C=lang("hero_closed")}else{if(D.status==-1){C=lang("please_clear_battle_cd")}else{if(D.status==3){C=lang("atk_fail_lv_not_match")}else{if(D.status!=1){C=lang("atk_fail_error")+D.status}}}}}if(C!=""){miscpop.hide("treasureenemypop");xGame.unlock();if(D.status==4){xGame.buyActConfirm()}else{xGame.toast.show(C)}return}player.taskaction(9);var E={};E.battlecd=D.info.cd;E.act=D.info.act;E.gold=parseInt(player.info.gold)+parseInt(D.info.reward_gold);E.silver=parseInt(player.info.silver)+parseInt(D.info.reward_silver);player.updateinfo(E);xGame.updateCd("battle",E.battlecd);E=null;$("#worldloading").addClass("black").show();miscpop.hide("treasureenemypop");setTimeout(function(){xGame.loadBattle(D,function(){miscpop.battleResultFromTreasure(D,B.id)},"treasure")},500)};loadContents({"c":"island","m":"pk","id":B.id},A)},battleResultFromTreasure:function(F,D){var C=this;C.clearflower=false;var B=xGame.loadPopTmpl("battleend");var A;if(F.info.win>0){B.find("#battleend_main").attr("class","main type1").html('<div class="get1">'+lang("get_un_get")+"</div>");A="flagwin"+F.info.win;if(F.info.reward_gold>0){B.find("#battleend_main").find(".get1").children("p").attr("class","gold").html(F.info.reward_gold)}if(F.info.reward_silver>0){B.find("#battleend_main").find(".get2").children("p").attr("class","silver").html(F.info.reward_silver)}}else{if(F.info.win==0){A="flaglose"+Math.abs(F.info.win);B.find(".flagbg").addClass("equal");B.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("lose_msg")+"</p>")}else{A="flaglose"+Math.abs(F.info.win);B.find(".flagbg").addClass("lose");B.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("lose_msg")+"</p>")}}B.find(".flag").addClass(A);var E=function(){miscpop.hide("battleendpop");xGame.loadWorld("treasure")};B.find(".confirm_btn").unbind("touchend").one("touchend",E);B.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");C.destoryAllBombFlower();battleWorld.refight()});if(F.info.report>0&&F.info.win>0){B.find(".share_btn").unbind("touchend").bind("touchend",function(){var G=$(this);miscpop.shareBattle({c:"island",m:"send_to_chat",id:D,report:F.info.report,win:F.info.win,},G)})}else{B.find(".share_btn").addClass("disable")}B.show();B=null;if(F.info.win==3){C.createBombFlower()}},enterBattleFromNian:function(B){if(xGame.checkLock()){return false}var A=function(C){xGame.unlock();switch(C.status){case 1:if(B==1){player.updateinfo({"gold":parseInt(C.info.all_gold)})}$("#worldloading").addClass("black").show();setTimeout(function(){xGame.loadBattle(C,function(){miscpop.battleResultFromNian(C)},"newyearboss")},500);break;case -1:xGame.toast.show(lang("activity_closed"));break;case -2:xGame.toast.show(lang("nian_attack_countdown"));break;case -3:xGame.toast.show(lang("nian_cd_not_clear"));case -4:xGame.toast.show(lang("nian_die"));break;case -5:xGame.toast.show(lang("no_gold_buy_life"));break;case -6:xGame.toast.show(lang("nian_attack_not_countdown"));break}};loadContents({"c":"newyearboss","m":"battle","now":B},A)},battleResultFromNian:function(E){var B=this;B.clearflower=false;var C=xGame.loadPopTmpl("battleend");C.find(".getinfobox").hide();var A;if(E.info.win>0){A="flagwin"+E.info.win;C.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("you_kill_boss")+"</p>")}else{if(E.info.win==0){A="flaglose"+Math.abs(E.info.win);C.find(".flagbg").addClass("equal");C.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("lose_msg")+"</p>")}else{A="flaglose"+Math.abs(E.info.win);C.find(".flagbg").addClass("lose");C.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("lose_msg")+"</p>")}}C.find(".flag").addClass(A);var D=function(){miscpop.hide("battleendpop");xGame.loadWorld("nian")};C.find(".confirm_btn").unbind("touchend").one("touchend",D);C.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");B.destoryAllBombFlower();battleWorld.refight()});C.find(".share_btn").addClass("disable");C.show();C=null;if(E.info.win==3){B.createBombFlower()}},enterBattleFromBoss:function(B){if(xGame.checkLock()){return false}var A=function(C){xGame.unlock();switch(C.status){case 1:if(B==1){player.updateinfo({"gold":parseInt(C.info.all_gold)})}$("#worldloading").addClass("black").show();setTimeout(function(){xGame.loadBattle(C,function(){miscpop.battleResultFromBoss(C)},"worldboss")},500);break;case 2:bossWorld.indexdata.countdown=C.info.cd;xGame.toast.show(lang("re_life"));break;case 3:xGame.goPay(lang("no_gold_buy_life"));break;case 5:xGame.toast.show(lang("boss_is_killed"));break;default:xGame.toast.show(lang("enter_battle_fail"));break}};loadContents({"c":"worldboss","m":"battle","now":B},A)},battleResultFromBoss:function(E){var B=this;B.clearflower=false;var C=xGame.loadPopTmpl("battleend");C.find(".getinfobox").hide();var A;if(E.info.win>0){A="flagwin"+E.info.win;C.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("you_kill_boss")+"</p>")}else{if(E.info.win==0){A="flaglose"+Math.abs(E.info.win);C.find(".flagbg").addClass("equal");C.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("lose_msg")+"</p>")}else{A="flaglose"+Math.abs(E.info.win);C.find(".flagbg").addClass("lose");C.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("lose_msg")+"</p>")}}C.find(".flag").addClass(A);var D=function(){C.find(".confirm_btn").off();C.find(".replay_btn").off();miscpop.hide("battleendpop");xGame.loadWorld("boss");C=null};C.find(".confirm_btn").unbind("touchend").one("touchend",D);C.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");B.destoryAllBombFlower();battleWorld.refight()});C.find(".share_btn").addClass("disable");C.show();if(E.info.win==3){B.createBombFlower()}},enterBattleFromCountryBoss:function(B){if(xGame.checkLock()){return false}var A=function(D){xGame.unlock();switch(D.status){case 1:if(B==1){player.updateinfo({"gold":parseInt(D.info.all_gold)})}countrybossWorld.diceAnim(D.dice[1],D);break;case 2:countrybossWorld.indexdata.countdown=D.info.cd;xGame.toast.show(lang("re_life"));break;case 3:xGame.goPay(lang("no_gold_buy_life"));break;case 4:xGame.toast.show(lang("boss_is_killed"));var C={};C.info={};C.info.win=3;C.no_replay=true;countrybossWorld.showPrepare(true);miscpop.countryBossReward(C);break;case 5:xGame.toast.show(lang("boss_is_killed"));var C={};C.info={};C.info.win=3;C.no_replay=true;countrybossWorld.showPrepare(true);miscpop.countryBossReward(C);xGame.updateCd("cBossButton",0);xGame.updateCd("cBoss",0);break;default:xGame.toast.show(lang("enter_battle_fail"));break}};loadContents({"c":"countryboss","m":"battle","now":B},A)},countryBossReward:function(B){if(xGame.checkLock()){return false}var A=function(C){xGame.unlock();switch(C.status){case 1:B.rewardInfo=C.reward;miscpop.newbattleResultFromCountryBoss(C);break;case 2:xGame.toast.show(lang("no_reward"));break;default:xGame.toast.show(lang("undefined_error"));break}};loadContents({"c":"countryboss","m":"reward",},A)},battleResultFromCountryBoss:function(B,A){var E=this;E.clearflower=false;var C=xGame.loadPopTmpl("battleend");C.find(".getinfobox").hide();var H;var G="";if(A!=undefined){if(A.jadenum>0){G+='<div class="box">';G+='<p class="rank">'+lang("current_rank",[A.rank])+(A.lasthit==1?'<em style="color:red;">(+50%)</em>':"")+"</p>";G+='<div class="itembox c_i_bj'+(parseInt(A.jadetype)+2)+'" ><span class="gem'+A.jadetype+'"></span><b>x'+A.jadenum+"</b></div>";G+="</div>"}if(A.itemnum>0){G+='<div class="box isitem">';var D="x"+A.itemnum;G+="<p>"+lang("get")+':<em style="color:'+helper.getItemColor(A.quality)+'">'+A.itemname+D+"</em></p>";G+='<div class="itembox c_i_bj'+A.quality+'" ><span style="background-image:url('+xGame.itemurl(A.itemid)+');"></span><b>'+D+"</b></div>";G+="</div>";D=null}if(A.lasthit==1){G+='<div class="last"></div>'}}if(B.info.win>0){H="flagwin4";if(parseInt(countrybossWorld.bosshurt)==1){C.find("#battleend_main").attr("class","main type7").html("<p>"+lang("you_kill_countryboss")+'</p><div class="hurt_num">'+lang("boss_hert_num",[B.hit,B.hit_multiple])+"</div>")}else{C.find("#battleend_main").attr("class","main type7").html("<p>"+lang("you_kill_countryboss")+"</p>")}}else{if(B.info.win==0){H="flaglose"+Math.abs(B.info.win);C.find(".flagbg").addClass("equal");if(parseInt(countrybossWorld.bosshurt)==1){C.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("lose_msg")+'</p><div class="hurt_num">'+lang("boss_hert_num",[B.hit,B.hit_multiple])+"</div>")}else{C.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("lose_msg")+"</p>")}}else{H="flaglose4";C.find(".flagbg").addClass("lose");if(A!=undefined){C.find("#battleend_main").attr("class","main type7").html(G)}else{if(parseInt(countrybossWorld.bosshurt)==1){C.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("lose_msg")+'</p><div class="hurt_num">'+lang("boss_hert_num",[B.hit,B.hit_multiple])+"</div>")}else{C.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("lose_msg")+"</p>")}}}}C.find(".flag").addClass(H);if(B.no_replay){C.find(".replay_btn").addClass("disable");C.find(".confirm_btn").html(lang("receive")).unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop")})}else{var F=function(){miscpop.hide("battleendpop");xGame.loadWorld("countryboss");setTimeout(function(){countrybossWorld.gotoBoss()},100)};C.find(".confirm_btn").unbind("touchend").one("touchend",F);C.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");E.destoryAllBombFlower();battleWorld.refight()})}C.find(".share_btn").addClass("disable");C.show();C=null;if(B.info.win==3){E.createBombFlower()}},newbattleResultFromCountryBoss:function(E){var D=this;var B=xGame.loadPopTmpl("battleend");B.find(".content").css("display","none");B.find(".countryboss").css("display","block");B.find(".countryboss .country_rank").html(lang("countryBoss_rank_title",[E.rank]));var G=E.reward;var A="";for(var C=1;C<4;C++){if(parseInt(G["reward_type"+C])!=0){A+='<div class="box">';if(parseInt(G["reward_type"+C])==8){A+='<span class="rtype rtype'+G["reward_type"+C]+'" id="addrtype'+G["reward_type"+C]+'" style="background-image: url('+xGame.itemurl(G["reward_info"+C].id)+');background-size:70px;"></span>';if(G["reward_info"+C].quality==8){A+='<span class="num"><em class="colorwords" style="color:'+helper.getItemColor(G["reward_info"+C].quality)+'">'+G["reward_info"+C].name+"</em></span>"}else{A+='<span class="num" style="color:'+helper.getItemColor(G["reward_info"+C].quality)+'">'+G["reward_info"+C].name+"</span>"}}else{if(parseInt(G["reward_type"+C])==12){A+='<span class="rtype rtype'+G["reward_type"+C]+'" id="addrtype'+G["reward_type"+C]+'" style="background-image:url('+xGame.avatar(G["reward_info"+C].image)+');background-size:70px;"></span>';A+='<span class="num">'+G["reward_info"+C].name+"</span>"}else{if(parseInt(G["reward_type"+C])>=17&&parseInt(G["reward_type"+C])<=25){A+='<span class="rtype essence rtype'+G["reward_type"+C]+'" id="addrtype'+G["reward_type"+C]+'" style="background-image:url('+xGame.essence(G["reward_info"+C].id)+');background-size:40px;"></span>';A+='<span class="num">x'+G["reward_value"+C]+"</span>"}else{if(parseInt(G["reward_type"+C])==26||parseInt(G["reward_type"+C])==34){A+='<span class="rtype horse rtype'+G["reward_type"+C]+'" id="addrtype'+G["reward_type"+C]+'" style="background-position:'+helper.getHorsePostion("small",G["reward_info"+C].id)+';"></span>';if(parseInt(G["reward_type"+C])==34){A+='<span class="itempart"></span>'}}else{if(parseInt(G["reward_type"+C])==29){A+='<span class="rtype rtype'+G["reward_type"+C]+'" id="addrtype'+G["reward_type"+C]+'" style="background-image:url('+xGame.forgeMaterial(G["reward_info"+C].materials_id)+');background-size:55px;"></span>';A+='<span class="num">x'+G["reward_value"+C]+"</span>"}else{if(parseInt(G["reward_type"+C])==45){A+='<span class="rtype rtype'+G["reward_type"+C]+'" id="addrtype'+G["reward_type"+C]+'"  style="background-image:url('+xGame.drumurl(G["reward_info"+C].id)+');background-size:40px;"></span>';A+='<span class="num">x'+G["reward_value"+C]+"</span>"}else{if((G["reward_type"+C]>=46&&G["reward_type"+C]<=49)||(G["reward_type"+C]>=53&&G["reward_type"+C]<=56)){A+='<span class="rtype stone rtype'+G["reward_type"+C]+'" id="addrtype'+G["reward_type"+C]+'" style="background-image:url('+xGame.gem(G["reward_info"+C].gem_type,G["reward_info"+C].gem_quality)+');background-size:40px;"></span>';A+='<span class="num">x'+G["reward_value"+C]+"</span>"}else{if(G["reward_type"+C]==50){A+='<span class="rtype rtype'+G["reward_type"+C]+'" id="addrtype'+G["reward_type"+C]+'" style="background-image:url(http://img2.hanjiangsanguo.com/hjimg/pop/soul_'+G["reward_info"+C].image+'.png);background-size:40px;"></span>';A+='<span class="num">x'+G["reward_value"+C]+"</span>"}else{if(G["reward_type"+C]==52){A+='<span class="rtype rtype'+G["reward_type"+C]+'" id="addrtype'+G["reward_type"+C]+'" style="background-image:url('+xGame.runeurl(G["reward_info"+C].type,Math.ceil(parseInt(G["reward_info"+C].quality)/5))+');background-size:40px;"></span>';A+='<span class="num">x'+G["reward_value"+C]+"</span>"}else{if(G["reward_type"+C]==73){A+='<span class="rtype rtype'+G["reward_type"+C]+'" id="addrtype'+G["reward_type"+C]+'" style="background-image:url('+xGame.awankeImg(G["reward_info"+C].image)+');"></span>';A+='<span class="num">'+G["reward_info"+C].name+"</span>"}else{A+='<span class="rtype rtype'+G["reward_type"+C]+'" id="addrtype'+G["reward_type"+C]+'"></span>';A+='<span class="num">x'+G["reward_value"+C]+"</span>"}}}}}}}}}}A+="</div>"}}B.find(".countryboss .reward").html(A);A=null;var F=function(){miscpop.hide("battleendpop");xGame.loadWorld("city")};B.find(".confirm_btn").unbind("touchend").one("touchend",F);B.show();B=null},viewBattleFromMap:function(B){if(xGame.checkLock()){return false}var A=function(C){xGame.unlock();if(C.status==1){$("#worldloading").addClass("black").show();strategypop.e.hide();$("#enemypop").hide();setTimeout(function(){xGame.loadBattle(C,null,C.info.background,function(){xGame.loadWorld("map");strategypop.e.show();$("#enemypop").show()})},500)}else{xGame.toast.show(lang("can_not_view_current_report"))}};loadContents({"c":"map","m":"report_detail","id":B},A)},viewBattleFromTreasure:function(B){if(xGame.checkLock()){return false}var A=function(C){xGame.unlock();if(C.status==1){$("#worldloading").addClass("black").show();strategypop.e.hide();$("#treasureenemypop").hide();setTimeout(function(){xGame.loadBattle(C,null,"treasure",function(){xGame.loadWorld("treasure");strategypop.e.show();$("#treasureenemypop").show()})},500)}else{xGame.toast.show(lang("can_not_view_current_report"))}};loadContents({"c":"island","m":"get_report_info","id":B},A)},viewBattleFromWorldarena:function(B){var A=function(C){if(C.status==1){$("#worldloading").addClass("black").show();worldarenapop.e.hide();setTimeout(function(){xGame.loadBattle(C,null,"worldarena",function(){worldarenapop.e.show();xGame.loadWorld("city")})},500)}else{xGame.toast.show(lang("can_not_view_current_report"))}};loadContents({"c":"worldarena","m":"get_report_info","id":B},A)},viewBattleFromGeneraltask:function(D,C,B){if(xGame.checkLock()){return false}var A=function(E){xGame.unlock();if(E.status==1){$("#worldloading").addClass("black").show();strategypop.e.hide();setTimeout(function(){xGame.loadBattle(E,null,"generaltask",function(){xGame.loadWorld("generaltask",{"generalid":C,"page":B});strategypop.e.show()})},500)}else{xGame.toast.show(lang("can_not_view_current_report"))}};loadContents({"c":"generaltask","m":"get_report","id":D},A)},viewBattleFromOverseastrade:function(B){if(xGame.checkLock()){return false}var A=function(C){xGame.unlock();if(C.status==1){$("#worldloading").addClass("black").show();overseastradepop.e.hide();setTimeout(function(){xGame.loadBattle(C,null,"overseastrade",function(){xGame.loadWorld("city");overseastradepop.e.show()})},500)}else{xGame.toast.show(lang("can_not_view_current_report"))}};loadContents({"c":"overseastrade","m":"get_report_info","id":B},A)},viewBattleFromActchrist:function(B){if(xGame.checkLock()){return false}var A=function(C){xGame.unlock();if(C.status==1){$("#worldloading").addClass("black").show();actchristmaspop.e.hide();setTimeout(function(){xGame.loadBattle(C,null,"overseastrade",function(){xGame.loadWorld("city");actchristmaspop.e.show()})},500)}else{xGame.toast.show(lang("can_not_view_current_report"))}};loadContents({"c":"overseastrade","m":"get_report_info","id":B},A)},viewBattleFromTower:function(B){if(xGame.checkLock()){return false}var A=function(C){xGame.unlock();if(C.status==1){$("#worldloading").addClass("black").show();strategypop.e.hide();var D=0;if(towerWorld&&towerWorld.nowstarid){D=towerWorld.nowstarid}setTimeout(function(){xGame.loadBattle(C,null,"tower",function(){xGame.loadWorld("tower",{starid:D});strategypop.e.show()})},500)}else{xGame.toast.show(lang("can_not_view_current_report"))}};loadContents({"c":"tower","m":"get_report_info","id":B},A)},viewBattleFromHeaven:function(B){if(xGame.checkLock()){return false}var A=function(C){xGame.unlock();if(C.status==1){$("#worldloading").addClass("black").show();strategypop.e.hide();setTimeout(function(){xGame.loadBattle(C,null,"heaven",function(){xGame.loadWorld("heaven");strategypop.e.show()})},500)}else{xGame.toast.show(lang("can_not_view_current_report"))}};loadContents({"c":"heaven","m":"get_report_info","id":B},A)},towerRewardbox:function(){var A=this;var B=function(D){if(D.status==2){xGame.toast.show(lang("today_had_receive"));return false}else{if(D.status==3){xGame.toast.show(lang("no_battle_reward"));return false}else{if(D.status!=1){xGame.toast.show(lang("no_reward_try_again"));return false}}}var C=xGame.loadPopTmpl("towerreward");var E=function(F){F.find(".content").find(".hidebtn").unbind("touchend");F.undelegate(".addtype","touchend");F=null};C.find(".content").find(".hidebtn").unbind("touchend").bind("touchend",function(F){if(xGame.checkLock(true)){return false}miscpop.hide("towerrewardpop");F.preventDefault();F.stopPropagation();E(C);E=null});C.find(".nowtower").html(lang("stage_mission",[D.info.stage,D.info.mission]));C.find(".nowsoul").html(" x"+D.base_reward+((D.effect!=0&&D.effect!=undefined)?'<em style="color:red;"> ( '+D.effect+"% "+lang("workshop_country_addition")+")</em>":""));C.find("#addtype1").html('<em></em><p class="price">'+lang("cost_get",[D.normal_reward.gold,D.normal_reward.multiple])+"</p>").attr("soulnum",parseInt(D.base_reward)*parseFloat(D.normal_reward.multiple));C.find("#addtype2").html('<em></em><p class="price">'+lang("cost_get",[D.best_reward.gold,D.best_reward.multiple])+"</p>").attr("soulnum",parseInt(D.base_reward)*parseFloat(D.best_reward.multiple));C.undelegate(".addtype","touchend").delegate(".addtype","touchend",function(F){F.preventDefault();F.stopPropagation();if($(this).hasClass("now")){$(this).removeClass("now")}else{C.find(".addtype").removeClass("now");$(this).addClass("now")}});C.find("#fetch_btn").attr("soulnum",D.base_reward).unbind("touchend").bind("touchend",function(G){G.preventDefault();G.stopPropagation();var J=C.find(".addtype.now");if(J.length>0){var F=J.attr("addtype");var I=parseFloat(J.attr("soulnum"))}else{var F=3;var I=parseInt($(this).attr("soulnum"))}var H=function(K){if(K.status==2){xGame.toast.show(lang("had_receive"));return false}else{if(K.status==4){xGame.goPay(lang("gold_plus_reward"));return false}else{if(K.status!=1){xGame.toast.show(lang("reward_get_fail"));return false}else{player.updateinfo({"gold":parseInt(K.gold)});xGame.toast.show(lang("get_original_soul",[I]));miscpop.hide("towerrewardpop")}}}};loadContents({"c":"tower","m":"get_reward","type":F},H)});C.show();xGame.unlock()};loadContents({"c":"tower","m":"reward_info"},B)},heavenRewardbox:function(){var A=this;if(xGame.checkLock()){return false}var B=function(F){xGame.unlock();if(F.status==2){xGame.toast.show(lang("today_had_receive"));return false}else{if(F.status==3){xGame.toast.show(lang("no_battle_reward"));return false}else{if(F.status==-1){xGame.toast.show(lang("lv_not_enough"));return false}else{if(F.status==-2){xGame.toast.show(lang("heavenworld_err1"));return false}else{if(F.status==-3){xGame.toast.show(lang("heavenworld_err2"));return false}else{if(F.status==-4){xGame.toast.show(lang("heavenworld_err3"));return false}else{if(F.status!=1){xGame.toast.show(lang("no_reward_try_again"));return false}}}}}}}var D=xGame.loadPopTmpl("heavenreward");var G=function(I){I.find(".content").find(".hidebtn").unbind("touchend");I.undelegate(".addtype","touchend");I.find("#fetch_btn").unbind("touchend")};var C=null;D.find(".content").find(".hidebtn").unbind("touchend").bind("touchend",function(I){if(xGame.checkLock(true)){return false}miscpop.hide("heavenrewardpop");if(C!=null){clearTimeout(C);C=null}I.preventDefault();I.stopPropagation();G(D);G=null});function H(L){var I="";var K=0;var J=1;I+='<div class="heavenreward_reward_box">';if(parseInt(L.refinestone)!=0){I+='<span class="reward_down pos'+J+'"><em class="refinestone"></em>x'+L.refinestone+"</span>";J++}if(parseInt(L.colorstone)!=0){I+='<span class="reward_down pos'+J+'"><em class="colorstone"></em>x'+L.colorstone+"</span>";J++}if(parseInt(L.bloodstone)!=0){I+='<span class="reward_down pos'+J+'"><em class="bloodstone"></em>x'+L.bloodstone+"</span>"}I+="</div>";$("#heavenrewardpop_wrap").append(I);C=setTimeout(function(){miscpop.hide("heavenrewardpop")},3000);I=null}function E(J,L,K){var I="";if(J){I+='<span class="stone refinestone">'+(parseInt(J)>=100000?player.getWan(J):J)+"</span>"}if(L){I+='<span class="stone colorstone">'+(parseInt(L)>=100000?player.getWan(L):L)+"</span>"}if(K){I+='<span class="stone bloodstone">'+(parseInt(K)>=100000?player.getWan(K):K)+"</span>"}return I}D.find(".nowheaven").html(lang("heavenworld_floor",[F.info.mission])+'<em class="name">'+F.info.name+"</em>");D.find(".nowreward").html(F.base_reward);D.find("#addtype1").html('<em class="pigeon"></em><span class="price">'+lang("heavenworld_gold",[F.two_reward.gold])+"</span>"+E(F.two_reward.refine_reward,F.two_reward.color_reward));D.find("#addtype2").html('<em class="pigeon"></em><span class="price">'+lang("heavenworld_gold",[F.four_reward.gold])+"</span>"+E(F.four_reward.refine_reward,F.four_reward.color_reward,F.four_reward.blood_reward));D.find("#addtype3").html('<em class="pigeon"></em><span class="price">'+lang("heavenworld_gold",[F.eight_reward.gold])+"</span>"+E(F.eight_reward.refine_reward,F.eight_reward.color_reward,F.eight_reward.blood_reward));D.undelegate(".addtype","touchend").delegate(".addtype","touchend",function(I){I.preventDefault();I.stopPropagation();if($(this).hasClass("now")){$(this).removeClass("now")}else{D.find(".addtype").removeClass("now");$(this).addClass("now")}});D.find("#fetch_btn").unbind("touchend").bind("touchend",function(J){if(xGame.checkLock()){return false}G(D);G=null;J.preventDefault();J.stopPropagation();var L=D.find(".addtype.now");if(L.length>0){var I=L.attr("addtype")}else{var I=0}var K=function(M){xGame.unlock();if(M.status==2){xGame.toast.show(lang("had_receive"));return false}else{if(M.status==3){xGame.toast.show(lang("no_battle_reward"));return false}else{if(M.status==-1){xGame.toast.show(lang("lv_not_enough"));return false}else{if(M.status==-2){xGame.toast.show(lang("heavenworld_err1"));return false}else{if(M.status==-3){xGame.toast.show(lang("equiprefinepop_refine_msg4"));return false}else{if(M.status==-4){xGame.toast.show(lang("heavenworld_err2"));return false}else{if(M.status==-5){xGame.toast.show(lang("heavenworld_err3"));return false}else{if(M.status==-6){xGame.goPay(lang("gold_not_enough"));return false}else{if(M.status==-7){xGame.toast.show(lang("heavenworld_err17"));return false}else{if(M.status!=1){xGame.toast.show(lang("reward_get_fail"));return false}else{player.updateinfo({"gold":parseInt(M.gold)});heavenWorld.buildTop(M.resource);H(M.reward)}}}}}}}}}}};loadContents({"c":"heaven","m":"get_reward","type":I},K)});D.show();xGame.unlock()};loadContents({"c":"heaven","m":"reward_info"},B)},sanctumRewardbox:function(){var A=this;var C=function(D){switch(parseInt(D)){case 2:xGame.toast.show(lang("sanctumworld_func_close"));break;case -1:xGame.toast.show(lang("get_user_info_fail"));break;case -2:xGame.toast.show(lang("sanctumworld_get_history_fail"));break;case -3:xGame.toast.show(lang("sanctumworld_had_receive"));break;case -4:xGame.toast.show(lang("sanctumworld_unreach"));break;case -5:xGame.toast.show(lang("get_reward_info_fail"));break;case -6:xGame.toast.show(lang("sanctumworld_get_fb_fail"));break;case -7:xGame.toast.show(lang("gold_not_enough"));break;default:xGame.toast.show(lang("undefined_error"));break}};var B=function(E){if(E.status!=1){C(E.status);return false}var D=xGame.loadPopTmpl("towerreward");D.find(".content").find(".hidebtn").unbind("touchend").bind("touchend",function(F){if(xGame.checkLock(true)){return false}C=null;miscpop.hide("towerrewardpop");F.preventDefault();F.stopPropagation()});D.find(".nowtower").html(lang("stage_mission",[E.mission.stage,E.mission.id]));D.find(".nowsoul").html(" x"+E.gem+((E.effect!=0&&E.effect!=undefined)?'<em style="color:red;"> ( '+E.effect+"% "+lang("workshop_country_addition")+")</em>":"")).addClass("gem");D.find("#addtype1").html('<em></em><p class="price">'+lang("cost_get",[E.normal_reward.gold,E.normal_reward.multiple])+"</p>").attr("gemnum",parseInt(E.gem)*parseFloat(E.normal_reward.multiple));D.find("#addtype2").html('<em></em><p class="price">'+lang("cost_get",[E.best_reward.gold,E.best_reward.multiple])+"</p>").attr("gemnum",parseInt(E.gem)*parseFloat(E.best_reward.multiple));D.undelegate(".addtype","touchend").delegate(".addtype","touchend",function(F){D.find(".now").removeClass("now");$(this).addClass("now");F.preventDefault();F.stopPropagation()});D.find("#fetch_btn").attr("gemnum",E.gem).unbind("touchend").bind("touchend",function(G){G.preventDefault();G.stopPropagation();var J=D.find(".addtype.now");if(J.length>0){var F=J.attr("addtype");var I=parseFloat(J.attr("gemnum"))}else{var F=0;var I=parseInt($(this).attr("gemnum"))}var H=function(K){if(K.status!=1){C(K.status);return false}player.updateinfo({"gold":parseInt(K.all_gold)});xGame.toast.show(lang("sanctumworld_receive_gemp",[I]));sanctumWorld.beastStageDom.find("#own_gem").html(K.all_gem);miscpop.hide("towerrewardpop")};loadContents({"c":"sanctum","m":"get_reward","type":1,"multiple":F},H)});D.show();xGame.unlock()};loadContents({"c":"sanctum","m":"get_reward","type":0},B)},viewBattleFromMail:function(D,A,B){if(xGame.checkLock()){return false}var C=function(E){xGame.unlock();if(E.status==1){$("#worldloading").addClass("black").show();if(mailpop&&mailpop.isshow==true){$("#mailpop").hide()}setTimeout(function(){var G=xGame.nowWorld;var F="";if(A=="message"){F="pvp"}else{if(A=="tower"){F="tower"}else{if(A=="heaven"){F="heaven"}else{if(A=="sanctum"){F="sanctum"+B}else{if(A=="map"){F=E.info.background}else{if(A=="treasure"){F="treasure"}else{if(A=="worldarena"){F="worldarena"}else{if(A=="countrybattle"){xGame.loadWorld("countrybattle",E);return}else{if(A=="champions"){F="champions"}else{if(A=="war"){F="war"}else{if(A=="pacify"){F="pacify"+B}else{if(A=="attackJapan"){F="attackJapan"}else{if(A=="essence"){F="essence"+B}else{if(A=="warfield"){F="warfield"}else{if(A=="starbattle"){F=miscpop.starbattle_bg[B-1]}else{if(A=="ladder_war"){F="ladder"}else{if(A=="exploit_tree"){F="exploit"}else{if(A=="exploit_stone"){F="exploit"}else{if(A=="awaken_copy"){F="overseastrade"}else{if(A=="three_talents_pk"){F="threepk"}}}}}}}}}}}}}}}}}}}}xGame.loadBattle(E,null,F,function(){xGame.loadWorld(G);if(mailpop&&mailpop.isshow==true){$("#mailpop").show()}})},500)}else{xGame.toast.show(lang("can_not_view_current_report"))}};if(A=="tower"){loadContents({"c":A,"m":"get_report_info","id":D},C)}else{if(A=="heaven"){loadContents({"c":A,"m":"get_report_info","id":D},C)}else{if(A=="sanctum"){loadContents({"c":"sanctum","m":"get_report_info","id":D},C)}else{if(A=="treasure"){loadContents({"c":"island","m":"get_report_info","id":D},C)}else{if(A=="worldarena"){loadContents({"c":"worldarena","m":"get_report_info","id":D},C)}else{if(A=="countrybattle"){loadContents({"c":"siege","m":"get_report","id":D},C)}else{if(A=="champions"){loadContents({"c":"god","m":"get_report_info","id":D,"stage":B},C)}else{if(A=="war"){loadContents({"c":A,"m":"get_report_info","id":D,"stage":B},C)}else{if(A=="pacify"){loadContents({"c":"copies","m":" get_report_info","d":"newequip","id":D},C)}else{if(A=="attackJapan"){loadContents({"c":"japan","m":"get_report_info","report":D},C)}else{if(A=="essence"){loadContents({"c":"essence_map","m":" get_report_info","d":"newequip","id":D},C)}else{if(A=="warfield"){loadContents({"c":"amphitheater","m":" get_report_info","id":D},C)}else{if(A=="starbattle"){loadContents({"c":"star_battle","m":" get_report_info","id":D},C)}else{if(A=="ladder_war"){loadContents({"c":"ladder_war","m":" get_report_info","id":D},C)}else{if(A=="awaken_copy"){loadContents({"c":"awaken_copy","m":"get_report","check":D,"point":B},C)}else{if(A=="three_talents_pk"){loadContents({"c":"three_talents_pk","m":"get_report_info","id":D,},C)}else{loadContents({"c":A,"m":"report_detail","id":D},C)}}}}}}}}}}}}}}}}},fetchRewardFromMail:function(B){if(xGame.checkLock()){return false}var A=function(C){xGame.unlock();C.status=parseInt(C.status);switch(C.status){case 1:var D={};if(C.info.add_act>0){D["act"]=C.info.all_act}if(C.info.add_gold>0){D["gold"]=C.info.all_gold}if(C.info.add_silver>0){D["silver"]=C.info.all_silver}player.updateinfo(D);$("#mail_fetch").hide();xGame.toast.show(lang("get_reward_success"));break;case -1:xGame.toast.show(lang("no_mail_to_receive"));break;case -2:xGame.toast.show(lang("mail_open_fail"));break;case -3:xGame.toast.show(lang("gift_not_exist"));break;case -4:xGame.toast.show(lang("bag_had_receive"));break;default:xGame.toast.show(lang("receiver_reward_fail_wait"));break}};loadContents({"c":"message","m":"open_gift","id":B},A)},createLevelUp:function(C){var G=null;var F=null;var H=xGame.xsGet(player.info.uid+"levelReward",true);var A=xGame.xsGet(player.info.uid+"levelFunc",true);if(H){G=JSON.parse(H)}if(A){F=JSON.parse(A)}if(G==null||G[1]==null||F.func_info==null){xGame.xsRemove(player.info.uid+"levelReward",true);xGame.xsRemove(player.info.uid+"levelFunc",true);return false}var D=xGame.loadPopTmpl("levelup");var E=D.find(".open_function");var B=D.find(".reward");D.find("#confirmbtn").unbind("touchend").bind("touchend",function(I){if(xGame.checkLock(true)){return false}xGame.xsRemove(player.info.uid+"levelReward",true);if(parseInt(F.func_open)==1){miscpop.openfunction(F,C)}else{xGame.xsRemove(player.info.uid+"levelFunc",true);if(C){C()}}G=null;F=null;E=null;B=null;D.remove();D=null;I.preventDefault()});D.find(".level").html(lang("leveluppop_level",[player.info.level]));D.find(".reward").addClass("type1").html(G[1]);if(F.func_mark!=""){if(F.func_mark!="avatar"){E.html(lang("leveluppop_func",[F.func_level,F.func_name]));D.find(".function_bg").addClass(F.func_mark)}else{E.html(lang("leveluppop_avatar",[F.func_level])+F.func_info);D.find(".function_bg").addClass(F.func_mark).css("background-image","url("+xGame.avatar(F.imageid)+")")}}else{D.find(".function_bg").addClass("levelup").html(F.func_info)}},openfunction:function(D,C){var A=xGame.loadPopTmpl("openfunction");var B=A.find("#confirmbtn");B.unbind("touchend").bind("touchend",function(E){if(xGame.checkLock(true)){return false}A.remove();A=null;E.preventDefault();xGame.xsRemove(player.info.uid+"levelFunc",true);if(C){C()}});A.find(".function").html(D.open.name);A.find(".level").html(lang("leveluppop_level",[player.info.level]));A.find(".level_des").html(D.open.info);A.find(".function_bg").addClass(D.open.mark)},createLevelUp_old:function(G){var C;var F;var E={"x":290,"y":160};if($.os.ipad){E.x+=32}var A=function(){xGame.doAnimate(F,"levelup_fadeOutUp","0.3s",function(){F.remove();if(G){G();G=null}})};var D=new movieClipClass({"img":staticUrl+"img/common/levelup_anim.png","width":380,"height":250,"x":E.x,"y":E.y,"loop":false,"endDestory":true,"callback":A,"frames":[{rect:[0,0],interval:110},{rect:[380,0],interval:110},{rect:[760,0],interval:110},{rect:[0,250],interval:110},{rect:[380,250],interval:110},{rect:[760,250],interval:110},]});var B=$("#world");D.appendTo(B);D.play();F=$('<div class="levelup_title" style="width:380px;height:250px;left:'+E.x+"px;top:"+E.y+'px;"></div>');B.append(F);B=null},passShiliReward:function(E,D,F){if($(".passreward_box_wrap").length>=1){return false}var B=($.os.ipad==true?1024:(isIPhone5?1136:960))/2-120;var C=$("body").height()/2-100;var A=$('<div id="passreward_box_wrap" class="passreward_box_wrap"><div id="passreward_box" class="btn" style="left:'+B+"px;top:"+C+'px;"></div></div>');$("body").append(A);A.unbind("touchend").one("touchend",function(G){G.preventDefault();G.stopPropagation();var H=function(J){if(J.status<1){var L=lang("receive_error_call_gm");switch(J.status){case -1:L=lang("no_reward");break;case -2:L=lang("shili_uncomplete");break;case -3:L=lang("had_receive");break;case -4:L=lang("have_no_reward");break}A.remove();xGame.toast.show(L);return false}var K=function(){A.remove();A=null;if(F==true){var O=""}else{var O=map_ini["world"][E].name||""}var N;var M;if(parseInt(J.gettype)==1){N=xGame.itemurl(J.item.id);M="background:url("+N+") center center no-repeat"}else{if(parseInt(J.gettype)==3){N=staticUrl+"img/common/prestige_icon.png";M="background:url("+N+") center center no-repeat";J.item={id:0,name:lang("reputation"),description:lang("passreward_prestige_desc"),quality:1,}}else{if(parseInt(J.gettype)==4){N=ximg(staticUrl+"img/plugin/mountpop_horses_small2.png");M="background-image:url("+N+");background-position:"+helper.getHorsePostion("small",J.info.mid)+"; background-repeat:no-repeat;width:100px;height:100px;top:10px;left:10px;";J.item={};J.item.description=lang("passrewardpop_mountqiling");J.item.name=J.info.name;J.item.id=J.info.mid;J.item.quality=J.info.quality}else{N=staticUrl+"img/pop/talent_item"+J.item.id+".png";J.item.description=lang("make_tianfu_up");M="background:url("+N+") center center no-repeat"}}}var Q={"itemid":J.item.id,"mapname":O,"itemname":J.item.name,"itemurl":M,"quality":J.item.quality,"desc":J.item.description,"color":helper.getItemColor(J.item.quality),"num":J.rewardnum,"url":N};N=null;M=null;var P=$("#world");P.append($.template("passrewardpop_tmpl",Q));var R=P.find("#passrewardpop");R.show();xGame.doAnimate(R.find("#passrewardpop_wrap"),"newhero_scalein","0.5s");R.find(".pop_btn_middle").unbind("touchend").one("touchend",function(S){S.preventDefault();S.stopPropagation();R.hide();word_dom=null;R.remove();R=null;if(D){D();D=null}if(parseInt(J.gettype)!=3&&parseInt(J.gettype)!=4){miscpop.itemfly2bag(Q)}player.info.newresult=0;xGame.xsRemove(player.info.uid+"shilialldone")})};A.addClass("open");var I=new movieClipClass({"img":staticUrl+"img/battle/resutl_box_stars.png","width":261,"height":233,"x":-30,"y":-20,"loop":false,"endDestory":true,"callback":K,"frames":[{rect:[0,0],interval:60},{rect:[261,0],interval:60},{rect:[522,0],interval:60},{rect:[783,0],interval:60},{rect:[1044,0],interval:60},{rect:[1305,0],interval:60},{rect:[1566,0],interval:60}],});A.find("#passreward_box").append(I.obj);I.play();H=null};loadContents({"c":"map","m":"get_newresult","id":E},H)})},bindPopConfirm:function(A,B){var C=B==true?lang("word_msg2"):lang("word_msg1");xGame.confirm.show(lang("qiangulifang"),C,1,function(){xGame.confirm.hide(function(){miscpop.bindPop(A)})})},bindPop:function(F){var B=this;xGame.clearCloud();var C=xGame.loadPopTmpl("bind");var E=C.find("#breg_username");var D=C.find("#breg_password");var A=C.find("#breg_mobile");E.unbind("touchend").one("touchend",function(){E.val("")});D.unbind("touchend").one("touchend",function(){D.val("")});A.unbind("touchend").one("touchend",function(){A.val("")});if(xGame.guide==false){C.find("#hidebtn").unbind("touchend").bind("touchend",function(G){xGame.confirm.show(lang("bindpop_giveup_title"),lang("bindpop_giveup_message",[player.info.nickname]),2,function(){xGame.confirm.hide();miscpop.exitGame()},function(){xGame.confirm.hide()},lang("bindpop_giveup_btn"),lang("bindpop_cancel_btn"));G.preventDefault();G.stopPropagation()}).show()}C.find("#rbtn_ingame").unbind("touchend").bind("touchend",function(){if(xGame.checkLock()){return false}if(E.val()==lang("4_16")){E.val("")}if(D.val()==lang("6_16")){D.val("")}if(A.val()==lang("only_find_psw")){A.val("")}var G=function(H){xGame.unlock();if(H.status==1){xGame.confirm.show(lang("bind_complete"),lang("bind_complete_msg",[E.val(),D.val()]),1,function(){xGame.confirm.hide(function(){miscpop.hide("bindpop");xGame.xsRemove("tryuid");var I=E.val()+","+D.val();xGame.xsSet("lastaccountsaved",I);if(xGame.nowWorld=="map"){xGame.createCloud()}if(F){F()}})})}else{if(H.status==-1){xGame.toast.show(lang("bind_fail"))}else{if(H.status==-2){xGame.toast.show(lang("you_had_bind_account"))}else{if(H.status==-3){xGame.toast.show(lang("account_mate_error"))}else{if(H.status==-4){xGame.toast.show(lang("psw_mate_error"))}else{if(H.status==-5){xGame.toast.show(lang("account_is_exist"))}}}}}}G=null};if(helper.checkUserName(E.val())&&helper.checkPassWord(D.val())&&helper.checkTel(A.val())){http(UCAPI+"&c=register&m=binding&",{"uid":player.info.uid,"u":E.val(),"p":D.val(),"mobile":A.val(),"v":localStorage["sg_ver"],"mac":xGame.macaddr,"adid":xGame.adid,"devicetoken":xGame.devicetoken,"channel":channelID,"32d7d8f515a95064d2d36ce16330a846":"c5e55009d72507b33ba7beecbf680550"},G)}else{xGame.unlock()}});C.show();C=null},openBossConfirm:function(){if(xGame.nowWorld=="login"||xGame.nowWorld=="role"||xGame.nowWorld=="battle"||xGame.nowWorld=="elitebattle"||xGame.nowWorld=="elitebattle"||xGame.nowWorld=="countrybattle"||xGame.nowWorld=="boss"||xGame.nowWorld=="gvgbattle"){return false}if((bossWorld&&bossWorld.e)||(bossbandpop&&bossbandpop.e)||(iospaypop&&iospaypop.e)||(rebatepop&&rebatepop.e)||(countrybattleWorld&&countrybattleWorld.e)||(gvgbattleWorld&&gvgbattleWorld.e)||(gvgWorld&&gvgWorld.e)||(championsWorld&&championsWorld.e)||(showmarpop&&showmarpop.e)){return false}if(xGame.guide==true&&guide.now<1434){return false}var A=xGame.xsGet("openboss");if(A&&A==helper.formatDate()){return false}xGame.confirm.show(lang("world_boss"),lang("boss_battle_ask"),2,function(){xGame.closePops();xGame.confirm.hide(function(){xGame.loadWorld("boss")})},function(){xGame.confirm.hide()});xGame.xsSet("openboss",helper.formatDate())},openNianConfirm:function(){if(xGame.nowWorld=="login"||xGame.nowWorld=="role"||xGame.nowWorld=="battle"||xGame.nowWorld=="elitebattle"||xGame.nowWorld=="elitebattle"||xGame.nowWorld=="countrybattle"||xGame.nowWorld=="boss"||xGame.nowWorld=="gvgbattle"){return false}if((nianWorld&&nianWorld.e)||(bossWorld&&bossWorld.e)||(bossbandpop&&bossbandpop.e)||(iospaypop&&iospaypop.e)||(rebatepop&&rebatepop.e)||(countrybattleWorld&&countrybattleWorld.e)||(gvgbattleWorld&&gvgbattleWorld.e)||(gvgWorld&&gvgWorld.e)||(championsWorld&&championsWorld.e)||(showmarpop&&showmarpop.e)){return false}if(xGame.guide==true&&guide.now<1434){return false}var A=xGame.xsGet("opennewyearboss");if(A&&A==helper.formatDate()){return false}xGame.confirm.show(lang("notice"),lang("nian_battle_ask"),2,function(){xGame.closePops();xGame.confirm.hide(function(){xGame.loadWorld("nian")})},function(){xGame.confirm.hide()});xGame.xsSet("opennewyearboss",helper.formatDate())},openCbattleConfirm:function(B){if(xGame.nowWorld=="login"||xGame.nowWorld=="role"||xGame.nowWorld=="battle"||xGame.nowWorld=="elitebattle"||xGame.nowWorld=="elitebattle"||xGame.nowWorld=="countrybattle"){return false}if((nianWorld&&nianWorld.e)||(bossWorld&&bossWorld.e)||(bossbandpop&&bossbandpop.e)||(iospaypop&&iospaypop.e)||(rebatepop&&rebatepop.e)||(countrybattleWorld&&countrybattleWorld.e)||(showmarpop&&showmarpop.e)){return false}if(xGame.guide==true&&guide.now<1434){return false}var A;if(B==1){A=xGame.xsGet("opencbattle");if(A&&A==helper.formatDate()){return false}xGame.confirm.show(lang("country_battle"),lang("country_battle_ask"),2,function(){xGame.closePops();xGame.xsSet("opencbattle",helper.formatDate());xGame.confirm.hide(function(){xGame.loadWorld("countrybattle")})},function(){xGame.confirm.hide()})}else{if(B==2){A=xGame.xsGet("opencbattle_now");if(A&&A==helper.formatDate()){return false}xGame.confirm.show(lang("country_battle"),lang("country_battle_ask2"),2,function(){xGame.closePops();xGame.xsSet("opencbattle_now",helper.formatDate());xGame.confirm.hide(function(){xGame.loadWorld("countrybattle")})},function(){xGame.confirm.hide()})}else{if(B==3){A=xGame.xsGet("opencbattle_apply");if(A&&A==helper.formatDate()){return false}xGame.confirm.show(lang("country_battle"),lang("country_battle_ask3"),2,function(){xGame.closePops();xGame.xsSet("opencbattle_apply",helper.formatDate());xGame.confirm.hide(function(){xGame.loadWorld("countrymap")})},function(){xGame.confirm.hide()})}}}},openDinnerConfirm:function(){if(newyeardinnerpop!=undefined&&newyeardinnerpop.isshow){return false}if(xGame.nowWorld=="login"||xGame.nowWorld=="role"||xGame.nowWorld=="battle"||xGame.nowWorld=="elitebattle"||xGame.nowWorld=="elitebattle"||xGame.nowWorld=="countrybattle"){return false}if((bossWorld&&bossWorld.e)||(bossbandpop&&bossbandpop.e)||(iospaypop&&iospaypop.e)||(rebatepop&&rebatepop.e)||(countrybattleWorld&&countrybattleWorld.e)||(showmarpop&&showmarpop.e)){return false}if(xGame.guide==true&&guide.now<1434){return false}var A=xGame.xsGet("openDinner");if(A&&A==helper.formatDate()){return false}xGame.confirm.show(lang("newyear_dinner"),lang("newyear_dinner_ask"),2,function(){xGame.closePops();xGame.xsSet("newyear_dinner",helper.formatDate());xGame.confirm.hide(function(){xGame.showpop("newyeardinner")})},function(){xGame.confirm.hide()})},newhero:function(F,A,E){var B=this;var E=E?E:2000;E=parseInt(F.generalid)>5?E:10;var D=xGame.loadPopTmpl("newhero");D.find("#newhero_avatar").css({"background":"url("+xGame.avatar(F.image,true)+") 0 0 no-repeat"});D.find("#newhero_type").html(helper.getItemVocation(F.type));if(appLanguage=="th"){D.find("#newhero_name").html(F.name)}else{D.find("#newhero_name").html(helper.getBrName(F.name)).addClass("word"+F.name.length)}D.find("#newhero_stars").css("width",(F.star*18));D.find("#newhero_wuli").html(F.wuli);D.find("#newhero_zhili").html(F.zhili);D.find("#newhero_tili").html(F.tili);D.find("#newhero_skill").html("<span>"+F.skill.name+"</span>："+F.skill.description);D.find("#newhero_talent").html("<span>"+F.talent.name+"</span>："+F.talent.description);var C=new iScroll("newhero_scroller",{bounce:false,momentum:false,hScrollbar:false,});setTimeout(function(){D.find("#newhero_okbtn").unbind("touchend").bind("touchend",function(G){miscpop.hide("newheropop");if(A){A()}G.preventDefault();G.stopPropagation()})},E);D.show();xGame.doAnimate(D.find("#newheropop_wrap"),"newhero_scalein","0.5s");player.reloadInfo()},countrymapCityInfo:function(C){var A=this;var B=function(E){if(E.status<1){xGame.toast.show(lang("no_city_info")+E.status);A=null;B=null;xGame.unlock();return false}var D=xGame.loadPopTmpl("cityinfo");var F=function(H){H.find(".content").find(".hidebtn").unbind("touchend");H.find("#attack_btn").unbind("touchend");H.find("#force_attack_btn").unbind("touchend");H.find("#helpinfo_btn").unbind("touchend");H=null};D.find(".content").find(".hidebtn").unbind("touchend").bind("touchend",function(H){if(xGame.checkLock(true)){return false}miscpop.hide("cityinfopop");H.preventDefault();H.stopPropagation();F(D);F=null});D.find(".avatarbox").children("p").html(E.info.name);D.find(".own").children("span").html(E.info.castellanname);D.find(".fightor").children("span").html(E.info.challengername);D.find(".battletime").children("span").html(E.info.time);D.find("#hold_effect").children("p").html(E.info.str);if(parseInt(E.info.force)==1){D.find("#force_attack_status").show()}else{D.find("#force_attack_status").hide()}if(E.info.open==1){var G=function(K,J,I){var H=function(N){N.status=parseInt(N.status);if(N.status==1){if(I){var L=xGame.nowWorld;setTimeout(function(){xGame.loadBattle(N,function(){A.battleResultFromCountrymap(N,L,K)},"countrymap")},500)}else{$("#attack_btn").attr("class","btn pop_btn_middle_disable attack_btn").html(lang("had_apply"));if(N.msg!=undefined){xGame.confirm.show(lang("notice"),N.msg,1,function(){xGame.confirm.hide()})}else{xGame.toast.show(lang("apply_wait_for_country_battle"))}var M=$("#map_wrap").find(".atking");if(M.length!=0){M.remove();countrymapWorld.clearAnim()}$("#worldshili"+K).append('<em class="atking c1"></em>');countrymapWorld.animStart();miscpop.hide("cityinfopop");player.reloadInfo();F(D);F=null}}else{var O="";switch(N.status){case -1:O=lang("you_have_no_country_zl");break;case -2:O=lang("your_job_to_low");break;case -3:O=lang("country_battle_lock2");break;case -4:O=lang("your_country_had_apply_zhanling_other");break;case -5:O=lang("get_city_info_fail");break;case -6:O=lang("city_not_open");break;case -7:O=lang("your_country_had_apply_zhanling_current");break;case -8:xGame.confirm.show(lang("notice"),N.msg,1,function(){xGame.confirm.hide()});break;case -9:O=lang("country_battle_can_not_apply");break;case -10:O=lang("country_battle_city_lock");break;case -11:O=lang("country_battle_not_force_att");break;case -12:O=lang("country_battle_city_lock_defense");break;case -13:O=lang("country_battle_force_gold_low");break;case 3:xGame.confirm.show(lang("notice"),N.msg,2,function(){xGame.confirm.hide();G(K,1,I)},function(){xGame.confirm.hide()});default:O=lang("can_not_zhanling_now");break}if(N.status!=-8&&parseInt(N.status)!=3){xGame.toast.show(O)}}};if(I==undefined||I<=0){I=0}else{I=1}if(J==undefined){loadContents({"c":"siege","m":"occupy","id":K,"force":I},H)}else{loadContents({"c":"siege","m":"occupy","id":K,"sure":J,"force":I},H)}};if(player.info.country==E.info.challengercid){D.find("#attack_btn").unbind("touchend").attr("class","btn pop_btn_middle_disable attack_btn").html(lang("had_apply"))}else{if(E.status==2){D.find("#attack_btn").unbind("touchend").attr("class","btn pop_btn_middle_disable attack_btn").html(lang("zhanling"))}else{D.find("#attack_btn").unbind("touchend").bind("touchend",function(H){G(C);H.preventDefault();H.stopPropagation()})}}if(parseInt(E.info.status)==1){D.find("#force_attack_btn").show();D.find("#force_attack_btn").unbind("touchend").bind("touchend",function(H){H.preventDefault();H.stopPropagation();xGame.confirm.show(lang("notice"),lang("do_ensure_force",[E.price]),2,function(){xGame.confirm.hide();G(C,0,1)},function(){xGame.confirm.hide()},lang("ok"),lang("close"))}).html(lang("force_attack"))}else{D.find("#force_attack_btn").unbind("").hide()}}else{D.find("#attack_btn").attr("class","btn pop_btn_middle_disable attack_btn").html(lang("not_open"))}D.find("#helpinfo_btn").unbind("touchend").bind("touchend",function(){miscpop.countrymapHelpinfo(E.info.generalname)});D.show();B=null;xGame.unlock()};loadContents({"c":"siege","m":"capital_info","id":C},B)},countrymapHelpinfo:function(B){var A=xGame.loadPopTmpl("cityhelp");A.find(".content").find(".hidebtn").unbind("touchend").bind("touchend",function(C){if(xGame.checkLock(true)){return false}miscpop.hide("cityhelppop");C.preventDefault();C.stopPropagation()});A.find("#cityhelppop_name").html(B);A.show()},cbattleresult:function(C,B){var A=function(G){switch(parseInt(G.status)){case -1:xGame.toast.show(lang("have_not_enter_the_country"));break;case -2:xGame.toast.show(lang("have_not_receive_reward"));break;case 0:xGame.toast.show(lang("reward_please_wait"));break;case 1:var E=xGame.loadPopTmpl("cbattleresult");if(C==2){E.find(".flagbg").addClass("lose");E.find(".flag").addClass("flaglose")}else{E.find(".flag").addClass("flagwin")}E.find(".reward_wrap").find(".junling").find("span").html(G.rule.act);E.find(".reward_wrap").find(".silver").find("span").html(G.rule.silver);if(parseInt(player.info.level)<91){E.find(".reward_wrap").find(".jade").hide()}else{E.find(".reward_wrap").find(".jade").find("span").html(G.rule.jade)}E.find(".reward_wrap").find(".soul").find("span").html(G.rule.soul);var D="";for(var F=0;F<G.list.length;F++){D+="<li>"+G.list[F].nickname+"<span>"+lang("liansha_num",[G.list[F].num])+"</span></li>"}E.find("#cbattleresult_rl").html(D);D=null;E.find("#fetch_btn").unbind("touchend").bind("touchend",function(H){H.preventDefault();H.stopPropagation();var I=function(J){switch(parseInt(J.status)){case -1:xGame.toast.show(lang("have_not_enter_the_country"));break;case -2:xGame.toast.show(lang("have_not_receive_reward"));break;case 0:xGame.toast.show(lang("reward_please_wait"));break;case 1:player.reloadInfo();miscpop.hide("cbattleresultpop");xGame.loadWorld("countrymap");xGame.toast.show(lang("reward_success"));break}};loadContents({"c":"siege","m":"get_reward","type":1},I)});miscpop.socialShareDisplay(B,"cbattle");E.show();break}};loadContents({"c":"siege","m":"get_reward","type":0},A)},iosbuy:function(C){var A=this;var B=function(E){if(E.status==1&&E.prepay_id>0){xGame.xsSet("pay_prepay_id",E.prepay_id+"")}else{if(E.status==-1){xGame.toast.show(lang("iospaypop_limit_num"));return false}else{xGame.toast.show(lang("can_not_buy_package"));return false}}xGame.showWaitmsg(lang("connecting_to_appstore")+'<br/><span style="font-size:20px;">'+lang("pay_auto_close")+"</span>");var F=function(G,I,H,J){console.log("productId: "+G+" title: "+I+" description: "+H+" price: "+J);window.plugins.inAppPurchaseManager.makePurchase(G,1)};var D=function(G){xGame.hideWaitmsg();console.log("Invalid product id: "+G);if(player.info.appreview==0){xGame.confirm.show(lang("webkit_pay"),"您好，请到官网充值：<br/>(支持网银、支付宝、手机充值卡)<br/>http://www.hanjiangsanguo.com",1,function(){xGame.confirm.hide()})}else{xGame.toast.show(lang("can_not_buy_now"))}};window.plugins.inAppPurchaseManager.requestProductData(C,F,D)};loadContents({"c":"ios","m":"prepay","product_id":C},B)},battleByUid:function(C){var A=this;var B=function(E){if(E.status==-1){xGame.toast.show(lang("canshu_lost"))}else{if(E.status==-2){xGame.toast.show(lang("get_info_fail"))}else{if(E.status==-3){xGame.toast.show(lang("infopop_challenge"))}else{if(E.status==1){$("#worldloading").addClass("black").show();if(infopop&&infopop.e){infopop.hide()}if(strategypop&&strategypop.e){strategypop.hide()}miscpop.hide("enemypop");miscpop.hide("treasureenemypop");var D=xGame.nowWorld;setTimeout(function(){xGame.loadBattle(E,function(){A.battleResultFromQC(E,C,D)},"pvp")},500)}else{xGame.toast.show(lang("undefined_error"))}}}}};loadContents({"c":"challenge","m":"action","uid":C},B)},battleResultFromQC:function(G,A,B){var C=this;C.clearflower=false;var D=xGame.loadPopTmpl("battleend");var E;if(G.info.win>0){E="flagwin"+G.info.win;D.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("battle_win")+"</p>")}else{if(G.info.win==0){E="flaglose"+Math.abs(G.info.win);D.find(".flagbg").addClass("equal");D.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("lose_msg")+"</p>")}else{E="flaglose"+Math.abs(G.info.win);D.find(".flagbg").addClass("lose");D.find(".getinfobox").addClass("mine_lose");D.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("lose_msg")+"</p>")}}D.find(".flag").addClass(E);var F=function(){miscpop.hide("battleendpop");xGame.loadWorld(B)};D.find(".confirm_btn").unbind("touchend").one("touchend",F);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");C.destoryAllBombFlower();battleWorld.refight()});if(G.info.report>0){D.find(".share_btn").unbind("touchend").bind("touchend",function(){var H=$(this);miscpop.shareBattle({c:"arena",m:"send_to_chat",touid:A,report:G.info.report,win:G.info.win,},H)});C.socialShareDisplay(G.share,"qiecuo")}else{D.find(".share_btn").addClass("disable")}D.show();D=null;if(G.win==3){C.createBombFlower()}},battleResultFromCountrymap:function(G,B,E){var C=this;C.clearflower=false;var D=xGame.loadPopTmpl("battleend");var A;if(G.info.win>0){A="flagwin"+G.info.win;D.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("apply_wait_for_country_battle")+"</p>")}else{A="flaglose"+Math.abs(G.info.win);D.find(".flagbg").addClass("lose");D.find(".getinfobox").addClass("mine_lose");D.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("countrymap_can_not_replace")+"</p>")}D.find(".flag").addClass(A);var F=function(){miscpop.hide("battleendpop");xGame.loadWorld(B);if(G.info.win>0){var H=$("#map_wrap").find(".atking");if(H.length!=0){H.remove();countrymapWorld.clearAnim()}miscpop.hide("cityinfopop");$("#worldshili"+E).append('<em class="atking c1"></em>');countrymapWorld.animStart()}};D.find(".confirm_btn").unbind("touchend").one("touchend",F);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");C.destoryAllBombFlower();battleWorld.refight()});D.show();D=null;if(G.win==3){C.createBombFlower()}player.reloadInfo()},shareBattle:function(C,A){var B=function(D){if(D.status==1){xGame.toast.show(lang("battle_report_share_to_chat"));CD["chat"].read();player.updateinfo({gold:D.all_gold});A.addClass("disable").unbind("touchend")}else{if(D.status==-2){xGame.toast.show(lang("gold_not_enough_for_send"))}else{xGame.toast.show(lang("can_not_share_report"))}}B=null};loadContents(C,B)},enterBattleFromCountry:function(D,A,E,B){countrypop.e.hide();$("#worldloading").addClass("black").show();var C=xGame.nowWorld;setTimeout(function(){xGame.loadBattle(D,function(){miscpop.battleResultFromCountry(D,C,A,E,B)},"pvp")},500)},battleResultFromCountry:function(B,H,G,D,A){var E=this;E.clearflower=false;var C=xGame.loadPopTmpl("battleend");C.find("#battleend_main").attr("class","main type4").html('<p class="tips"></p>');var I;if(B.info.win>0){I="flagwin"+B.info.win;C.find("#battleend_main").children("p").html(D+lang("upgrade_to_%job",[A]));countrypop.bulidLi(B,1)}else{if(B.info.win==0){I="flaglose"+Math.abs(B.info.win);C.find(".flagbg").addClass("equal");C.find("#battleend_main").children("p").html(D+lang("battle_fail"))}else{I="flaglose"+Math.abs(B.info.win);C.find(".flagbg").addClass("lose");C.find("#battleend_main").children("p").html(D+lang("battle_fail"))}}C.find(".flag").addClass(I);var F=function(){miscpop.hide("battleendpop");countrypop.showBtnByJob();countrypop.e.show();countrypop.fillHasCountry(B);xGame.loadWorld(H);if(B.info.win>0){countrypop.createResult(1)}else{countrypop.createResult(2)}};C.find(".confirm_btn").unbind("touchend").one("touchend",F);C.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");E.destoryAllBombFlower();battleWorld.refight()});if(B.info.report>0){C.find(".share_btn").unbind("touchend").bind("touchend",function(){var J=$(this);miscpop.shareBattle({c:"arena",m:"send_to_chat",touid:G,report:B.info.report,win:B.info.win,},J)})}else{C.find(".share_btn").addClass("disable")}C.show();C=null;if(B.win==3){E.createBombFlower()}},battleResultFromGeneraltask:function(D,N,E,K,L,A,C,H){var I=this;I.clearflower=false;var F=xGame.loadPopTmpl("battleend");F.find("#battleend_main").attr("class","main type5");var B='<div class="get1">'+lang("comment_reward_title")+"：<p></p></div>";F.find("#battleend_main").html(B);var M;if(D.info.win>0){M="flagwin"+D.info.win}else{if(D.info.win==0){M="flaglose"+Math.abs(D.info.win);F.find(".flagbg").addClass("equal")}else{M="flaglose"+Math.abs(D.info.win);F.find(".flagbg").addClass("lose")}}F.find(".flag").addClass(M);var G="";if(parseInt(L)==1){G="("+lang("ten_times_bet")+")"}else{if(parseInt(L)==2){G="("+lang("hundred_times_bet")+")"}}if(parseInt(D.info.firstkill)==1){F.find("#battleend_main").find(".get1").addClass("type"+D.info.first_type).children("p").html("+"+D.info.first_value+lang("shousha"))}else{F.find("#battleend_main").find(".get1").addClass("type"+D.info.re_type).children("p").html("+"+D.info.soul+" "+G)}player.taskaction(16);var J=function(){miscpop.hide("battleendpop");var O=null;if(D.clear!=0){O={clearstar:true}}else{O={starid:nowstartid}}xGame.loadWorld("generaltask",{"generalid":N,"page":E,"nowIndex":A,"nowShowData":C,"nowObj":H,})};F.find(".confirm_btn").unbind("touchend").one("touchend",J);F.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");I.destoryAllBombFlower();battleWorld.refight()});if(D.info.report>0){F.find(".share_btn").unbind("touchend").bind("touchend",function(){var O=$(this);miscpop.shareBattle({c:"generaltask",m:"send_to_chat",id:K,report:D.info.report,},O)})}else{F.find(".share_btn").addClass("disable")}F.show();F=null;if(D.info.win==3){I.createBombFlower()}},battleResultFromElite:function(F){var C=this;C.clearflower=false;var D=xGame.loadPopTmpl("battleend");if(D==false){return false}D.find("#battleend_main").attr("class","main type6");var B="";if(parseInt(F.firstkill)==1){B='<div class="get1">'+lang("hero_get_exp")+"<p>+"+F.first_exp+"</p></div>";B+='<div class="getitem"><p>'+lang("get")+'：<span style="color:'+helper.getItemColor(F.firstquality)+'">'+F.firstitemname+'</span></p><div class="itembox"></div></div>';D.find("#battleend_main").html(B);D.find(".itembox").addClass("c_i_bj"+F.firstquality);if(F.firstitemtype==1){D.find(".itembox").html('<img src="'+xGame.itemurl(F.firstitemid)+'" />')}else{if(F.firstitemtype==2){D.find(".itembox").html('<img src="'+ximg(staticUrl+"img/pop/talent_item"+F.firstitemid+".png")+'" />')}}}else{if(F.itemid>0){B='<div class="get1">'+lang("hero_get_exp")+"<p>+"+F.exp+"</p></div>";B+='<div class="getitem"><p>'+lang("get")+'：<span style="color:'+helper.getItemColor(F.quality)+'">'+F.itemname+'</span></p><div class="itembox"></div></div>';D.find("#battleend_main").html(B);D.find(".itembox").addClass("c_i_bj"+F.quality);if(F.itemtype==1){D.find(".itembox").html('<img src="'+xGame.itemurl(F.itemid)+'" />')}else{if(F.itemtype==2){D.find(".itembox").html('<img src="'+ximg(staticUrl+"img/pop/talent_item"+F.itemid+".png")+'" />')}}}else{B='<div class="get1">'+lang("hero_get_exp")+"<p>+"+(F.win==1?F.exp:0)+"</p></div>";D.find("#battleend_main").html(B)}}var A=F.win==1?"flagwin3":(F.win==2?"flaglose3":"flaglose0");D.find(".flag").addClass(A);if(F.win==2){D.find(".flagbg").addClass("lose")}else{if(F.win==3){D.find(".flagbg").addClass("equal")}}var E=function(){miscpop.hide("battleendpop");C.destoryAllBombFlower();if(F.levelup&&F.levelup==1){xGame.xsSet(player.info.uid+"levelup",1,true)}elitebattleWorld.back()};D.find(".confirm_btn").unbind("touchend").one("touchend",E);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");C.destoryAllBombFlower();elitebattleWorld.refight()});D.find(".share_btn").addClass("disable");D.show();D=null;if(F.win==3){C.createBombFlower()}},enterBattleFromWorldarena:function(C,A){worldarenapop.e.hide();$("#worldloading").addClass("black").show();var B=xGame.nowWorld;setTimeout(function(){xGame.loadBattle(C,function(){miscpop.battleResultFromWorldarena(C,B,A)},"worldarena")},500)},battleResultFromWorldarena:function(G,B,A){var C=this;C.clearflower=false;var D=xGame.loadPopTmpl("battleend");D.find("#battleend_main").attr("class","main type4").html('<p class="tips"></p>');var E;if(G.info.win>0){E="flagwin"+G.info.win;if(parseInt(G.torank)==0){D.find("#battleend_main").children("p").html(lang("you_win_msg3"))}else{if(parseInt(G.torank)==1){D.find("#battleend_main").children("p").html(lang("you_win_msg2",[G.torank]))}else{D.find("#battleend_main").children("p").html(lang("you_win_msg1",[G.torank]))}}if(G.rank!=""){G.rank["list"]=G.list;worldarenapop.fillPlayerList(G.rank)}if(G.top!=""){worldarenapop.fillAllTop3(G.top)}}else{if(G.info.win==0){E="flaglose"+Math.abs(G.info.win);D.find(".flagbg").addClass("equal");D.find("#battleend_main").children("p").html(lang("you_lose_msg"))}else{E="flaglose"+Math.abs(G.info.win);D.find(".flagbg").addClass("lose");D.find("#battleend_main").children("p").html(lang("you_lose_msg"))}}D.find(".flag").addClass(E);var F=function(){miscpop.hide("battleendpop");worldarenapop.e.show();xGame.loadWorld(B)};D.find(".confirm_btn").unbind("touchend").one("touchend",F);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");C.destoryAllBombFlower();battleWorld.refight()});if(G.info.report>0){D.find(".share_btn").unbind("touchend").bind("touchend",function(){var H=$(this);miscpop.shareBattle({c:"worldarena",m:"send_to_chat",reportid:G.info.report},H)});C.socialShareDisplay(G.share,"worldarena")}else{D.find(".share_btn").addClass("disable")}D.show();D=null;if(G.info.win==3){C.createBombFlower()}},enterBattleFromThrone:function(B,A){$("#worldloading").addClass("black").show();setTimeout(function(){xGame.loadBattle(B,function(){if(B.info.win>0&&B.info.reward.length>0){if(miscpop.includeItem(B.info.reward)){miscpop.showRewardbox(B,"throne")}else{miscpop.battleResultFromThrone(B,B.info.reward)}}else{miscpop.battleResultFromThrone(B)}},A)},500)},includeItem:function(B){if(B.length==0){return false}else{for(var A=0;A<B.length;A++){if(parseInt(B[A].gettype)>2){return true}}return false}},battleResultFromThrone:function(C,B,F){var H=this;H.clearflower=false;var E=xGame.loadPopTmpl("battleend");var M;if(C.info.win>0){M="flagwin"+C.info.win}else{if(C.info.win==0){M="flaglose"+Math.abs(C.info.win);E.find(".flagbg").addClass("equal")}else{M="flaglose"+Math.abs(C.info.win);E.find(".flagbg").addClass("lose")}}if(B==undefined){E.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("every_10_get_reward")+"</p>")}else{var L="";if(F){var J='<div class="box" style="margin-top:10px;">';var D=false;var A=0;for(var G=0,K=B.length;G<K;G++){if(B[G].gettype==3||B[G].gettype==4||B[G].gettype==5||B[G].gettype==6){D=true}if(B[G].gettype==14){A++}}if(A>1){D=true}for(var G=0;G<B.length;G++){if(B[G].gettype==1){J+='<em class="wuzi silver">'+lang("silver")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==2){J+='<em class="wuzi jade">'+lang("jade")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==5||B[G].gettype==6){L+='<div class="box isitem">';L+="<p>"+lang("get")+':<em style="color:'+helper.getItemColor(B[G].getvalue.quality)+'">'+B[G].getvalue.itemname+" x 1</em></p>";L+='<div class="itembox c_i_bj'+B[G].getvalue.quality+'" ><span style="background-image:url('+staticUrl+"img/pop/talent_item"+B[G].getvalue.itemtype+'.png);"></span><b>x 1</b></div>';L+="</div>"}else{if(B[G].gettype==7){J+='<em class="wuzi reputation">'+lang("reputation")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==8){J+='<em class="wuzi original_soul">'+lang("original_soul")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==9){J+='<em class="wuzi tfcard">'+lang("tfcard")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==10){J+='<em class="wuzi purple_jade">'+lang("purple_jade")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==11){J+='<em class="wuzi refinestone">'+lang("refinestone")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==12){J+='<em class="wuzi colorstone">'+lang("colorstone")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==13){J+='<em class="wuzi bloodstone">'+lang("bloodstone")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==14){if(D==false){L+='<div class="box isitem">';L+="<p>"+lang("get")+':<em style="color:'+helper.getItemColor(B[G].getvalue.quality)+'">'+B[G].getvalue.itemname+" x "+B[G].getnum+"</em></p>";L+='<div class="itembox c_i_bj'+B[G].getvalue.quality+'" ><span class="horse" style="background-position:'+helper.getHorsePostion("small",B[G].getvalue.id)+';"></span><b>x '+B[G].getnum+"</b></div>";L+="</div>"}else{J+='<em class="wuzi mount" style="color:'+helper.getItemColor(B[G].getvalue.quality)+';"><b class="horse" style="background-position:'+helper.getHorsePostion("buff",B[G].getvalue.id)+';"></b>'+B[G].getvalue.itemname+":"+B[G].getnum+"</em>"}}else{L+='<div class="box isitem">';L+="<p>"+lang("get")+':<em style="color:'+helper.getItemColor(B[G].getvalue.quality)+'">'+B[G].getvalue.itemname+" x 1</em></p>";L+='<div class="itembox c_i_bj'+B[G].getvalue.quality+'" ><span style="background-image:url('+xGame.itemurl(B[G].getvalue.itemid)+');"></span><b>x 1</b></div>';L+="</div>"}}}}}}}}}}}}J+="</div>";L=J+L}else{for(var G=0;G<B.length;G++){L+='<div class="box">';if(B[G].gettype==1){L+='<em class="wuzi silver" style="margin-top:50px;">'+lang("silver")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==2){L+='<em class="wuzi jade" style="margin-top:50px;">'+lang("jade")+":"+B[G].getvalue+"</em>"}}L+="</div>"}}E.find("#battleend_main").attr("class","main type7").html(L)}E.find(".flag").addClass(M);var I=function(){miscpop.hide("battleendpop");if(C.info.view==0){xGame.loadWorld("herothrone")}else{if(C.info.view==1){xGame.loadWorld("herothrone",true)}}};E.find(".confirm_btn").unbind("touchend").one("touchend",I);E.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");H.destoryAllBombFlower();battleWorld.refight()});E.find(".share_btn").addClass("disable");E.show();E=null;if(C.info.win==3){H.createBombFlower()}},alipayOrder:function(B){var A=function(C){if(C.status==1){var D=C.orderinfo+'&sign="'+C.sign+'"&sign_type="RSA"';window.plugins.AlipayManagerPlugin.fetchPay(function(){console.log("支付宝-支付成功");xGame.toast.show(lang("pay_success_msg"));player.reloadInfo()},function(){console.log("支付宝-支付失败");xGame.confirm.show(lang("pay_fail_msg"),lang("pay_fail_msg4"),1,function(){xGame.confirm.hide()})},[D])}else{xGame.toast.show(lang("no_pay_info"))}};loadContents({"c":"pay","m":"get_pay_info","id":B},A)},go91Order:function(B){var A=function(D){if(D.status==1){var E=function(){console.log("91-支付成功");xGame.toast.show(lang("pay_success_msg"));setTimeout(function(){player.reloadInfo()},1500)};var C=function(){console.log("91-支付失败");xGame.confirm.show(lang("pay_fail_msg"),lang("pay_fail_msg4"),1,function(){xGame.confirm.hide()})};window.plugins.NdComPlatformPlugin.purchaseGold(E,C,[{orderSerial:D.orderid,productId:"com.zctech.sanguo91sdk",productName:D.productname,productPrice:D.price,productOrignalPrice:D.price,payDescription:xGame.server_prefix.substring(1),productCount:1}])}else{xGame.toast.show(lang("no_pay_info"))}};loadContents({"c":"pay","m":"create_91_order","id":B},A)},goPPOrder:function(B){var A=function(D){if(D.status==1){var E=function(){console.log("PP-支付成功");xGame.toast.show(lang("pay_success_msg"));setTimeout(function(){player.reloadInfo()},1500)};var C=function(){console.log("PP-支付失败");xGame.confirm.show(lang("pay_fail_msg"),lang("pay_fail_msg4"),1,function(){xGame.confirm.hide()})};window.plugins.PPComPlatformPlugin.purchaseGold(E,C,[{orderSerial:D.orderid,productName:D.productname,productPrice:D.price,serverPrefix:xGame.server_prefix}])}else{xGame.toast.show(lang("no_pay_info"))}};loadContents({"c":"pay","m":"create_pp_order","id":B},A)},goKYOrder:function(B){var A=function(D){if(D.status==1){var E=function(){console.log("KY-支付成功");xGame.toast.show(lang("pay_success_msg"));setTimeout(function(){player.reloadInfo()},1500)};var C=function(){console.log("KY-支付失败");xGame.confirm.show(lang("pay_fail_msg"),lang("pay_fail_msg4"),1,function(){xGame.confirm.hide()})};window.plugins.KuaiyongPlatform.purchaseGold(E,C,[{orderSerial:D.orderid,productName:D.productname,productPrice:D.price,uid:xGame.server_prefix+"|"+player.info.uid,}])}else{xGame.toast.show(lang("no_pay_info"))}};loadContents({"c":"pay","m":"create_kuaiyong_order","id":B},A)},goDJOrder:function(B){var A=function(C){if(C.status==1){window.plugins.DjPlatformPlugin.purchaseGold(function(){},function(){},[{amount:parseInt(C.price)*10,orderid:C.orderid,extra:xGame.server_prefix.substring(1),}])}else{xGame.toast.show(lang("no_pay_info"))}};loadContents({"c":"paydj","m":"create_djpay_order","id":B},A)},otherPay:function(){var A=xGame.loadPopTmpl("otherpay");A.find("#pay_channel_hidebtn").unbind("touchend").bind("touchend",function(B){if(xGame.checkLock(true)){return false}miscpop.hide("otherpaypop");B.preventDefault();B.stopPropagation()});A.find("#alipay_btn").unbind("touchend").bind("touchend",function(B){if(xGame.checkLock(true)){return false}miscpop.hide("otherpaypop");xGame.showpop("iospay");B.preventDefault();B.stopPropagation()});A.find("#card_btn").unbind("touchend").bind("touchend",function(B){if(xGame.checkLock(true)){return false}miscpop.szfpay();B.preventDefault();B.stopPropagation()});A.show();$("#worldloading").hide()},szfpay:function(){var A=$("#otherpaypop");A.find("#otherpaypop_wrap").addClass("card");A.find("#szf_type").unbind("touchend").bind("touchend",function(B){if(xGame.checkLock(true)){return false}A.find("#szf_type_select_list").toggle();B.preventDefault();B.stopPropagation()});A.find("#szf_type_select_list").undelegate("li","touchend").delegate("li","touchend",function(D){if(xGame.checkLock(true)){return false}var E=$(this).attr("type");var B=$(this).html();var C=miscpop.SZF_cardlist[E][0];A.find("#szf_amount").attr("amount",C).html(C+"元");A.find("#szf_type").attr("type",E).html(B);A.find("#szf_type_select_list").hide();D.preventDefault();D.stopPropagation()});A.find("#szf_amount").unbind("touchend").bind("touchend",function(B){if(xGame.checkLock(true)){return false}var C=A.find("#szf_type").attr("type");if(C&&C!=""){miscpop.szfselectlist(C)}B.preventDefault();B.stopPropagation()});A.find("#card_pay_hidebtn").unbind("touchend").bind("touchend",function(B){if(xGame.checkLock(true)){return false}A.find("#otherpaypop_wrap").removeClass("card");A.find("#szf_id").val("");A.find("#szf_pw").val("");A.find("#szf_amount").attr("amount","0");miscpop.hide("otherpaypop");B.preventDefault();B.stopPropagation()});A.find("#card_ok_btn").unbind("touchend").bind("touchend",function(C){if(xGame.checkLock(true)){return false}var F=A.find("#szf_id").val();var E=A.find("#szf_pw").val();var D=A.find("#szf_amount").attr("amount");if(F.length<=0||E.length<=0||D<=0){xGame.toast.show("请将充值卡类型、卡密信息输入完整！");return false}var B=function(G){if(G&&G.status==1){xGame.toast.show(G.message);setTimeout(function(){player.reloadInfo()},3000);miscpop.hide("otherpaypop");return false}else{xGame.toast.show("充值失败，请检查充值卡密是否输入正确！");return false}};loadContents({"c":"pay","m":"szf_order","id":F,"pw":E,"amount":D,"paychannel":"ios"},B);C.preventDefault();C.stopPropagation()})},szfselectlist:function(E){var D=this.SZF_cardlist[E];if(D&&D.length>0){var B=xGame.loadPopTmpl("szfselect");var A="";for(var C=0;C<D.length;C++){A+='<a amount="'+D[C]+'">'+D[C]+"元</a>"}B.find("#szfselectpop_wrap").html(A);B.undelegate("a","touchend").delegate("a","touchend",function(F){var G=$(this).attr("amount");setTimeout(function(){$("#szf_amount").attr("amount",G).html(G+"元");miscpop.hide("szfselectpop")},300);F.preventDefault();F.stopPropagation()})}},viewBattleDiy:function(B){$("#worldloading").addClass("black").show();var A={battle:B,status:1,info:{background:"1",cd:82,exp:0,generalinfo:[],generalstatus:0,get_level:0,gettype:0,getvalue:0,gexp:0,image:"42",itemid:0,itemname:"",levelup:0,levelupexp:0,name:"河北名士",openstatus:0,report:0,type:"1",win:1}};setTimeout(function(){xGame.loadBattle(A,null,A.info.background,function(){xGame.loadWorld("city")})},500)},add_friend:function(A,C){if(xGame.checkLock()){return false}var B=function(D){xGame.unlock();if(D.status==1){xGame.toast.show(lang("friends_add_sucess"));A.unbind().attr("class","is_friend")}else{if(D.status==-1){xGame.toast.show(lang("friends_full"))}else{if(D.status==-2){xGame.toast.show(lang("friends_isfriend"))}else{if(D.status==-3){xGame.toast.show(lang("friends_add_fail"))}else{if(D.status==-4){xGame.toast.show(lang("friends_canshu_error"))}else{if(D.status==-5){xGame.toast.show(lang("friends_can_not_add_yourself"))}else{xGame.toast.show(lang("undefined_error"))}}}}}}};loadContents({"c":"friend","m":"add_friend","f":C},B)},in_array:function(A,C){if(C.length>0){for(var B=0;B<C.length;B++){if(C[B]==A){return true}}}return false},getTimestamp:function(B){var A=B.match(/\d+/g);return +new Date(A[0],A[1]-1,A[2],A[3],A[4],A[5])},battleResultFromChampions:function(C,G,A){var E=this;E.clearflower=false;var D=xGame.loadPopTmpl("battleend");var B="";var H="";C.info.win=parseInt(C.info.win);B=C.info.win>0?C.battle.left_role.name:C.battle.right_role.name;H=C.info.win>0?C.battle.right_role.name:C.battle.left_role.name;var I="";if(C.battle.up==1){D.addClass("championsworld_up");I='<p class="tips">'+lang("champions_vs",[B,H])+"</p>"}else{if(C.battle.up==2){D.addClass("championsworld_king");I='<p class="tips">'+B+'</p><span class="king_flag"></span>';setTimeout(function(){$("div#battleendpop").find("span.king_flag").css("display","block")},200)}}D.find("#battleend_main").attr("class","main type4").html(I);I=null;B=null;H=null;var F=function(){miscpop.hide("battleendpop");xGame.loadWorld("champions")};D.find(".confirm_btn").unbind("touchend").one("touchend",F);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");battleWorld.refight()});D.find(".share_btn").unbind("touchend").bind("touchend",function(){var J=$(this);miscpop.shareBattle({"c":"god","m":"share_report","id":G,"stage":A,},J)});E.socialShareDisplay(C.share,"champions");D.show();D=null},battleResultFromGvg:function(E,C,A){var B=this;B.clearflower=false;var D=xGame.loadPopTmpl("battleend");var F="";D.addClass("championsworld_up");if(C){D.addClass("gvg");F='<p class="tips">'+lang("gvg_world_last_win",[E])+"</p>"}else{F='<p class="tips">'+lang("gvg_world_result_msg",[E])+"</p>"}D.find("#battleend_main").attr("class","main type4").html(F);F=null;var G=function(){miscpop.hide("battleendpop");xGame.loadWorld("gvg")};D.find(".confirm_btn").unbind("touchend").one("touchend",G);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");gvgbattleWorld.refight()});D.find(".share_btn").addClass("disable");B.socialShareDisplay(A,"gvg");D.show();D=null},battleResultFromWar:function(C,G,A){var E=this;E.clearflower=false;var D=xGame.loadPopTmpl("battleend");var B="";var H="";C.info.win=parseInt(C.info.win);B=C.info.win>0?C.battle.left_role.name:C.battle.right_role.name;H=C.info.win>0?C.battle.right_role.name:C.battle.left_role.name;var I="";if(C.battle.up==1){D.addClass("warworld_up");I='<p class="tips">'+lang("war_vs",[B,H,C.info.integral])+"</p>"}else{if(C.battle.up==2){D.addClass("warworld_king");I='<p class="tips">'+B+'</p><span class="king_flag"></span>';setTimeout(function(){$("div#battleendpop").find("span.king_flag").css("display","block")},200)}}D.find("#battleend_main").attr("class","main type4").html(I);I=null;B=null;H=null;var F=function(){miscpop.hide("battleendpop");xGame.loadWorld("war")};D.find(".confirm_btn").unbind("touchend").one("touchend",F);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");battleWorld.refight()});D.find(".share_btn").unbind("touchend").bind("touchend",function(){var J=$(this);miscpop.shareBattle({"c":"war","m":"share_report","id":G,"stage":A,},J)});D.show();D=null},viewBattleFromSanctum:function(B){if(xGame.checkLock()){return false}var A=function(F){xGame.unlock();if(F.status==1){$("#worldloading").addClass("black").show();strategypop.e.hide();var D=0;var E=0;var C={};if(sanctumWorld&&sanctumWorld.beastid&&sanctumWorld.stage&&sanctumWorld.currentData){D=sanctumWorld.beastid;E=sanctumWorld.stage;C=sanctumWorld.currentData}setTimeout(function(){xGame.loadBattle(F,null,"sanctum"+D,function(){xGame.loadWorld("sanctum",{beastid:D,stage:E,currentData:C});strategypop.e.show()})},500)}else{xGame.toast.show(lang("can_not_view_current_report"))}};loadContents({"c":"sanctum","m":"get_report_info","id":B},A)},enterBattleFromSanctum:function(B){$("#worldloading").addClass("black").show();var A=0;if(sanctumWorld&&sanctumWorld.beastid&&sanctumWorld.stage){A=sanctumWorld.beastid}setTimeout(function(){xGame.loadBattle(B,function(){miscpop.battleResultFromSanctum(B,{beastid:A,})},"sanctum"+A)},500)},viewBattleFromPacify:function(C){if(xGame.checkLock()){return false}var A=xGame.nowWorld;var B=function(E){xGame.unlock();if(E.status==1){$("#worldloading").addClass("black").show();strategypop.e.hide();var D=0;if(pacifypop&&pacifypop.nowBeastId&&pacifypop.nowDifficulty&&pacifypop.nowMilitary){D=pacifypop.nowMilitary}setTimeout(function(){xGame.loadBattle(E,null,"pacify"+D,function(){xGame.loadWorld(A);strategypop.e.show()})},500)}else{xGame.toast.show(lang("can_not_view_current_report"))}};loadContents({"c":"copies","m":"get_report_info","d":"newequip","id":C},B)},battleResultFromSanctum:function(G,F){var C=this;C.clearflower=false;var D=xGame.loadPopTmpl("battleend");D.find("#battleend_main").attr("class","main type5");var B='<div class="get1">'+lang("sanctumworld_get_gemp")+'<p class="gem_part"></p></div>';B+='<div class="add_doggold"></div>';G.info.gem=parseInt(G.info.gem);if(G.info.gem>0){B+='<div class="getitem"><p>'+lang("sanctumworld_get_gem")+'<span></span></p><div class="itembox"></div></div>'}D.find("#battleend_main").html(B);var A;if(G.info.win>0){A="flagwin"+G.info.win}else{if(G.info.win==0){A="flaglose"+Math.abs(G.info.win);D.find(".flagbg").addClass("equal")}else{A="flaglose"+Math.abs(G.info.win);D.find(".flagbg").addClass("lose")}}D.find(".flag").addClass(A);if(parseInt(G.info.firstkill)==1){D.find("#battleend_main").find(".get1").children("p").html("+"+G.info.first_chip_num)}else{D.find("#battleend_main").find(".get1").children("p").html("+"+G.info.chip)}if(G.info.gem>0){D.find("#battleend_main").find(".getitem").children("p").children("span").css("color",helper.getItemColor(G.info.gem_quality)).html(G.info.gem_name);D.find(".itembox").addClass("c_i_bj"+G.info.gem_quality).html('<img class="gem" src="'+xGame.gem(G.info.gem_type,G.info.gem_quality)+'" />')}if(!G.info.general_item.value||G.info.general_item.value==0){D.find(".add_doggold").css("display","none")}else{D.find(".add_doggold").html("+"+G.info.general_item.value)}var E=function(){miscpop.hide("battleendpop");F.stage=G.info.stage;if(G.info.complete==1){F={clear:true}}if(G.info.all_pass==1){F={clearopen:true}}xGame.loadWorld("sanctum",F)};D.find(".confirm_btn").unbind("touchend").one("touchend",E);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");C.destoryAllBombFlower();battleWorld.refight()});if(G.info.report>0){D.find(".share_btn").unbind("touchend").bind("touchend",function(){var H=$(this);miscpop.shareBattle({c:"sanctum",m:"send_to_chat",id:F.beastid,report:G.info.report,},H)})}else{D.find(".share_btn").addClass("disable")}D.show();D=null;if(G.info.win==3){C.createBombFlower()}},enterBattleFromJapan:function(A,C,B){$("#worldloading").addClass("black").show();setTimeout(function(){xGame.loadBattle(A,function(){miscpop.battleResultFromJapan(A,C,B)},"attackJapan")},500)},battleResultFromJapan:function(B,G,E){var D=this;var A="";D.clearflower=false;var C=xGame.loadPopTmpl("battleend");C.find("#battleend_main").attr("class","main type2");A='<div class="get1 Japan">'+lang("attackJapan_conhurt")+'<p class="hit_Japan">'+B.info.hit+"</p></div>";A+='<div class="get2 Japan">'+lang("comment_reward_title")+'<p class="contribution_Japan">'+lang("attackJapan_contribute",[B.info.devote])+'</p><p class="honor_Japan">'+lang("attackJapan_honor",[B.info.credit])+"</p></div>";C.find("#battleend_main").html(A);if(B.info.final_credit){C.find("#battleend_main").append('<div class="Japanextra">'+lang("attackJapan_lasthit")+'<p class="extra">'+lang("attackJapan_extra",[B.info.final_credit])+"</p></div>")}var H;if(B.info.win>0){H="flagwin_Japan"}else{H="flagend_Japan"}C.find(".flag").addClass(H);C.find(".flagbg").addClass("flagbg_Japan");var F=function(){miscpop.hide("battleendpop");if(B.info.complete==1){returndata={clear:true}}xGame.loadWorld("attackJapan",E)};C.find(".confirm_btn").unbind("touchend").one("touchend",F);C.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");battleWorld.refight()});if(B.info.report>0){C.find(".share_btn").unbind("touchend").bind("touchend",function(){var I=$(this);miscpop.shareBattle({"c":"japan","m":"send_to_chat","bossid":G,"report":"data.info.report"},I)})}else{C.find(".share_btn").addClass("disable")}C.show();C=null},enterBattleFromPacify:function(C){var A="city";$("#worldloading").addClass("black").show();var B=0;if(pacifypop&&pacifypop.nowBeastId&&pacifypop.nowDifficulty&&pacifypop.nowMilitary){B=pacifypop.nowMilitary}setTimeout(function(){xGame.loadBattle(C,function(){miscpop.battleResultFromPacify(C,{beastid:B,},A)},"pacify"+B)},500)},battleResultFromPacify:function(D,L,J){var H=this;H.clearflower=false;var E=xGame.loadPopTmpl("battleend");var F=D.reward_info.reward;var C=D.reward_info.first_reward;E.find("#battleend_main").attr("class","main type5");var B='<div class="get1">'+lang("pacify_get_reputation")+'<p class="reputation_part"></p></div>';if(F){var A=F.length;if(A&&!C){if(F.length==1){if(F[0].type==3){B+='<div class="getitem">'+lang("eggpop_got")+'<span style="color:'+helper.getItemColor(F[0].quality)+'" >'+F[0].name+"x"+F[0].value+'</span><span class="pacify_reward"><em style="background-image:url('+xGame.forgeMaterial(F[0].materials_id)+')"></em></span></div>'}else{if(F[0].type==2||F[0].type==1){B+='<div class="getitem">'+lang("eggpop_got")+'<span style="color:'+helper.getItemColor(F[0].quality)+'" >'+F[0].name+"x"+F[0].value+'</span><span class="pacify_reward"><em style="background-image:url('+xGame.itemurl(F[0].id)+')"></em></span></div>'}else{if(F[0].type==42){B+='<div class="getitem">'+lang("eggpop_got")+'<span style="color:'+helper.getItemColor(F[0].quality)+'" >'+lang("doggold")+"x"+F[0].value+'</span><span class="pacify_reward"><em class="add_doggold"></em></span></div>'}}}}else{if(F.length>1){B+='<div class="getitem">'+lang("eggpop_got")+'<ul class="pacify_reward_list">';for(var G=0;G<A;G++){var N=F[G];var K=N.type;if(K==3){B+='<li class="pacify_reward_item" style="background-image:url('+xGame.forgeMaterial(N.materials_id)+')"><span style="color:'+helper.getItemColor(N.quality)+'">'+N.name+"x"+N.value+"</span></li>"}else{if(K==1||K==2){B+='<li class="pacify_reward_item" style="background-image:url('+xGame.itemurl(N.id)+')"><span style="color:'+helper.getItemColor(N.quality)+'">'+N.name+"x"+N.value+"</span></li>"}else{if(K==42){B+='<li class="pacify_reward_doggold"><span style="color:'+helper.getItemColor(N.quality)+'">'+lang("doggold")+"x"+N.value+"</span></li>"}}}}B+="</ul>"}}}else{if(A&&C){B+='<div class="getitem">'+lang("eggpop_got")+'<ul class="pacify_reward_list">';if(C.type==3){B+='<li class="pacify_reward_item" style="background-image:url('+xGame.forgeMaterial(C.materials_id)+')"><span style="color:'+helper.getItemColor(C.quality)+'">'+C.name+"x"+C.value+"</span></li>"}else{if(C.type==1||C.type==2){B+='<li class="pacify_reward_item" style="background-image:url('+xGame.itemurl(C.id)+')"><span style="color:'+helper.getItemColor(C.quality)+'">'+C.name+"x"+C.value+"</span></li>"}}for(var G=0;G<A;G++){var N=F[G];var K=N.type;if(K==3){B+='<li class="pacify_reward_item" style="background-image:url('+xGame.forgeMaterial(N.materials_id)+')"><span style="color:'+helper.getItemColor(N.quality)+'">'+N.name+"x"+N.value+"</span></li>"}else{if(K==1||K==2){B+='<li class="pacify_reward_item" style="background-image:url('+xGame.itemurl(N.id)+')"><span style="color:'+helper.getItemColor(N.quality)+'">'+N.name+"x"+N.value+"</span></li>"}else{if(K==42){B+='<li class="pacify_reward_doggold"><span style="color:'+helper.getItemColor(N.quality)+'">'+lang("doggold")+"x"+N.value+"</span></li>"}}}}B+="</ul>"}else{if(!A&&C){if(C.type==3){B+='<div class="getitem">'+lang("eggpop_got")+'<span style="color:'+helper.getItemColor(C.quality)+'" >'+C.name+"x"+C.value+'</span><span class="pacify_reward"><em style="background-image:url('+xGame.forgeMaterial(C.id)+')"></em></span></div>'}else{if(C.type==1||C.type==2){B+='<div class="getitem">'+lang("eggpop_got")+'<span style="color:'+helper.getItemColor(C.quality)+'" >'+C.name+"x"+C.value+'</span><span class="pacify_reward"><em style="background-image:url('+xGame.itemurl(C.id)+')"></em></span></div>'}}}}}}E.find("#battleend_main").html(B);var M="";if(D.info.win>0){M="flagwin"+D.info.win}else{if(D.info.win==0){M="flaglose"+Math.abs(D.info.win);E.find(".flagbg").addClass("equal")}else{M="flaglose"+Math.abs(D.info.win);E.find(".flagbg").addClass("lose")}}E.find(".flag").addClass(M);if(D.reward_info.reputation){E.find("#battleend_main").find(".get1").children("p").html("+"+D.reward_info.reputation)}else{E.find("#battleend_main").find(".get1").children("p").html("+0")}var I=function(){miscpop.hide("battleendpop");L.stage=D.info.stage;if(D.info.complete==1){L={clear:true}}xGame.loadWorld(J);if(pacifypop&&pacifypop.e){pacifypop.e.show();if(D.reward_info.first_kill){pacifypop.removeDifficulty();pacifypop.getBeastInfo(pacifypop.nowMilitary);pacifypop.firstBossKill=D.first_succ}pacifypop.beastDom.hide()}};E.find(".confirm_btn").unbind("touchend").bind("touchend",I);E.find(".replay_btn").unbind("touchend").bind("touchend",function(){miscpop.hide("battleendpop");H.destoryAllBombFlower();battleWorld.refight()});if(D.info.report>0){E.find(".share_btn").unbind("touchend").bind("touchend",function(){var O=$(this);miscpop.shareBattle({"c":"copies","m":"send_to_chat","d":"newequip","report":D.info.report,"id":pacifypop.nowMilitary,"diff_id":pacifypop.nowDifficulty,"monster_id":pacifypop.nowBeastId,},O)})}else{E.find(".share_btn").addClass("disable")}E.show();E=null;if(D.info.win==3){H.createBombFlower()}},showInvitecode:function(){var A=$("#invitecodepop_wrap");if(A.length>0){return false}var A=xGame.loadPopTmpl("invitecode");var C=function(){$("#invitecodepop").remove()};var B=function(D){var E=function(F){if(F.status==1){xGame.toast.show(lang("invitefriend_done",[F.reward.gold,F.reward.silver]));player.updateinfo({gold:parseInt(player.info.gold)+parseInt(F.reward.gold),silver:parseInt(player.info.silver)+parseInt(F.reward.silver)});$("#invitecodepop").remove();if(invitationpop&&invitationpop.e){invitationpop.e.find("#invitefriend_myinvitor_btn").hide()}}else{if(F.status==2){xGame.toast.show(lang("inviteitem_code_drop"))}else{if(F.status==3){xGame.toast.show(lang("inviteitem_code_error"));$("#invitecodepop").find("#input_invitecode").val("")}else{if(F.status==4){xGame.toast.show(lang("had_receive"))}else{if(F.status==5){xGame.toast.show(lang("inviteitem_code_too_much_error"))}else{xGame.toast.show(lang("undefined_error"))}}}}}};loadContents({"c":"invitation","m":"change","code":D},E)};A.find(".hidebtn").unbind("touchend").bind("touchend",function(D){D.preventDefault();D.stopPropagation();C()});A.find("#submit_invitecode_btn").unbind("touchend").bind("touchend",function(D){var E=$("#input_invitecode").val();if(E){B(E)}else{C()}D.preventDefault();D.stopPropagation()});A.show();A=null},showComment:function(){if(!_inArray([3,100,106,107,153,154],channelID)){return false}var A={3:"https://itunes.apple.com/app/han-jiang-san-guo/id577752754?l=zh&mt=8",100:"https://itunes.apple.com/app/wu-shen-guan-sheng/id594385563?l=zh&mt=8",106:"https://itunes.apple.com/cn/app/han-jiang-san-guo/id739810801?ls=1&mt=8",107:"https://itunes.apple.com/cn/app/han-jiang-san-guohd/id747785885?ls=1&mt=8",153:"https://itunes.apple.com/kr/app/bunnouimuseong/id614460115?mt=8",154:"https://itunes.apple.com/jp/app/san-guoguroriasu/id619087844?mt=8",};xGame.confirm.show(lang("comment_title"),lang("comment_msg"),1,function(){var B=function(C){if(C.status==1){player.updateinfo({"gold":C.all_gold,});setTimeout(function(){xGame.confirm.show(lang("comment_reward_title"),lang("comment_reward_msg",[C.add_gold]),1,function(){xGame.confirm.hide()})},1000);console.log(A[channelID]);if(typeof cordova!="undefined"&&islocal==false){location.href=A[channelID]}}else{if(C.status==-1){xGame.toast.show(lang("had_receive"))}else{if(C.status==-3){xGame.toast.show(lang("comment_level_limit"))}else{xGame.toast.show(lang("undefined_error"))}}}B=null};loadContents({"c":"clickreward","m":"index"},B)},null,lang("comment_btn"),"",true)},showAddToScreen:function(){return;if(typeof window.navigator.standalone=="undefined"||window.navigator.standalone==true){return false}var A={};if($.os.ipad){A["left"]="48px";A["margin"]="0"}else{if(supportFullScreen){if(isIPhone5){A["left"]="330px";A["margin"]="0"}else{A["left"]="240px";A["margin"]="0"}}else{}}A["display"]="block";$("#add_notice").css(A).attr("show","true")},hideAddToScreen:function(){$("#add_notice").css("display","none").attr("show","false")},showStandaloneTips:function(){$("#standalonetips").css("display","block").attr("show","true");$("#standalonetips").find("p").html(lang("standalonetips_msg"))},hideStandaloneTips:function(){$("#standalonetips").addClass("hide").unbind("webkitAnimationEnd").one("webkitAnimationEnd",function(){$(this).css("display","none").attr("show","false").removeClass("hide")})},exitGame:function(){xGame.xsRemove("token");xGame.xsRemove("addr");xGame.xsRemove("guide");xGame.xsRemove("guidenow");xGame.xsRemove("game_notice");xGame.xsRemove("chatdata");xGame.xsRemove("tryuid");xGame.xsRemove("serverlist",true);xGame.xsRemove("chatdata");xGame.xsRemove("chatlasttab");xGame.xsRemove(player.info.uid+"guide_hide_page",true);if(typeof gAudio!="undefined"&&gAudio!=null){gAudio.stopMusic()}if(typeof Platform!="undefined"&&Platform.id=="pc"){window.location.href=Platform.loginurl;return false}else{window.location.hash="";xGame.xsRemove("temptoken");setTimeout(function(){window.location.reload()},100)}},weiboBindPop:function(E){if(typeof cordova!="undefined"&&typeof window.plugins.childBrowser!="undefined"){if(player.info.weibobind==1){if(E){E();return}}var B=this;gAudio.stopMusic();cb=window.plugins.childBrowser;cb.onLocationChange=function(G){console.log(G);if(G.indexOf("bind_success")>0){cb.close();if(E){E()}else{xGame.toast.show("恭喜您成功绑定微博，现在您可以分享战报啦！")}}};cb.onClose=function(){player.reloadInfo();if(xGame.nowWorld=="battle"){gAudio.playbgm("battle_bgm")}else{gAudio.playbgm("city_bgm")}};var C="104155745";var A="http://uct.game.hanjiangsanguo.com/index.php?c=weibocallback&m=index";var F=xGame.server_prefix+","+player.info.uid;var D="https://api.weibo.com/oauth2/authorize?client_id="+C+"&state="+F+"&display=mobile&redirect_uri="+encodeURIComponent(A);cb.showWebPage(D,{showLocationBar:false})}},fetchBattleLogUrl:function(D,A,B){var E=$("#social_wrap").data("link");if(E&&E!=""){console.log("link: "+E);if(B){B(E)}return}var C=function(F){if(F.status==1){$("#social_wrap").data("link",F.link);console.log("link: "+F.link);if(B){B(F.link)}}else{xGame.toast.show(lang("undefined_error"))}};loadContents({"c":"report","m":"save","id":D,"type":A},C)},share2weibo:function(C,A){var B=function(D){if(D.status==1){xGame.toast.show("分享到微博成功！")}else{if(D.status==-103){xGame.toast.show("您已经成功分享过本战报了！")}else{xGame.toast.show("分享失败，请稍后重试！")}}};loadContents({"c":"weibo","m":A==="true"?"clientupload":"clientsend","uid":player.info.uid,"message":C},B)},openCopyPc:function(A){var B=this;var C=xGame.loadPopTmpl("copypc");C.find("#battlelog_url").val(A);C.find("#hide_btn").unbind("touchend").bind("touchend",function(D){$("#copypcpop").remove();D.preventDefault();D.stopPropagation()});C.show();$("#ajaxloading").show();ScriptQueue.AddTask(staticUrl+"js/plugin/ZeroClipboard.js",function(){ZeroClipboard.setMoviePath(staticUrl+"js/plugin/ZeroClipboard.swf");var D=new ZeroClipboard.Client();D.setText("");D.setHandCursor(true);D.addEventListener("complete",function(F,E){$("#copypcpop").remove();xGame.toast.show("恭喜您，战报地址已经复制到粘贴板。")});D.addEventListener("mouseDown",function(E){D.setText($("#battlelog_url").val())});D.glue("realcopy_btn");$("#ajaxloading").hide()})},socialShareDisplay:function(A,B){if(appLanguage!="zh-cn"||channelID!=106){return}var E="";var D="";switch(B){case"battle":E="五关斩六将！";D="看我在#悍将三国#中披荆斩棘，所向披靡，吓得守城将领们屁滚尿流！";break;case"arena":case"worldarena":case"qiecuo":case"mine":case"countrymine":E="你知道谁是天下第一吗？";D="我在#悍将三国#中天天虐别人，嘿~这腰也不酸了，背也不疼了，一虐顶过去被虐！小贼，拿命来~";break;case"champions":E="天下英雄，谁与争锋！";D="#悍将三国#战神争霸战， 等你来参战！";break;case"cbattle":E="攻城略地，天下归一！";D="#悍将三国#一支穿云箭，千军万马来相见！";break;case"gvg":E="史上最牛的战役，你见过吗？";D="#悍将三国#为了兄弟、为了荣誉";break}var C=$("#social_wrap");C.find(".copyborad_btn").unbind("touchend").bind("touchend",function(F){F.preventDefault();F.stopPropagation();if(typeof cordova=="undefined"&&Platform.id!="pc"){xGame.toast.show("只有在ios客户端里才能复制战报地址哟")}else{if(typeof cordova=="undefined"&&Platform.id=="pc"){miscpop.fetchBattleLogUrl(A.id,A.type,function(G){miscpop.openCopyPc(G)})}else{if(typeof cordova!="undefined"&&typeof window.plugins.copyboardPlugin!="undefined"){miscpop.fetchBattleLogUrl(A.id,A.type,function(G){window.plugins.copyboardPlugin.copy([G]);xGame.toast.show("恭喜，您已成功将战报地址复制到粘贴板。")})}else{xGame.toast.show("您的版本较旧，不支持复制地址，建议您尽快更新。")}}}return false});C.find(".share2weixin_btn").unbind("touchend").bind("touchend",function(F){F.preventDefault();F.stopPropagation();if(typeof cordova=="undefined"){xGame.toast.show("只有在ios客户端里才能分享到微信哟");return false}else{if(jBreaking==true){xGame.toast.show("您的设备已越狱，不支持分享到微信哟");return false}}miscpop.fetchBattleLogUrl(A.id,A.type,function(G){window.plugins.wxTimeline.sendmsg([E,D,G],function(H){if(H==true){C.find(".share2weixin_btn").attr("class","btn pop_btn_middle share2weixin_btn_disable");xGame.toast.show("恭喜您，已成功分享到微信！")}},null,null)})});C.show()},showHeroInfo:function(E){var C=xGame.loadPopTmpl("heroinfo");var B=C.find("#heroinfopop_hidebtn");var D=C.find(".mask");var A=null;B.unbind("touchend").bind("touchend",function(F){if(xGame.checkLock(true)){return false}B.unbind();B=null;D.unbind();D=null;A.destroy();A=null;C.remove();C=null;F.preventDefault()});D.unbind("touchend").bind("touchend",function(F){if(xGame.checkLock(true)){return false}B.trigger("touchend");F.preventDefault()});C.find(".hero_avatar").css({"background":"url("+xGame.avatar(E.image,true)+") 0 0 no-repeat;"});C.find(".hero_name").html(E.name);C.find(".hero_type").html(helper.getItemVocation(E.type));C.find(".hero_stars").css({"width":(18*parseInt(E.star))+"px"});C.find(".hero_wuli").html(lang("springshoppop_wuli",[E.wuli]));C.find(".hero_zhili").html(lang("springshoppop_zhili",[E.zhili]));C.find(".hero_tili").html(lang("springshoppop_tili",[E.tili]));C.find(".hero_talent_title").html(lang("springshoppop_talent"));C.find(".hero_talent").html('<span class="title">'+E.talent.name+"</span>："+E.talent.description);C.find(".hero_skill_title").html(lang("springshoppop_skill"));C.find(".hero_skill .skill_content").html('<span class="title">'+E.skill.name+"</span>："+E.skill.description);A=new iScroll("heroinfo_scroller",{bounce:false,momentum:false,hScrollbar:false,})},showItemInfo:function(D){var A=xGame.loadPopTmpl("iteminfo");var B=A.find("#iteminfopop_hidebtn");var C=A.find(".mask");B.unbind("touchend").bind("touchend",function(E){if(xGame.checkLock(true)){return false}B.unbind();B=null;C.unbind();C=null;A.remove();A=null;E.preventDefault()});C.unbind("touchend").bind("touchend",function(E){if(xGame.checkLock(true)){return false}B.trigger("touchend");E.preventDefault()});A.find(".itembox").addClass("c_i_bj"+D.quality);A.find(".img").css({"background":"url("+xGame.itemurl(D.id)+") center center no-repeat"});A.find(".needlevel").html(lang("need_lv")+D.needlevel);if(D.quality<8||D.quality>8){A.find(".name").css({"color":helper.getItemColor(D.quality)}).html(D.name)}else{A.find(".name").addClass("colorwords");A.find(".name").css({"color":helper.getItemColor(D.quality)}).html(D.name)}A.find(".vocation").html(lang("mountpop_job")+"："+helper.getItemVocation(D.type));A.find(".powerup").html(helper.getItemPowerName(D.type)+"："+D.power)},showGemInfo:function(E,C){var A=xGame.loadPopTmpl("iteminfo");var B=A.find("#iteminfopop_hidebtn");var D=A.find(".mask");B.unbind("touchend").bind("touchend",function(F){if(xGame.checkLock(true)){return false}B.unbind();B=null;D.unbind();D=null;A.remove();A=null;F.preventDefault()});D.unbind("touchend").bind("touchend",function(F){if(xGame.checkLock(true)){return false}B.trigger("touchend");F.preventDefault()});A.find(".itembox").addClass("c_i_bj"+E.gem_quality);A.find(".img").css({"background":"url("+xGame.gem(E.gem_type,E.gem_quality)+") center center no-repeat"});A.find(".needlevel").html(helper.getTalent(parseInt(E.gem_type)));if(C){A.find(".name").css({"color":helper.getItemColor(E.gem_quality)}).html(C)}else{A.find(".name").css({"color":helper.getItemColor(E.gem_quality)}).html(E.gem_name)}A.find(".vocation").html(lang("level")+"："+E.gem_level);A.find(".powerup").html(lang("properties")+"："+helper.getTalent(parseInt(E.gem_type))+"+"+E.gem_power)},showMarchInfo:function(D){var A=xGame.loadPopTmpl("marchinfo");var B=A.find("#marchinfopop_hidebtn");var C=A.find(".mask");B.unbind("touchend").bind("touchend",function(E){if(xGame.checkLock(true)){return false}B.unbind();B=null;C.unbind();C=null;A.remove();A=null;E.preventDefault()});C.unbind("touchend").bind("touchend",function(E){if(xGame.checkLock(true)){return false}B.trigger("touchend");E.preventDefault()});A.find(".itembox").addClass("c_i_bj"+D.quality);A.find(".img").css({"background-position":helper.getHorsePostion("small",D.id)});A.find(".needlevel").html(lang());if(parseInt(D.quality)==8){A.find(".name").addClass("colorwords")}else{A.find(".name").removeClass("colorwords")}A.find(".name").css({"color":helper.getItemColor(D.quality)}).html(D.name);A.find("#marchattack").html(D.attack);A.find("#marchwufang").html(D.wufang);A.find("#marchhp").html(D.hp);A.find("#marchlv").html(0);A.find("#marchcefang").html(D.attack);A.find("#marchcefangup").html(D.cefang);if(D.type!="undefined"&&D.type==1){A.find("#gongji").html(lang("valentinepop_march_gongji",[D.value]))}else{if(D.type!="undefined"&&D.type==2){A.find("#gongji").html(lang("valentinepop_march_fangyu",[D.value]))}else{if(D.type!="undefined"&&D.type==3){A.find("#gongji").html(lang("christmasgiftpop_kcrit",[D.value]))}else{if(D.type!="undefined"&&D.type==4){A.find("#gongji").html(lang("valentinepop_march_life",[D.value]))}else{if(D.type!="undefined"&&D.type==8){A.find("#gongji").html(lang("valentinepop_march_poji",[D.value]))}else{if(D.type!="undefined"&&D.type==9){A.find("#gongji").html(lang("valentinepop_march_kanpo",[D.value]))}else{if(D.special_type!="undefined"&&D.special_type==10){A.find("#gongji").html(lang("valentinepop_march_zhongshang",[D.value]))}else{if(D.special_type!="undefined"&&D.special_type==50){A.find("#gongji").html(lang("suit_attr50")+"："+D.value+"%")}else{if(D.special_type!="undefined"&&D.special_type==51){A.find("#gongji").html(lang("suit_attr51")+"："+D.value+"%")}}}}}}}}}},showSoulInfo:function(G,F,A,C){var E=xGame.loadPopTmpl("iteminfo");var D=E.find("#iteminfopop_hidebtn");var B=E.find(".mask");if(F==true){E.addClass("getSoul")}if(G.type2&&G.type2>0){E.addClass("soul_info")}D.unbind("touchend").bind("touchend",function(H){if(xGame.checkLock(true)){return false}D.unbind();D=null;B.unbind();B=null;E.remove();E=null;if(A){A()}H.preventDefault()});B.unbind("touchend").bind("touchend",function(H){if(xGame.checkLock(true)){return false}D.trigger("touchend");H.preventDefault()});if(F!=true){E.find(".itembox").addClass("c_i_bj"+G.quality)}E.find(".img").css({"background-image":"url(http://img2.hanjiangsanguo.com/hjimg/pop/soul_"+G.image+".png)"});E.find(".needlevel").html(helper.getSoulTypeName(parseInt(G.type)));if(G.type2&&G.type2>0){E.find(".name").css({"color":helper.getItemColor(G.quality)}).html(G.name+" Lv."+G.level)}else{E.find(".name").css({"color":helper.getItemColor(G.quality)}).html(G.name);if(C){E.find(".vocation").html(lang("level")+"：15")}else{E.find(".vocation").html(lang("level")+"："+G.level)}}if(C){E.find(".powerup").html(lang("properties")+"："+helper.getSoulTypeName(parseInt(G.type)))}else{E.find(".powerup").html(lang("properties")+"："+helper.getSoulTypeName(parseInt(G.type))+"+"+G.power)}if(G.type2&&G.type2>0){E.find(".newpowerup").html(lang("soul_make_properties")+"："+helper.getSoulTypeName(parseInt(G.type2))+"+"+G.power2)}},showFuseInfo:function(E,A){var C=xGame.loadPopTmpl("fuseinfo");var B=C.find("#fuseinfopop_hidebtn");var D=C.find(".mask");B.unbind("touchend").bind("touchend",function(F){if(xGame.checkLock(true)){return false}B.unbind();B=null;D.unbind();D=null;C.remove();C=null;if(A){A()}F.preventDefault()});D.unbind("touchend").bind("touchend",function(F){if(xGame.checkLock(true)){return false}B.trigger("touchend");F.preventDefault()});C.find(".img").css({"background-image":"url(http://img2.hanjiangsanguo.com/hjimg/pop/soul_"+E.info.image+".png)"});C.find(".needlevel").html(helper.getSoulTypeName(parseInt(E.info.type)));C.find(".name").css({"color":helper.getItemColor(E.info.quality)}).html(E.info.name+"Lv."+E.info.level);C.find(".powerup").html(lang("get")+lang("soul_make_properties")+"："+helper.getSoulTypeName(parseInt(E.info.type2))+"+"+E.info.power2);if(parseInt(E.new_pop)==0){C.find(".fuse_tip").hide()}else{C.find(".fuse_tip").show();C.find(".fuse_tip > em").html(lang("soulpop_strong_tip3",[helper.getSoulTypeName(parseInt(E.book_info.type)),E.book_info.rate]))}},showMergegemInfo:function(E,A){var C=xGame.loadPopTmpl("iteminfo");var B=C.find("#iteminfopop_hidebtn");var D=C.find(".mask");C.addClass("getSoul");B.unbind("touchend").bind("touchend",function(F){if(xGame.checkLock(true)){return false}B.unbind();B=null;D.unbind();D=null;C.remove();C=null;if(A){A()}F.preventDefault()});D.unbind("touchend").bind("touchend",function(F){if(xGame.checkLock(true)){return false}B.trigger("touchend");F.preventDefault()});C.find(".img").css({"background-image":"url("+xGame.gem(E.type,E.quality)+")"});C.find(".needlevel").removeClass("needlevel");C.find(".name").css({"color":helper.getItemColor(E.quality)}).html(E.name);if(parseInt(E.quality)==8){C.find(".name").addClass("colorwords")}else{C.find(".name").removeClass("colorwords")}C.find(".vocation").html(lang("level")+"："+E.level);C.find(".powerup").html(lang("properties")+"："+helper.getTalent(E.type)+"+"+E.power)},showMaterialItemInfo:function(D){var A=xGame.loadPopTmpl("materialiteminfo");var B=A.find("#materialiteminfopop_hidebtn");var C=A.find(".mask");B.unbind("touchend").bind("touchend",function(E){if(xGame.checkLock(true)){return false}B.unbind();B=null;C.unbind();C=null;A.remove();A=null;E.preventDefault()});C.unbind("touchend").bind("touchend",function(E){if(xGame.checkLock(true)){return false}B.trigger("touchend");E.preventDefault()});A.find(".itembox").addClass("c_i_bj"+D.quality);if(!D.desc){A.find(".img").css({"background":"url("+xGame.drumurl(D.id)+") center center no-repeat"})}else{A.find(".img").css({"background":"url("+xGame.forgeMaterial(D.id)+") center center no-repeat"})}A.find(".name").css({"color":helper.getItemColor(D.quality)}).html(D.name);if(!D.desc){A.find(".name").append(" <em>Lv"+D.needlevel+"</em>");A.find(".des").html(D.description)}else{A.find(".des").html(D.desc)}},runeItemInfo:function(D){var A=xGame.loadPopTmpl("materialiteminfo");var B=A.find("#materialiteminfopop_hidebtn");var C=A.find(".mask");B.unbind("touchend").bind("touchend",function(E){if(xGame.checkLock(true)){return false}B.unbind();B=null;C.unbind();C=null;A.remove();A=null;E.preventDefault()});C.unbind("touchend").bind("touchend",function(E){if(xGame.checkLock(true)){return false}B.trigger("touchend");E.preventDefault()});A.find(".itembox").addClass("c_i_bj1");A.find(".img").css({"background":"url("+xGame.runeurl(D.type,Math.ceil(D.quality/5))+") center center no-repeat"});A.find(".name").css({"color":"orange"}).html(D.name);A.find(".des").append('<div style="line-height: 35px;">'+lang("properties")+'：<span style="color:#fff">'+helper.getSuitAttr(D.type,D.power)+"</span></div>");if(D.description!=undefined){A.find(".des").append("<div>"+D.description+"</div>")}},showEssenceInfo:function(D){var A=xGame.loadPopTmpl("materialiteminfo");var B=A.find("#materialiteminfopop_hidebtn");var C=A.find(".mask");B.unbind("touchend").bind("touchend",function(E){if(xGame.checkLock(true)){return false}B.unbind();B=null;C.unbind();C=null;A.remove();A=null;E.preventDefault()});C.unbind("touchend").bind("touchend",function(E){if(xGame.checkLock(true)){return false}B.trigger("touchend");E.preventDefault()});A.find(".itembox").addClass("c_i_bj"+D.quality);A.find(".img").css({"background":"url("+xGame.essence(D.id,D.quality)+") center center no-repeat"});A.find(".name").css({"color":helper.getItemColor(D.quality)}).html(D.name);A.find(".des").html(D.desc)},awakenItemInfo:function(F){var A=xGame.loadPopTmpl("marchinfo");var D=A.find("#marchinfopop_hidebtn");var E=A.find(".mask");D.unbind("touchend").bind("touchend",function(G){if(xGame.checkLock(true)){return false}D.unbind();D=null;E.unbind();E=null;A.remove();A=null;G.preventDefault()});E.unbind("touchend").bind("touchend",function(G){if(xGame.checkLock(true)){return false}D.trigger("touchend");G.preventDefault()});A.find(".itembox").addClass("c_i_bj"+F.quality);A.find(".img").css({"background-image":"url("+xGame.awankeImg(F.image)+")"});A.find(".name").css({"color":helper.getItemColor(F.quality)}).html(F.name);A.find(".level").html("");var C="";for(var B=1;B<6;B++){if(F["add_type"+B]!=0&&F["add_value"+B]!=0){C+='<li class="attr_num">'+helper.getAttrs(F["add_type"+B])+":"+F["add_value"+B]+"</li>"}}A.find("ul").html(C);C=null},showMaterialInfo:function(C){var B=xGame.loadPopTmpl("materialinfo");var E=B.find("#materialinfo_hidebtn");var J=B.find(".mask");var A=B.find("#materialinfo_copy_list");var D=null;var I="";var G=null;E.bind("touchend",function(K){if(xGame.checkLock(true)){return false}E.unbind();E=null;J.unbind();J=null;D.destroy();D=null;A.undelegate(".copy_btn","click");A=null;B.remove();B=null;K.preventDefault()});J.bind("touchend",function(K){if(xGame.checkLock(true)){return false}E.trigger("touchend");K.preventDefault()});A.delegate(".copy_btn","click",function(M){if(xGame.checkLock(true)){return false}var N=$(this);var O=parseInt(N.attr("copies_id"));var L=parseInt(N.attr("diff_id"));var K=parseInt(N.attr("type"));if(K==1){if(pacifypop==null||pacifypop.e==null){xGame.showpop("pacify",{"callback":function(){pacifypop.getBeastInfo(O,L)}})}else{pacifypop.getBeastInfo(O,L)}if(essencepop!=null){essencepop.hide();xGame.loadWorld("city")}}else{if(essencepop==null||essencepop.e==null){xGame.showpop("essence",{"callback":function(){essencepop.getBeastInfo(O,L)}})}else{essencepop.getBeastInfo(O,L)}if(pacifypop!=null){pacifypop.hide()}}E.trigger("touchend");systempop.hide();M.preventDefault()});B.find(".box").addClass("material_quality"+C.quality);B.find(".img").css("background-image","url("+xGame.forgeMaterial(C.type)+")");B.find(".name").html(C.mname);B.find(".intro").html(C.mdesc);for(var F=0,H=C.guide.length;F<H;F++){G=C.guide[F];if(!G.type){I+='<li class="btn '+(parseInt(G.open)==1?"copy_btn":"copy_btn_disable")+'" copies_id="'+G.copies_id+'" diff_id="'+G.diff_id+'" type='+1+">";I+=lang("materialinfopop_copy"+G.copies_id)+"("+lang("materialinfopop_diff"+G.diff_id)+")"}else{if(G.type==1){I+='<li class="btn '+(parseInt(G.open)==1?"copy_btn":"copy_btn_disable")+'" copies_id="'+G.copies_id+'" diff_id="'+G.diff_id+'" type='+G.type+">";I+=lang("materialinfopop_copy"+G.copies_id)+"("+lang("materialinfopop_diff"+G.diff_id)+")"}else{if(G.type==2){I+='<li class="btn '+(parseInt(G.open)==1?"copy_btn":"copy_btn_disable")+'" copies_id="'+G.essence_id+'" diff_id="'+G.diff_id+'" type='+G.type+">";I+=lang("materialinfopop_country"+G.essence_id)+"("+lang("materialinfopop_diff"+G.diff_id)+")"}}}I+="</li>"}A.html(I);D=new iScroll("materialinfo_scroller",{bounce:false,momentum:false,hScrollbar:false,vScrollbar:false});G=null},drumshowMaterialInfo:function(D){var C=xGame.loadPopTmpl("materialinfo");var F=C.find("#materialinfo_hidebtn");var K=C.find(".mask");var A=C.find("#materialinfo_copy_list");var E=null;var J="";var H=null;F.bind("touchend",function(L){if(xGame.checkLock(true)){return false}F.unbind();F=null;K.unbind();K=null;E.destroy();E=null;A.undelegate(".copy_btn","click");A=null;C.remove();C=null;L.preventDefault()});K.bind("touchend",function(L){if(xGame.checkLock(true)){return false}F.trigger("touchend");L.preventDefault()});A.delegate(".copy_btn","click",function(N){if(xGame.checkLock(true)){return false}var O=$(this);var P=parseInt(O.attr("copies_id"));var M=parseInt(O.attr("diff_id"));var L=parseInt(O.attr("type"));if(L==1){if(pacifypop==null||pacifypop.e==null){xGame.showpop("pacify",{"callback":function(){pacifypop.getBeastInfo(P,M)}})}else{pacifypop.getBeastInfo(P,M)}if(essencepop!=null){essencepop.hide();xGame.loadWorld("city")}}else{if(L==2){if(essencepop==null||essencepop.e==null){xGame.showpop("essence",{"callback":function(){essencepop.getBeastInfo(P,M)}})}else{essencepop.getBeastInfo(P,M)}if(pacifypop!=null){pacifypop.hide()}}else{if(L==3){if(mapWorld==null){xGame.loadWorld("map",{"callback":function(){mapWorld.loadGuanqiaMap(P,M)}})}else{mapWorld.loadGuanqiaMap(P,M)}$("#menu_friends").hide();$("#menu_city").show();$("#menu_back").show();$("#menu_map").hide();if(essencepop!=null){essencepop.hide();xGame.loadWorld("city")}if(pacifypop!=null){pacifypop.hide()}}}}C.remove();systempop.hide();N.preventDefault()});C.find(".box").addClass("material_quality"+D.materials_info.quality);C.find(".img").css("background-image","url("+xGame.forgeMaterial(D.materials_info.id)+")");C.find(".name").html(D.materials_info.name);C.find(".intro").html(D.materials_info.desc);for(var G=0,I=D.list.length;G<I;G++){H=D.list[G];if(!H.type){J+='<li class="btn '+(parseInt(H.open)==1?"copy_btn":"copy_btn_disable")+'" copies_id="'+H.copies_id+'" diff_id="'+H.diff_id+'" type='+1+">";J+=lang("materialinfopop_copy"+H.copies_id)+"("+lang("materialinfopop_diff"+H.diff_id)+")"}else{if(H.type==1){J+='<li class="btn '+(parseInt(H.open)==1?"copy_btn":"copy_btn_disable")+'" copies_id="'+H.copies_id+'" diff_id="'+H.diff_id+'" type='+H.type+">";J+=lang("materialinfopop_copy"+H.copies_id)+"("+lang("materialinfopop_diff"+H.diff_id)+")"}else{if(H.type==2){J+='<li class="btn '+(parseInt(H.open)==1?"copy_btn":"copy_btn_disable")+'" copies_id="'+H.essence_id+'" diff_id="'+H.diff_id+'" type='+H.type+">";J+=lang("materialinfopop_country"+H.essence_id)+"("+lang("materialinfopop_diff"+H.diff_id)+")"}else{if(H.type==3){var B=map_ini["shili"][H.map_level_id][H.map_stage_id];J+='<li class="btn '+(parseInt(H.open)==1?"copy_btn":"copy_btn_disable")+'" copies_id="'+H.map_level_id+'" diff_id="'+H.map_stage_id+'" type='+H.type+">";J+=B.name}}}}J+="</li>"}A.html(J);E=new iScroll("materialinfo_scroller",{bounce:false,momentum:false,hScrollbar:false,vScrollbar:false});H=null},showForgeEquipInfo:function(D){var A=this;var B=function(E){if(parseInt(E.status)==1){C(E)}else{xGame.toast.show(E.msg)}};loadContents({"c":"equip_forge","m":"get_equip_attr","d":"newequip","id":D,},B);function C(H){var M=xGame.loadPopTmpl("forgeequipinfo");var J=M.find("#forgeequipinfopop_hidebtn");var O=M.find("#forgeequipinfo_intro");var P=M.find("#forgeequipinfo_attribute");var F=H.equip_info.suitarr;var K=H.godcast_info.attribute;var G="";J.bind("touchend",function(){if(xGame.checkLock(true)){return false}J.unbind();J=null;O=null;P=null;M.remove();M=null});O.find(".box").addClass("c_i_bj"+H.equip_info.quality);O.find(".img").css("background-image","url("+xGame.itemurl(H.equip_info.equipid)+")");O.find(".des").html(H.equip_info.desc);if(H.equip_info.quality<8||H.equip_info.quality>8){O.find(".name").removeClass("colorwords");M.find("#forgeequipinfo .title").removeClass("colorwords");O.find(".name").css("color",helper.getItemColor(H.equip_info.quality)).html(H.equip_info.name);M.find("#forgeequipinfo .title").css("color",helper.getItemColor(H.equip_info.quality))}else{O.find(".name").addClass("colorwords");M.find("#forgeequipinfo .title").addClass("colorwords");O.find(".name").css("color",helper.getItemColor(H.equip_info.quality)).html(H.equip_info.name);M.find("#forgeequipinfo .title").css("color",helper.getItemColor(H.equip_info.quality))}if(parseInt(H.equip_info.hammer)>0){O.find(".hammer").addClass("hammer"+H.equip_info.hammer_quality).html(H.equip_info.hammer).show()}else{O.find(".hammer").hide()}if(parseInt(H.equip_info.level)>0){O.find(".strong_level").html(H.equip_info.level).show()}else{O.find(".strong_level").hide()}var I=0;var N=parseInt(H.equip_info.type);if(N<=2){I=1}else{if(N<=4){I=2}else{I=3}}P.find(".need_level > .des").html(H.equip_info.needlevel);P.find(".initial_prop > .title").html(lang("initial_prop"+I)).siblings(".des").html(H.equip_info.power);P.find(".strong_prop > .title").html(lang("strong_prop"+I)).siblings(".des").html(H.equip_info.powerup);P.find(".refine_prop > .title").html(lang("refine_prop"+I)).siblings(".des").html(H.equip_info.refineadd);P.find(".strong_achieve > .des").html(H.equip_info.stgadd);M.find(".total_prop").html(lang("total_prop"+I)+H.equip_info.allpower);M.find(".suit_name").html(F.name);var E="";for(var L=1;L<=6;L++){if(K["type"+L]==null){E+=""}else{E+="<li>"+helper.getSuitAttr(K["type"+L],K["num"+L])+"</li>"}}M.find("#forgeequipinfo ul").html(E);E=null;for(var L=1;L<=4;L++){G+='<li class="box c_i_bj'+F.quality+'">';G+='<span class="img" style="background-image: url('+xGame.itemurl(F["eid"+L])+')"></span>';if(F["open"+L]==0){G+='<div class="mask"></div>'}if(F.quality<8||F.quality>8){G+='<em class="name" style="color: '+helper.getItemColor(F.quality)+'">'+F["name"+L]+"</em>"}else{G+='<em class="name" style="color: '+helper.getItemColor(F.quality)+'"><b class="colorwords">'+F["name"+L]+"<b></em>"}G+="</li>"}M.find(".equip_list").html(G);if(A.propertyScroller){A.propertyScroller.destroy();delete A.propertyScroller}G="";for(var L=2;L<=4;L++){G+='<li class="add_item '+(parseInt(H.equip_info.open)>=L?"equip":"")+'">';G+='<div class="title">'+lang("forgeequipinfopop_equip",[L])+"</div>";G+='<p class="add_attr">'+helper.getSuitAttr(F["suit"+L+"_1"],F["params"+L+"_1"])+"</p>";G+='<p class="add_attr">'+helper.getSuitAttr(F["suit"+L+"_2"],F["params"+L+"_2"])+"</p>";G+="</li>"}M.find(".add_list").html(G);if(A.propertyScroller==null){A.propertyScroller=new iScroll("add_list_scroller",{bounce:false,momentum:false,hScrollbar:false,vScrollbar:false})}A.propertyScroller.refresh()}},fuminewuziInfo:function(A,C){var B=xGame.loadPopTmpl("materialiteminfo");var E=B.find("#materialiteminfopop_hidebtn");var D=B.find(".mask");E.unbind("touchend").bind("touchend",function(F){if(xGame.checkLock(true)){return false}E.unbind();E=null;D.unbind();D=null;B.remove();B=null;F.preventDefault()});D.unbind("touchend").bind("touchend",function(F){if(xGame.checkLock(true)){return false}E.trigger("touchend");F.preventDefault()});B.find(".itembox").addClass("c_i_bj1");B.find(".img").addClass("rtype"+A+"");if(player.info.fukubukuro_type==1){B.find(".name").css({"color":"red","font-size":"18px"}).html(lang("newfukubukuropop_title"+A+""));if(A==71){B.find(".des").attr({"id":"des_scroll"}).append("<div>"+lang("newfukubukuropop_title"+A+"_tip")+"</div>")}else{B.find(".des").attr({"id":"des_scroll"}).append("<div>"+lang("newfukubukuropop_title"+A+"_tip",[C])+"</div>")}}else{B.find(".name").css({"color":"red","font-size":"18px"}).html(lang("fukubukuropop_title"+A+""));if(A==71){B.find(".des").attr({"id":"des_scroll"}).append("<div>"+lang("fukubukuropop_title"+A+"_tip")+"</div>")}else{B.find(".des").attr({"id":"des_scroll"}).append("<div>"+lang("fukubukuropop_title"+A+"_tip",[C])+"</div>")}}scroller=new iScroll("des_scroll",{bounce:false,momentum:false,hScrollbar:false,})},showresolveTip:function(B,J){var H=xGame.loadPopTmpl("resolvetip");var D=null;var F=null;var K="";var A="";var L=null;H.delegate("#return_btn","click",function(M){if(xGame.checkLock(true)){return false}H.remove();M.preventDefault()});H.delegate("#sure_btn","click",function(M){if(xGame.checkLock(true)){return false}H.remove();if(resolvepop!=null||resolvepop.e!=null){resolvepop.resolvemulit()}M.preventDefault()});if(B.equip_arr){var C=B.equip_arr}if(B.drum_arr){var C=B.drum_arr}for(var E=0;E<C.length;E++){if(C[E].quality==8){A+='<span class="colorwords" style="color:'+helper.getItemColor(parseInt(C[E].quality))+'">'+C[E].name+"x"+C[E].num+""}else{A+='<span style="color:'+helper.getItemColor(parseInt(C[E].quality))+'">'+C[E].name+"x"+C[E].num+""}if(E<C.length-1){A+="</span>,"}else{A+="</span>"}}H.find(".resolve_cn #tip_info").html(lang("resolvepop_tip_title",[A]));F=new iScroll("tip_scroller",{bounce:false,momentum:false,hScrollbar:false,});for(var G=0,I=B.material_arr.length;G<I;G++){L=B.material_arr[G];K+='<li class="item_list">';K+='<span style="background-image: url('+xGame.forgeMaterial(L.godcast)+");color: "+helper.getItemColor(L.quality)+';">'+L.name+"x"+L.num+"</span>";if(L.gcrate==100){K+=lang("elitepop_get")}else{K+=lang("xiao_gailv")}K+="</li>"}if(B.silver){K+='<li class="item_list type1"><span>x'+helper.convertWan(B.silver)+"</span></li>"}if(B.jade){K+='<li class="item_list type2"><span>x'+helper.convertWan(B.jade)+"</span></li>"}if(B.refinestone){K+='<li class="item_list type3"><span>x'+helper.convertWan(B.refinestone)+"</span></li>"}if(B.colorstone){K+='<li class="item_list type4"><span>x'+helper.convertWan(B.colorstone)+"</span></li>"}if(B.bloodstone){K+='<li class="item_list type5"><span>x'+helper.convertWan(B.bloodstone)+"</span></li>"}H.find("#reward_list").html(K);D=new iScroll("reward_scroller",{bounce:false,momentum:false,hScrollbar:false,vScrollbar:false});L=null},ladderInfo:function(B){var A=this;if(xGame.checkLock()){return false}var C=function(D){switch(parseInt(D.status)){case 1:A.showLadderInfo(D.info);break;default:xGame.toast.show(D.msg);$("#worldloading").hide();break}xGame.unlock()};loadContents({"c":"ladder","m":"get_ladder_info_by_ladderid","ladderid":B},C);C=null},showLadderInfo:function(F){var A=xGame.loadPopTmpl("ladderinfo");var D=A.find("#ladderinfopop_hidebtn");var E=A.find(".mask");var C="";D.unbind("touchend").bind("touchend",function(G){if(xGame.checkLock(true)){return false}D.unbind();D=null;E.unbind();E=null;A.remove();A=null;G.preventDefault()});E.unbind("touchend").bind("touchend",function(G){if(xGame.checkLock(true)){return false}D.trigger("touchend");G.preventDefault()});if(ladderwarpop){C+='<div class="ladder_name">'+lang("ladderpop_debris_name",[F.name])+"</div>"}else{C+='<div class="ladder_name">'+F.name+"</div>"}C+='<div class="ladder_num">'+lang("ladderpop_has_tatter_num",[F.have_num])+"</div>";C+='<div style="color:red;">'+lang("ladderpop_need_tatter_num",[F.need_num])+"</div>";C+='<div class="ladder_skill">'+F.skill.discription+"</div>";C+='<div class="attr_title">'+lang("ladderpop_plus")+"</div>";C+='<ul class="attr_list">';for(var B=1;B<7;B++){if(parseInt(F["type"+B])!=0){C+="<li>"+helper.getAttrs(F["type"+B])+"<em>+"+F["value"+B]+"</em></li>"}}C+="</ul>";if(ladderpop){if(F.light==0){C+='<div class="ladder_state">'+lang("ladderpop_state")+"<span>"+lang("ladderpop_not_have")+"</span></div>"}else{if(F.light==1){C+='<div class="ladder_state">'+lang("ladderpop_state")+'<span style="color:red;">'+lang("ladderpop_synthesis_make")+"</span></div>";C+='<button class="btn pop_btn_small" id="make_btn" bid='+F.id+">"+lang("ladderpop_make")+"</button>"}else{if(ladderpop.ladderId==F.ladderid){C+='<div class="ladder_state">'+lang("ladderpop_state")+'<span style="color:#00FF00;">'+lang("ladderpop_is_equip")+"</span></div>";C+='<button class="btn pop_btn_small" id="down_up" bid='+F.ladderid+">"+lang("ladderpop_down_fail")+"</button>"}else{C+='<div class="ladder_state">'+lang("ladderpop_state")+'<span style="color:green;">'+lang("jademallpop_have")+"</span></div>";C+='<button class="btn pop_btn_small" id="equip_up" bid='+F.ladderid+">"+lang("countrygvgpop_get_exp")+"</button>"}}}}A.find(".iteminfo").html(C);C=null;A.find("#equip_up").unbind("touchend").bind("touchend",function(G){if(xGame.checkLock(true)){return false}var H=$(this).attr("bid");if(ladderpop&&ladderpop.e){ladderpop.equipLadder(H)}A.remove();A=null;G.preventDefault()});A.find("#down_up").unbind("touchend").bind("touchend",function(G){if(xGame.checkLock(true)||$(this).hasClass("pop_btn_small_selected")){return false}var H=$(this).attr("bid");if(ladderpop&&ladderpop.e){ladderpop.unequipLadder(H)}A.remove();A=null;G.preventDefault()});A.find("#make_btn").unbind("touchend").bind("touchend",function(G){if(xGame.checkLock(true)){return false}var H=$(this).attr("bid");if(ladderpop&&ladderpop.e){ladderpop.ladderMerge(H)}A.remove();A=null;G.preventDefault()})},showlockHtml:function(B,A,C){var D=xGame.loadPopTmpl("equiplock");D.addClass("setlock");if(parseInt(A)==3){D.find(".set_dom .title").css({"font-size":"17px"});D.find(".set_dom .title").html(lang("wuzi_lock_set"))}else{if(parseInt(A)==1){D.find(".set_dom .title").html(lang("equip_lock_set"))}else{D.find(".set_dom .title").html(lang("equip_unlock_set"))}}D.find(".content").find("#hide_btn").unbind("touchend").bind("touchend",function(E){D.remove();xGame.unlock();E.preventDefault()});D.find(".content").find("#sure_btn").unbind("touchend").bind("touchend",function(){if(D.find(".set_dom #private_code").val()==""){xGame.toast.show(lang("equiplock_code_fault"));return false}if(parseInt(A)==3){var E=function(F){switch(parseInt(F.status)){case 1:if(C){C()}D.remove();break;case -1:xGame.toast.show(lang("packpop_equip_msg"));break;default:xGame.toast.show(lang("undefined_error"));break}};loadContents({"c":"member","m":"resource_unlock","pwd":D.find(".set_dom #private_code").val()},E)}else{var E=function(F){switch(parseInt(F.status)){case 1:if(C){C()}if(parseInt(A)==1){player.info.equip_pwd=1;xGame.toast.show(lang("lock_success"))}else{xGame.toast.show(lang("unlock_complete"))}D.remove();break;case -1:xGame.toast.show(lang("equiplock_msg1"));break;case -2:xGame.toast.show(lang("packpop_equip_msg"));break;case -3:xGame.toast.show(lang("psw_mate_error"));break;case -4:xGame.toast.show(lang("equiplock_msg3"));break;default:xGame.toast.show(lang("undefined_error"));break}};if(parseInt(A)==1){loadContents({"c":"pack","m":"set_pwd","pwd":D.find(".set_dom #private_code").val()},E)}else{if(parseInt(A)==2){loadContents({"c":"pack","m":"equip_unlock","eid":B,"pwd":D.find(".set_dom #private_code").val()},E)}else{if(parseInt(A)==4){loadContents({"c":"mount","m":"mount_unlock","id":B,"pwd":D.find(".set_dom #private_code").val()},E)}else{if(parseInt(A)==5){loadContents({"c":"soul","m":"soul_unlock","id":B,"pwd":D.find(".set_dom #private_code").val()},E)}else{if(parseInt(A)==6){loadContents({"c":"gem","m":"gem_unlock","id":B,"pwd":D.find(".set_dom #private_code").val()},E)}}}}}}E=null;xGame.unlock()})},enterBattleFromBeauty:function(A){$("#worldloading").addClass("black").show();setTimeout(function(){xGame.loadBattle(A,function(){if(parseInt(A.b_info.chip_status)==1){miscpop.showRewardbox(A,"beauty")}else{miscpop.battleResultFromBeauty(A)}},"")},500)},battleResultFromBeauty:function(C){var G=this;G.clearflower=false;var D=xGame.loadPopTmpl("battleend");D.find("#battleend_main").attr("class","main type8");var F="";var B=C.reward_info;var K=parseInt(B.type);var H="";var J=C.b_info;var E=C.chip[parseInt(J.chip_id)-1];player.updateinfo({"gold":C.all_gold,"silver":C.all_silver});switch(K){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 9:case 10:case 15:case 16:case 17:case 31:case 32:F='<p class="reward type'+K+'">x'+B.value+"</p>";break;case 8:F='<p class="name" style="color: '+helper.getItemColor(B.info.quality)+';">'+B.info.name+"</p>";F+='<div class="itembox c_i_bj'+B.info.quality+'"><span class="img" style="background-image: url('+xGame.itemurl(B.info.id)+');"></span></div>';break;case 30:F='<p class="chip_name">'+B.info.name+"</p>";F+='<div class="beauty_chip"><span class="img" style="background-image: url('+ximg(staticUrl+"img/plugin/beautypop_girl"+B.info.beauty_id+"_chip"+B.info.chip_id+".png")+');"></span></div>';break;default:break}if(parseInt(J.chip_status)==1){H='<p class="chip_name">'+E.chip_name+"</p>";H+='<div class="beauty_chip"><span class="img" style="background-image: url('+ximg(staticUrl+"img/plugin/beautypop_girl"+E.beauty_id+"_chip"+E.chip_id+".png")+');"></span></div>'}else{H='<p class="name">'+lang("no")+"</p>"}var A='<div class="left"><span class="title">'+lang("beautypop_battle_reward")+"</span>"+F+"</div>";var M='<div class="right"><span class="title">'+lang("beautypop_get_chip")+"</span>"+H+"</div>";D.find("#battleend_main").html(A+M);var L;if(C.info.win>0){L="flagwin"+C.info.win}else{if(C.info.win==0){L="flaglose"+Math.abs(C.info.win);D.find(".flagbg").addClass("equal")}else{L="flaglose"+Math.abs(C.info.win);D.find(".flagbg").addClass("lose")}}D.find(".flag").addClass(L);var I=function(){miscpop.hide("battleendpop");xGame.loadWorld("city");if(beautypop&&beautypop.e){beautypop.e.show();if(beautypop.robChip){beautypop.robChip.show()}}};D.find(".confirm_btn").unbind("touchend").one("touchend",function(){I()});D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");G.destoryAllBombFlower();battleWorld.refight()});if(C.info.report>0){D.find(".share_btn").unbind("touchend").bind("touchend",function(){var N=$(this);miscpop.shareBattle({c:"beauty",m:"send_to_chat",touid:C.info.touid,report:C.info.report,win:C.info.win,},N)})}else{D.find(".share_btn").addClass("disable")}D.show();D=null;if(C.info.win==3){G.createBombFlower()}},enterBattleFromSword:function(A){$("#worldloading").addClass("black").show();if(swordpop&&swordpop.e){swordpop.e.hide()}setTimeout(function(){xGame.loadBattle(A,function(){miscpop.battleResultFromSword(A)},"")},500)},battleResultFromSword:function(B){var E=this;E.clearflower=false;var C=xGame.loadPopTmpl("battleend");var D="";var G=parseInt(B.nums);if(G){D='<p class="nums">'+B.nums+"</p>"}else{D='<p class="nums">'+lang("no")+"</p>"}var A='<div class="sword_cn"><span class="title">'+lang("swordpop_battle_reward")+"</span>"+D+"</div>";C.find("#battleend_main").html(A);var H;if(B.info.win>0){H="flagwin"+B.info.win}else{if(B.info.win==0){H="flaglose"+Math.abs(B.info.win);C.find(".flagbg").addClass("equal")}else{H="flaglose"+Math.abs(B.info.win);C.find(".flagbg").addClass("lose")}}C.find(".flag").addClass(H);var F=function(){miscpop.hide("battleendpop");xGame.loadWorld("city");if(swordpop&&swordpop.e){swordpop.e.show();var I=swordpop;if(I.rankScroller){I.rankScroller.destroy();I.rankScroller=null}if(I.rankScroller==null){I.rankScroller=new iScroll("sword_bottom_scroller",{bounce:false,momentum:false,hScrollbar:false,vScrollbar:false})}I.rankScroller.refresh()}};C.find(".confirm_btn").unbind("touchend").one("touchend",function(){F()});C.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");battleWorld.refight()});if(B.info.report>0){C.find(".share_btn").unbind("touchend").bind("touchend",function(){var I=$(this);miscpop.shareBattle({c:"arena",m:"send_to_chat",touid:B.info.touid,report:B.info.report,win:B.info.win,},I)})}else{C.find(".share_btn").addClass("disable")}C.show();C=null;if(B.info.win==3){E.createBombFlower()}},viewBattleFromEssence:function(C){if(xGame.checkLock()){return false}var A=xGame.nowWorld;var B=function(E){xGame.unlock();if(E.status==1){$("#worldloading").addClass("black").show();strategypop.e.hide();var D=0;if(essencepop&&essencepop.nowBeastId&&essencepop.nowDifficulty&&essencepop.nowMilitary){D=essencepop.nowMilitary}setTimeout(function(){xGame.loadBattle(E,null,"essence"+D,function(){xGame.loadWorld(A);$("#footer").hide();$("#header").hide();strategypop.e.show()})},500)}else{xGame.toast.show(lang("can_not_view_current_report"))}};loadContents({"c":"essence_map","m":"get_report_info","d":"newequip","id":C},B)},enterBattleFromEssence:function(C){var A="city";$("#worldloading").addClass("black").show();var B=0;if(essencepop&&essencepop.nowBeastId&&essencepop.nowDifficulty&&essencepop.nowMilitary){B=essencepop.nowMilitary}setTimeout(function(){xGame.loadBattle(C,function(){miscpop.battleResultFromEssence(C,{beastid:B,},A)},"essence"+B)},500)},battleResultFromEssence:function(D,L,J){var H=this;H.clearflower=false;var E=xGame.loadPopTmpl("battleend");var F=D.reward_info.reward;var C=D.reward_info.first_reward;E.find("#battleend_main").attr("class","main type5");var B='<div class="get1">'+lang("pacify_get_reputation")+'<p class="reputation_part"></p></div>';if(F){var A=F.length;if(A&&!C){if(F.length==1){if(F[0].type==3){B+='<div class="getitem">'+lang("eggpop_got")+'<span style="color:'+helper.getItemColor(F[0].quality)+'" >'+F[0].name+"x"+F[0].value+'</span><span class="pacify_reward"><em style="background-image:url('+xGame.forgeMaterial(F[0].materials_id)+')"></em></span></div>'}else{if(F[0].type==2||F[0].type==1){B+='<div class="getitem">'+lang("eggpop_got")+'<span style="color:'+helper.getItemColor(F[0].quality)+'" >'+F[0].name+"x"+F[0].value+'</span><span class="pacify_reward"><em style="background-image:url('+xGame.itemurl(F[0].id)+')"></em></span></div>'}else{if(F[0].type==4){B+='<div class="getitem">'+lang("eggpop_got")+'<span style="color:'+helper.getItemColor(F[0].quality)+'" >'+lang("danyao")+"x"+F[0].value+'</span><span class="pacify_reward"><em class="danyao"></em></span></div>'}else{if(F[0].type==42){B+='<div class="getitem">'+lang("eggpop_got")+'<span style="color:'+helper.getItemColor(F[0].quality)+'" >'+lang("doggold")+"x"+F[0].value+'</span><span class="pacify_reward"><em class="add_doggold"></em></span></div>'}}}}}else{if(F.length>1){B+='<div class="getitem">'+lang("eggpop_got")+'<ul class="pacify_reward_list">';for(var G=0;G<A;G++){var N=F[G];var K=N.type;if(K==3){B+='<li class="pacify_reward_item" style="background-image:url('+xGame.forgeMaterial(N.materials_id)+')"><span style="color:'+helper.getItemColor(N.quality)+'">'+N.name+"x"+N.value+"</span></li>"}else{if(K==1||K==2){B+='<li class="pacify_reward_item" style="background-image:url('+xGame.itemurl(N.id)+')"><span style="color:'+helper.getItemColor(N.quality)+'">'+N.name+"x"+N.value+"</span></li>"}else{if(K==4){B+='<li class="pacify_reward_item danyao"><span style="color:'+helper.getItemColor(N.quality)+'">'+lang("danyao")+"x"+N.value+"</span></li>"}else{if(K==42){B+='<li class="pacify_reward_doggold"><span style="color:'+helper.getItemColor(N.quality)+'">'+lang("doggold")+"x"+N.value+"</span></li>"}}}}}B+="</ul>"}}}else{if(A&&C){B+='<div class="getitem">'+lang("eggpop_got")+'<ul class="pacify_reward_list">';if(C.type==3){B+='<li class="pacify_reward_item" style="background-image:url('+xGame.forgeMaterial(C.materials_id)+')"><span style="color:'+helper.getItemColor(C.quality)+'">'+C.name+"x"+C.value+"</span></li>"}else{if(C.type==1||C.type==2){B+='<li class="pacify_reward_item" style="background-image:url('+xGame.itemurl(C.id)+')"><span style="color:'+helper.getItemColor(C.quality)+'">'+C.name+"x"+C.value+"</span></li>"}}for(var G=0;G<A;G++){var N=F[G];var K=N.type;if(K==3){B+='<li class="pacify_reward_item" style="background-image:url('+xGame.forgeMaterial(N.materials_id)+')"><span style="color:'+helper.getItemColor(N.quality)+'">'+N.name+"x"+N.value+"</span></li>"}else{if(K==1||K==2){B+='<li class="pacify_reward_item" style="background-image:url('+xGame.itemurl(N.id)+')"><span style="color:'+helper.getItemColor(N.quality)+'">'+N.name+"x"+N.value+"</span></li>"}else{if(K==4){B+='<li class="pacify_reward_item danyao"><span style="color:'+helper.getItemColor(N.quality)+'">'+lang("danyao")+"x"+N.value+"</span></li>"}else{if(K==42){B+='<li class="pacify_reward_doggold"><span style="color:'+helper.getItemColor(N.quality)+'">'+lang("doggold")+"x"+N.value+"</span></li>"}}}}}B+="</ul>"}else{if(!A&&C){if(C.type==3){B+='<div class="getitem">'+lang("eggpop_got")+'<span style="color:'+helper.getItemColor(C.quality)+'" >'+C.name+"x"+C.value+'</span><span class="pacify_reward"><em style="background-image:url('+xGame.forgeMaterial(C.id)+')"></em></span></div>'}else{if(C.type==1||C.type==2){B+='<div class="getitem">'+lang("eggpop_got")+'<span style="color:'+helper.getItemColor(C.quality)+'" >'+C.name+"x"+C.value+'</span><span class="pacify_reward"><em style="background-image:url('+xGame.itemurl(C.id)+')"></em></span></div>'}}}}}}E.find("#battleend_main").html(B);var M="";if(D.info.win>0){M="flagwin"+D.info.win}else{if(D.info.win==0){M="flaglose"+Math.abs(D.info.win);E.find(".flagbg").addClass("equal")}else{M="flaglose"+Math.abs(D.info.win);E.find(".flagbg").addClass("lose")}}E.find(".flag").addClass(M);if(D.reward_info.reputation){E.find("#battleend_main").find(".get1").children("p").html("+"+D.reward_info.reputation)}else{E.find("#battleend_main").find(".get1").children("p").html("+0")}var I=function(){miscpop.hide("battleendpop");L.stage=D.info.stage;if(D.info.complete==1){L={clear:true}}xGame.loadWorld(J);$("#footer").hide();$("#header").hide();if(essencepop&&essencepop.e){essencepop.e.show();if(D.reward_info.first_kill){essencepop.removeDifficulty();essencepop.getBeastInfo(essencepop.nowMilitary);essencepop.firstBossKill=D.first_succ}essencepop.beastDom.hide()}else{xGame.showpop("essence",{"callback":function(){essencepop.getBeastInfo(elixirpop.nowMilitary);essencepop.firstBossKill=D.first_succ}})}};E.find(".confirm_btn").unbind("touchend").bind("touchend",I);E.find(".replay_btn").unbind("touchend").bind("touchend",function(){miscpop.hide("battleendpop");H.destoryAllBombFlower();battleWorld.refight()});if(D.info.report>0){E.find(".share_btn").unbind("touchend").bind("touchend",function(){var O=$(this);miscpop.shareBattle({"c":"essence_map","m":"send_to_chat","d":"newequip","report":D.info.report,"id":essencepop.nowMilitary,"diff_id":essencepop.nowDifficulty,"monster_id":essencepop.nowBeastId,},O)})}else{E.find(".share_btn").addClass("disable")}E.show();E=null;if(D.info.win==3){H.createBombFlower()}},enterBattleFromWarfield:function(A){$("#worldloading").addClass("black").show();if(warfieldpop&&warfieldpop.e){warfieldpop.e.hide()}setTimeout(function(){xGame.loadBattle(A,function(){miscpop.battleResultFromWarfield(A)},"")},500)},battleResultFromWarfield:function(B){var F=this;F.clearflower=false;var D=xGame.loadPopTmpl("battleend");var E="";var C=Math.ceil(parseInt(B.gold));if(B.info.win<0){E='<span class="add_goldstring">'+C+"</span>";var A='<div class="warfield_cn"><span class="title">'+lang("warfieldpop_lose")+":</span>"+E+"</div>"}else{if(B.info.win==0){E='<span class="add_goldstring">'+C+"</span>";var A='<div class="warfield_cn draw"><span class="title">'+lang("warfieldpop_draw")+":</span>"+E+"</div>"}else{E='<span class="add_goldstring">'+Math.ceil(C/2)+'</span><span class="add_goldpackage">'+Math.ceil(C/2)+"</span>";var A='<div class="warfield_cn"><span class="title">'+lang("get")+":</span>"+E+"</div>"}}D.find("#battleend_main").html(A);var H;if(B.info.win>0){H="flagwin"+B.info.win}else{if(B.info.win==0){H="flaglose"+Math.abs(B.info.win);D.find(".flagbg").addClass("equal")}else{H="flaglose"+Math.abs(B.info.win);D.find(".flagbg").addClass("lose")}}D.find(".flag").addClass(H);var G=function(){miscpop.hide("battleendpop");xGame.loadWorld("city");if(warfieldpop&&warfieldpop.e){warfieldpop.e.show();var I=warfieldpop;if(B.out==1){xGame.confirm.show(lang(""),lang("warfieldpop_out1"),1,function(){xGame.confirm.hide();I.hide();xGame.showpop("warfield")})}else{if(B.out==2){xGame.confirm.show(lang(""),lang("warfieldpop_out2"),1,function(){xGame.confirm.hide();I.hide();xGame.showpop("warfield")})}else{if(B.out==3){xGame.confirm.show(lang(""),lang("warfieldpop_out3"),1,function(){xGame.confirm.hide();I.hide();xGame.showpop("warfield")})}else{I.enterticket()}}}if(!B.reward||!B.reward.info||!B.reward.info.type){return true}else{I.vsDom.find(".reward_box").show();I.boxAnimation(I.vsDom.find(".reward_box"));I.rewardDown(B.reward.info);I.deleteThread=setTimeout(function(){I.vsDom.find(".reward_box").hide()},3600)}}};D.find(".confirm_btn").unbind("touchend").one("touchend",function(){G()});D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");battleWorld.refight()});if(parseInt(B.info.report)>0){D.find(".share_btn").unbind("touchend").bind("touchend",function(){var I=$(this);miscpop.shareBattle({c:"amphitheater",m:"send_to_chat",id:B.info.report,win:B.info.win,touid:warfieldpop.touid,toserverid:warfieldpop.serverid,type:warfieldpop.totype,},I)})}else{D.find(".share_btn").addClass("disable")}D.show();D=null;if(B.info.win==3){F.createBombFlower()}},showNewinvitecode:function(){var A=$("#newinvitecodepop_wrap");if(A.length>0){return false}var A=xGame.loadPopTmpl("newinvitecode");var C=A.find("#newinvitecode_info_page");var D=function(){A.remove();A=null;C=null};var B=function(E){var F=function(G){if(G.status==1){xGame.toast.show(lang("invitefriend_done",[G.reward.gold,G.reward.silver]));player.updateinfo({gold:parseInt(player.info.gold)+parseInt(G.reward.gold),silver:parseInt(player.info.silver)+parseInt(G.reward.silver)});A.remove();A=null;C=null;if(invitationpop&&invitationpop.e){invitationpop.e.find("#invitefriend_myinvitor_btn").hide()}}else{if(G.status==2){xGame.toast.show(lang("inviteitem_code_drop"))}else{if(G.status==3){xGame.toast.show(lang("inviteitem_code_error"));A.find("#input_newinvitecode").val("")}else{if(G.status==4){xGame.toast.show(lang("had_receive"))}else{if(G.status==5){xGame.toast.show(lang("inviteitem_code_too_much_error"))}else{xGame.toast.show(lang("undefined_error"))}}}}}};loadContents({"c":"invitation","m":"change","code":E},F)};A.find(".hidebtn").unbind("touchend").bind("touchend",function(E){E.preventDefault();E.stopPropagation();D()});A.find("#submit_newinvitecode_btn").unbind("touchend").bind("touchend",function(E){var F=$("#input_newinvitecode").val();if(F){B(F)}else{D()}E.preventDefault();E.stopPropagation()});A.find("#newinvitecode_info").unbind("touchend").bind("touchend",function(E){C.show();E.preventDefault()});A.find("#newinvitecode_info_hidebtn").unbind("touchend").bind("touchend",function(E){C.hide();E.preventDefault()});C.find(".mask").unbind("touchend").bind("touchend",function(E){C.hide();E.preventDefault()});A.show()},enterBattleFromStarBattle:function(C){var A="city";$("#worldloading").addClass("black").show();var B=0;if(starbattlepop&&starbattlepop.nowBeastId&&starbattlepop.nowDifficulty&&starbattlepop.nowpage){B=starbattlepop.nowpage}setTimeout(function(){xGame.loadBattle(C,function(){miscpop.battleResultFromStarBattle(C,{beastid:B,},A)},starbattlepop.battlelist[starbattlepop.nowpage-1])},500)},battleResultFromStarBattle:function(D,K,J){var G=this;G.clearflower=false;var E=xGame.loadPopTmpl("battleend");var C=D.reward_info;E.find("#battleend_main").attr("class","main type2");if(D.info.win>0){var B='<div class="get1">'+lang("starbattle_star_judge")+'<span class="starbattle_desc desc1">'+D.info.star_msg1+'</span><span class="starbattle_desc desc2">'+D.info.star_msg2+'</span><span class="starbattle_desc desc3">'+D.info.star_msg3+"</span></div>"}else{var B='<div class="get1">'+lang("starbattle_star_judge")+"</div>"}B+='<div class="get2">'+lang("starbattle_star_reward")+"</div>";if(C!=""){B+='<div class="starbattle_rewardDiv">';for(var F=0,A=C.length;F<A;F++){B+='<div class="starbattle_rewardbox">';B+='<span class="starbattle_rewardimg rtype'+C[F].type+'"></span>';B+='<span class="starbattle_rewardnum">x'+helper.convertWan(C[F].num)+"</span></div>"}B+="</div>"}else{B+=""}E.find("#battleend_main").html(B);var L="";if(D.info.win>0){var I="";I+='<span class="getStar star1"></span>';I+='<span class="getStar star2"></span>';I+='<span class="getStar star3"></span>';E.find(".flag").html(I);if(D.info.star1==0){E.find(".star1").addClass("star_dump")}else{E.find(".star1").addClass("star_light")}if(D.info.star2==0){E.find(".star2").addClass("star_dump")}else{E.find(".star2").addClass("star_light")}if(D.info.star3==0){E.find(".star3").addClass("star_dump")}else{E.find(".star3").addClass("star_light")}}else{if(D.info.win==0){L="flaglose"+Math.abs(D.info.win);E.find(".flagbg").addClass("equal")}else{L="flaglose"+Math.abs(D.info.win);E.find(".flagbg").addClass("lose")}}E.find(".flag").addClass(L);var H=function(){miscpop.hide("battleendpop");K.stage=D.info.stage;if(D.info.complete==1){K={clear:true}}xGame.loadWorld(J);if(starbattlepop&&starbattlepop.e){starbattlepop.e.show();starbattlepop.requestEnter();starbattlepop.beastDom.hide()}};E.find(".confirm_btn").unbind("touchend").bind("touchend",H);E.find(".replay_btn").unbind("touchend").bind("touchend",function(){miscpop.hide("battleendpop");G.destoryAllBombFlower();battleWorld.refight()});if(D.info.report>0){E.find(".share_btn").unbind("touchend").bind("touchend",function(){var M=$(this);miscpop.shareBattle({"c":"star_battle","m":"send_to_chat","report":D.info.report,"id":starbattlepop.nowpage,"diff_id":starbattlepop.nowDifficulty,"monster_id":starbattlepop.nowBeastId,},M)})}else{E.find(".share_btn").addClass("disable")}E.show();E=null;if(D.info.win==3){G.createBombFlower()}},battleResultFromCountrygvg:function(G){var C=this;C.clearflower=false;var D=xGame.loadPopTmpl("battleend");D.find(".content").css("display","none");D.find(".countrygvg").css("display","block");if(G.win>0){D.find(".countrygvg .flagbg").addClass("winner");D.find(".countrygvg .gvg_title").html(lang("battle_winner"))}else{D.find(".countrygvg .flagbg").addClass("loser");D.find(".countrygvg .gvg_title").html(lang("battle_loser"))}D.find(".countrygvg .server_name").html("【"+G.win_country.server+"】"+G.win_country.name);var E=G.report_list;var A=E.length;for(var B=0;B<G.score.length;B++){if(G.score[B].field==E[E.length-1].field){D.find(".countrygvg .flag").addClass("field"+G.score[B].field);D.find(".countrygvg .reward").html(lang("battle_integral_reward",[G.score[B].score]))}}var F=function(){miscpop.hide("battleendpop");xGame.loadWorld("city");if(typeof countrygvgpop!="undefined"&&countrygvgpop.e!=null){countrygvgpop.cdEndRefresh()}};D.find(".confirm_btn").unbind("touchend").one("touchend",F);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");C.destoryAllBombFlower();countrygvgpop.fight(G)});D.show();D=null},runeenterBattleFromThrone:function(B,A){$("#worldloading").addClass("black").show();player.taskaction(17);setTimeout(function(){xGame.loadBattle(B,function(){if(B.info.win>0&&B.info.reward.length>0){if(miscpop.runeincludeItem(B.info.reward)){miscpop.showRewardbox(B,"rune")}else{miscpop.runebattleResultFromThrone(B,B.info.reward)}}else{miscpop.runebattleResultFromThrone(B)}},A)},500)},runeincludeItem:function(B){if(B.length==0){return false}else{for(var A=0;A<B.length;A++){if(parseInt(B[A].gettype)>2){return true}}return false}},runebattleResultFromThrone:function(C,B,F){var H=this;H.clearflower=false;var E=xGame.loadPopTmpl("battleend");var M;if(C.info.win>0){M="flagwin"+C.info.win}else{if(C.info.win==0){M="flaglose"+Math.abs(C.info.win);E.find(".flagbg").addClass("equal")}else{M="flaglose"+Math.abs(C.info.win);E.find(".flagbg").addClass("lose")}}if(B==undefined){E.find("#battleend_main").attr("class","main type4").html('<p class="tips">'+lang("every_10_get_reward")+"</p>")}else{var L="";if(F){var J='<div class="box" style="margin-top:10px;">';var D=false;var A=0;for(var G=0,K=B.length;G<K;G++){if(B[G].gettype==52){A++}}if(A>1){D=true}for(var G=0;G<B.length;G++){if(B[G].gettype==1){J+='<em class="wuzi gold">'+lang("gold")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==2){J+='<em class="wuzi silver">'+lang("silver")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==6){J+='<em class="wuzi jade">'+lang("jade")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==7){J+='<em class="wuzi reputation">'+lang("reputation")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==5){J+='<em class="wuzi original_soul">'+lang("original_soul")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==10){J+='<em class="wuzi tfcard">'+lang("tfcard")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==4){J+='<em class="wuzi purple_jade">'+lang("purple_jade")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==14){J+='<em class="wuzi refinestone">'+lang("refinestone")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==15){J+='<em class="wuzi colorstone">'+lang("colorstone")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==16){J+='<em class="wuzi bloodstone">'+lang("bloodstone")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==34||B[G].gettype==26){J+='<em class="wuzi" style="color:'+helper.getItemColor(B[G].info.quality)+'">'+B[G].info.name+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==52){if(D==false){L+='<div class="box isitem">';L+="<p>"+lang("get")+':<em style="color:#fff">'+B[G].info.name+" x "+B[G].getvalue+"</em></p>";L+='<div class="itembox c_i_bj1"><span style="background-image:url('+xGame.runeurl(B[G].info.type,Math.ceil(B[G].info.quality/5))+');"></span><b>x'+B[G].getvalue+"</b></div>";L+="</div>"}else{J+='<em class="wuzi" style="background:url('+xGame.runeurl(B[G].info.type,Math.ceil(B[G].info.quality/5))+') left center no-repeat;background-size: 35px;">'+B[G].info.name+":"+B[G].getvalue+"</em>"}}else{if(B[G].gettype==8){J+='<em class="wuzi" style="color:'+helper.getItemColor(B[G].info.quality)+'">'+B[G].info.name+":"+B[G].getvalue+"</em>"}}}}}}}}}}}}}}J+="</div>";L=J+L}else{for(var G=0;G<B.length;G++){L+='<div class="box">';if(B[G].gettype==1){L+='<em class="wuzi gold" style="margin-top:50px;">'+lang("gold")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==2){L+='<em class="wuzi silver" style="margin-top:50px;">'+lang("silver")+":"+B[G].getvalue+"</em>"}else{if(B[G].gettype==3){L+='<em class="wuzi jade" style="margin-top:50px;">'+lang("jade")+":"+B[G].getvalue+"</em>"}}}L+="</div>"}}E.find("#battleend_main").attr("class","main type7").html(L)}E.find(".flag").addClass(M);var I=function(){miscpop.hide("battleendpop");if(C.info.view==0){xGame.loadWorld("runethrone")}else{if(C.info.view==1){xGame.loadWorld("runethrone",true)}}};E.find(".confirm_btn").unbind("touchend").one("touchend",I);E.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");H.destoryAllBombFlower();battleWorld.refight()});E.find(".share_btn").addClass("disable");E.show();E=null;if(C.info.win==3){H.createBombFlower()}},battleResultFromMonoply:function(G){var C=this;C.clearflower=false;var E=xGame.loadPopTmpl("battleend");var B=parseInt(actmonopolypop.nowpageData.score)+parseInt(G.score);actmonopolypop.e.find(".actmonopoly_score").html(lang("actmonopolypop_score_num",[B]));var A="";if(G.status==1&&G.battle.assess>=1){A="flagwin"+G.battle.assess}else{E.find(".flagbg").addClass("lose");A="flaglose"+Math.abs(G.battle.assess)}E.find(".flag").addClass(A);var D="";if(G.status==1&&G.battle.assess>=1){D+='<div class="monoply_reward">';D+='<div class="wuzi">';D+="<span>"+lang("get")+":</span>";if(G.reward.type==8){D+='<span class="reward_name rtype'+G.reward.type+'">'+G.reward.info.name+"</span>"}else{if(G.reward.type>=17&&G.reward.type<=25){D+='<span class="reward_name rtype'+G.reward.type+'">'+G.reward.info.name+"</span>"}else{if(G.reward.type==34||G.reward.type==26){D+='<span class="reward_name rtype'+G.reward.type+'">'+G.reward.info.name+"</span>"}else{if(G.reward.type==29){D+='<span class="reward_name rtype'+G.reward.type+'">'+G.reward.info.name+"</span>"}else{if(G.reward.type==52){D+='<span class="reward_name rtype'+G.reward.type+'">'+G.reward.info.name+"</span>"}else{D+='<span class="reward_type rtype'+G.reward.type+'"></span>'}}}}}if(G.reward.type==1){player.updateinfo({"gold":parseInt(player.info.gold)+parseInt(G.reward.value)})}else{if(G.reward.type==2){player.updateinfo({"silver":parseInt(player.info.silver)+parseInt(G.reward.value)})}}D+='<span class="num">x'+G.reward.value+"</span>";D+="</div>";D+='<span class="monoply_score">'+lang("actmonopolypop_battle_score",[G.score])+"</span>";D+="</div>"}E.find("#battleend_main").addClass("type2");E.find("#battleend_main").html(D);var F=function(){miscpop.hide("battleendpop");xGame.loadWorld("city")};E.find(".share_btn").addClass("disable");E.find(".confirm_btn").unbind("touchend").one("touchend",F);E.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");battleWorld.refight()});E.show();E=null},battleResultFromLadderwar:function(F){var B=this;B.clearflower=false;var D=xGame.loadPopTmpl("battleend");var A="";if(F.info.win>0){A="flagwin"+F.battle.assess}else{if(F.info.win==0){D.find(".flagbg").addClass("equal");A="flaglose"+Math.abs(F.info.win)}else{D.find(".flagbg").addClass("lose");A="flaglose"+Math.abs(F.battle.assess)}}D.find(".flag").addClass(A);var C="";if(F.info.win>0){C+='<div class="ladder_reward">';C+="<span>"+lang("get")+":</span>";C+='<div class="wuzi ladderwar_stone">';C+='<span class="img"></span>';C+="<em>x"+F.reward_info.stone+"</em>";C+="</div>";C+='<div class="wuzi ladderwar_wood">';C+='<span class="img"></span>';C+="<em>x"+F.reward_info.wood+"</em>";C+="</div>";C+="</div>";if(F.pass_reward!=undefined){C+='<div class="ladder_getitem">';C+="<p>"+lang("get")+':<span style="color:#09964c">'+F.pass_reward.info.name+"</span></p>";C+='<div class="itembox">';C+='<span style="background-image:url('+xGame.charioturl(F.pass_reward.info.img)+')"></span>';C+="<em>x"+F.pass_reward.num+"</em>";C+="</div>";C+="</div>"}}else{C+='<div class="ladder_reward">';C+="<span>"+lang("get")+":</span>";C+='<div class="wuzi ladderwar_stone">';C+='<span class="img"></span>';C+="<em>x"+0+"</em>";C+="</div>";C+='<div class="wuzi ladderwar_wood">';C+='<span class="img"></span>';C+="<em>x"+0+"</em>";C+="</div>";C+="</div>"}D.find("#battleend_main").addClass("type2");D.find("#battleend_main").html(C);var E=function(){miscpop.hide("battleendpop");xGame.loadWorld("city");if(ladderwarpop){ladderwarpop.wuchangData()}};D.find(".confirm_btn").unbind("touchend").one("touchend",E);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");battleWorld.refight()});if(F.info.report>0){D.find(".share_btn").unbind("touchend").bind("touchend",function(){var G=$(this);miscpop.shareBattle({"c":"ladder_war","m":"send_to_chat","report":F.info.report,"id":ladderwarpop.wartype,"floor":ladderwarpop.warfloor,},G)})}else{D.find(".share_btn").addClass("disable")}D.show();D=null},battleResultFromLadderexploitRob:function(F){var B=this;B.clearflower=false;var D=xGame.loadPopTmpl("battleend");var A="";if(F.info.win>0){A="flagwin"+F.battle.assess}else{if(F.info.win==0){D.find(".flagbg").addClass("equal");A="flaglose"+Math.abs(F.info.win)}else{D.find(".flagbg").addClass("lose");A="flaglose"+Math.abs(F.battle.assess)}}D.find(".flag").addClass(A);var C="";C+='<div class="ladder_reward">';C+="<span>"+lang("get")+":</span>";C+='<div class="wuzi ladderwar_wood">';C+='<span class="img"></span>';C+="<em>x"+F.reward+"</em>";C+="</div>";C+="</div>";D.find("#battleend_main").addClass("type2");D.find("#battleend_main").html(C);if(F.info.win>0){var E=function(){miscpop.hide("battleendpop");xGame.loadWorld("city");if(exploittreepop){exploittreepop.lootLottery()}}}else{var E=function(){miscpop.hide("battleendpop");xGame.loadWorld("city");if(exploittreepop){exploittreepop.gorobData()}}}D.find(".confirm_btn").unbind("touchend").one("touchend",E);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");battleWorld.refight()});if(F.info.win>0){D.find(".share_btn").unbind("touchend").bind("touchend",function(){var G=$(this);miscpop.shareBattle({"c":"exploit_tree","m":"loot_send_to_chat","touid":F.info.touid,"report":F.info.report,"win":F.info.win,},G)})}else{D.find(".share_btn").addClass("disable")}D.show();D=null},battleResultFromLadderexploitArrest:function(F){var B=this;B.clearflower=false;var D=xGame.loadPopTmpl("battleend");var A="";if(F.info.win>0){A="flagwin"+F.battle.assess}else{if(F.win==0){D.find(".flagbg").addClass("equal");A="flaglose"+Math.abs(F.info.win)}else{D.find(".flagbg").addClass("lose");A="flaglose"+Math.abs(F.battle.assess)}}D.find(".flag").addClass(A);var C="";C+='<div class="monoply_reward">';if(F.info.win>0){C+='<div class="wuzi">';C+="<span>"+lang("get")+":</span>";if(F.reward.reward_type==8){C+='<span class="reward_name rtype'+F.reward.reward_type+'">'+F.reward.info.name+"</span>"}else{if(F.reward.reward_type>=17&&F.reward.reward_type<=25){C+='<span class="reward_name rtype'+F.reward.reward_type+'">'+F.reward.info.name+"</span>"}else{if(F.reward.reward_type==34||F.reward.reward_type==26){C+='<span class="reward_name rtype'+F.reward.reward_type+'">'+F.reward.info.name+"</span>"}else{if(F.reward.reward_type==29){C+='<span class="reward_name rtype'+F.reward.reward_type+'">'+F.reward.info.name+"</span>"}else{if(F.reward.reward_type==52){C+='<span class="reward_name rtype'+F.reward.reward_type+'">'+F.reward.info.name+"</span>"}else{if(F.reward.reward_type==62){C+='<span class="reward_name rtype'+F.reward.reward_type+'">'+F.reward.info.name+"</span>"}else{C+='<span class="reward_type rtype'+F.reward.reward_type+'"></span>'}}}}}}if(F.reward.reward_type==1){player.updateinfo({"gold":parseInt(player.info.gold)+parseInt(F.reward.reward_value)})}else{if(F.reward.reward_type==2){player.updateinfo({"silver":parseInt(player.info.silver)+parseInt(F.reward.reward_value)})}}C+='<span class="num">x'+F.reward.reward_value+"</span>";C+="</div>"}else{C+="<span>"+lang("exploittreepop_loser")+"</span>"}C+="</div>";D.find("#battleend_main").addClass("type2");D.find("#battleend_main").html(C);var E=function(){miscpop.hide("battleendpop");xGame.loadWorld("city");if(exploittreepop){if(exploittreepop.tabType==1){exploittreepop.gorobData()}else{if(exploittreepop.tabType==2){exploittreepop.rankData()}}}};D.find(".confirm_btn").unbind("touchend").one("touchend",E);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");battleWorld.refight()});if(F.info.win>0){D.find(".share_btn").unbind("touchend").bind("touchend",function(){var G=$(this);miscpop.shareBattle({"c":"exploit_tree","m":"arrest_send_to_chat","touid":F.info.touid,"report":F.info.report,"win":F.info.win,},G)})}else{D.find(".share_btn").addClass("disable")}D.show();D=null},battleResultFromLadderexploitstoneRob:function(F){var B=this;B.clearflower=false;var D=xGame.loadPopTmpl("battleend");var A="";if(F.info.win>0){A="flagwin"+F.battle.assess}else{if(F.info.win==0){D.find(".flagbg").addClass("equal");A="flaglose"+Math.abs(F.info.win)}else{D.find(".flagbg").addClass("lose");A="flaglose"+Math.abs(F.battle.assess)}}D.find(".flag").addClass(A);var C="";C+='<div class="ladder_reward">';C+="<span>"+lang("get")+":</span>";C+='<div class="wuzi ladderwar_stone">';C+='<span class="img"></span>';C+="<em>x"+F.reward+"</em>";C+="</div>";C+="</div>";D.find("#battleend_main").addClass("type2");D.find("#battleend_main").html(C);if(F.info.win>0){var E=function(){miscpop.hide("battleendpop");xGame.loadWorld("city");if(exploitstonepop){exploitstonepop.lootLottery()}}}else{var E=function(){miscpop.hide("battleendpop");xGame.loadWorld("city");if(exploitstonepop){exploitstonepop.gorobData()}}}D.find(".confirm_btn").unbind("touchend").one("touchend",E);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");battleWorld.refight()});if(F.info.win>0){D.find(".share_btn").unbind("touchend").bind("touchend",function(){var G=$(this);miscpop.shareBattle({"c":"exploit_stone","m":"loot_send_to_chat","touid":F.info.touid,"report":F.info.report,"win":F.info.win,},G)})}else{D.find(".share_btn").addClass("disable")}D.show();D=null},battleResultFromLadderexploitstoneArrest:function(F){var B=this;B.clearflower=false;var D=xGame.loadPopTmpl("battleend");var A="";if(F.info.win>0){A="flagwin"+F.battle.assess}else{if(F.win==0){D.find(".flagbg").addClass("equal");A="flaglose"+Math.abs(F.info.win)}else{D.find(".flagbg").addClass("lose");A="flaglose"+Math.abs(F.battle.assess)}}D.find(".flag").addClass(A);var C="";C+='<div class="monoply_reward">';if(F.info.win>0){C+='<div class="wuzi">';C+="<span>"+lang("get")+":</span>";if(F.reward.reward_type==8){C+='<span class="reward_name rtype'+F.reward.reward_type+'">'+F.reward.info.name+"</span>"}else{if(F.reward.reward_type>=17&&F.reward.reward_type<=25){C+='<span class="reward_name rtype'+F.reward.reward_type+'">'+F.reward.info.name+"</span>"}else{if(F.reward.reward_type==34||F.reward.reward_type==26){C+='<span class="reward_name rtype'+F.reward.reward_type+'">'+F.reward.info.name+"</span>"}else{if(F.reward.reward_type==29){C+='<span class="reward_name rtype'+F.reward.reward_type+'">'+F.reward.info.name+"</span>"}else{if(F.reward.reward_type==52){C+='<span class="reward_name rtype'+F.reward.reward_type+'">'+F.reward.info.name+"</span>"}else{if(F.reward.reward_type==62){C+='<span class="reward_name rtype'+F.reward.reward_type+'">'+F.reward.info.name+"</span>"}else{C+='<span class="reward_type rtype'+F.reward.reward_type+'"></span>'}}}}}}if(F.reward.reward_type==1){player.updateinfo({"gold":parseInt(player.info.gold)+parseInt(F.reward.reward_value)})}else{if(F.reward.reward_type==2){player.updateinfo({"silver":parseInt(player.info.silver)+parseInt(F.reward.reward_value)})}}C+='<span class="num">x'+F.reward.reward_value+"</span>";C+="</div>"}else{C+="<span>"+lang("exploittreepop_loser")+"</span>"}C+="</div>";D.find("#battleend_main").addClass("type2");D.find("#battleend_main").html(C);var E=function(){miscpop.hide("battleendpop");xGame.loadWorld("city");if(exploitstonepop){if(exploitstonepop.tabType==1){exploitstonepop.gorobData()}else{if(exploitstonepop.tabType==2){exploitstonepop.rankData()}}}};D.find(".confirm_btn").unbind("touchend").one("touchend",E);D.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");battleWorld.refight()});if(F.info.win>0){D.find(".share_btn").unbind("touchend").bind("touchend",function(){var G=$(this);miscpop.shareBattle({"c":"exploit_stone","m":"arrest_send_to_chat","touid":F.info.touid,"report":F.info.report,"win":F.info.win,},G)})}else{D.find(".share_btn").addClass("disable")}D.show();D=null},enterBattleFromfuMine:function(B,A){$("#worldloading").addClass("black").show();setTimeout(function(){xGame.loadBattle(B,function(){miscpop.battleResultFromfuMine(B,A)},"")},500)},battleResultFromfuMine:function(F,A){var B=this;B.clearflower=false;var C=xGame.loadPopTmpl("battleend");C.find("#battleend_main").attr("class","main type4").html('<p class="tips"></p>');var D;if(F.info.win>0){D="flagwin"+F.info.win;C.find("#battleend_main").children("p").css("font-size","22px");if(F.info.event.name!=undefined){C.find("#battleend_main").children("p").html(lang("fumine_rob_from",[F.info.country,F.info.name,F.info.reward_type,F.info.reward_value,F.info.event.type,F.info.event.value]))}else{C.find("#battleend_main").children("p").html(lang("fumine_rob_from1",[F.info.country,F.info.name,F.info.reward_type,F.info.reward_value]))}}else{if(F.info.win==0){D="flaglose"+Math.abs(F.info.win);C.find(".flagbg").addClass("equal");C.find("#battleend_main").children("p").html(lang("fukubukuropop_mine_fail"))}else{D="flaglose"+Math.abs(F.info.win);C.find(".flagbg").addClass("lose");C.find("#battleend_main").children("p").html(lang("fukubukuropop_mine_fail"))}}C.find(".flag").addClass(D);var E=function(){miscpop.hide("battleendpop");xGame.loadWorld("fumine",F.info)};C.find(".confirm_btn").unbind("touchend").one("touchend",E);C.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");B.destoryAllBombFlower();battleWorld.refight()});if(F.info.report>0){C.find(".share_btn").unbind("touchend").bind("touchend",function(){var G=$(this);miscpop.shareBattle({c:"fukubukuro",m:"send_to_chat",touid:A,report:F.info.report,win:F.info.win,},G)})}else{C.find(".share_btn").addClass("disable")}C.show();C=null;if(F.win==3){B.createBombFlower()}},battleResultFromDiagram:function(G){var C=this;C.clearflower=false;var E=xGame.loadPopTmpl("battleend");var A="";if(G.status==1&&G.battle.assess>=1){A="flagwin"+G.battle.assess}else{E.find(".flagbg").addClass("lose");A="flaglose"+Math.abs(G.battle.assess)}E.find(".flag").addClass(A);var D="";if(G.status==1&&G.battle.assess>=1){D+='<div class="monoply_reward">';D+='<div class="wuzi">';D+='<span class="eight_title">'+lang("get")+":</span>";for(var B=1;B<5;B++){D+='<div class="eight_reward">';if(G.reward["type"+B]&&G.reward["type"+B]!=0){if(G.reward["type"+B]==8){D+='<span class="reward_name rtype'+G.reward["type"+B]+'">'+G.reward["info"+B].name+"</span>"}else{if(G.reward["type"+B]>=17&&G.reward["type"+B]<=25){D+='<span class="reward_name rtype'+G.reward["type"+B]+'">'+G.reward["info"+B].name+"</span>"}else{if(G.reward["type"+B]==34||G.reward["type"+B]==26){D+='<span class="reward_name rtype'+G.reward["type"+B]+'">'+G.reward["info"+B].name+"</span>"}else{if(G.reward["type"+B]==29){D+='<span class="reward_name rtype'+G.reward["type"+B]+'">'+G.reward["info"+B].name+"</span>"}else{if(G.reward["type"+B]==52){D+='<span class="reward_name rtype'+G.reward["type"+B]+'">'+G.reward["info"+B].name+"</span>"}else{D+='<span class="reward_type rtype'+G.reward["type"+B]+'"></span>'}}}}}D+='<span class="num">x'+G.reward["num"+B]+"</span>"}D+="</div>"}D+="</div>";D+="</div>"}else{D='<p class="tips">'+lang("eightdiagrampop_fail")+"</p>"}if(G.reward.times&&parseInt(G.reward.times)!=0){D+='<div class="multiple"><span>'+G.reward.times+"</span></div>"}E.find("#battleend_main").addClass("type2");E.find("#battleend_main").html(D);var F=function(){miscpop.hide("battleendpop");xGame.loadWorld("city");if(typeof eightdiagrampop!="undefined"&&eightdiagrampop.e!=null){eightdiagrampop.levelSelect(eightdiagrampop.level)}};E.find(".share_btn").addClass("disable");E.find(".confirm_btn").unbind("touchend").one("touchend",F);E.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");battleWorld.refight()});E.show();E=null},battleFromThreecontest:function(G,A){var B=this;var D=xGame.nowWorld;B.clearflower=false;var C=xGame.loadPopTmpl("battleend");C.find("#battleend_main").attr("class","main type4").html('<p class="tips"></p>');var F;if(G.win_or_lose>0){F="flagwin"+G.info.win;C.find("#battleend_main").children("p").html(lang("threecontest_win_msg",[G.pk_integral]))}else{F="flaglose"+Math.abs(G.info.win);C.find(".flagbg").addClass("lose");C.find("#battleend_main").children("p").html(lang("threecontest_lose_msg",[G.pk_integral]))}C.find(".flag").addClass(F);var E=function(){miscpop.hide("battleendpop");xGame.loadWorld("city");if(threecontestpop){threecontestpop.threecontestinit()}};C.find(".confirm_btn").unbind("touchend").one("touchend",E);C.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");B.destoryAllBombFlower();battleWorld.refight()});C.find(".share_btn").unbind("touchend").bind("touchend",function(){var H=$(this);miscpop.shareBattle({c:"three_talents_pk",m:"send_to_chat",touid:A,report:G.info.report,win:G.win_or_lose,},H)});C.show();C=null;if(G.info.win==3){B.createBombFlower()}},battleFromAssistwar:function(B){var F=this;var D=xGame.nowWorld;F.clearflower=false;var C=xGame.loadPopTmpl("battleend");var I;if(parseInt(B["info"].win)>0){I="flagwin"+B.info.win}else{I="flaglose"+Math.abs(B.info.win);C.find(".flagbg").addClass("lose")}C.find(".flag").addClass(I);var H="";H+='<div class="monoply_reward assistwar_reward">';H+='<div class="wuzi">';H+='<span class="eight_title">'+lang("get")+":</span>";if(parseInt(B["info"].win)>0){for(var E in B["info"]["reward_info"]){var A=B["info"]["reward_info"][E];if(parseInt(A["number"])!=0){H+='<div class="eight_reward">';if(A["name"]==86){H+='<span class="reward_type rtype'+A["name"]+'" style="background-image:url('+xGame.avatar(A["card_info"]["imageid"])+');" id="addrtype'+A["name"]+'"></span>';var J=lang("assistcardpop_type1");if(parseInt(A["card_info"]["card_type"])==2){J=lang("assistcardpop_type2")}if(parseInt(A["card_info"]["card_quality"])==8){H+='<span class="num"><em class="colorwords" style="color:'+helper.getItemColor(parseInt(A.card_info.card_quality))+'">'+A["card_info"]["card_name"]+""+J+"x"+A["number"]+"</em></span>"}else{H+='<span style="color:'+helper.getItemColor(parseInt(A.card_info.card_quality))+'" class="num">'+A["card_info"]["card_name"]+""+J+"x"+A["number"]+"</span>"}}else{if(A["name"]==90){H+='<span class="reward_type rtype'+A["name"]+'" style="background-image:url('+xGame.avatar(A["card_info"]["imageid"])+');" id="addrtype'+A["name"]+'"></span>';var J=lang("assistcardpop_type1");if(parseInt(A["card_info"]["card_type"])==2){J=lang("assistcardpop_type2")}if(parseInt(A["card_info"]["card_quality"])==8){H+='<span class="num"><em class="colorwords" style="color:'+helper.getItemColor(parseInt(A.card_info.card_quality))+'">'+lang("debris",[A["card_info"]["card_name"]+J])+"x"+A["number"]+"</em></span>"}else{H+='<span style="color:'+helper.getItemColor(parseInt(A.card_info.card_quality))+'" class="num">'+lang("debris",[A["card_info"]["card_name"]+J])+"x"+A["number"]+"</span>"}}else{H+='<span class="reward_type rtype'+A["name"]+'" id="addrtype'+A["name"]+'"></span>';H+='<span class="num">'+helper.wuziname(A["name"])+"x"+A["number"]+"</span>"}}H+="</div>"}}}else{H+='<div class="eight_reward">';H+='<span class="reward_type rtype87" id="addrtype87"></span>';H+='<span class="num">'+helper.wuziname(87)+"x0</span>";H+="</div>"}H+="</div>";H+="</div>";C.find("#battleend_main").attr({"class":"main type2"});C.find("#battleend_main").html(H);var G=function(){miscpop.hide("battleendpop");xGame.loadWorld("city");if(assistwarpop){assistwarpop.refreshInit()}};C.find(".confirm_btn").unbind("touchend").one("touchend",G);C.find(".replay_btn").unbind("touchend").one("touchend",function(){miscpop.hide("battleendpop");F.destoryAllBombFlower();battleWorld.refight()});C.find(".share_btn").addClass("disable").unbind("touchend");C.show();C=null;if(B.info.win==3){F.createBombFlower()}},viewBattleFromAssistwar:function(C){if(xGame.checkLock()){return false}var A=xGame.nowWorld;var B=function(D){xGame.unlock();if(D.status==1){$("#worldloading").addClass("black").show();strategypop.e.hide();setTimeout(function(){xGame.loadBattle(D,null,"6",function(){xGame.loadWorld(A);$("#footer").hide();$("#header").hide();strategypop.e.show()})},500)}else{xGame.toast.show(lang("can_not_view_current_report"))}};loadContents({"c":"assist_copy","m":"battle_report_info","id":C},B)},sweepReward:function(B,H){var F=this;var C=xGame.loadPopTmpl("sweepreward");var G;C.find(".title").html(lang("one_sweep_title",[B.mission_num,B.challenge_num,B.cost_act]));var I="";if(B.exp){I+='<li><em class="expname">'+lang("sweep_lord")+"</em><em>+"+B.exp+"</em></li>"}if(B.gexp){I+='<li><em class="gexpname">'+lang("general")+"</em><em>+"+B.gexp+"</em></li>"}if(B.general_score){if(parseInt(B.general_score.gettype1)!=0){I+='<li><span class="reward_type" id="addrtype'+B.general_score.gettype1+'">'+helper.wuziname(B.general_score.gettype1)+"x"+B.general_score.getvalue1+"</span></li>"}}if(B.reel){for(var E in B.reel){if(B.reel[E]){var J=B.reel[E];I+="<li>";if(parseInt(J.quality)==8){I+='<span class="colorwords" style="color:'+helper.getItemColor(J.quality)+'">'+J.itemname+"x"+J.num+"</span>"}else{I+='<span style="color:'+helper.getItemColor(J.quality)+'">'+J.itemname+"x"+J.num+"</span>"}I+="</li>"}}}if(B.reputation){I+='<li><span class="reward_type" id="addrtype7">'+helper.wuziname(7)+"x"+B.reputation+"</span></li>"}if(B.reward){for(var E in B.reward){if(B.reward[E]){var A=B.reward[E];var H=A.type;var D=E+1;I+="<li>";if(H==3){I+='<span class="reward_type type'+D+'" style="background-image:url('+xGame.forgeMaterial(A.materials_id)+')"><em style="color:'+helper.getItemColor(A.quality)+'">'+A.name+"x"+A.value+"</em></span>"}else{if(H==1||H==2){I+='<span class="reward_type type'+D+'" style="background-image:url('+xGame.itemurl(A.id)+')"><em style="color:'+helper.getItemColor(A.quality)+'">'+A.name+"x"+A.value+"</em></span>"}else{if(H==4){I+='<span class="reward_type type'+D+'" id="addrtype37"><em style="color:#1FAB46">'+lang("danyao")+"x"+A.value+"</em></span>"}else{if(H==42){I+='<span class="reward_type type'+D+'" id="addrtype42"><em style="color:#1FAB46">'+lang("doggold")+"x"+A.value+"</em></span>"}}}}I+="</li>"}}}C.find("#sweepreward_list").html(I);if(G==null){G=new iScroll("sweepreward_scroller",{bounce:false,momentum:false,hScrollbar:false,vScrollbar:false})}G.refresh();I=null;C.find("#sweepreward_hidebtn").unbind("touchend").bind("touchend",function(K){if(xGame.checkLock(true)){return false}C.remove();C=null;K.preventDefault()});C.find("#sure_btn").unbind("touchend").bind("touchend",function(K){if(xGame.checkLock(true)){return false}C.remove();C=null;K.preventDefault()})},hide:function(B){var A=this;if(B){$("#"+B).remove()}},}})();