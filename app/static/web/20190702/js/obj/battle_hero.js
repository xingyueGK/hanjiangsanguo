var nowHero={};var Hero=function(A){this.e=null;this.ini={};this.heroid=0;this.name="";this.pos=0;this.team="left";this.herodata=null;this.heroimage=null;this.body=null;this.zindex=0;this.timer=null;this.timeout=[];this.isApparentDeath=false;this.passiveSkillAnim=null;this.allblood=0;this.blood=0;this.power=0;this.poweranim=null;this.attackanim=null;this.faintDom=null;this.SilenceDom=null;this.energyDom=null;this.markDom=null;this.confusionDom=null;this.exacttarget=null;this.MonsterDom=null;this.shieldRound=0;this.yellowshieldRound=0;this.penetrate=null;this.penetrateRound=0;this.attackForce=null;this.attackForceRound=0;this.exacttargetRound=0;this.jinduan=null;this.mingyan=null;this.extra_type="";this.isaddblood=false;this.isblood=false;if(A.id){this.id=A.id}if(A.name){this.name=A.name}if(A.heroid){this.heroid=A.heroid}if(A.herodata){this.herodata=A.herodata}if(A.pos){this.pos=A.pos}if(A.team){this.team=A.team}if(A.heroimage){this.heroimage=A.heroimage}if(A.zindex){this.zindex=A.zindex}if(this.herodata.power>0){this.power=this.herodata.power}this.init()};Hero.prototype.clear=function(){for(var A=0,B=this.timeout.length;A<B;A++){clearTimeout(this.timeout)}this.timeout=null;if(this.timer){clearTimeout(this.timer)}this.timer=null;if(this.faintDom){this.faintDom.remove();this.faintDom=null}if(this.SilenceDom){this.SilenceDom.remove();this.SilenceDom=null}if(this.energyDom){this.energyDom.remove();this.energyDom=null}if(this.markDom){this.markDom.remove();this.markDom=null}if(this.confusionDom){this.confusionDom.remove();this.confusionDom=null}if(this.MonsterDom){this.MonsterDom.remove();this.MonsterDom=null}this.jinduan=null;this.mingyan=null;if(this.e){this.e.remove();this.e.empty();this.e=null}if(this.body_wrap){this.body_wrap.remove();this.body_wrap=null}if(stage){stage.remove();stage=null}this.ini=null;this.heroid=0;this.name="";this.pos=0;this.team="left";this.herodata=null;this.heroimage=null;this.body=null;this.zindex=0;this.allblood=0;this.blood=0;this.power=0;this.poweranim=null;this.attackanim=null;this.exacttarget=null;this.isApparentDeath=false;if(this.passiveSkillAnim){this.passiveSkillAnim.destory();this.passiveSkillAnim=null}this.shieldRound=0;this.yellowshieldRound=0;this.penetrate=null;this.penetrateRound=0;this.attackForce=null;this.attackForceRound=0;this.exacttargetRound=0;this.extra_type=""},Hero.prototype.init=function(){this.width=315;this.height=253;if(this.heroid==99){this.extra_type="guanqiaboss";this.width=640;this.height=320}else{if(miscpop.in_array(this.heroid,[201,204,207,210,213])){this.extra_type="sanctum_small";this.width=360;this.height=180}else{if(miscpop.in_array(this.heroid,[202,205,208,211,214])){this.extra_type="sanctum_middle";this.width=524;this.height=262}else{if(miscpop.in_array(this.heroid,[203,206,209,212,215])){this.extra_type="sanctum_big";this.width=640;this.height=320}}}}if(this.team=="left"){this.ini.container_x=battle_pos[this.team][this.pos].x+hero_ini[this.heroid].mx;this.ini.body_wrap_x=0;this.ini.body_wrap_scalX=1;this.ini.shadow_x=hero_ini[this.heroid].sx;this.ini.bar_wrap_x=hero_ini[this.heroid].bx;this.ini.label_x=hero_ini[this.heroid].lx;this.ini.power_x=hero_ini[this.heroid].px;this.ini.drum_x=hero_ini[this.heroid].bx-46;this.ini.drum_anim_x=hero_ini[this.heroid].bx+60;this.ini.battle_label_x=hero_ini[this.heroid].bx+60}else{this.ini.container_x=battle_pos[this.team][this.pos].x+hero_ini[this.heroid].mx+hero_ini[this.heroid].rx;this.ini.body_wrap_x=this.width;this.ini.body_wrap_scalX=-1;this.ini.shadow_x=this.width-99-hero_ini[this.heroid].sx;this.ini.bar_wrap_x=this.width-70-hero_ini[this.heroid].bx;this.ini.label_x=this.width-92-hero_ini[this.heroid].lx;this.ini.power_x=this.width-150-hero_ini[this.heroid].px;this.ini.drum_x=this.width-116-hero_ini[this.heroid].bx;this.ini.drum_anim_x=this.width-155-hero_ini[this.heroid].bx;this.ini.battle_label_x=this.width-155-hero_ini[this.heroid].bx}this.x=this.ini.container_x;this.y=battle_pos[this.team][this.pos].y-this.height;this.zindex=helper.getBattleZindex(this.pos);this.e=$('<div id="'+this.id+'" class="battle_sprite '+this.team+"team "+this.extra_type+'" style="left:'+this.x+"px;top:"+this.y+"px;z-index:"+this.zindex+'"></div>');this.body_wrap=$('<div class="battle_sprite_body_wrap '+this.extra_type+'" style="top:'+hero_ini[this.heroid].my+"px;"+(this.ini.body_wrap_scalX==-1?"-webkit-transform:scaleX(-1);":"")+'"></div>');var A=$('<div id="stand_'+this.id+'" style="background:url('+this.heroimage+") 0 0 no-repeat;position:absolute;left:0px;top:"+(this.height-hero_ini[this.heroid].height)+"px;width:"+hero_ini[this.heroid].width+"px;height:"+hero_ini[this.heroid].height+'px;"></div>');this.body_wrap.append(A);A=null;this.shadow=$('<div class="battle_sprite_shadow_wrap" style="left:'+this.ini.shadow_x+'px;"></div>');this.allblood=this.herodata.allblood;this.blood=this.herodata.blood>0?this.herodata.blood:this.allblood;this.bar_wrap=$('<div class="battle_sprite_bar_wrap" style="left:'+this.ini.bar_wrap_x+'px;"><div class="bar_blood" id="bar_blood_'+this.id+'" style="width:'+(66*helper.min(this.blood/this.allblood,1))+'px;"></div><div class="bar_power" id="bar_power_'+this.id+'" style="width:'+(66*helper.min(this.power/100,1))+'px;"></div></div>');if(parseInt(this.herodata.quality)==8){this.name_wrap=$('<div class="battle_sprite_name_wrap colorwords" style="left:'+(this.ini.bar_wrap_x-40)+"px;color:"+helper.getHeroColor(this.herodata.quality)+';">'+this.name+"</div>")}else{this.name_wrap=$('<div class="battle_sprite_name_wrap" style="left:'+(this.ini.bar_wrap_x-40)+"px;color:"+helper.getHeroColor(this.herodata.quality)+';">'+this.name+"</div>")}this.drum_wrap=$('<div class="battle_sprite_drum_wrap" style="left:'+this.ini.drum_x+'px;"><span class="bg"></span><span class="battle_drum" style="background-image:url('+xGame.drumurl(this.herodata.drum)+');"></span></div>');this.drum_anim_wrap=$('<p class="drumChange_up" style="left:'+this.ini.drum_anim_x+'px;"></p>');this.drum_anim_down=$('<p class="drumChange_down" style="left:'+this.ini.drum_anim_x+'px;"></p>');this.drumer_wrap=$('<p class="drummer_up" style="left:'+this.ini.drum_anim_x+'px;"></p>');this.drumer_down=$('<p class="drummer_down" style="left:'+this.ini.drum_anim_x+'px;"></p>');this.battle_label_warp=$('<div class="battle_label" style="left:'+this.ini.battle_label_x+'px;"></div>');this.battle_attr_up=$('<p class="battle_attr_up" style="left:'+this.ini.drum_anim_x+'px;"></p>');this.battle_jingmai=$('<div class="battle_jingmai_attack" style="left:'+(this.ini.shadow_x-50)+'px;"></div>');this.battle_energy=$('<div class="battle_energy_attack" style="left:'+this.ini.bar_wrap_x+'px;top: 20px"></div>');if(this.herodata.ladderid){this.e.append(this.body_wrap)}else{this.e.append(this.shadow);this.e.append(this.body_wrap);this.e.append(this.bar_wrap);this.e.append(this.name_wrap);this.e.append(this.battle_label_warp);if(this.team=="left"){this.e.append(this.battle_attr_up)}if(this.herodata.drummer==1&&this.herodata.drum!=undefined){this.e.append(this.drum_wrap);this.e.append(this.drumer_wrap);this.e.append(this.drumer_down)}if(this.herodata.drum==undefined){this.e.append(this.drum_anim_wrap);this.e.append(this.drum_anim_down)}}if(this.herodata.drug_tx&&parseInt(this.herodata.drug_tx)==1){this.e.append(this.battle_jingmai);this.jingmaiAtk()}if(this.herodata.energy_effect&&parseInt(this.herodata.energy_effect)==1){this.e.append(this.battle_energy)}if(this.team=="left"&&this.herodata.field_effect&&parseInt(this.herodata.field_effect)!=0){$("#container").append('<div class="field_left field'+this.herodata.field_effect+'" id="field_left"></div>');$("#container").find(".field_left").css({"display":"block"});var C=$("#container").find(".field_left");for(var B=0;B<C.length;B++){if(B!=0){C[B].remove()}}}if(this.team=="right"&&this.herodata.field_effect&&parseInt(this.herodata.field_effect)!=0){$("#container").append('<div class="field_right field'+this.herodata.field_effect+'" id="field_right"></div>');$("#container").find(".field_right").css({"display":"block"});var C=$("#container").find(".field_right");for(var B=0;B<C.length;B++){if(B!=0){C[B].remove()}}}};Hero.prototype.showSkill=function(D,C){this.removePower();if(D){this.setBar({power:this.power-100})}if(this.team=="left"){var A=battle_pos[this.team][this.pos]["x"]+26;var B=battle_pos[this.team][this.pos]["y"]-130}else{var A=battle_pos[this.team][this.pos]["x"]-122;var B=battle_pos[this.team][this.pos]["y"]-130}if(this.herodata.devil==1&&D!=undefined){B-=80;if(C){this.team=="left"?A-=100:A-=570;var E=$('<p class="devil_skill_wrap special'+(this.team=="right"?" right":"")+'" style="z-index:100;left:'+A+"px;top:"+B+'px"><span class="skill_anim"></span><span class="skill_anim2"></span><span class="avatar" style="background-image: url('+xGame.avatar(this.herodata.image)+');background-size:100% 100%;"></span><em class="skill">'+this.herodata.skill+'</em><span class="skill2 pos_'+C+'"></span><span class="devil_hurt '+(D>20?"hurts":"")+" hurt"+D+" "+(this.team=="right"?" right":"left")+'" style="z-index:100;"><em></em></span></p>')}else{this.team=="left"?A-=100:A-=370;var E=$('<p class="skill_wrap special'+(this.team=="right"?" right":"")+'" style="z-index:100;left:'+A+"px;top:"+B+'px"><span class="avatar" style="background-image: url('+xGame.avatar(this.herodata.image)+');"></span><em class="skill">'+this.herodata.skill+'</em><span class="devil_hurt '+(D>20?"hurts":"")+" hurt"+D+" "+(this.team=="right"?" right":"left")+'" style="z-index:100;"><em></em></span></p>')}}else{if(this.herodata.star==1){B-=60;this.team=="left"?A-=100:A-=370;var E=$('<p class="skill_wrap special'+(this.team=="right"?" right":"")+'" style="z-index:100;left:'+A+"px;top:"+B+'px"><span class="avatar" style="background-image: url('+xGame.avatar(this.herodata.image)+');"></span><em class="skill">'+this.herodata.skill+"</em></p>")}else{var E=$('<p class="skill_wrap'+(this.herodata.skill.length>5?" two_line":"")+'" style="z-index:100;left:'+A+"px;top:"+B+'px"><em>'+this.herodata.skill+"</em></p>")}}stage.append(E);this.timeout.push(setTimeout(function(){E.remove()},900))};Hero.prototype.powerChange=function(B,F){var C=parseInt(this.bar_wrap.css("left"));var G=this.bar_wrap.width();if(this.team=="left"){var D=C+G}else{var D=C-90}if(F){var A=$('<p class="powerchange_'+B+'" style="z-index:10;left:'+D+"px;bottom:"+F+'px"></p>')}else{var E=75;var A=$('<p class="powerchange_'+B+'" style="z-index:10;left:'+D+"px;bottom:"+E+'px"></p>')}this.e.append(A);this.timeout.push(setTimeout(function(){var H=B=="up"?"fadeOutUp":"fadeOutDown";xGame.doAnimate(A,H,"0.4s",function(){A.remove();A=null})},400))};Hero.prototype.exactChange=function(B){var C=parseInt(this.bar_wrap.css("left"));var F=this.bar_wrap.width();if(this.team=="left"){var D=C+F}else{var D=C-90}var E=75;var A=$('<p class="exactChange_'+B+'" style="z-index:10;left:'+D+"px;bottom:"+E+'px"></p>');this.e.append(A);this.timeout.push(setTimeout(function(){var G=B=="up"?"fadeOutUp":"fadeOutDown";xGame.doAnimate(A,G,"0.4s",function(){A.remove();A=null})},400))};Hero.prototype.targetChange=function(B){var C=parseInt(this.bar_wrap.css("left"));var F=this.bar_wrap.width();if(this.team=="left"){var D=C+F}else{var D=C-90}var E=75;var A=$('<p class="targetChange_'+B+'" style="z-index:10;left:'+D+"px;bottom:"+E+'px"></p>');this.e.append(A);this.timeout.push(setTimeout(function(){var G=B=="up"?"fadeOutUp":"fadeOutDown";xGame.doAnimate(A,G,"0.4s",function(){A.remove();A=null})},400))};Hero.prototype.showexacttarget=function(){if(this.exacttargetRound>0){this.exacttargetRound=2;return false}this.exacttargetRound=2;if(this.exacttarget!=null){return false}var A=this.ini.shadow_x-20;var B=212;var C=100;this.exacttarget=new movieClipClass({"img":ximg(staticUrl+"img/plugin/battle_exacttarget_anim.png"),"width":150,"height":80,"x":A,"y":B,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:C},{rect:[150,0],interval:C},{rect:[300,0],interval:C},{rect:[450,0],interval:C},{rect:[0,80],interval:C},{rect:[150,80],interval:C},{rect:[300,80],interval:C},{rect:[450,80],interval:C},]});this.e.prepend(this.exacttarget.obj);this.exacttarget.play()};Hero.prototype.clearexacttarget=function(){if(this.exacttargetRound>0){this.exacttargetRound-=1;if(this.exacttargetRound<=0&&this.exacttarget!=null){this.exacttarget.destory();this.exacttarget=null}}};Hero.prototype.showFaint=function(){if(this.faintDom!=null){return false}var A=battle_pos[this.team][this.pos]["x"]-50;var B=battle_pos[this.team][this.pos]["y"]-200;this.faintDom=$('<p class="faint_wrap" style="left:'+A+"px;top:"+B+'px"></p>');stage.append(this.faintDom)};Hero.prototype.hideFaint=function(){if(this.faintDom!=null){var A=this;this.faintDom.remove();A.faintDom=null;A=null}};Hero.prototype.showSilence=function(){if(this.SilenceDom!=null){return false}var A=this.ini.bar_wrap_x-50;var B=-30;this.SilenceDom=$('<p class="silence_wrap" style="left:'+A+"px;top:"+B+'px"></p>');this.e.append(this.SilenceDom)};Hero.prototype.hideSilence=function(){if(this.SilenceDom!=null){var A=this;this.SilenceDom.remove();A.SilenceDom=null;A=null}};Hero.prototype.showEnergy=function(){this.e.find(".battle_energy_attack").attr("class","battle_energy_attack sweep")};Hero.prototype.hideEnergy=function(){this.e.find(".battle_energy_attack").attr("class","battle_energy_attack")};Hero.prototype.showMark=function(){if(this.markDom!=null){return false}var A=this.ini.bar_wrap_x;var B=0;this.markDom=$('<p class="mark_wrap" style="left:'+A+"px;top:"+B+'px"></p>');this.e.append(this.markDom)};Hero.prototype.hideMark=function(){if(this.markDom!=null){var A=this;this.markDom.remove();A.markDom=null;A=null}};Hero.prototype.showConfusion=function(){if(this.confusionDom!=null){return false}var A=this.ini.bar_wrap_x;var B=0;this.confusionDom=$('<p class="confusion_wrap" style="left:'+A+"px;top:"+B+'px"></p>');this.e.append(this.confusionDom)};Hero.prototype.hideConfusion=function(){if(this.confusionDom!=null){var A=this;this.confusionDom.remove();A.confusionDom=null;A=null}};Hero.prototype.showNumber=function(E,D,G,B){if(D==true){this.isaddblood=true}else{this.isblood=true}var F="-"+parseInt(E).toString();var C=-50;if(G){C=-80}if(this.pos>=1&&this.pos<=3){var C=-80;if(G){C=-110}if(D==true&&this.isaddblood==true){C=-40}else{if(D==false&&this.isblood==true){C=-40}}}else{if(this.pos>=4&&this.pos<=6){C=-50;if(G){C=-80}if(D==true&&this.isaddblood==true){C=-20}else{if(D==false&&this.isblood==true){C=-20}}}else{if(this.pos>=7&&this.pos<=9){C=-20;if(G){C=-50}if(D==true&&this.isaddblood==true){C=5}else{if(D==false&&this.isblood==true){C=5}}}}}if(B){C=C-25}var A=new Num({id:helper.createUUID("bloodnum"),src:staticUrl+"img/battle/numtext"+(D==true?"_add":"")+".png",max:F.length,gap:24,height:30,x:35-(24*F.length)/2,y:C,value:F,zindex:20,});this.bar_wrap.append(A.e);this.timeout.push(setTimeout(function(){A.e.animate({opacity:0,top:(A.y-20)+"px"},500,"ease-out",function(){A.destory();this.isaddblood=false;this.isblood=false})},400))};Hero.prototype.showLabel=function(A){var C=this;var D="";if(A==-1){D="label_miss"}else{if(A==-2){D="label_viewbreak"}else{if(A==-4){D="label_mulhit"}else{if(A==1){D="label_hit"}else{if(A=="fanshang"){D="label_fanshang"}else{if(A=="mianyi"){D="label_mianyi"}else{if(A=="xixue"){D="label_xixue"}else{if(A=="huiqi"){D="label_huiqi"}else{if(A=="qingqi"){D="label_qingqi"}else{if(A=="touqi"){D="label_touqi"}else{if(A=="kuangbao"){D="label_kuangbao"}else{if(A=="shanbi"){D="label_shanbi"}else{if(A=="shipo"){D="label_shipo"}else{if(A=="diankuang"){D="label_diankuang"}else{if(A==-5){D="label_zhuiji"}else{if(A==-6){D="label_lieri"}else{if(A==-7){D="label_leiting"}}}}}}}}}}}}}}}}}var E=$('<div class="battle_sprite_label '+D+'" style="left:'+this.ini.label_x+"px;top:"+hero_ini[this.heroid].ly+'px;"></div>');this.e.append(E);this.timeout.push(setTimeout(function(){E.fadeOut(500,function(){$(this).remove()})},1000));if(A==-1){if(this.team=="left"){var F=this.x;var B=this.x-20}else{var F=this.x;var B=this.x+20}this.e.animate({opacity:0.8,left:B+"px"},160,"ease-out",function(){var G=$(this);C.timeout.push(setTimeout(function(){G.animate({opacity:1,left:F+"px"},160,"ease-out")},100))})}else{if(A==1){}}};Hero.prototype.devilshowLabel=function(A,E){var C=this;var D="";if(A==-1){D="label_miss"}else{if(A==-2){D="label_viewbreak"}else{if(A==-4){D="label_mulhit"}else{if(A==1){D="label_hit"}else{if(A=="fanshang"){D="label_fanshang"}else{if(A=="mianyi"){D="label_mianyi"}else{if(A=="xixue"){D="label_xixue"}else{if(A=="huiqi"){D="label_huiqi"}else{if(A=="qingqi"){D="label_qingqi"}else{if(A=="touqi"){D="label_touqi"}else{if(A=="kuangbao"){D="label_kuangbao"}else{if(A=="shanbi"){D="label_shanbi"}else{if(A=="shipo"){D="label_shipo"}else{if(A=="diankuang"){D="label_diankuang"}else{if(A=="fanji"){D="label_fanji"}else{if(A==-6){D="label_lieri"}else{if(A==-7){D="label_leiting"}}}}}}}}}}}}}}}}}if(E){var F=$('<div class="battle_sprite_label '+D+'" style="top: '+E+'px;"></div>')}else{var F=$('<div class="battle_sprite_label '+D+'"></div>')}this.battle_label_warp.append(F);this.e.find(".battle_label").append(F);this.timeout.push(setTimeout(function(){F.fadeOut(500,function(){$(this).remove()})},1000));if(A==-1){if(this.team=="left"){var G=this.x;var B=this.x-20}else{var G=this.x;var B=this.x+20}this.e.animate({opacity:0.8,left:B+"px"},160,"ease-out",function(){var H=$(this);C.timeout.push(setTimeout(function(){H.animate({opacity:1,left:G+"px"},160,"ease-out")},100))})}else{if(A==1){}}};Hero.prototype.showSuffer=function(A,B){var E=this;var H=$('<div class="suffer" style="background:url('+xGame.hero(this.heroid,3)+") 0 0 no-repeat;position:absolute;left:0px;top:"+(this.height-hero_ini[this.heroid].height)+"px;width:"+hero_ini[this.heroid].width+"px;height:"+hero_ini[this.heroid].height+'px;"></div>');E.body_wrap.append(H);E.body_wrap.find("#stand_"+E.id).hide();E.timer=setTimeout(function(){E.body_wrap.find("#stand_"+E.id).show();E.timer=null;H.remove();H=null},600);E.timeout.push(E.timer);if(A==0){return}this.showNumber(A,"","",B);this.blood=this.blood-A;if(this.blood<0){this.blood=0}this.setBar({blood:this.blood});var G=battle_pos[this.team][this.pos]["x"]-72;var F=battle_pos[this.team][this.pos]["y"]-136;var D=1;if(this.team=="right"){G+=44;D=-1}var C=new movieClipClass({"img":staticUrl+"img/battle/attackanim.png","width":110,"height":145,"x":G,"y":F,"scaleX":D,"loop":false,"endDestory":true,"zindex":100,"frames":[{rect:[0,0],label:"run",interval:60},{rect:[110,0],interval:60},{rect:[220,0],interval:60},{rect:[330,0],interval:60},{rect:[440,0],stop:1,interval:60},]});stage.append(C.obj);C.play();C=null};Hero.prototype.showPower=function(){return false;this.poweranim=new movieClipClass({"img":staticUrl+"img/battle/poweranim.png","width":150,"height":151,"x":this.ini.power_x,"y":110,"loop":true,"zindex":20,"frames":[{rect:[0,0],label:"run",interval:50},{rect:[150,0],interval:50},{rect:[300,0],interval:50},{rect:[450,0],interval:50},{rect:[0,150],interval:50},{rect:[150,150],interval:50},{rect:[300,150],interval:50},{rect:[450,150],interval:50},]});this.e.append(this.poweranim.obj);this.poweranim.play()};Hero.prototype.removePower=function(){return false;if(this.poweranim){this.poweranim.destory();this.poweranim=null}};Hero.prototype.toDie=function(){this.removePower();this.hideFaint();this.e.fadeOut(800,function(){$(this).remove()})};Hero.prototype.showShield=function(){if(this.shieldRound>0){this.shieldRound=2;return false}this.shieldRound=2;var B=this.ini.label_x-15;var C=34;if(this.team=="right"){B+=60}var A=$('<div class="shield '+this.team+'" style="left:'+B+"px;bottom:"+C+'px;"></div>');this.e.append(A)};Hero.prototype.reduceShieldRound=function(){if(this.shieldRound>0){this.shieldRound-=1;if(this.shieldRound<=0){this.e.find(".shield").remove()}}};Hero.prototype.showyellowShield=function(){if(this.yellowshieldRound>0){this.yellowshieldRound=2;return false}if(this.shieldRound>0){this.e.find(".shield").css("zIndex",2)}this.yellowshieldRound=2;var B=this.ini.label_x-15;var C=34;if(this.team=="right"){B+=60}var A=$('<div class="yellowshield '+this.team+'" style="left:'+B+"px;bottom:"+C+'px;"></div>');this.e.append(A)};Hero.prototype.reduceyellowShieldRound=function(){if(this.yellowshieldRound>0){this.yellowshieldRound-=1;if(this.yellowshieldRound<=0){this.e.find(".yellowshield").remove()}}};Hero.prototype.showPenetrate=function(){if(this.team=="left"){var B=battle_pos[this.team][this.pos]["x"]+20;var C=battle_pos[this.team][this.pos]["y"]-120}else{var B=battle_pos[this.team][this.pos]["x"]-100;var C=battle_pos[this.team][this.pos]["y"]-120}var A=$('<div class="battle_penetrate_down" style="top:'+C+"px;left:"+B+'px;z-index:20"></div>');stage.append(A);this.timeout.push(setTimeout(function(){xGame.doAnimate(A,"fadeOutDown","0.4s",function(){A.remove();A=null})},400));if(this.penetrateRound>0){this.penetrateRound=2;return false}this.penetrateRound=2;if(this.penetrate!=null){return false}var D=this.ini.shadow_x-20;var E=212;var F=100;this.penetrate=new movieClipClass({"img":ximg(staticUrl+"img/plugin/battle_penetrate_down_anim.png"),"width":150,"height":80,"x":D,"y":E,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:F},{rect:[150,0],interval:F},{rect:[300,0],interval:F},{rect:[450,0],interval:F},{rect:[0,80],interval:F},{rect:[150,80],interval:F},{rect:[300,80],interval:F},{rect:[450,80],interval:F},]});this.e.prepend(this.penetrate.obj);this.penetrate.play()};Hero.prototype.clearPenetrate=function(){if(this.penetrateRound>0){this.penetrateRound-=1;if(this.penetrateRound<=0&&this.penetrate!=null){this.penetrate.destory();this.penetrate=null}}};Hero.prototype.showAtk=function(){if(this.team=="left"){var B=battle_pos[this.team][this.pos]["x"]+20;var C=battle_pos[this.team][this.pos]["y"]-120}else{var B=battle_pos[this.team][this.pos]["x"]-100;var C=battle_pos[this.team][this.pos]["y"]-120}var A=$('<div class="battle_attack_up" style="top:'+C+"px;left:"+B+'px;z-index:20"></div>');this.timeout.push(setTimeout(function(){stage.append(A)},500));this.timeout.push(setTimeout(function(){xGame.doAnimate(A,"fadeOutUp","0.4s",function(){A.remove();A=null})},700));if(this.attackForceRound>0){this.attackForceRound=2;return false}this.attackForceRound=2;if(this.attackForce!=null){return false}var D=this.ini.shadow_x-50;var E=137;var F=100;this.attackForce=new movieClipClass({"img":ximg(staticUrl+"img/plugin/battle_attack_up_anim.png"),"width":200,"height":150,"x":D,"y":E,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:F},{rect:[200,0],interval:F},{rect:[400,0],interval:F},{rect:[600,0],interval:F},{rect:[800,0],interval:F},{rect:[1000,0],interval:F},{rect:[0,150],interval:F},{rect:[200,150],interval:F},{rect:[400,150],interval:F},{rect:[600,150],interval:F},{rect:[800,150],interval:F},{rect:[1000,150],interval:F},]});this.e.prepend(this.attackForce.obj);this.attackForce.play()};Hero.prototype.clearAtk=function(){if(this.attackForceRound>0){this.attackForceRound-=1;if(this.attackForceRound<=0&&this.attackForce!=null){this.attackForce.destory();this.attackForce=null}}};Hero.prototype.attackProcess=function(A){var B=this;var C=new movieClipClass({"img":xGame.hero(B.heroid,2,true),"width":hero_ini[B.heroid].width,"height":hero_ini[B.heroid].height,"x":0,"y":this.height-hero_ini[B.heroid].height,"loop":false,"endDestory":true,"callback":A,"frames":hero_ini[B.heroid].animations2,});C.appendTo(B.body_wrap);C.play();C=null;setTimeout(function(){B.body_wrap.find("#stand_"+B.id).hide()},10)};Hero.prototype.lierianima=function(){var B=this.ini.bar_wrap_x-55;var C=100;var A=new movieClipClass({"img":staticUrl+"img/battle/battle_lieri_bomb.png","width":180,"height":177,"x":B,"y":C,"scaleX":1,"loop":false,"endDestory":true,"zindex":100,"frames":[{rect:[0,0],label:"run",interval:100},{rect:[180,0],interval:100},{rect:[180*2,0],interval:100},{rect:[180*3,0],interval:100},{rect:[180*4,0],interval:100},{rect:[0,177],interval:100},{rect:[180,177],interval:60},{rect:[180*2,177],interval:100},{rect:[180*3,177],interval:100},{rect:[180*4,177],interval:100},{rect:[0,354],interval:100},{rect:[180,354],interval:100},{rect:[180*2,354],stop:1,interval:100},]});this.e.append(A.obj);A.play();A=null};Hero.prototype.leitinganima=function(){var B=this.ini.bar_wrap_x-124;var C=-50;var A=new movieClipClass({"img":staticUrl+"img/battle/battle_leiting_bomb.png","width":318,"height":363,"x":B,"y":C,"scaleX":1,"loop":false,"endDestory":true,"zindex":100,"frames":[{rect:[0,0],label:"run",interval:100},{rect:[319,0],interval:100},{rect:[319*2,0],interval:100},{rect:[319*3,0],interval:100},{rect:[319*4,0],interval:100},{rect:[319*5,0],stop:1,interval:100},]});this.e.append(A.obj);A.play();A=null};Hero.prototype.showMonster=function(C){if(this.MonsterDom!=null){return false}var A=this.ini.bar_wrap_x-25;var B=150;this.MonsterDom=$('<p class="monster_wrap '+C+'" style="left:'+A+"px;top:"+B+'px"></p>');this.e.append(this.MonsterDom)};Hero.prototype.hideMonster=function(){if(this.MonsterDom!=null){var A=this;this.MonsterDom.remove();A.MonsterDom=null;A=null}};Hero.prototype.toAttack=function(H){var M=this;var L=null;if(H.attacktype==-3){M.timeout.push(setTimeout(function(){for(var O in H.hurt){if(H.hurt[O].self==1&&H.hurt[O].silence==0){M.hideSilence()}if(H.hurt[O].self==1&&H.hurt[O].abjuration==0){M.hidejinduan();M.ladderpowerChange("down",48)}if(H.hurt[O].self==1&&H.hurt[O].phlogistic==0){M.hidemingyan();M.ladderpowerChange("down",47)}if(H.hurt[O].self==1&&H.hurt[O].faint==0){M.hideFaint()}}M.hideFaint();battleWorld.fight()},200));return false}var C,B,G,E;if(H.to_side&&H.to_side!=undefined){var N=H.to_side}else{var N=H.launch=="left"?"right":"left"}var J=H.beattackors[0];var A=H.hurt;if(N=="right"){C=this.x;B=this.y;if(H.launch=="right"){G=battle_pos["right"][J]["x"]}else{G=C-battle_pos["left"][this.pos]["x"]+battle_pos["right"][J]["x"]-110}E=B-battle_pos["left"][this.pos]["y"]+battle_pos["right"][J]["y"];if(H.launch=="right"){G-=0}else{if(hero_ini[M.heroid].ax!=undefined){G+=hero_ini[M.heroid].ax}}}else{C=this.x;B=this.y;if(H.launch=="left"){G=battle_pos["left"][J]["x"]}else{G=C-battle_pos["right"][this.pos]["x"]+battle_pos["left"][J]["x"]+110}E=B-battle_pos["right"][this.pos]["y"]+battle_pos["left"][J]["y"];if(H.launch=="left"){G-=250}else{if(hero_ini[M.heroid].ax!=undefined){G-=hero_ini[M.heroid].ax}}}M.nowIndex=helper.getBattleZindex(M.pos);M.showPassiveSkill(H);if(hero_ini[this.heroid].herotype==1&&H.skill==0){var F=parseInt(sprites[N][H.beattackors[0]].zindex)+1;M.e.css("z-index",F);M.e.animate({opacity:0.2},30,"ease-out",function(){M.e.css({"opacity":1,"left":G+"px","top":E+"px"});var O=setTimeout(function(){var P=function(){if(H.hit==1){M.showLabel(1)}M.body_wrap.find("#stand_"+M.id).show();M.afterSkillPlay(H);for(var T in A){if(A[T].self==0){if(parseInt(A[T].energy)==0){sprites[N][A[T].pos].hideEnergy()}if(parseInt(A[T].energy)==1){sprites[N][A[T].pos].showEnergy()}if(parseInt(A[T].confusion)==1){sprites[N][A[T].pos].showConfusion()}if(parseInt(A[T].mark)==0){sprites[N][A[T].pos].hideMark()}if(parseInt(A[T].mark)==1){sprites[N][A[T].pos].showMark()}if(A[T].jingzhun_up==1){for(var V in battleWorld.battledata.leftteam){sprites[N][V].allpowerChange("up",11,40)}}if(A[T].mingzhong_up==1){for(var V in battleWorld.battledata.leftteam){sprites[N][V].allpowerChange("up",12,40)}}}else{if(parseInt(A[T].energy)==0){sprites[M.team][A[T].pos].hideEnergy()}if(parseInt(A[T].confusion)==0){sprites[M.team][A[T].pos].hideConfusion()}if(parseInt(A[T].mark)==0){sprites[M.team][A[T].pos].hideMark()}if(parseInt(A[T].mark)==1){sprites[M.team][A[T].pos].showMark()}if(A[T].monster_zr==0){M.hideMonster();M.allpowerChange("down",31,40);M.allpowerChange("down",30,10)}if(A[T].monster_zr==1){M.showMonster("monster_zr");M.allpowerChange("up",31,40);M.allpowerChange("up",30,10)}if(A[T].monster_zj==0){M.hideMonster();M.allpowerChange("down",31,40);M.allpowerChange("down",30,10)}if(A[T].monster_zj==1){M.showMonster("monster_zj");M.allpowerChange("up",31,40);M.allpowerChange("up",30,10)}}}for(var T in A){if(A[T].self==1){if(parseInt(A[T].field_effect)==0){if(M.team=="left"){$("#container").find(".field_left").css({"display":"none"})}else{$("#container").find(".field_right").css({"display":"none"})}}if(H.attacktype==-5){if(A[T].xixue&&A[T].xixue==1){if(A[T].blood!=0){sprites[M.team][A[T].pos].allpowerChange("up",19,10)}}if(A[T].attack==0){sprites[M.team][A[T].pos].allpowerChange("down",31,40)}if(A[T].attack==1){sprites[M.team][A[T].pos].allpowerChange("up",31,40)}}}else{if(H.attacktype==-5){if(A[T].xixue&&A[T].xixue==1){if(A[T].blood!=0){sprites[N][A[T].pos].allpowerChange("up",19,10)}}if(A[T].attack==0){sprites[N][A[T].pos].allpowerChange("down",31,40)}if(A[T].attack==1){sprites[N][A[T].pos].allpowerChange("up",31,40)}}}}if(H.attacktype==-1){for(var T in A){if(A[T].self==0){if(A[T].dodge&&parseInt(A[T].dodge)==1){sprites[N][A[T].pos].showLabel(-1)}}else{if(A[T].self==1&&A[T].phlogistic&&A[T].phlogistic==0){sprites[M.team][M.pos].hidemingyan();sprites[M.team][A[T].pos].ladderpowerChange("down",47)}if(A[T].self==1&&A[T].abjuration&&A[T].abjuration==0){sprites[M.team][M.pos].hidejinduan();sprites[M.team][A[T].pos].ladderpowerChange("down",48)}if(A[T].self==1&&A[T].silence&&A[T].silence==1){sprites[M.team][A[T].pos].showSilence()}if(A[T].self==1&&A[T].silence==0){sprites[M.team][A[T].pos].hideSilence()}if(A[T].self==1&&A[T].faint&&A[T].faint==1){sprites[M.team][A[T].pos].showFaint()}if(A[T].self==1&&A[T].faint==0){sprites[M.team][A[T].pos].hideFaint()}if(A[T].self==1){if(A[T].huixue&&parseInt(A[T].huixue)==1){M.showSuitEffect(H,true)}}}}}else{if(H.attacktype==-2){for(var T in A){if(A[T].self==0){if(A[T].penetrate&&parseInt(A[T].penetrate)==1){sprites[N][A[T].pos].showLabel(-2)}}else{if(A[T].self==1&&A[T].phlogistic&&A[T].phlogistic==0){sprites[M.team][M.pos].hidemingyan();sprites[M.team][A[T].pos].ladderpowerChange("down",47)}if(A[T].self==1&&A[T].abjuration&&A[T].abjuration==0){sprites[M.team][M.pos].hidejinduan();sprites[M.team][A[T].pos].ladderpowerChange("down",48)}if(A[T].self==1&&A[T].silence&&A[T].silence==1){sprites[M.team][A[T].pos].showSilence()}if(A[T].self==1&&A[T].silence==0){sprites[M.team][A[T].pos].hideSilence()}if(A[T].self==1&&A[T].faint&&A[T].faint==1){sprites[M.team][A[T].pos].showFaint()}if(A[T].self==1&&A[T].faint==0){sprites[M.team][A[T].pos].hideFaint()}if(A[T].self==1){if(A[T].huixue&&parseInt(A[T].huixue)==1){M.showSuitEffect(H,true)}}}}for(var T in A){if(A[T].blood&&A[T].blood!=0){sprites[M.team][A[T].pos].showSuffer(A[T].blood)}}}else{if(H.attacktype==-4){M.showLabel(-4)}else{if(H.attacktype==-5){M.showLabel(-5)}else{if(H.attacktype==-6){M.appendBattleMask(H);M.showLabel(-6);for(var T in A){if(A[T].self==0){sprites[N][A[T].pos].lierianima()}}}else{if(H.attacktype==-7){M.appendBattleMask(H);M.showLabel(-7);for(var T in A){if(A[T].self==0){sprites[N][A[T].pos].leitinganima()}}}}}}M.showSuitEffect(H);for(var T in A){if(A[T].self==0){if(A[T].percent){sprites[N][A[T].pos].showSuffer(A[T].blood,A[T].percent);if(A[T].godjiaqi==1){var S=sprites[N][H.beattackors[0]];S.powerChange("up");if(S.faintDom!=null){S.hideFaint()}}}else{var a=true;var R=-1;for(var U in A){if(A[U].fanjiaxue){a=false;R=U}}if(a){sprites[N][A[T].pos].showSuffer(A[T].blood)}else{if(R==T){var W=sprites[N][A[T].pos];var X=A[R].blood;W.showNumber(X,true);W.blood=W.blood+X;W.setBar({blood:W.blood})}}}if(A[T].silence&&A[T].silence==1){sprites[N][A[T].pos].showSilence()}if(A[T].dodge&&A[T].dodge==1){sprites[N][A[T].pos].showLabel(-1)}if(A[T].penetrate&&parseInt(A[T].penetrate)==1){sprites[N][A[T].pos].showLabel(-2)}}else{if(A[T].silence&&A[T].silence==0){sprites[M.team][A[T].pos].hideSilence()}if(A[T].self==1&&A[T].abjuration==0){sprites[M.team][A[T].pos].hidejinduan();sprites[M.team][A[T].pos].ladderpowerChange("down",48)}if(A[T].self==1&&A[T].phlogistic==0){sprites[M.team][A[T].pos].hidemingyan();sprites[M.team][A[T].pos].ladderpowerChange("down",47)}if(A[T].silence&&A[T].silence==1){sprites[M.team][A[T].pos].showSilence()}if(A[T].self==1&&A[T].silence==0){sprites[M.team][A[T].pos].hideSilence()}if(A[T].self==1&&A[T].faint&&A[T].faint==1){sprites[M.team][A[T].pos].showFaint()}if(A[T].self==1&&A[T].faint==0){sprites[M.team][A[T].pos].hideFaint()}if(A[T].self==1){if(A[T].dead=="undefined"){if(A[T].blood&&A[T].blood!=0){sprites[M.team][A[T].pos].showSuffer(A[T].blood,true)}}}}}}}var Z=setTimeout(function(){M.e.css({"opacity":1,"left":C+"px","top":B+"px","z-index":M.nowIndex});M.setBar({power:H.attackpower});if(H.attacktype==-2){for(var b in A){sprites[M.team][A[b].pos].setBar({power:A[b].power})}}else{for(var b in A){if(A[b].self==0){sprites[N][A[b].pos].setBar({power:A[b].power})}else{if(A[b].silence==0){sprites[M.team][A[b].pos].hideSilence()}if(A[b].abjuration==0){sprites[M.team][A[b].pos].hidejinduan();sprites[M.team][A[b].pos].ladderpowerChange("down",48)}if(A[b].phlogistic==0){sprites[M.team][A[b].pos].hidemingyan();sprites[M.team][A[b].pos].ladderpowerChange("down",47)}if(A[b].silence==1){sprites[M.team][A[b].pos].showSilence()}}}}temp=null;A=null},200);var Y=setTimeout(function(){M.removeBattleMask(H);M=null;battleWorld.fight()},M.getBattleInterval());M.timeout.push(Z);M.timeout.push(Y)};if(H.attackor==0){M.ladderafterSkillPlay(H)}M.attackProcess(P);if(H.to_side===H.launch){for(var Q in A){if(A[Q].self==1){sprites[N][A[Q].pos].showSuffer(A[Q].blood)}}}},100);M.timeout.push(O)})}else{var K=setTimeout(function(){var Q=function(){M.body_wrap.find("#stand_"+M.id).show();M.afterSkillPlay(H);for(var f in A){if(A[f].self==0){if(parseInt(A[f].energy)==0){sprites[N][A[f].pos].hideEnergy()}if(parseInt(A[f].energy)==1){sprites[N][A[f].pos].showEnergy()}if(parseInt(A[f].confusion)==1){sprites[N][A[f].pos].showConfusion()}if(parseInt(A[f].mark)==0){sprites[N][A[f].pos].hideMark()}if(parseInt(A[f].mark)==1){sprites[N][A[f].pos].showMark()}if(A[f].jingzhun_up==1){for(var b in battleWorld.battledata.leftteam){sprites[N][b].allpowerChange("up",11,40)}}if(A[f].mingzhong_up==1){for(var b in battleWorld.battledata.leftteam){sprites[N][b].allpowerChange("up",12,40)}}}else{if(parseInt(A[f].energy)==0){sprites[M.team][A[f].pos].hideEnergy()}if(parseInt(A[f].confusion)==0){sprites[M.team][A[f].pos].hideConfusion()}if(parseInt(A[f].mark)==0){sprites[M.team][A[f].pos].hideMark()}if(parseInt(A[f].mark)==1){sprites[M.team][A[f].pos].showMark()}if(A[f].monster_zr==0){M.hideMonster();M.allpowerChange("down",31,40);M.allpowerChange("down",30,10)}if(A[f].monster_zr==1){M.showMonster("monster_zr");M.allpowerChange("up",31,40);M.allpowerChange("up",30,10)}if(A[f].monster_zj==0){M.hideMonster();M.allpowerChange("down",31,40);M.allpowerChange("down",30,10)}if(A[f].monster_zj==1){M.showMonster("monster_zj");M.allpowerChange("up",31,40);M.allpowerChange("up",30,10)}}}for(var f in A){if(A[f].self==1){if(parseInt(A[f].field_effect)==0){if(M.team=="left"){$("#container").find(".field_left").css({"display":"none"})}else{$("#container").find(".field_right").css({"display":"none"})}}if(H.attacktype==-5){if(A[f].xixue&&A[f].xixue==1){if(A[f].blood!=0){sprites[M.team][A[f].pos].allpowerChange("up",19,10)}}if(A[f].attack==0){sprites[M.team][A[f].pos].allpowerChange("down",31,40)}if(A[f].attack==1){sprites[M.team][A[f].pos].allpowerChange("up",31,40)}}}else{if(H.attacktype==-5){if(A[f].xixue&&A[f].xixue==1){if(A[f].blood!=0){sprites[N][A[f].pos].allpowerChange("up",19,10)}}if(A[f].attack==0){sprites[N][A[f].pos].allpowerChange("down",31,40)}if(A[f].attack==1){sprites[N][A[f].pos].allpowerChange("up",31,40)}}}}if(H.attacktype==-1){for(var f in A){if(A[f].self==0){if(A[f].dodge&&parseInt(A[f].dodge)==1){sprites[N][A[f].pos].showLabel(-1)}}else{if(A[f].self==1&&A[f].phlogistic&&A[f].phlogistic==0){sprites[M.team][M.pos].hidemingyan();sprites[M.team][A[f].pos].ladderpowerChange("down",47)}if(A[f].self==1&&A[f].abjuration&&A[f].abjuration==0){sprites[M.team][M.pos].hidejinduan();sprites[M.team][A[f].pos].ladderpowerChange("down",48)}if(A[f].self==1&&A[f].silence&&A[f].silence==1){sprites[M.team][A[f].pos].showSilence()}if(A[f].self==1&&A[f].silence==0){sprites[M.team][A[f].pos].hideSilence()}if(A[f].self==1&&A[f].faint&&A[f].faint==1){sprites[M.team][A[f].pos].showFaint()}if(A[f].self==1&&A[f].faint==0){sprites[M.team][A[f].pos].hideFaint()}if(A[f].self==1){if(A[f].huixue&&parseInt(A[f].huixue)==1){M.showSuitEffect(H)}}}}}else{if(H.attacktype==-2){for(var f in A){if(A[f].self==0){if(A[f].penetrate&&parseInt(A[f].penetrate)==1){sprites[N][A[f].pos].showLabel(-2)}}else{if(A[f].self==1&&A[f].phlogistic&&A[f].phlogistic==0){sprites[M.team][M.pos].hidemingyan();sprites[M.team][A[f].pos].ladderpowerChange("down",47)}if(A[f].self==1&&A[f].abjuration&&A[f].abjuration==0){sprites[M.team][M.pos].hidejinduan();sprites[M.team][A[f].pos].ladderpowerChange("down",48)}if(A[f].self==1&&A[f].silence&&A[f].silence==1){sprites[M.team][A[f].pos].showSilence()}if(A[f].self==1&&A[f].silence==0){sprites[M.team][A[f].pos].hideSilence()}if(A[f].self==1&&A[f].faint&&A[f].faint==1){sprites[M.team][A[f].pos].showFaint()}if(A[f].self==1&&A[f].faint==0){sprites[M.team][A[f].pos].hideFaint()}if(A[f].self==1){if(A[f].huixue&&parseInt(A[f].huixue)==1){M.showSuitEffect(H,true)}}}}for(var f in A){var X=true;var g=-1;for(var Y in A){if(A[Y].shijiaxue){X=false;g=Y}}if(X){if(A[f].blood!=0&&A[f].blood!=undefined){sprites[M.team][A[f].pos].showSuffer(A[f].blood)}}else{if(g==f){var a=sprites[N][A[f].pos];var Z=A[g].blood;a.showNumber(Z,true);a.blood=a.blood+Z;a.setBar({blood:a.blood})}else{sprites[M.team][A[f].pos].showSuffer(A[f].blood)}}}}else{M.showSuitEffect(H);if(H.skill==1||H.skill==0){if(H.attacktype==-4){M.showLabel(-4)}else{if(H.attacktype==-5){M.showLabel(-5)}else{if(H.attacktype==-6){M.appendBattleMask(H);M.showLabel(-6);for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].lierianima()}}}else{if(H.attacktype==-7){M.appendBattleMask(H);M.showLabel(-7);for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].leitinganima()}}}}}}for(var f in A){if(A[f].self==0){if(A[f].percent){A[f].percent=0.01;sprites[N][A[f].pos].showSuffer(A[f].blood,A[f].percent)}else{var X=true;var g=-1;for(var Y in A){if(A[Y].fanjiaxue){X=false;g=Y}}if(X){sprites[N][A[f].pos].showSuffer(A[f].blood)}else{if(g==f){var a=sprites[N][A[f].pos];var Z=A[g].blood;a.showNumber(Z,true);a.blood=a.blood+Z;a.setBar({blood:a.blood})}}}}if(A[f].self==1&&A[f].silence==0){sprites[M.team][A[f].pos].hideSilence()}if(A[f].self==1&&A[f].abjuration==0){sprites[M.team][A[f].pos].hidejinduan();sprites[M.team][A[f].pos].ladderpowerChange("down",48)}if(A[f].self==1&&A[f].phlogistic==0){sprites[M.team][A[f].pos].hidemingyan();sprites[M.team][A[f].pos].ladderpowerChange("down",47)}if(A[f].self==1&&A[f].silence==1){sprites[M.team][A[f].pos].showSilence()}if(A[f].self==1&&A[f].silence==0){sprites[M.team][A[f].pos].hideSilence()}if(A[f].self==1&&A[f].faint&&A[f].faint==1){sprites[M.team][A[f].pos].showFaint()}if(A[f].self==1&&A[f].faint==0){sprites[M.team][A[f].pos].hideFaint()}if(A[f].dead){L=sprites[M.team][A[f].pos];L.setBar({blood:parseInt(L.blood)+parseInt(A[f].blood)});L.showNumber(A[f].blood,true)}}}else{if(H.skill==2||H.skill==17||H.skill==23||H.skill==27||H.skill==34||H.skill==36||H.skill==37||H.skill==38||H.skill==39){for(var f in A){if(A[f].self==0){if(A[f].penetrate&&parseInt(A[f].penetrate)==1){if(A[f].blood&&A[f].blood!=0){M.showSuffer(A[f].blood,true)}}else{sprites[N][A[f].pos].showSuffer(A[f].blood)}if(A[f].faint==1){sprites[N][A[f].pos].showFaint()}if(H.skill==17||H.skill==23||H.skill==27||H.skill==38||H.skill==39){sprites[N][A[f].pos].powerChange("down")}}else{if(A[f].self==1){if(H.skill==17||H.skill==23||H.skill==27||H.skill==34||H.skill==39){sprites[M.team][M.pos].powerChange("up")}else{if(H.skill==36||H.skill==37){if(A[f].hxzs&&A[f].hxzs>=1){sprites[M.team][M.pos].showSuffer(A[f].blood)}}}}}}}else{if(H.skill==3||H.skill==14||H.skill==15||H.skill==16){var d=[];var r={};var T=-1;for(var f in A){if(A[f].self==1){if(!miscpop.in_array(A[f].pos,d)){d.push(A[f].pos)}if(typeof r[A[f].pos]=="undefined"){r[A[f].pos]=[]}r[A[f].pos].push(A[f].blood)}}if(d.length==1){T=d[0]}for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood)}else{if(T==-1){L=sprites[M.team][A[f].pos];L.setBar({blood:parseInt(L.blood)+parseInt(A[f].blood)});L.showNumber(A[f].blood,true)}}}if(T!=-1){var o=0;for(var b=0;b<r[T].length;b++){o+=parseInt(r[T][b])}L=sprites[M.team][T];if(o>=0){L.setBar({blood:parseInt(L.blood)+o});L.showNumber(o,true)}else{L.showNumber(-o);L.blood+=o;if(L.blood<0){L.blood=0}L.setBar({blood:L.blood})}}if(H.skill==14||H.skill==16){sprites[M.team][M.pos].powerChange("up")}}else{if(H.skill==4){for(var f in A){var h=A[f].self==0?N:M.team;var e=parseInt(sprites[h][A[f].pos].blood)+parseInt(A[f].blood);sprites[h][A[f].pos].setBar({blood:e});sprites[h][A[f].pos].showNumber(A[f].blood,true)}}else{if(H.skill==5){for(var f in A){sprites[N][A[f].pos].showSuffer(A[f].blood)}}else{if(H.skill==6){for(var f in A){var h=A[f].self==0?N:M.team;var m=H.skill==6?"down":"up";sprites[h][A[f].pos].showSuffer(A[f].blood);sprites[h][A[f].pos].powerChange("down")}}else{if(H.skill==7){for(var f in A){var h=A[f].self==0?N:M.team;sprites[h][A[f].pos].powerChange("up")}}else{if(H.skill==8||H.skill==31||H.skill==32||H.skill==33){for(var f in A){var h=A[f].self==0?N:M.team;if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood);sprites[N][A[f].pos].powerChange("down");if(H.skill==32){if(A[f].faint==1){sprites[N][A[f].pos].showFaint()}}}else{sprites[h][A[f].pos].powerChange("up")}}}else{if(H.skill==9||H.skill==10||H.skill==11||H.skill==47||H.skill==48){for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood)}else{sprites[M.team][A[f].pos].powerChange("up");if(H.skill==47){for(var l in A[f].top_arr){sprites[M.team][A[f].top_arr[l]].showAtk()}}if(H.skill==48){for(var l in A[f].top_arr){sprites[M.team][A[f].top_arr[l]].allpowerChange("up",30,40)}}}}}else{if(H.skill==12||H.skill==19||H.skill==20||H.skill==21||H.skill==22||H.skill==26||H.skill==44){for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood);if(H.skill==19){sprites[N][A[f].pos].showPenetrate()}if(H.skill==44){sprites[N][A[f].pos].showShanbi()}}}if(H.skill==20){var U=sprites[M.team];for(var f in U){if(stage.find("#"+M.team+f).length!=0){sprites[M.team][f].showAtk()}}}sprites[M.team][M.pos].powerChange("up")}else{if(H.skill==18){for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood)}}sprites[M.team][M.pos].powerChange("up");sprites[M.team][M.pos].showShield()}else{if(H.skill==24){var W={};var q=0;for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood)}else{if(W[A[f].pos]==null){W[A[f].pos]=[]}W[A[f].pos].push(A[f].blood)}}for(var f in W){q=0;L=W[f];for(var b=0,n=L.length;b<n;b++){q+=parseInt(L[b])}L=sprites[M.team][f];if(q>=0){L.setBar({blood:parseInt(L.blood)+q});L.showNumber(q,true)}else{L.showNumber(-q);L.blood+=q;if(L.blood<0){L.blood=0}L.setBar({blood:L.blood})}}sprites[M.team][M.pos].powerChange("up")}else{if(H.skill==25||H.skill==35){if(H.attacktype==-4){M.showLabel(-4)}for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood)}}M.powerChange("up")}else{if(H.skill==28){for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood);sprites[N][A[f].pos].powerChange("down")}}var U=sprites[M.team];for(var f in U){if(stage.find("#"+M.team+f).length!=0){sprites[M.team][f].showyellowShield()}}M.powerChange("up")}else{if(H.skill==29){for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood)}}var U=sprites[N];for(var f in U){if(stage.find("#"+N+f).length!=0){var V="";if(N=="right"){V=battleWorld.battledata.rightteam[f].herotype}else{V=battleWorld.battledata.leftteam[f].herotype}if(V==1||V==0){sprites[N][f].targetChange("down")}else{sprites[N][f].exactChange("down")}sprites[N][f].showexacttarget()}}M.powerChange("up")}else{if(H.skill==30){for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood);if(A[f].faint==1){sprites[N][A[f].pos].showFaint()}sprites[N][A[f].pos].powerChange("down")}else{if(A[f].dead){L=sprites[M.team][A[f].pos];L.setBar({blood:parseInt(L.blood)+parseInt(A[f].blood)});L.showNumber(A[f].blood,true)}sprites[M.team][A[f].pos].powerChange("up")}}}else{if(H.skill==42||H.skill==43||H.skill==45||H.skill==46){for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood);if(A[f].faint==1){sprites[N][A[f].pos].showFaint()}sprites[N][A[f].pos].powerChange("down")}}if(H.skill==45){for(var f in A){if(A[f].xuande==1){M.showAtk()}}var q=0;for(var b=0,n=A.length;b<n;b++){if(A[b].xixue==1){q+=parseInt(A[b].blood)}}if(q>0){M.setBar({blood:parseInt(M.blood)+q});M.showNumber(q,true)}}if(H.skill==46){for(var f in A){if(A[f].zhangjiao==1){M.showShield()}}}}else{if(H.skill==49||H.skill==50){for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood);if(A[f].faint==1){sprites[N][A[f].pos].showFaint()}sprites[N][A[f].pos].powerChange("down")}else{M.powerChange("up",95);if(H.skill==49){M.allpowerChange("up",12,5);M.allpowerChange("up",13,35);M.allpowerChange("up",14,65)}if(H.skill==50){M.showAtk()}}}}else{if(H.skill==51){for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood)}else{if(A[f].pos!=H.attackor){sprites[M.team][A[f].pos].powerChange("up");sprites[M.team][A[f].pos].showAtk();sprites[M.team][A[f].pos].allpowerChange("up",30,40)}}}}else{if(H.skill==53){for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood);if(A[f].faint==1){sprites[N][A[f].pos].showFaint()}}else{if(H.skill==53){M.allpowerChange("up","js",5);M.powerChange("up")}}}}else{if(H.skill==54){for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood);if(A[f].faint==1){sprites[N][A[f].pos].showFaint()}}else{if(H.skill==54){M.allpowerChange("up","jineng",5);M.powerChange("up")}}}}else{if(H.skill==55){for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood);if(A[f].faint==1){sprites[N][A[f].pos].showFaint()}}else{sprites[M.team][A[f].pos].powerChange("up")}}}else{if(H.skill==56||H.skill==57){for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood);if(A[f].faint==1){sprites[N][A[f].pos].showFaint()}}else{if(A[f].ad_pwer&&parseInt(A[f].ad_pwer)==1){sprites[M.team][A[f].pos].powerChange("up")}sprites[M.team][A[f].pos].showAtk();sprites[M.team][A[f].pos].allpowerChange("up",20,40)}}}else{if(H.skill==58||H.skill==59){for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood);if(A[f].faint==1){sprites[N][A[f].pos].showFaint()}sprites[N][A[f].pos].allpowerChange("down",30,40)}}M.powerChange("up");M.allpowerChange("up",10,10);M.allpowerChange("up",30,40)}else{for(var f in A){if(A[f].self==0){sprites[N][A[f].pos].showSuffer(A[f].blood);if(A[f].faint==1){sprites[N][A[f].pos].showFaint()}}if(H.attackor==0){if(A[f].self==0){if(A[f].faint==1){sprites[N][A[f].pos].showFaint()}if(A[f].silence==1){sprites[N][A[f].pos].showSilence()}if(A[f].qingqi==1){sprites[N][A[f].pos].powerChange("down")}}else{if(A[f].shiqi==1){sprites[M.team][A[f].pos].powerChange("up")}if(A[f].baoshang==1){sprites[M.team][A[f].pos].allpowerChange("up",10,40)}}}}}}}}}}}}}}}}}}}}}}}}}}}}for(var f in A){if(A[f].self==0&&A[f].godjiaqi==1){var c=sprites[N][H.beattackors[0]];c.powerChange("up");if(c.faintDom!=null){c.hideFaint()}}if(A[f].self==0&&A[f].silence&&A[f].silence==1){sprites[N][A[f].pos].showSilence()}if(A[f].self==1&&A[f].silence&&A[f].silence==0){sprites[M.team][A[f].pos].hideSilence()}if(A[f].self==0&&A[f].phlogistic&&A[f].phlogistic==1){sprites[N][A[f].pos].showmingyan()}if(A[f].self==0&&A[f].abjuration&&A[f].abjuration==1){sprites[N][A[f].pos].showjinduan()}if(A[f].self==1&&A[f].phlogistic&&A[f].phlogistic==0){sprites[M.team][A[f].pos].hidemingyan();sprites[M.team][A[f].pos].ladderpowerChange("down",47)}if(A[f].self==1&&A[f].abjuration&&A[f].abjuration==0){sprites[M.team][A[f].pos].hidejinduan();sprites[M.team][A[f].pos].ladderpowerChange("down",48)}if(A[f].self==1&&A[f].silence&&A[f].silence==1){sprites[M.team][A[f].pos].showSilence()}if(A[f].self==1&&A[f].silence==0){sprites[M.team][A[f].pos].hideSilence()}if(A[f].self==1&&A[f].faint&&A[f].faint==1){sprites[M.team][A[f].pos].showFaint()}if(A[f].self==1&&A[f].faint==0){sprites[M.team][A[f].pos].hideFaint()}if(A[f].self==0&&A[f].burning==1){sprites[N][A[f].pos].showzhugeskill()}if(A[f].taunt_hit==1){sprites[N][A[f].pos].showguanyuSuffer(A[f].blood)}if(H.attackor==0){if(A[f].down_che_buff){sprites[N][A[f].pos].ladderpowerChange("down",A[f].down_che_buff)}}if(A[f].dodge&&A[f].dodge==1){sprites[N][A[f].pos].showLabel(-1)}if(A[f].penetrate&&parseInt(A[f].penetrate)==1){sprites[N][A[f].pos].showLabel(-2)}if(A[f].self==1){if(A[f].dead=="undefined"){if(A[f].blood&&A[f].blood!=0){sprites[M.team][A[f].pos].showSuffer(A[f].blood)}}}}}}var p=setTimeout(function(){M.setBar({power:H.attackpower});if(H.attacktype==-2){for(var j in A){if(sprites[M.team][A[j].pos]){sprites[M.team][A[j].pos].setBar({power:A[j].power})}}}else{for(var j in A){var i=A[j].self==0?N:M.team;if(sprites[i][A[j].pos]){sprites[i][A[j].pos].setBar({power:A[j].power})}}}A=null;L=null},200);var k=setTimeout(function(){M.removeBattleMask(H);M=null;battleWorld.fight()},M.getBattleInterval());M.timeout.push(p);M.timeout.push(k)};if(H.skill>=1){var O=null;for(var P=0,S=H.hurt.length;P<S;P++){item=H.hurt[P];if(item.bao&&item.bao==1){O="bao"}if(item.zhi&&item.zhi==1){O="zhi"}}if(O!=null){M.showSkill(M.checkReducePower(H),O)}else{M.showSkill(M.checkReducePower(H))}if(M.herodata.star==1){M.timeout.push(setTimeout(function(){if(H.attackor==0){M.ladderafterSkillPlay(H)}M.attackProcess(Q)},1000))}else{if(H.attackor==0){M.ladderafterSkillPlay(H)}M.attackProcess(Q)}}else{if(H.attackor==0){M.ladderafterSkillPlay(H)}M.attackProcess(Q)}if(H.hit==1){M.showLabel(1)}if(H.to_side===H.launch){for(var R in A){if(A[R].self==1){sprites[N][A[R].pos].showSuffer(A[R].blood)}}}},200);M.timeout.push(K)}for(var I=0,D=H.hurt.length;I<D;I++){item=H.hurt[I];if(item.fj&&parseInt(item.fj)==1){M.devilshowLabel("fanji",-20)}}if(battleWorld.starbattle_huihe!=undefined){$("#world").find("#battleworld_page").find("#starbattle_huihe").html(lang("starbattlepop_huihe",[H.round]))}};Hero.prototype.setBar=function(B){if(B.blood>=0){this.blood=B.blood;if(this.blood<=0){this.bar_wrap.find("#bar_blood_"+this.id).width(0);if(this.isApparentDeath==false){if(this.herodata.drummer==1){battleWorld.drumdrow(this.team)}if(this.herodata.mingzhong_up==1||this.herodata.jingzhun_up==1){for(var A in battleWorld.battledata.leftteam){sprites[this.team][A].allpowerChange("up",31,40)}if(this.herodata.mingzhong_up==1){for(var A in battleWorld.battledata.leftteam){sprites[this.team][A].allpowerChange("down",12,10)}}if(this.herodata.jingzhun_up==1){for(var A in battleWorld.battledata.leftteam){sprites[this.team][A].allpowerChange("down",11,10)}}}this.removePower();this.hideFaint();this.toDie()}}else{this.bar_wrap.find("#bar_blood_"+this.id).width(66*helper.min(this.blood/this.allblood,1))}}if(B.power>=0){this.power=B.power;var C=this.power<=0?0:(66*helper.min(this.power/100,1));this.bar_wrap.find("#bar_power_"+this.id).width(C);if(B.power>=100&&this.poweranim==null){this.showPower()}else{if(B.power<100&&this.poweranim!=null){this.removePower()}}}};Hero.prototype.ladderpowerChange=function(B,F){var C=parseInt(this.bar_wrap.css("left"));var G=this.bar_wrap.width();if(this.team=="left"){var D=C+G}else{var D=C-90}var E=75;if(B=="down"){var A=$('<p class="powerchange_'+B+'" style="background:url('+xGame.drumdownurl(F)+") left center no-repeat;z-index:10;left:"+D+"px;bottom:"+E+'px"></p>')}else{var A=$('<p class="powerchange_'+B+'" style="background:url('+xGame.drumupurl(F)+") left center no-repeat;z-index:10;left:"+D+"px;bottom:"+E+'px"></p>')}this.e.append(A);this.timeout.push(setTimeout(function(){var H=B=="up"?"fadeOutUp":"fadeOutDown";xGame.doAnimate(A,H,"0.4s",function(){A.remove();A=null})},400))};Hero.prototype.allpowerChange=function(B,E,G){var C=parseInt(this.bar_wrap.css("left"));var F=this.bar_wrap.width();if(this.team=="left"){var D=C+F}else{var D=C-90}if(B=="down"){var A=$('<p class="powerchange_'+B+'" style="background:url('+xGame.drumdownurl(E)+") left center no-repeat;z-index:10;left:"+D+"px;bottom:"+G+'px"></p>')}else{var A=$('<p class="powerchange_'+B+'" style="background:url('+xGame.drumupurl(E)+") left center no-repeat;z-index:10;left:"+D+"px;bottom:"+G+'px"></p>')}this.e.append(A);this.timeout.push(setTimeout(function(){var H=B=="up"?"fadeOutUp":"fadeOutDown";xGame.doAnimate(A,H,"0.4s",function(){A.remove();A=null})},600))};Hero.prototype.showSuitEffect=function(T,b){var E=null;var S=T.hurt;var D=parseInt(T.skill);if(T.to_side&&T.to_side!=undefined){var U=T.to_side}else{var U=T.launch=="left"?"right":"left"}var N=0;var I=[11,12,14,16,18,19,20,21,22,24,25,26,29,35,36,45,46,47,48,49,50];var G=[8,17,23,27,28,30,31,32,33,39,42,43,44];var H=[7,9,10,51];var J=[6,38];var F=[3,14,15,16,24,45];if(this.herodata.devil==1){var P=0;var K=0;var Q=0;var M=0;var R=0;var W=0;var V=0;var L=0;var A=0;var B=0;var a=0}for(var Z=0;Z<S.length;Z++){E=S[Z];if(E.mianyi==1){if(L==0){sprites[U][T.beattackors[0]].devilshowLabel("mianyi")}L=1}if(E.devil_touqi==1){sprites[U][E.pos].powerChange("down")}if(E.devil_qingqi==1){sprites[U][E.pos].powerChange("down")}if(E.self==0){continue}if(E.xixue==1){var C=false;for(var O in T.hurt){if(T.hurt[O].dead){C=true}}if(!miscpop.in_array(D,F)&&!C){if(D==58||T.attacktype==-5){if(E.blood!=0){this.showNumber(E.blood,true)}}else{this.showNumber(E.blood,true)}this.setBar({blood:this.blood+parseInt(E.blood)});S.splice(Z,1);Z--}if(this.herodata.devil==1){if(R==0){this.devilshowLabel("xixue")}R=1}}else{if(E.touqi==1){if(this.herodata.devil==1){if(V==0){this.devilshowLabel("touqi")}V=1}else{if(miscpop.in_array(D,I)){sprites[U][T.beattackors[0]].powerChange("down")}else{if(miscpop.in_array(D,G)){}else{if(miscpop.in_array(D,H)){this.powerChange("up");sprites[U][T.beattackors[0]].powerChange("down")}else{if(miscpop.in_array(D,J)){this.powerChange("up")}else{this.powerChange("up");sprites[U][T.beattackors[0]].powerChange("down")}}}}S.splice(Z,1);Z--}}else{if(E.huiqi==1){if(miscpop.in_array(D,I)){}else{if(miscpop.in_array(D,G)){}else{if(miscpop.in_array(D,H)){this.powerChange("up")}else{if(miscpop.in_array(D,J)){this.powerChange("up")}else{this.powerChange("up")}}}}S.splice(Z,1);Z--;if(this.herodata.devil==1){if(W==0){this.devilshowLabel("huiqi")}W=1}}else{if(E.qingqi==1){if(this.herodata.devil==1){if(P==0){this.devilshowLabel("qingqi")}P=1}else{if(miscpop.in_array(D,I)){sprites[U][T.beattackors[0]].powerChange("down")}else{if(miscpop.in_array(D,G)){}else{if(miscpop.in_array(D,H)){sprites[U][T.beattackors[0]].powerChange("down")}else{if(miscpop.in_array(D,J)){}else{sprites[U][T.beattackors[0]].powerChange("down")}}}}S.splice(Z,1);Z--}}else{if(E.fanshang==1){var C=false;for(var O in T.hurt){if(T.hurt[O].dead){C=true}}if(!miscpop.in_array(D,F)&&!C){N=-parseInt(E.blood);this.showNumber(N);this.blood=this.blood-N;if(this.blood<0){this.blood=0}this.setBar({blood:this.blood});S.splice(Z,1);Z--}for(var X=0,Y=E.defpos.length;X<Y;X++){sprites[U][E.defpos[X]].devilshowLabel("fanshang")}}else{if(E.kuangbao==1){if(this.herodata.devil==1){if(Q==0){this.devilshowLabel("kuangbao")}Q=1}}else{if(E.shanbi==1){if(this.herodata.devil==1){if(K==0){this.devilshowLabel("shanbi")}K=1}}else{if(E.shipo==1){if(this.herodata.devil==1){if(B==0){this.devilshowLabel("shipo")}B=1}}else{if(E.diankuang==1){if(this.herodata.devil==1){if(M==0){this.devilshowLabel("diankuang")}M=1}}else{if(E.huixue==1){var C=false;for(var O in T.hurt){if(T.hurt[O].dead){C=true}}if(!miscpop.in_array(D,F)&&!C){this.showNumber(E.blood,true,b);this.setBar({blood:this.blood+parseInt(E.blood)});S.splice(Z,1);Z--}}else{if(E.baoshang==1){this.allpowerChange("up",10,40)}}}}}}}}}}}if(E.bizhong==1){this.targetChange("up");a=1}if(E.gu_xixue==1){var C=false;for(var O in T.hurt){if(T.hurt[O].dead){C=true}}if(!miscpop.in_array(D,F)&&!C){if(E.self==1){heroItem=sprites[this.team][E.pos]}else{heroItem=sprites[U][E.pos]}heroItem.showNumber(E.blood,true);heroItem.setBar({blood:heroItem.blood+parseInt(E.blood)});S.splice(Z,1);Z--}}}};Hero.prototype.showPassiveSkill=function(D){var H=null;var E=D.hurt;var G=null;var B=0;for(var C=0;C<E.length;C++){H=E[C];if(H.kongcheng>0){B=H.pos;if(H.self==1){G=D.launch;E.splice(C,1);C--}else{G=D.launch=="left"?"right":"left"}xGame.xsSet(player.info.uid+G+"kongcheng",H.kongcheng,true);xGame.xsSet(player.info.uid+G+"heroData",JSON.stringify({"team":G,"pos":B}),true);sprites[G][B].isApparentDeath=true}if(H.endkongcheng==1){if(H.self==1){G=D.launch}else{G=D.launch=="left"?"right":"left"}var A=xGame.xsGet(player.info.uid+G+"heroData",true);if(A!=null){A=JSON.parse(A);var F=sprites[A.team][A.pos];if(F.passiveSkillAnim!=null){F.passiveSkillAnim.destory();F.passiveSkillAnim=null}xGame.xsRemove(player.info.uid+G+"heroData",true)}}}H=null};Hero.prototype.afterSkillPlay=function(F){var H=["left","right"];var I=null;var A={};var D=null;var C=null;for(var E=0,G=H.length;E<G;E++){I=H[E];A[I]=xGame.xsGet(player.info.uid+I+"kongcheng",true);if(A[I]!=null){this.appendBattleMask(F);var B=xGame.xsGet(player.info.uid+I+"heroData",true);if(B!=null){B=JSON.parse(B);if(B.team=="left"){D=sprites[B.team][B.pos]}else{C=sprites[B.team][B.pos]}}}}if(D!=null&&C!=null){C.showPassiveSkillName(function(){C.showPassiveSkillAnim(A["right"]);D.showPassiveSkillAnim(A["left"])})}else{if(D!=null){D.showPassiveSkillName(function(){D.showPassiveSkillAnim(A["left"])})}if(C!=null){C.showPassiveSkillName(function(){C.showPassiveSkillAnim(A["right"])})}}};Hero.prototype.ladderafterSkillPlay=function(A){var D=["left","right"];var C=null;for(var B=0,E=D.length;B<E;B++){C=D[B];this.appendBattleMask(A)}C=null};Hero.prototype.showPassiveSkillName=function(A){if(this.team=="left"){var B=battle_pos[this.team][this.pos]["x"]+26;var C=battle_pos[this.team][this.pos]["y"]-130}else{var B=battle_pos[this.team][this.pos]["x"]-122;var C=battle_pos[this.team][this.pos]["y"]-130}C-=60;this.team=="left"?B-=100:B-=370;var D=$('<p class="skill_wrap special'+(this.team=="right"?" right":"")+'" style="z-index:100;left:'+B+"px;top:"+C+'px"><span class="avatar" style="background-image: url('+xGame.avatar(this.herodata.image)+');"></span><em class="skill">'+lang("battle_zhuge_skill")+"</em></p>");stage.append(D);this.timeout.push(setTimeout(function(){D.remove();if(A){A()}},900))};Hero.prototype.showPassiveSkillAnim=function(A){var C=this;var B=new playFrameAnimClass({"css":{"background-image":"url("+ximg(staticUrl+"img/plugin/battle_passive_skill1.png")+")","left":"50%","bottom":"-50px","width":"280px","height":"270px","margin-left":"-140px","z-index":20,},"rowNum":3,"colNum":3,"frameNum":9,"callback":function(){C.showNumber(A,true);C.blood=parseInt(A);C.setBar({"blood":C.blood});C.isApparentDeath=false;C.passiveSkillAnim.appendTo(C.shadow);C.passiveSkillAnim.play()},});B.appendTo(this.shadow);B.play();C.passiveSkillAnim=new playFrameAnimClass({"css":{"background-image":"url("+ximg(staticUrl+"img/plugin/battle_passive_skill2.png")+")","left":"50%","bottom":"0","width":"230px","height":"200px","margin-left":"-115px","z-index":20,},"rowNum":5,"colNum":4,"frameNum":20,"loop":true,})};Hero.prototype.appendBattleMask=function(D){var G=$("#battleworld_page");if(G.find(".skill_mask").length==1){return}this.e.css("z-index",parseInt(this.nowIndex)+20);if(D.to_side&&D.to_side!=undefined){var A=D.to_side}else{var A=D.launch=="left"?"right":"left"}var E=null;var H=null;var F=null;if(D.attackor==0){F=sprites[D.launch][0];F.e.css("display","block")}if(D.attacktype==-2||D.attacktype==-1){E=sprites[A][D.beattackors[0]];E.e.css("z-index",parseInt(E.e.css("z-index"))+20)}else{if(D.attackor==0){for(var C=0,B=D.hurt.length;C<B;C++){H=D.hurt[C];if(H.self==0){E=sprites[A][H.pos]}E.e.css("z-index",(parseInt(E.e.css("z-index"))||0)+20)}}else{for(var C=0,B=D.hurt.length;C<B;C++){H=D.hurt[C];if(H.self==0){E=sprites[A][H.pos]}else{if(H.pos==undefined){return true}E=sprites[D.launch][H.pos]}E.e.css("z-index",(parseInt(E.e.css("z-index"))||0)+20)}}}G.append('<div class="skill_mask" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:19;background:rgba(0,0,0,0.7)"></div>');G=null;E=null;H=null;F=null};Hero.prototype.removeBattleMask=function(D){var G=$("#battleworld_page");if(G.find(".skill_mask").length==0){return}if(D.to_side&&D.to_side!=undefined){var A=D.to_side}else{var A=D.launch=="left"?"right":"left"}var E=null;var H=null;var F=null;if(D.attackor==0){F=sprites[D.launch][0];F.e.css("display","none")}if(D.attacktype==-2||D.attacktype==-1){E=sprites[A][D.beattackors[0]];E.e.css("z-index",parseInt(E.e.css("z-index"))-20)}else{if(D.attackor==0){for(var C=0,B=D.hurt.length;C<B;C++){H=D.hurt[C];if(H.self==0){E=sprites[A][H.pos]}E.e.css("z-index",parseInt(E.e.css("z-index"))-20)}}else{for(var C=0,B=D.hurt.length;C<B;C++){H=D.hurt[C];if(H.self==0){E=sprites[A][H.pos]}else{E=sprites[D.launch][H.pos]}E.e.css("z-index",parseInt(E.e.css("z-index"))-20)}}}this.e.css("z-index",this.nowIndex);G.find(".skill_mask").remove();G=null;E=null;H=null;F=null};Hero.prototype.checkReducePower=function(A){var D=null;var B=[];for(var C=0,E=A.hurt.length;C<E;C++){D=A.hurt[C];if(parseInt(this.herodata.devil)==1){if(D.mobeishu){B.push(D.mobeishu)}}if(D.noy==1){return false}}var G=B[0];for(var F=1;F<B.length;F++){if(B[F]>G){G=B[F]}}return G;return true};Hero.prototype.getBattleInterval=function(){var B=200;var C=["left","right"];var D=null;var F=null;for(var A=0,E=C.length;A<E;A++){D=C[A];F=xGame.xsGet(player.info.uid+D+"kongcheng",true);xGame.xsRemove(player.info.uid+D+"kongcheng",true);if(F!=null){B=2000}}return B};Hero.prototype.showzhugeskill=function(){if(this.exacttargetRound>0){this.exacttargetRound=2;return false}this.exacttargetRound=2;if(this.exacttarget!=null){return false}var A=this.ini.shadow_x-100;var B=50;var C=100;this.exacttarget=new movieClipClass({"img":ximg(staticUrl+"img/plugin/battle_kill_zhugeL.png"),"width":315,"height":253,"x":A,"y":B,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:C},{rect:[315,0],interval:C},{rect:[630,0],interval:C},{rect:[945,0],interval:C},]});this.e.prepend(this.exacttarget.obj);this.exacttarget.play()};Hero.prototype.showguanyuSuffer=function(A){if(A==0){return}var C=this;var B=staticUrl+"img/plugin/battle_kill_guanyu.png";var H=$('<div style="background:url('+B+") 0 0 no-repeat;position:absolute;left:0px;top:"+(this.height-hero_ini[this.heroid].height)+"px;width:"+hero_ini[this.heroid].width+"px;height:"+hero_ini[this.heroid].height+'px;-webkit-transform: scaleX(-1);"></div><div class="suffer" style="background:url('+xGame.hero(this.heroid,3)+") 0 0 no-repeat;position:absolute;left:0px;top:"+(this.height-hero_ini[this.heroid].height)+"px;width:"+hero_ini[this.heroid].width+"px;height:"+hero_ini[this.heroid].height+'px;"></div>');C.body_wrap.append(H);C.body_wrap.find("#stand_"+C.id).hide();C.timer=setTimeout(function(){C.body_wrap.find("#stand_"+C.id).show();C.timer=null;H.remove();H=null},600);C.timeout.push(C.timer);var F=battle_pos[this.team][this.pos]["x"]-72;var G=battle_pos[this.team][this.pos]["y"]-136;var E=1;if(this.team=="right"){F+=44;E=-1}var D=new movieClipClass({"img":staticUrl+"img/battle/attackanim.png","width":110,"height":145,"x":F,"y":G,"scaleX":E,"loop":false,"endDestory":true,"zindex":100,"frames":[{rect:[0,0],label:"run",interval:60},{rect:[110,0],interval:60},{rect:[220,0],interval:60},{rect:[330,0],interval:60},{rect:[440,0],stop:1,interval:60},]});stage.append(D.obj);D.play();D=null};Hero.prototype.showShanbi=function(){if(this.team=="left"){var B=battle_pos[this.team][this.pos]["x"]+20;var C=battle_pos[this.team][this.pos]["y"]-120}else{var B=battle_pos[this.team][this.pos]["x"]-100;var C=battle_pos[this.team][this.pos]["y"]-120}var A=$('<div class="battle_shanbi_down" style="top:'+C+"px;left:"+B+'px;z-index:20"></div>');stage.append(A);this.timeout.push(setTimeout(function(){xGame.doAnimate(A,"fadeOutDown","0.4s",function(){A.remove();A=null})},400));if(this.penetrateRound>0){this.penetrateRound=2;return false}this.penetrateRound=2;if(this.penetrate!=null){return false}var D=this.ini.shadow_x-20;var E=212;var F=100;this.penetrate=new movieClipClass({"img":ximg(staticUrl+"img/plugin/battle_penetrate_down_anim.png"),"width":150,"height":80,"x":D,"y":E,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:F},{rect:[150,0],interval:F},{rect:[300,0],interval:F},{rect:[450,0],interval:F},{rect:[0,80],interval:F},{rect:[150,80],interval:F},{rect:[300,80],interval:F},{rect:[450,80],interval:F},]});this.e.prepend(this.penetrate.obj);this.penetrate.play()};Hero.prototype.showjinduan=function(){var A=this.ini.shadow_x-20;var B=212;var C=100;this.jinduan=new movieClipClass({"img":ximg(staticUrl+"img/plugin/battle_kill_jinduan.png"),"width":150,"height":80,"x":A,"y":B,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:C},{rect:[150,0],interval:C},{rect:[300,0],interval:C},{rect:[450,0],interval:C},{rect:[0,80],interval:C},{rect:[150,80],interval:C},{rect:[300,80],interval:C},{rect:[450,80],interval:C},]});this.e.prepend(this.jinduan.obj);this.jinduan.play()};Hero.prototype.hidejinduan=function(){if(this.jinduan!=null){this.jinduan.destory();this.jinduan=null}};Hero.prototype.showmingyan=function(){var A=this.ini.shadow_x-100;var B=50;var C=100;this.mingyan=new movieClipClass({"img":ximg(staticUrl+"img/plugin/battle_kill_mingyan.png"),"width":315,"height":253,"x":A,"y":B,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:C},{rect:[315,0],interval:C},{rect:[630,0],interval:C},{rect:[945,0],interval:C},]});this.e.prepend(this.mingyan.obj);this.mingyan.play()};Hero.prototype.hidemingyan=function(){if(this.mingyan!=null){this.mingyan.destory();this.mingyan=null}};Hero.prototype.jingmaiAtk=function(){var A=0;var B=0;var C=100;this.jingmaianim=new movieClipClass({"img":staticUrl+"img/plugin/battle_jingmai.png","width":200,"height":160,"x":A,"y":B,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:C},{rect:[200,0],interval:C},{rect:[400,0],interval:C},{rect:[600,0],interval:C},{rect:[800,0],interval:C},{rect:[0,160],interval:C},{rect:[200,160],interval:C},{rect:[400,160],interval:C},{rect:[600,160],interval:C},{rect:[800,160],interval:C},{rect:[0,320],interval:C},{rect:[200,320],interval:C},{rect:[400,320],interval:C},{rect:[600,320],interval:C},{rect:[800,320],interval:C},{rect:[0,480],interval:C},{rect:[200,480],interval:C},{rect:[400,480],interval:C},{rect:[600,480],interval:C},{rect:[800,480],interval:C},]});this.e.find(".battle_jingmai_attack").prepend(this.jingmaianim.obj);this.jingmaianim.play()};var Boss=function(A){this.e=null;this.ini={};this.heroid=0;this.name="";this.pos=0;this.team="left";this.herodata=null;this.heroimage=null;this.body=null;this.timer=null;this.timeout=[];this.isApparentDeath=false;this.passiveSkillAnim=null;this.allblood=0;this.blood=0;this.attackanim=null;this.faintDom=null;if(A.id){this.id=A.id}if(A.name){this.name=A.name}if(A.heroid){this.heroid=A.heroid}if(A.herodata){this.herodata=A.herodata}if(A.pos){this.pos=A.pos}if(A.team){this.team=A.team}if(A.heroimage){this.heroimage=A.heroimage}this.init()};Boss.prototype.clear=function(){this.ini={};this.heroid=0;this.name="";this.pos=0;this.blood=0;this.allblood=0;this.herodata=null;this.heroimage=null;this.body=null;for(var A=0,B=this.timeout.length;A<B;A++){clearTimeout(this.timeout[A])}this.timeout=null;if(this.timer){clearTimeout(this.timer)}this.timer=null;if(this.e){this.e.remove();this.e=null}if(this.attackanim){this.attackanim.remove();this.attackanim=null}if(this.faintDom){this.faintDom.remove();this.faintDom=null}this.isApparentDeath=false;if(this.passiveSkillAnim){this.passiveSkillAnim.destory();this.passiveSkillAnim=null}};Boss.prototype.init=function(){this.ini.container_x=battle_pos[this.team][this.pos].x+hero_ini[this.heroid].mx+hero_ini[this.heroid].rx;this.ini.body_wrap_x=525;this.ini.body_wrap_scalX=-1;this.ini.shadow_x=525-99-hero_ini[this.heroid].sx;this.ini.bar_wrap_x=525-350-hero_ini[this.heroid].bx;this.ini.label_x=525-92-hero_ini[this.heroid].lx;this.width=525;this.height=262;this.x=this.ini.container_x;this.y=battle_pos[this.team][this.pos].y-256;this.e=$('<div id="'+this.id+'" class="battle_sprite '+this.team+'team battle_sprite_boss" style="left:'+this.x+"px;top:"+this.y+'px"></div>');this.body_wrap=$('<div class="battle_sprite_body_wrap battle_sprite_boss" style="'+(this.ini.body_wrap_scalX==-1?"-webkit-transform:scaleX(-1);":"")+'"></div>');var A=$('<div id="stand_'+this.id+'" style="background:url('+this.heroimage+") 0 0 no-repeat;position:absolute;left:0px;top:0px;width:"+hero_ini[this.heroid].width+"px;height:"+hero_ini[this.heroid].height+'px;"></div>');this.body_wrap.append(A);A=null;this.shadow=$('<div class="battle_sprite_shadow_wrap" style="left:'+this.ini.shadow_x+'px;"></div>');if(this.heroid=="countryboss"||this.heroid=="elk_boss"){this.blood=this.herodata.blood;this.allblood=this.herodata.allblood;this.bar_wrap=$('<div class="battle_boss_sprite_bar_wrap" style="left:'+this.ini.bar_wrap_x+'px;"><div class="bar_blood" id="bar_blood_'+this.id+'" style="width:'+(348*helper.min(this.blood/this.allblood,1))+'px;"></div><p class="boss_blood_num">'+this.blood+" / "+this.allblood+"</p></div>")}else{if(this.herodata.blood>0){this.blood=this.herodata.blood;this.allblood=100}else{this.blood=this.herodata.allblood;this.allblood=100}this.bar_wrap=$('<div class="battle_boss_sprite_bar_wrap" style="left:'+this.ini.bar_wrap_x+'px;"><div class="bar_blood" id="bar_blood_'+this.id+'" style="width:'+(348*helper.min(this.blood/this.allblood,1))+'px;"></div><p class="boss_blood_num">'+this.blood+"%</p></div>")}this.name_wrap=$('<div class="battle_sprite_name_wrap battle_boss_sprite_name_wrap" style="left:'+(this.ini.bar_wrap_x)+'px;">'+this.name+"</div>");this.e.append(this.shadow);this.e.append(this.body_wrap);this.e.append(this.bar_wrap);this.e.append(this.name_wrap)};Boss.prototype.showSilence=function(){if(this.SilenceDom!=null){return false}if(this.team=="left"){var A=hero_ini[this.heroid].bx}else{var A=this.width-110-hero_ini[this.heroid].bx}var B=-30;this.SilenceDom=$('<p class="silence_wrap" style="left:'+A+"px;top:"+B+'px"></p>');this.e.append(this.SilenceDom)};Boss.prototype.hideSilence=function(){if(this.SilenceDom!=null){var A=this;A.SilenceDom.fadeOut(200,function(){$(this).remove();A.SilenceDom=null;A=null})}};Boss.prototype.showNumber=function(C,B){var D="-"+parseInt(C).toString();var A=new Num({id:helper.createUUID("bloodnum"),src:staticUrl+"img/battle/numtext"+(B==true?"_add":"")+".png",max:D.length,gap:24,height:30,x:175-(24*D.length)/2,y:-50,value:D,});this.bar_wrap.append(A.e);this.timeout.push(setTimeout(function(){A.e.animate({opacity:0,top:(A.y-20)+"px"},500,"ease-out",function(){A.destory()})},400))};Boss.prototype.showFaint=function(){if(this.faintDom!=null){return false}var A=battle_pos[this.team][this.pos]["x"]-50;var B=battle_pos[this.team][this.pos]["y"]-240;this.faintDom=$('<p class="faint_wrap" style="left:'+A+"px;top:"+B+'px"></p>');stage.append(this.faintDom)};Boss.prototype.hideFaint=function(){if(this.faintDom!=null){var A=this;A.faintDom.fadeOut(500,function(){$(this).remove();A.faintDom=null;A=null})}};Boss.prototype.powerChange=function(B){if(this.team=="left"){var C=battle_pos[this.team][this.pos]["x"]+40;var D=battle_pos[this.team][this.pos]["y"]-170}else{var C=battle_pos[this.team][this.pos]["x"]-120;var D=battle_pos[this.team][this.pos]["y"]-170}var A=$('<p class="powerchange_'+B+'" style="z-index:100;left:'+C+"px;top:"+D+'px"></p>');stage.append(A);this.timeout.push(setTimeout(function(){var E=B=="up"?"fadeOutUp":"fadeOutDown";xGame.doAnimate(A,E,"0.4s",function(){A.remove();A=null})},400))};Boss.prototype.exactChange=function(A){};Boss.prototype.targetChange=function(B){var C=parseInt(this.bar_wrap.css("left"));var F=this.bar_wrap.width();if(this.team=="left"){var D=C+F}else{var D=C+60}var E=133;var A=$('<p class="targetChange_'+B+'" style="z-index:10;left:'+D+"px;bottom:"+E+'px"></p>');this.e.append(A);this.timeout.push(setTimeout(function(){var G=B=="up"?"fadeOutUp":"fadeOutDown";xGame.doAnimate(A,G,"0.4s",function(){A.remove();A=null})},400))};Boss.prototype.showLabel=function(H){var E=this;var B="";if(H==-1){B="label_miss"}else{if(H==-2){B="label_viewbreak"}else{if(H==-4){B="label_mulhit"}else{if(H==1){B="label_hit"}else{if(H=="fanshang"){B="label_fanshang"}else{if(H=="mianyi"){B="label_mianyi"}else{if(H=="xixue"){B="label_xixue"}else{if(H=="huiqi"){B="label_huiqi"}else{if(H=="qingqi"){B="label_qingqi"}else{if(H=="touqi"){B="label_touqi"}else{if(H=="kuangbao"){B="label_kuangbao"}else{if(H=="shanbi"){B="label_shanbi"}else{if(H=="shipo"){B="label_shipo"}else{if(H=="diankuang"){B="label_diankuang"}else{if(H==-5){B="label_zhuiji"}}}}}}}}}}}}}}}var D=battle_pos[this.team][this.pos]["x"]-120;var C=battle_pos[this.team][this.pos]["y"]-170;var G=$('<div class="battle_sprite_label '+B+'" style="left:'+D+"px;top:"+C+'px;"></div>');stage.append(G);this.timeout.push(setTimeout(function(){G.fadeOut(500,function(){$(this).remove()})},1000));if(H==-1){if(this.team=="left"){var F=this.x;var A=this.x-20}else{var F=this.x;var A=this.x+20}this.e.animate({opacity:0.8,left:A+"px"},160,"ease-out",function(){var I=$(this);E.timeout.push(setTimeout(function(){I.animate({opacity:1,left:F+"px"},160,"ease-out")},100))})}else{if(H==1){}}};Boss.prototype.devilshowLabel=function(A,E){var C=this;var D="";if(A==-1){D="label_miss"}else{if(A==-2){D="label_viewbreak"}else{if(A==-4){D="label_mulhit"}else{if(A==1){D="label_hit"}else{if(A=="fanshang"){D="label_fanshang"}else{if(A=="mianyi"){D="label_mianyi"}else{if(A=="xixue"){D="label_xixue"}else{if(A=="huiqi"){D="label_huiqi"}else{if(A=="qingqi"){D="label_qingqi"}else{if(A=="touqi"){D="label_touqi"}else{if(A=="kuangbao"){D="label_kuangbao"}else{if(A=="shanbi"){D="label_shanbi"}else{if(A=="shipo"){D="label_shipo"}else{if(A=="diankuang"){D="label_diankuang"}else{if(A=="fanji"){D="label_fanji"}}}}}}}}}}}}}}}if(E){var F=$('<div class="battle_sprite_label '+D+'" style="top: '+E+'px;"></div>')}else{var F=$('<div class="battle_sprite_label '+D+'"></div>')}this.battle_label_warp.append(F);this.e.find(".battle_label").append(F);this.timeout.push(setTimeout(function(){F.fadeOut(500,function(){$(this).remove()})},1000));if(A==-1){if(this.team=="left"){var G=this.x;var B=this.x-20}else{var G=this.x;var B=this.x+20}this.e.animate({opacity:0.8,left:B+"px"},160,"ease-out",function(){var H=$(this);C.timeout.push(setTimeout(function(){H.animate({opacity:1,left:G+"px"},160,"ease-out")},100))})}else{if(A==1){}}};Boss.prototype.showSuffer=function(A,H){var B=this;var D="";switch(this.heroid){case"countryboss":D="pop/"+this.heroid+"_defense";break;case"newyearboss":D="plugin/"+this.heroid+"_defense";break;case"worldboss1":D="worldboss/"+this.heroid+".1";break;case"elk_boss":D="plugin/"+this.heroid+".1";break}var I=$('<div class="suffer" style="background:url('+ximg(staticUrl+"img/"+D+".png")+") 0 0 no-repeat;position:absolute;left:0px;top:0;width:"+hero_ini[this.heroid].width+"px;height:"+hero_ini[this.heroid].height+'px;"></div>');B.body_wrap.append(I);B.body_wrap.find("#stand_"+B.id).hide();B.timer=setTimeout(function(){B.body_wrap.find("#stand_"+B.id).show();B.timer=null;I.remove();I=null},600);B.timeout.push(B.timer);this.showNumber(A);if(this.heroid=="countryboss"||this.heroid=="elk_boss"){this.blood=this.blood-A}else{this.blood=this.blood-H}if(this.blood<0){this.blood=0}this.setBar({blood:this.blood});var E=battle_pos[this.team][this.pos]["x"]-62;var F=battle_pos[this.team][this.pos]["y"]-210;var G=1;if(this.team=="right"){E+=44;G=-1}if(this.heroid=="newyearboss"){E-=20;F+=60}var C=new movieClipClass({"img":staticUrl+"img/battle/attackanim.png","width":110,"height":145,"x":E,"y":F,"scaleX":G,"loop":false,"endDestory":true,"frames":[{rect:[0,0],label:"run",interval:60},{rect:[110,0],interval:60},{rect:[220,0],interval:60},{rect:[330,0],interval:60},{rect:[440,0],stop:1,interval:60},]});stage.append(C.obj);C.play();C=null};Boss.prototype.toDie=function(){this.e.fadeOut(800,function(){$(this).remove()})};Boss.prototype.showShield=function(){};Boss.prototype.reduceShieldRound=function(){};Boss.prototype.showyellowShield=function(){};Boss.prototype.reduceyellowShieldRound=function(){};Boss.prototype.showexacttarget=function(){if(this.exacttargetRound>0){this.exacttargetRound=2;return false}this.exacttargetRound=2;if(this.exacttarget!=null){return false}var A=this.ini.shadow_x-20;var B=212;var C=100;this.exacttarget=new movieClipClass({"img":ximg(staticUrl+"img/plugin/battle_exacttarget_anim.png"),"width":150,"height":80,"x":A,"y":B,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:C},{rect:[150,0],interval:C},{rect:[300,0],interval:C},{rect:[450,0],interval:C},{rect:[0,80],interval:C},{rect:[150,80],interval:C},{rect:[300,80],interval:C},{rect:[450,80],interval:C},]});this.e.prepend(this.exacttarget.obj);this.exacttarget.play()};Boss.prototype.clearexacttarget=function(){if(this.exacttargetRound>0){this.exacttargetRound-=1;if(this.exacttargetRound<=0&&this.exacttarget!=null){this.exacttarget.destory();this.exacttarget=null}}};Boss.prototype.showPenetrate=function(){if(this.team=="left"){var B=battle_pos[this.team][this.pos]["x"]+20;var C=battle_pos[this.team][this.pos]["y"]-120}else{var B=battle_pos[this.team][this.pos]["x"]-130;var C=battle_pos[this.team][this.pos]["y"]-170}var A=$('<div class="battle_penetrate_down" style="top:'+C+"px;left:"+B+'px;z-index:20"></div>');stage.append(A);this.timeout.push(setTimeout(function(){xGame.doAnimate(A,"fadeOutDown","0.4s",function(){A.remove();A=null})},400));if(this.penetrateRound>0){this.penetrateRound=2;return false}this.penetrateRound=2;if(this.penetrate!=null){return false}var D=this.ini.shadow_x-20;var E=212;var F=100;this.penetrate=new movieClipClass({"img":ximg(staticUrl+"img/plugin/battle_penetrate_down_anim.png"),"width":150,"height":80,"x":D,"y":E,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:F},{rect:[150,0],interval:F},{rect:[300,0],interval:F},{rect:[450,0],interval:F},{rect:[0,80],interval:F},{rect:[150,80],interval:F},{rect:[300,80],interval:F},{rect:[450,80],interval:F},]});this.e.prepend(this.penetrate.obj);this.penetrate.play()};Boss.prototype.clearPenetrate=function(){if(this.penetrateRound>0){this.penetrateRound-=1;if(this.penetrateRound<=0&&this.penetrate!=null){this.penetrate.destory();this.penetrate=null}}};Boss.prototype.showAtk=function(){};Boss.prototype.clearAtk=function(){};Boss.prototype.attackProcess=function(A){var B=this;var D="";switch(this.heroid){case"countryboss":D="pop/"+this.heroid+"_attack";break;case"newyearboss":D="plugin/"+this.heroid+"_attack";break;case"worldboss1":D="worldboss/"+this.heroid+".a";break;case"elk_boss":D="plugin/"+this.heroid+".a";break}var C=new movieClipClass({"img":ximg(staticUrl+"img/"+D+".png"),"width":hero_ini[B.heroid].width,"height":hero_ini[B.heroid].height,"x":0,"y":0,"loop":false,"endDestory":true,"callback":A,"frames":hero_ini[B.heroid].animations2,});C.appendTo(B.body_wrap);C.play();C=null;setTimeout(function(){B.body_wrap.find("#stand_"+B.id).hide()},10)};Boss.prototype.toAttack=function(A){var E=this;if(A.attacktype==-3){E.timeout.push(setTimeout(function(){E.hideFaint();battleWorld.fight()},200));return false}var D=A.launch=="left"?"right":"left";var C=sprites[D][A.beattackors[0]].pos;var B=A.hurt;E.showPassiveSkill(A);var F=setTimeout(function(){var G=function(){E.body_wrap.find("#stand_"+E.id).show();E.afterSkillPlay(A);if(A.attacktype==-1){sprites[D][A.beattackors[0]].showLabel(-1)}else{for(var J in B){if(B[J].self==0){sprites[D][B[J].pos].showSuffer(B[J].blood)}else{if(A.hurt[J].silence==0){sprites[A.launch][B[J].pos].hideSilence()}}}}var H=setTimeout(function(){for(var K in B){if(B[K].self==0){sprites[D][B[K].pos].setBar({power:B[K].power})}}B=null},200);var I=setTimeout(function(){E.removeBattleMask(A);E=null;battleWorld.fight()},E.getBattleInterval());E.timeout.push(H);E.timeout.push(I)};E.attackProcess(G)},200);E.timeout.push(F)};Boss.prototype.setBar=function(A){if(A.blood>=0){if(this.heroid=="countryboss"||this.heroid=="elk_boss"){this.blood=A.blood}else{this.blood=parseFloat(A.blood).toFixed(2)}if(this.blood<=0){this.bar_wrap.find("#bar_blood_"+this.id).width(0);if(this.heroid=="countryboss"){this.bar_wrap.find(".boss_blood_num").html("0 / "+this.allblood)}else{if(this.heroid=="elk_boss"){this.bar_wrap.find(".boss_blood_num").html("0 / "+this.allblood)}else{this.bar_wrap.find(".boss_blood_num").html("0%")}}this.toDie()}else{this.bar_wrap.find("#bar_blood_"+this.id).width(348*helper.min(this.blood/this.allblood,1));if(this.heroid=="countryboss"){this.bar_wrap.find(".boss_blood_num").html(this.blood+" / "+this.allblood)}else{if(this.heroid=="elk_boss"){this.bar_wrap.find(".boss_blood_num").html(this.blood+" / "+this.allblood)}else{this.bar_wrap.find(".boss_blood_num").html(this.blood+"%")}}}}};Boss.prototype.showPassiveSkill=function(D){var H=null;var E=D.hurt;var G=null;var B=0;for(var C=0;C<E.length;C++){H=E[C];if(H.kongcheng>0){B=H.pos;if(H.self==1){G=D.launch;E.splice(C,1);C--}else{G=D.launch=="left"?"right":"left"}xGame.xsSet(player.info.uid+G+"kongcheng",H.kongcheng,true);xGame.xsSet(player.info.uid+G+"heroData",JSON.stringify({"team":G,"pos":B}),true);sprites[G][B].isApparentDeath=true}if(H.endkongcheng==1){if(H.self==1){G=D.launch}else{G=D.launch=="left"?"right":"left"}var A=xGame.xsGet(player.info.uid+G+"heroData",true);if(A!=null){A=JSON.parse(A);var F=sprites[A.team][A.pos];if(F.passiveSkillAnim!=null){F.passiveSkillAnim.destory();F.passiveSkillAnim=null}xGame.xsRemove(player.info.uid+G+"heroData",true)}}}H=null};Boss.prototype.afterSkillPlay=function(F){var H=["left","right"];var I=null;var A={};var D=null;var C=null;for(var E=0,G=H.length;E<G;E++){I=H[E];A[I]=xGame.xsGet(player.info.uid+I+"kongcheng",true);if(A[I]!=null){this.appendBattleMask(F);var B=xGame.xsGet(player.info.uid+I+"heroData",true);if(B!=null){B=JSON.parse(B);if(B.team=="left"){D=sprites[B.team][B.pos]}else{C=sprites[B.team][B.pos]}}}}if(D!=null&&C!=null){C.showPassiveSkillName(function(){C.showPassiveSkillAnim(A["right"]);D.showPassiveSkillAnim(A["left"])})}else{if(D!=null){D.showPassiveSkillName(function(){D.showPassiveSkillAnim(A["left"])})}if(C!=null){C.showPassiveSkillName(function(){C.showPassiveSkillAnim(A["right"])})}}};Boss.prototype.showPassiveSkillName=function(A){if(this.team=="left"){var B=battle_pos[this.team][this.pos]["x"]+26;var C=battle_pos[this.team][this.pos]["y"]-130}else{var B=battle_pos[this.team][this.pos]["x"]-122;var C=battle_pos[this.team][this.pos]["y"]-130}C-=60;this.team=="left"?B-=100:B-=370;var D=$('<p class="skill_wrap special'+(this.team=="right"?" right":"")+'" style="z-index:100;left:'+B+"px;top:"+C+'px"><span class="avatar" style="background-image: url('+xGame.avatar(this.herodata.image)+');"></span><em class="skill">'+lang("battle_zhuge_skill")+"</em></p>");stage.append(D);this.timeout.push(setTimeout(function(){D.remove();if(A){A()}},900))};Boss.prototype.showPassiveSkillAnim=function(A){var C=this;var B=new playFrameAnimClass({"css":{"background-image":"url("+ximg(staticUrl+"img/plugin/battle_passive_skill1.png")+")","left":"50%","bottom":"-50px","width":"280px","height":"270px","margin-left":"-140px","z-index":20,},"rowNum":3,"colNum":3,"frameNum":9,"callback":function(){C.showNumber(A,true);C.blood=parseInt(A);C.setBar({"blood":C.blood});C.isApparentDeath=false;C.passiveSkillAnim.appendTo(C.shadow);C.passiveSkillAnim.play()},});B.appendTo(this.shadow);B.play();C.passiveSkillAnim=new playFrameAnimClass({"css":{"background-image":"url("+ximg(staticUrl+"img/plugin/battle_passive_skill2.png")+")","left":"50%","bottom":"0","width":"230px","height":"200px","margin-left":"-115px","z-index":20,},"rowNum":5,"colNum":4,"frameNum":20,"loop":true,})};Boss.prototype.appendBattleMask=function(A){var C=$("#battleworld_page");if(C.find(".skill_mask").length==1){return}this.e.css("z-index",parseInt(this.nowIndex)+20);if(A.to_side&&A.to_side!=undefined){var B=A.to_side}else{var B=A.launch=="left"?"right":"left"}var G=null;var E=null;if(A.attacktype==-2||A.attacktype==-1){G=sprites[B][A.beattackors[0]];G.e.css("z-index",parseInt(G.e.css("z-index"))+20)}else{for(var D=0,F=A.hurt.length;D<F;D++){E=A.hurt[D];if(E.self==0){G=sprites[B][E.pos]}else{G=sprites[A.launch][E.pos]}G.e.css("z-index",(parseInt(G.e.css("z-index"))||0)+20)}}C.append('<div class="skill_mask" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:19;background:rgba(0,0,0,0.7)"></div>');C=null;G=null;E=null};Boss.prototype.removeBattleMask=function(A){var C=$("#battleworld_page");if(C.find(".skill_mask").length==0){return}if(A.to_side&&A.to_side!=undefined){var B=A.to_side}else{var B=A.launch=="left"?"right":"left"}var G=null;var E=null;if(A.attacktype==-2||A.attacktype==-1){G=sprites[B][A.beattackors[0]];G.e.css("z-index",parseInt(G.e.css("z-index"))-20)}else{for(var D=0,F=A.hurt.length;D<F;D++){E=A.hurt[D];if(E.self==0){G=sprites[B][E.pos]}else{G=sprites[A.launch][E.pos]}G.e.css("z-index",parseInt(G.e.css("z-index"))-20)}}this.e.css("z-index",this.nowIndex);C.find(".skill_mask").remove();C=null;G=null;E=null};Boss.prototype.checkReducePower=function(A){var C=null;for(var B=0,D=A.hurt.length;B<D;B++){C=A.hurt[B];if(C.noy==1){return false}}return true};Boss.prototype.getBattleInterval=function(){var B=200;var C=["left","right"];var D=null;var F=null;for(var A=0,E=C.length;A<E;A++){D=C[A];F=xGame.xsGet(player.info.uid+D+"kongcheng",true);xGame.xsRemove(player.info.uid+D+"kongcheng",true);if(F!=null){B=2000}}return B};Boss.prototype.showzhugeskill=function(){if(this.exacttargetRound>0){this.exacttargetRound=2;return false}this.exacttargetRound=2;if(this.exacttarget!=null){return false}var A=this.ini.shadow_x-100;var B=50;var C=100;this.exacttarget=new movieClipClass({"img":ximg(staticUrl+"img/plugin/battle_kill_zhugeL.png"),"width":315,"height":253,"x":A,"y":B,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:C},{rect:[315,0],interval:C},{rect:[630,0],interval:C},{rect:[945,0],interval:C},]});this.e.prepend(this.exacttarget.obj);this.exacttarget.play()};Boss.prototype.showguanyuSuffer=function(A){if(A==0){return}var C=this;var B=staticUrl+"img/plugin/battle_kill_guanyu.png";var H=$('<div style="background:url('+B+") 0 0 no-repeat;position:absolute;left:0px;top:"+(this.height-hero_ini[this.heroid].height)+"px;width:"+hero_ini[this.heroid].width+"px;height:"+hero_ini[this.heroid].height+'px;-webkit-transform: scaleX(-1);"></div><div class="suffer" style="background:url('+xGame.hero(this.heroid,3)+") 0 0 no-repeat;position:absolute;left:0px;top:"+(this.height-hero_ini[this.heroid].height)+"px;width:"+hero_ini[this.heroid].width+"px;height:"+hero_ini[this.heroid].height+'px;"></div>');C.body_wrap.append(H);C.body_wrap.find("#stand_"+C.id).hide();C.timer=setTimeout(function(){C.body_wrap.find("#stand_"+C.id).show();C.timer=null;H.remove();H=null},600);C.timeout.push(C.timer);var F=battle_pos[this.team][this.pos]["x"]-72;var G=battle_pos[this.team][this.pos]["y"]-136;var E=1;if(this.team=="right"){F+=44;E=-1}var D=new movieClipClass({"img":staticUrl+"img/battle/attackanim.png","width":110,"height":145,"x":F,"y":G,"scaleX":E,"loop":false,"endDestory":true,"zindex":100,"frames":[{rect:[0,0],label:"run",interval:60},{rect:[110,0],interval:60},{rect:[220,0],interval:60},{rect:[330,0],interval:60},{rect:[440,0],stop:1,interval:60},]});stage.append(D.obj);D.play();D=null};Boss.prototype.showShanbi=function(){if(this.team=="left"){var B=battle_pos[this.team][this.pos]["x"]+20;var C=battle_pos[this.team][this.pos]["y"]-120}else{var B=battle_pos[this.team][this.pos]["x"]-130;var C=battle_pos[this.team][this.pos]["y"]-170}var A=$('<div class="battle_shanbi_down" style="top:'+C+"px;left:"+B+'px;z-index:20"></div>');stage.append(A);this.timeout.push(setTimeout(function(){xGame.doAnimate(A,"fadeOutDown","0.4s",function(){A.remove();A=null})},400));if(this.penetrateRound>0){this.penetrateRound=2;return false}this.penetrateRound=2;if(this.penetrate!=null){return false}var D=this.ini.shadow_x-20;var E=212;var F=100;this.penetrate=new movieClipClass({"img":ximg(staticUrl+"img/plugin/battle_penetrate_down_anim.png"),"width":150,"height":80,"x":D,"y":E,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:F},{rect:[150,0],interval:F},{rect:[300,0],interval:F},{rect:[450,0],interval:F},{rect:[0,80],interval:F},{rect:[150,80],interval:F},{rect:[300,80],interval:F},{rect:[450,80],interval:F},]});this.e.prepend(this.penetrate.obj);this.penetrate.play()};Boss.prototype.ladderpowerChange=function(B,F){var C=parseInt(this.bar_wrap.css("left"));var G=this.bar_wrap.width();if(this.team=="left"){var D=C+G}else{var D=C-90}var E=75;if(B=="down"){var A=$('<p class="powerchange_'+B+'" style="background:url('+xGame.drumdownurl(F)+") left center no-repeat;z-index:10;left:"+D+"px;bottom:"+E+'px"></p>')}else{var A=$('<p class="powerchange_'+B+'" style="background:url('+xGame.drumupurl(F)+") left center no-repeat;z-index:10;left:"+D+"px;bottom:"+E+'px"></p>')}this.e.append(A);this.timeout.push(setTimeout(function(){var H=B=="up"?"fadeOutUp":"fadeOutDown";xGame.doAnimate(A,H,"0.4s",function(){A.remove();A=null})},400))};Boss.prototype.allpowerChange=function(B,E,G){var C=parseInt(this.bar_wrap.css("left"));var F=this.bar_wrap.width();if(this.team=="left"){var D=C+F}else{var D=C-90}if(B=="down"){var A=$('<p class="powerchange_'+B+'" style="background:url('+xGame.drumdownurl(E)+") left center no-repeat;z-index:10;left:"+D+"px;bottom:"+G+'px"></p>')}else{var A=$('<p class="powerchange_'+B+'" style="background:url('+xGame.drumupurl(E)+") left center no-repeat;z-index:10;left:"+D+"px;bottom:"+G+'px"></p>')}this.e.append(A);this.timeout.push(setTimeout(function(){var H=B=="up"?"fadeOutUp":"fadeOutDown";xGame.doAnimate(A,H,"0.4s",function(){A.remove();A=null})},400))};Boss.prototype.jingmaiAtk=function(){var A=0;var B=0;var C=100;this.jingmaianim=new movieClipClass({"img":staticUrl+"img/plugin/battle_jingmai.png","width":200,"height":160,"x":A,"y":B,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:C},{rect:[200,0],interval:C},{rect:[400,0],interval:C},{rect:[600,0],interval:C},{rect:[800,0],interval:C},{rect:[0,160],interval:C},{rect:[200,160],interval:C},{rect:[400,160],interval:C},{rect:[600,160],interval:C},{rect:[800,160],interval:C},{rect:[0,320],interval:C},{rect:[200,320],interval:C},{rect:[400,320],interval:C},{rect:[600,320],interval:C},{rect:[800,320],interval:C},{rect:[0,480],interval:C},{rect:[200,480],interval:C},{rect:[400,480],interval:C},{rect:[600,480],interval:C},{rect:[800,480],interval:C},]});this.e.find(".battle_jingmai_attack").prepend(this.jingmaianim.obj);this.jingmaianim.play()};Boss.prototype.showjinduan=function(){var A=this.ini.shadow_x-20;var B=212;var C=100;this.jinduan=new movieClipClass({"img":ximg(staticUrl+"img/plugin/battle_kill_jinduan.png"),"width":150,"height":80,"x":A,"y":B,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:C},{rect:[150,0],interval:C},{rect:[300,0],interval:C},{rect:[450,0],interval:C},{rect:[0,80],interval:C},{rect:[150,80],interval:C},{rect:[300,80],interval:C},{rect:[450,80],interval:C},]});this.e.prepend(this.jinduan.obj);this.jinduan.play()};Boss.prototype.hidejinduan=function(){if(this.jinduan!=null){this.jinduan.destory();this.jinduan=null}};Boss.prototype.showmingyan=function(){var A=this.ini.shadow_x-100;var B=50;var C=100;this.mingyan=new movieClipClass({"img":ximg(staticUrl+"img/plugin/battle_kill_mingyan.png"),"width":315,"height":253,"x":A,"y":B,"loop":true,"endDestory":false,"frames":[{rect:[0,0],interval:C},{rect:[315,0],interval:C},{rect:[630,0],interval:C},{rect:[945,0],interval:C},]});this.e.prepend(this.mingyan.obj);this.mingyan.play()};Boss.prototype.hidemingyan=function(){if(this.mingyan!=null){this.mingyan.destory();this.mingyan=null}};Boss.prototype.showEnergy=function(){this.e.find(".battle_energy_attack").attr("class","battle_energy_attack sweep")};Boss.prototype.hideEnergy=function(){this.e.find(".battle_energy_attack").attr("class","battle_energy_attack")};Boss.prototype.showMark=function(){if(this.markDom!=null){return false}var C=this.bar_wrap.width();var A=this.ini.bar_wrap_x+C/2-20;var B=-20;this.markDom=$('<p class="mark_wrap" style="left:'+A+"px;top:"+B+'px"></p>');this.e.append(this.markDom)};Boss.prototype.hideMark=function(){if(this.markDom!=null){var A=this;this.markDom.remove();A.markDom=null;A=null}};Boss.prototype.showConfusion=function(){if(this.confusionDom!=null){return false}var C=this.bar_wrap.width();var A=this.ini.bar_wrap_x+C/2-20;var B=-20;this.confusionDom=$('<p class="confusion_wrap" style="left:'+A+"px;top:"+B+'px"></p>');this.e.append(this.confusionDom)};Boss.prototype.hideConfusion=function(){if(this.confusionDom!=null){var A=this;this.confusionDom.remove();A.confusionDom=null;A=null}};Boss.prototype.lierianima=function(){var B=this.ini.bar_wrap_x-55;var C=100;var A=new movieClipClass({"img":staticUrl+"img/battle/battle_lieri_bomb.png","width":180,"height":177,"x":B,"y":C,"scaleX":1,"loop":false,"endDestory":true,"zindex":100,"frames":[{rect:[0,0],label:"run",interval:100},{rect:[180,0],interval:100},{rect:[180*2,0],interval:100},{rect:[180*3,0],interval:100},{rect:[180*4,0],interval:100},{rect:[0,177],interval:100},{rect:[180,177],interval:60},{rect:[180*2,177],interval:100},{rect:[180*3,177],interval:100},{rect:[180*4,177],interval:100},{rect:[0,354],interval:100},{rect:[180,354],interval:100},{rect:[180*2,354],stop:1,interval:100},]});this.e.append(A.obj);A.play();A=null};Boss.prototype.leitinganima=function(){var B=this.ini.bar_wrap_x-124;var C=-50;var A=new movieClipClass({"img":staticUrl+"img/battle/battle_leiting_bomb.png","width":318,"height":363,"x":B,"y":C,"scaleX":1,"loop":false,"endDestory":true,"zindex":100,"frames":[{rect:[0,0],label:"run",interval:100},{rect:[319,0],interval:100},{rect:[319*2,0],interval:100},{rect:[319*3,0],interval:100},{rect:[319*4,0],interval:100},{rect:[319*5,0],stop:1,interval:100},]});this.e.append(A.obj);A.play();A=null};Boss.prototype.showMonster=function(C){if(this.MonsterDom!=null){return false}var A=this.ini.bar_wrap_x-25;var B=150;this.MonsterDom=$('<p class="monster_wrap '+C+'" style="left:'+A+"px;top:"+B+'px"></p>');this.e.append(this.MonsterDom)};Boss.prototype.hideMonster=function(){if(this.MonsterDom!=null){var A=this;this.MonsterDom.remove();A.MonsterDom=null;A=null}};